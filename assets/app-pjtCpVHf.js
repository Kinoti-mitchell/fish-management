import{t as ar,c as rr,r as c,j as e,S as ka,a as Zt,O as Xt,C as ea,b as Ca,X as Xs,P as Da,R as za,T as Oa,d as Fa,e as ir,F as nr,f as sa,g as ee,h as lr,i as Te,M as or,L as ma,A as qs,k as us,l as wt,U as Ts,m as Ws,n as bt,o as ks,p as Vs,q as Ls,W as Fs,H as Ks,B as Ft,s as Wt,u as ts,v as xa,Z as ta,G as cr,w as dr,x as mr,E as xr,y as rs,z as Pa,D as xs,I as Qe,J as hr,K as gr,N as ur,Q as pr,V as fr,Y as qe,_ as Qt,$ as Ps,a0 as ns,a1 as aa,a2 as Ze,a3 as gs,a4 as Cs,a5 as Ns,a6 as Hs,a7 as As,a8 as br,a9 as ra,aa as yt,ab as Ea,ac as jr,ad as yr,ae as vr,af as Gs,ag as Nr,ah as _r,ai as wr,aj as Sr,ak as kr,al as Cr,am as dt,an as Dr,ao as zr,ap as Nt,aq as Or,ar as Fr,as as Pt,at as Ds,au as $s,av as et,aw as mt,ax as xt,ay as Bs,az as ia,aA as nt,aB as Pr,aC as Er,aD as Ys,aE as ut,aF as Ir,aG as Ia,aH as na,aI as _t,aJ as ha,aK as Mt,aL as Et,aM as ga,aN as qr,aO as Tr,aP as Ar,aQ as $r,aR as Rr,aS as Lr,aT as Wr,aU as Mr,aV as Ur,aW as Vr,aX as Br,aY as kt,aZ as pt,a_ as Kr,a$ as Ct,b0 as Dt,b1 as zt,b2 as ft,b3 as Gr,b4 as Qr,b5 as Hr,b6 as Yr,b7 as ua,b8 as Jr,b9 as pa,ba as Zr,bb as Xr,bc as ei,bd as si,be as ti,bf as ai,bg as ri,bh as At,bi as Ht,bj as tt,bk as ii,bl as fa,bm as ni,bn as li,bo as ba,bp as oi,bq as ci,br as ja,bs as di}from"./vendor-DLLmvrOi.js";const mi="modulepreload",xi=function(a){return"/fish-management/"+a},ya={},ps=function(t,s,r){let l=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const x=document.querySelector("meta[property=csp-nonce]"),m=x?.nonce||x?.getAttribute("nonce");l=Promise.allSettled(s.map(g=>{if(g=xi(g),g in ya)return;ya[g]=!0;const f=g.endsWith(".css"),n=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${n}`))return;const S=document.createElement("link");if(S.rel=f?"stylesheet":mi,f||(S.as="script"),S.crossOrigin="",S.href=g,m&&S.setAttribute("nonce",m),document.head.appendChild(S),f)return new Promise((T,V)=>{S.addEventListener("load",T),S.addEventListener("error",()=>V(new Error(`Unable to preload CSS for ${g}`)))})}))}function d(x){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=x,window.dispatchEvent(m),!m.defaultPrevented)throw x}return l.then(x=>{for(const m of x||[])m.status==="rejected"&&d(m.reason);return t().catch(d)})};function Ee(...a){return ar(rr(a))}const Yt=Zt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),k=c.forwardRef(({className:a,variant:t,size:s,asChild:r=!1,...l},d)=>{const x=r?ka:"button";return e.jsx(x,{"data-slot":"button",className:Ee(Yt({variant:t,size:s,className:a})),ref:d,...l})});k.displayName="Button";function hi({...a}){return e.jsx(za,{"data-slot":"sheet",...a})}function gi({...a}){return e.jsx(Oa,{"data-slot":"sheet-trigger",...a})}function ui({...a}){return e.jsx(Da,{"data-slot":"sheet-portal",...a})}const qa=c.forwardRef(({className:a,...t},s)=>e.jsx(Xt,{ref:s,"data-slot":"sheet-overlay",className:Ee("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",a),...t}));qa.displayName=Xt.displayName;const Ta=c.forwardRef(({className:a,children:t,side:s="right",...r},l)=>e.jsxs(ui,{children:[e.jsx(qa,{}),e.jsxs(ea,{ref:l,"data-slot":"sheet-content",className:Ee("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",s==="right"&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",s==="left"&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",s==="top"&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",s==="bottom"&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",a),...r,children:[t,e.jsxs(Ca,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[e.jsx(Xs,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ta.displayName=ea.displayName;function pi({className:a,...t}){return e.jsx(Fa,{"data-slot":"sheet-title",className:Ee("text-foreground font-semibold",a),...t})}function va({className:a,...t}){return e.jsx(ir,{"data-slot":"avatar",className:Ee("relative flex size-10 shrink-0 overflow-hidden rounded-full",a),...t})}function Na({className:a,...t}){return e.jsx(nr,{"data-slot":"avatar-fallback",className:Ee("bg-muted flex size-full items-center justify-center rounded-full",a),...t})}const fi=Zt("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function se({className:a,variant:t,asChild:s=!1,...r}){const l=s?ka:"span";return e.jsx(l,{"data-slot":"badge",className:Ee(fi({variant:t}),a),...r})}const la="https://pgpazwlejhysxabtkifz.supabase.co",Aa="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBncGF6d2xlamh5c3hhYnRraWZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4NjE0ODksImV4cCI6MjA2OTQzNzQ4OX0.VZjBmh5647fzGgfW8ttNMUirKRXIg1hj0X8pG0dhjD0";console.log("Supabase URL:",la);console.log("Supabase Key present:",!0);const j=sa(la,Aa,{auth:{autoRefreshToken:!1,persistSession:!1,detectSessionInUrl:!1},realtime:{params:{eventsPerSecond:10}}}),bi=a=>sa(la,Aa,{auth:{autoRefreshToken:!1,persistSession:!1,detectSessionInUrl:!1},global:{headers:{"X-User-ID":a,"X-Auth-Type":"custom"}}}),Ut=a=>a?bi(a):j,Ne=(a,t)=>{if(console.error(`Supabase ${t} error:`,a),a&&typeof a=="object"){if(a.code==="PGRST116")return"No data found";if(a.code==="23505")return"This record already exists";if(a.code==="23503")return"Referenced record not found";if(a.message&&typeof a.message=="string"&&a.message.includes("JWT"))return"Authentication error. Please log in again.";if(a.message&&typeof a.message=="string")return a.message}return"An unexpected error occurred"},ie=async(a,t=3,s=1e3)=>{let r;for(let l=1;l<=t;l++)try{return await a()}catch(d){if(r=d,l===t)throw d;if(d?.message?.includes("fetch")||d?.status>=500||d?.code==="NETWORK_ERROR")console.warn(`Attempt ${l} failed, retrying in ${s}ms...`),await new Promise(x=>setTimeout(x,s)),s*=2;else throw d}throw r},ji={async getProfile(a){try{const{data:t,error:s}=await ie(async()=>await j.from("profiles").select("*").eq("id",a).single());if(s)throw s;return t}catch(t){throw new Error(Ne(t,"fetching user profile"))}},async createProfile(a){try{const{data:t,error:s}=await ie(async()=>await j.from("profiles").insert([a]).select().single());if(s)throw s;return t}catch(t){throw new Error(Ne(t,"creating user profile"))}},async updateProfile(a,t){try{const{data:s,error:r}=await ie(async()=>await j.from("profiles").update({...t,updated_at:new Date().toISOString()}).eq("id",a).select().single());if(r)throw r;return s}catch(s){throw new Error(Ne(s,"updating user profile"))}},async updateLastLogin(a){try{const{data:t,error:s}=await ie(async()=>await j.from("profiles").update({last_login:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",a).select().single());if(s)throw s;return t}catch(t){throw new Error(Ne(t,"updating last login"))}},async getAllProfiles(){try{const{data:a,error:t}=await ie(async()=>await j.from("profiles").select("*").order("created_at",{ascending:!1}));if(t)throw t;return a||[]}catch(a){throw new Error(Ne(a,"fetching all profiles"))}}},yi={async getOutlets(){try{const{data:a,error:t}=await ie(async()=>await j.from("outlets").select("*").order("created_at",{ascending:!1}));if(t)throw t;return a||[]}catch(a){throw new Error(Ne(a,"fetching outlets"))}},async createOutlet(a){try{const{data:t,error:s}=await ie(async()=>await j.from("outlets").insert([a]).select().single());if(s)throw s;return t}catch(t){throw new Error(Ne(t,"creating outlet"))}},async updateOutlet(a,t){try{const{data:s,error:r}=await ie(async()=>await j.from("outlets").update({...t,updated_at:new Date().toISOString()}).eq("id",a).select().single());if(r)throw r;return s}catch(s){throw new Error(Ne(s,"updating outlet"))}}},_a={async getOutletOrders(){try{const{data:a,error:t}=await ie(async()=>await j.from("outlet_orders").select(`
            *,
            outlet:outlets(name, location, phone, manager_name, status)
          `).order("order_date",{ascending:!1}));if(t)throw t;return a||[]}catch(a){throw new Error(Ne(a,"fetching outlet orders"))}},async createOutletOrder(a){try{const{data:t,error:s}=await ie(async()=>await j.from("outlet_orders").insert([a]).select().single());if(s)throw s;return t}catch(t){throw new Error(Ne(t,"creating outlet order"))}},async updateOutletOrder(a,t){try{const{data:s,error:r}=await ie(async()=>await j.from("outlet_orders").update({...t,updated_at:new Date().toISOString()}).eq("id",a).select().single());if(r)throw r;return s}catch(s){throw new Error(Ne(s,"updating outlet order"))}}},vi={async getDashboardStats(){try{const{count:a}=await j.from("warehouse_entries").select("*",{count:"exact",head:!0}),{count:t}=await j.from("processing_records").select("*",{count:"exact",head:!0}),{data:s}=await j.from("processing_records").select("ready_for_dispatch_count").not("ready_for_dispatch_count","is",null),r=s?.reduce((V,u)=>V+(u.ready_for_dispatch_count||0),0)||0,{data:l}=await j.from("fish_inventory").select("weight"),d=l?.reduce((V,u)=>V+(u.weight||0),0)||0,{count:x}=await j.from("outlet_orders").select("*",{count:"exact",head:!0}),{count:m}=await j.from("dispatch_records").select("*",{count:"exact",head:!0}).in("status",["scheduled","pending"]),{data:g}=await j.from("warehouse_entries").select("total_weight"),f=g?.reduce((V,u)=>V+(u.total_weight||0),0)||0,{data:n}=await j.from("warehouse_entries").select("temperature").not("temperature","is",null);console.log("Temperature data found:",n?.length||0,"records");const S=n&&n.length>0?n.reduce((V,u)=>V+(u.temperature||0),0)/n.length:22,T=d>0?f/d:.5;return{warehouseEntries:a||0,processingQueue:t||0,readyForDispatch:r,totalStock:d,outletOrders:x||0,pendingDispatches:m||0,totalWeight:f,avgTemperature:Number(S.toFixed(2)),avgFishSize:Number(T.toFixed(2))}}catch(a){return console.error("Dashboard service error:",a),{warehouseEntries:0,processingQueue:0,readyForDispatch:0,totalStock:0,outletOrders:0,pendingDispatches:0,totalWeight:0,avgTemperature:22,avgFishSize:.5}}},async getEnhancedDashboardStats(){try{const[a,t,s,r,l,d,x,m]=await Promise.all([this.getWarehouseStats(),this.getProcessingStats(),this.getInventoryStats(),this.getOrderStats(),this.getDispatchStats(),this.getFarmerStats(),this.getOutletStats(),this.getRecentActivity()]);return{...a,...t,...s,...r,...l,...d,...x,recentActivity:m}}catch(a){throw console.error("Enhanced dashboard service error:",a),new Error(Ne(a,"fetching enhanced dashboard stats"))}},async getWarehouseStats(){try{const{data:a}=await j.from("warehouse_entries").select("total_weight, temperature, entry_date").order("entry_date",{ascending:!1});console.log("Warehouse entries fetched:",a?.length||0,"records");const t=a?.reduce((x,m)=>x+(m.total_weight||0),0)||0,s=a?.filter(x=>x.temperature!==null&&x.temperature!==void 0)||[];console.log("Entries with temperature data:",s.length);const r=s.length>0?s.reduce((x,m)=>x+m.temperature,0)/s.length:22,l=new Date;l.setDate(l.getDate()-7);const d=a?.filter(x=>new Date(x.entry_date)>=l)||[];return{totalWarehouseEntries:a?.length||0,totalWeight:t,avgTemperature:Number(r.toFixed(2)),recentEntriesCount:d.length,recentWeight:d.reduce((x,m)=>x+(m.total_weight||0),0)}}catch(a){return console.error("Warehouse stats error:",a),{totalWarehouseEntries:0,totalWeight:0,avgTemperature:22,recentEntriesCount:0,recentWeight:0}}},async getProcessingStats(){try{const{data:a}=await j.from("processing_records").select("ready_for_dispatch_count, processing_date, post_processing_weight").order("processing_date",{ascending:!1}),t=a?.reduce((d,x)=>d+(x.post_processing_weight||0),0)||0,s=a?.reduce((d,x)=>d+(x.post_processing_weight||0),0)||0,r=new Date;r.setDate(r.getDate()-7);const l=a?.filter(d=>new Date(d.processing_date)>=r)||[];return{totalProcessingRecords:a?.length||0,totalReadyForDispatch:Math.round(t),totalProcessedWeight:s,recentProcessingCount:l.length,recentProcessedWeight:l.reduce((d,x)=>d+(x.post_processing_weight||0),0)}}catch(a){return console.error("Processing stats error:",a),{totalProcessingRecords:0,totalReadyForDispatch:0,totalProcessedWeight:0,recentProcessingCount:0,recentProcessedWeight:0}}},async getInventoryStats(){try{console.log("Fetching inventory stats from sorting_results table (same as inventory components)...");const{data:a,error:t}=await j.from("sorting_results").select(`
          id,
          size_class,
          total_pieces,
          total_weight_grams,
          storage_location_id,
          sorting_batch_id,
          sorting_batch:sorting_batches(
            id,
            batch_number,
            status,
            created_at
          )
        `).eq("sorting_batch.status","completed").not("storage_location_id","is",null);if(t)throw console.error("Error fetching inventory:",t),t;console.log("Inventory data fetched from sorting_results:",a?.length||0,"records"),console.log("Sample inventory record:",a?.[0]);const s=a?.reduce((m,g)=>m+(g.total_pieces||0),0)||0,r=a?.reduce((m,g)=>m+(g.total_weight_grams||0),0)/1e3||0,l=a?.length||0,d=s>0?r/s:.5;console.log("Inventory stats calculated:",{totalInventoryWeight:r,totalInventoryPieces:s,totalInventoryItems:l,avgFishSize:d});const x=a?.reduce((m,g)=>{const f=`Size ${g.size_class}`,n=(g.total_weight_grams||0)/1e3;return m[f]=(m[f]||0)+n,m},{})||{};return{totalInventoryWeight:r,totalInventoryItems:Math.round(r),avgFishSize:Number(d.toFixed(2)),gradeDistribution:x}}catch(a){return console.error("Inventory stats error:",a),{totalInventoryWeight:0,totalInventoryItems:0,avgFishSize:.5,gradeDistribution:{}}}},async getOrderStats(){try{const{data:a}=await j.from("outlet_orders").select("total_value, status, order_date, requested_quantity").order("order_date",{ascending:!1}),t=a?.reduce((n,S)=>n+(S.total_value||0),0)||0,s=a?.length||0,r=a?.reduce((n,S)=>n+(S.requested_quantity||0),0)||0,l=a?.filter(n=>n.status==="pending").length||0,d=a?.filter(n=>n.status==="confirmed").length||0,x=a?.filter(n=>n.status==="dispatched").length||0,m={pending:l,confirmed:d,dispatched:x},g=new Date;g.setDate(g.getDate()-7);const f=a?.filter(n=>new Date(n.order_date)>=g)||[];return console.log("Order stats calculated (same as OrderManagement component):",{totalOrders:s,pendingOrders:l,confirmedOrders:d,dispatchedOrders:x,totalOrderValue:t,totalQuantity:r}),{totalOrders:s,totalOrderValue:t,statusDistribution:m,recentOrdersCount:f.length,recentOrderValue:f.reduce((n,S)=>n+(S.total_value||0),0)}}catch(a){return console.error("Order stats error:",a),{totalOrders:0,totalOrderValue:0,statusDistribution:{},recentOrdersCount:0,recentOrderValue:0}}},async getDispatchStats(){try{const{data:a}=await j.from("outlet_orders").select("id, status, total_value, order_date").eq("status","confirmed").order("order_date",{ascending:!1}),{data:t}=await j.from("outlet_orders").select("id, status, total_value, dispatch_date").eq("status","dispatched").order("dispatch_date",{ascending:!1}),{data:s}=await j.from("dispatch_records").select("total_weight, status").order("dispatch_date",{ascending:!1}),r=(t?.length||0)+(s?.length||0),l=s?.reduce((x,m)=>x+(m.total_weight||0),0)||0,d=a?.length||0;return console.log("Dispatch stats calculated:",{confirmedOrders:a?.length||0,dispatchedOrders:t?.length||0,dispatchRecords:s?.length||0,pendingDispatchesCount:d,totalDispatchedWeight:l}),{totalDispatches:r,totalDispatchedWeight:l,pendingDispatchesCount:d}}catch(a){return console.error("Dispatch stats error:",a),{totalDispatches:0,totalDispatchedWeight:0,pendingDispatchesCount:0}}},async getFarmerStats(){try{const{data:a}=await j.from("farmers").select("id, name, location"),{data:t}=await j.from("warehouse_entries").select("farmer_id, total_weight, entry_date").order("entry_date",{ascending:!1}),s=a?.length||0,r=t?.reduce((d,x)=>d+(x.total_weight||0),0)||0,l=t?.reduce((d,x)=>{const m=x.farmer_id;return d[m]||(d[m]={weight:0,entries:0}),d[m].weight+=x.total_weight||0,d[m].entries+=1,d},{})||{};return{totalFarmers:s,totalFarmerWeight:r,farmerPerformance:l}}catch(a){return console.error("Farmer stats error:",a),{totalFarmers:0,totalFarmerWeight:0,farmerPerformance:{}}}},async getOutletStats(){try{const{data:a}=await j.from("outlets").select("id, name, location, status"),{data:t}=await j.from("outlet_orders").select("outlet_id, total_value, order_date").order("order_date",{ascending:!1}),s=a?.length||0,r=t?.reduce((d,x)=>d+(x.total_value||0),0)||0,l=a?.filter(d=>d.status==="active")||[];return{totalOutlets:s,totalOutletValue:r,activeOutletsCount:l.length}}catch(a){return console.error("Outlet stats error:",a),{totalOutlets:0,totalOutletValue:0,activeOutletsCount:0}}},async getRecentActivity(){try{const{data:a}=await j.from("warehouse_entries").select("id, entry_date, total_weight, created_at").order("created_at",{ascending:!1}).limit(10),{data:t}=await j.from("processing_records").select("id, processing_date, ready_for_dispatch_count, created_at").order("created_at",{ascending:!1}).limit(10),{data:s}=await j.from("outlet_orders").select("id, order_date, status, total_value, created_at").order("created_at",{ascending:!1}).limit(10),r=[];return a&&a.forEach(l=>{r.push({id:l.id,type:"entry",action:`New warehouse entry: ${l.total_weight}kg`,details:`Entry date: ${l.entry_date}`,created_at:l.created_at})}),t&&t.forEach(l=>{r.push({id:l.id,type:"processing",action:`Processing completed: ${l.ready_for_dispatch_count} fish ready`,details:`Processing date: ${l.processing_date}`,created_at:l.created_at})}),s&&s.forEach(l=>{r.push({id:l.id,type:"order",action:`New outlet order: KES ${l.total_value}`,details:`Status: ${l.status}`,created_at:l.created_at})}),r.sort((l,d)=>new Date(d.created_at).getTime()-new Date(l.created_at).getTime()).slice(0,15)}catch(a){return console.error("Error fetching recent activity:",a),[]}}},$a=c.createContext(void 0),Js=()=>{const a=c.useContext($a);if(a===void 0)throw new Error("useAuth must be used within an AuthProvider");return a},Ni=({children:a})=>{const[t,s]=c.useState(null),[r,l]=c.useState(null),[d,x]=c.useState(null),[m,g]=c.useState(!0),[f,n]=c.useState(!1),S=async(K,z)=>(z?.toLowerCase(),{id:K,email:z||"",first_name:"User",last_name:"Name",role:"viewer",phone:"",is_active:!0,last_login:new Date().toISOString(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),T=async(K,z)=>{try{g(!0);const{data:ae,error:re}=await j.from("profiles").select("*").eq("email",K.toLowerCase().trim()).eq("is_active",!0).single();if(re||!ae)return g(!1),re&&re.code==="PGRST116"?{success:!1,error:"Email address not found. Please check your email or contact your administrator."}:{success:!1,error:"Email address not found. Please check your email or contact your administrator."};if(!await lr.compare(z,ae.password_hash))return g(!1),{success:!1,error:"Incorrect password. Please try again or contact your administrator to reset your password."};const le={id:ae.id,email:ae.email,first_name:ae.first_name,last_name:ae.last_name,role:ae.role,phone:ae.phone,is_active:ae.is_active,last_login:ae.last_login,created_at:ae.created_at,updated_at:ae.updated_at};s(le),sessionStorage.setItem("currentUser",JSON.stringify(le));const W={id:le.id,email:le.email,user_metadata:{first_name:le.first_name,last_name:le.last_name,role:le.role,phone:le.phone}};l(W);const G={access_token:"demo-token-"+le.id,refresh_token:"demo-refresh-"+le.id,expires_in:3600,token_type:"bearer",user:W};x(G);try{const{error:J}=await j.from("audit_logs").insert([{user_id:le.id,action:"LOGIN",table_name:"auth",record_id:le.id,old_values:null,new_values:JSON.stringify({login_time:new Date().toISOString()}),ip_address:null,user_agent:navigator.userAgent,created_at:new Date().toISOString()}]);J&&console.warn("Failed to log login audit event:",J)}catch(J){console.warn("Failed to log login audit event:",J)}return ee.success(`Welcome back, ${le.first_name}!`),g(!1),{success:!0}}catch(ae){return g(!1),{success:!1,error:ae.message||"An unexpected error occurred"}}},V=async()=>{try{if(t)try{const{error:K}=await j.from("audit_logs").insert([{user_id:t.id,action:"LOGOUT",table_name:"auth",record_id:t.id,old_values:null,new_values:JSON.stringify({logout_time:new Date().toISOString()}),ip_address:null,user_agent:navigator.userAgent,created_at:new Date().toISOString()}]);K&&console.warn("Failed to log logout audit event:",K)}catch(K){console.warn("Failed to log logout audit event:",K)}sessionStorage.removeItem("currentUser"),s(null),l(null),x(null),ee.success("Signed out successfully")}catch(K){console.error("Sign out error:",K)}},u=async()=>{if(r){const K=await S(r.id,r.email||void 0);s(K)}},v=async K=>{try{if(!t)return{success:!1,error:"No user logged in"};const z=await ji.updateProfile(t.id,K);return s({...t,...K,updated_at:new Date().toISOString()}),ee.success("Profile updated successfully"),{success:!0}}catch(z){return ee.error("Failed to update profile"),{success:!1,error:z.message||"Failed to update profile"}}},b=K=>t?.role===K,M=K=>t?K.includes(t.role):!1,R=()=>t?.role==="admin",X=(K,z="read")=>{if(!t||!t.is_active)return!1;const ae=t.role;if(ae==="admin")return!0;const O={users:{read:["admin"],create:["admin"],update:["admin"],delete:["admin"]},audit_logs:{read:["admin","processor"]},processing_records:{read:["admin","processor","warehouse_manager"],create:["admin","processor"],update:["admin","processor"],delete:["admin"]},outlet_orders:{read:["admin","outlet_manager","processor"],create:["admin","outlet_manager"],update:["admin","outlet_manager"],delete:["admin"]},warehouse_entries:{read:["admin","warehouse_manager","processor"],create:["admin","warehouse_manager"],update:["admin","warehouse_manager"],delete:["admin"]},dispatch_records:{read:["admin","processor","outlet_manager","warehouse_manager","viewer"],create:["admin","processor","warehouse_manager"],update:["admin","processor","warehouse_manager"],delete:["admin"]},fish_inventory:{read:["admin","processor","outlet_manager","warehouse_manager","viewer"],create:["admin","processor","warehouse_manager"],update:["admin","processor","warehouse_manager"],delete:["admin"]}}[K];if(!O)return!1;const le=O[z];return le?le.includes(ae):!1};c.useEffect(()=>{g(!1)},[]);const Z={user:t,supabaseUser:r,session:d,loading:m,signIn:T,signOut:V,hasRole:b,hasAnyRole:M,isAdmin:R,canAccess:X,refreshUser:u,updateUserProfile:v};return e.jsx($a.Provider,{value:Z,children:a})},Vt=a=>["read:basic"];function $t(){const{user:a,loading:t}=Js(),[s,r]=c.useState(null),[l,d]=c.useState([]),[x,m]=c.useState(!0);c.useEffect(()=>{if(a){const K=Vt(a.role);d(K),g(a.role)}else r(null),d([]),m(!1)},[a]),c.useEffect(()=>{const K=setTimeout(()=>{if(x&&(console.warn("Permissions loading timeout, using default permissions"),m(!1),a?.role)){const z=Vt(a.role);d(z)}},5e3);return()=>clearTimeout(K)},[x,a]);const g=async K=>{try{const{data:z,error:ae}=await j.from("user_roles").select("*").eq("name",K).eq("is_active",!0).single();if(ae){console.warn("Error fetching user role, using default permissions:",ae);const O=Vt(K);r({id:"default",name:K,display_name:K.charAt(0).toUpperCase()+K.slice(1),description:`Default ${K} role`,permissions:O,icon:"user",color:"blue",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),d(O),m(!1);return}r(z);let re=[];try{Array.isArray(z.permissions)?re=z.permissions:typeof z.permissions=="string"?re=JSON.parse(z.permissions):re=[]}catch(O){console.warn("Error parsing permissions, using empty array:",O),re=[]}d(re),m(!1)}catch(z){console.error("Error in fetchUserRole:",z),r(null),d([]),m(!1)}},f=K=>{if(!l.length)return!1;if(l.includes("*")||l.includes("admin:*")||l.includes(K))return!0;const[z,ae]=K.split(":");return!!(z&&ae&&(l.includes(`${z}:*`)||l.includes(`*:${ae}`)))},n=K=>K.some(z=>f(z)),S=K=>K.every(z=>f(z)),T=K=>{if(x)return K==="dashboard";if(u())return!0;const ae={dashboard:["read:basic"],"warehouse-entry":["write:inventory"],processing:["write:processing"],sorting:["write:processing"],inventory:["read:inventory"],"outlet-orders":["read:sales"],dispatch:["write:logistics"],"outlet-receiving":["read:sales"],reports:["read:basic"],"user-management":["admin:*","write:users"]}[K]||[];return n(ae)},V=(K,z)=>{const ae=`${K}:${z}`;return f(ae)},u=()=>l.includes("*")||l.includes("admin:*")||l.includes("admin_access");return{user:a,userProfile:a,userRole:s,permissions:l,loading:x||t,hasPermission:f,hasAnyPermission:n,hasAllPermissions:S,canAccess:T,canPerform:V,isAdmin:u,isManager:()=>l.includes("*")||l.includes("admin:*")||l.includes("manage_users")||l.includes("manage_roles")||l.includes("system_settings"),canManageUsers:()=>u()||f("write:users"),canManageRoles:()=>u()||f("write:roles"),canViewAuditLogs:()=>u()||f("read:audit"),canExportData:()=>u()||f("export:data"),canModifySystemSettings:()=>u()||f("write:system")}}class bs extends c.Component{state={hasError:!1};static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error("ErrorBoundary caught an error:",t,s)}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Something went wrong"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"The application encountered an error. Please refresh the page."}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Refresh Page"})}),this.state.error&&e.jsxs("details",{className:"mt-4 text-left",children:[e.jsx("summary",{className:"text-sm text-gray-600 cursor-pointer",children:"Error Details"}),e.jsx("pre",{className:"mt-2 text-xs text-gray-500 bg-gray-100 p-2 rounded overflow-auto",children:this.state.error.toString()})]})]})]})}):this.props.children}}function _i({currentSection:a,onNavigate:t,onLogout:s}){const[r,l]=c.useState(!1),{userProfile:d,canAccess:x,isAdmin:m,loading:g,permissions:f}=$t(),n=u=>({Home:Ks,Warehouse:Fs,Scissors:Ls,Package:Te,ShoppingCart:Vs,Truck:ks,CheckSquare:bt,BarChart3:Ws,Users:Ts,Filter:wt,Trash2:us,ArrowRight:qs})[u]||Ks,S=[{title:"Overview",items:[{id:"dashboard",label:"Dashboard",icon:"Home",permissions:["read:basic"]}]},{title:"Warehouse Operations",items:[{id:"warehouse-entry",label:"Fish Entry",icon:"Warehouse",permissions:["write:inventory"]},{id:"processing",label:"Processing",icon:"Scissors",permissions:["write:processing"]},{id:"sorting",label:"Sorting",icon:"Filter",permissions:["write:processing"]},{id:"inventory",label:"Inventory",icon:"Package",permissions:["read:inventory"]},{id:"transfers",label:"Transfers",icon:"ArrowRight",permissions:["read:inventory"]},{id:"disposal",label:"Disposal",icon:"Trash2",permissions:["write:disposal"]}]},{title:"Outlet Sales",items:[{id:"outlet-orders",label:"Outlet Orders",icon:"ShoppingCart",permissions:["read:sales"]},{id:"dispatch",label:"Dispatch",icon:"Truck",permissions:["write:logistics"]},{id:"outlet-receiving",label:"Outlet Receiving",icon:"CheckSquare",permissions:["read:sales"]}]},{title:"Analytics",items:[{id:"reports",label:"Reports & Analytics",icon:"BarChart3",permissions:["read:basic"]}]},{title:"System Administration",items:[{id:"user-management",label:"User Management",icon:"Users",permissions:["admin:*","write:users"]}]}],T=()=>{try{if(g&&d?.role==="admin")return e.jsx("div",{className:"flex flex-col h-full overflow-y-auto overflow-x-hidden",children:e.jsx("nav",{className:"space-y-4 flex-1",children:S.map((v,b)=>e.jsxs("div",{children:[e.jsx("h3",{className:"px-3 text-xs font-semibold text-muted-foreground uppercase tracking-wide mb-2",children:v.title}),e.jsx("div",{className:"space-y-0.5",children:v.items.map(M=>{const R=n(M.icon),X=a===M.id;return e.jsxs(k,{variant:X?"default":"ghost",className:`w-full justify-start gap-3 h-10 text-left font-medium mx-2 text-sm px-3 overflow-hidden ${X?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted"}`,onClick:()=>{t(M.id),l(!1)},children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{className:"flex-1",children:M.label}),M.badge&&e.jsx(se,{variant:"secondary",className:`text-xs h-4 px-1.5 rounded-full ${X?"bg-primary-foreground/20 text-primary-foreground":""}`,children:M.badge})]},M.id)})})]},b))})});const u=S.map(v=>({...v,items:v.items.filter(b=>g?b.id==="dashboard":!b.permissions||m()?!0:x(b.id))})).filter(v=>v.items.length>0);return e.jsxs("div",{className:"flex flex-col h-full overflow-y-auto overflow-x-hidden",children:[e.jsx("nav",{className:"space-y-4 flex-1",children:u.map((v,b)=>e.jsxs("div",{children:[e.jsx("h3",{className:"px-3 text-xs font-semibold text-blue-700 uppercase tracking-wide mb-2",children:v.title}),e.jsx("div",{className:"space-y-0.5",children:v.items.map(M=>{const R=n(M.icon),X=a===M.id;return e.jsxs(k,{variant:X?"default":"ghost",className:`w-full justify-start gap-3 h-10 text-left font-medium mx-2 text-sm px-3 overflow-hidden ${X?"bg-blue-600 text-white shadow-md":"text-blue-800 hover:text-blue-900 hover:bg-blue-200"}`,onClick:()=>{t(M.id),l(!1)},children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{className:"flex-1",children:M.label}),M.badge&&e.jsx(se,{variant:"secondary",className:`text-xs h-4 px-1.5 rounded-full ${X?"bg-primary-foreground/20 text-primary-foreground":""}`,children:M.badge})]},M.id)})})]},b))}),e.jsxs("div",{className:"border-t border-blue-200 pt-3 space-y-2 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-blue-100 rounded-lg mx-1",children:[e.jsx(va,{className:"w-8 h-8",children:e.jsx(Na,{className:"bg-blue-600 text-white font-semibold text-xs",children:d?.first_name&&d?.last_name?`${d.first_name.charAt(0)}${d.last_name.charAt(0)}`:"RF"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-xs truncate text-blue-900",children:d?.first_name&&d?.last_name?`${d.first_name} ${d.last_name}`:"User"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-blue-600 truncate",children:d?.role?d.role.replace("_"," ").toUpperCase():"Rio Fish Farm"}),f&&f.length>0&&e.jsx(se,{variant:"outline",className:"text-xs bg-white text-blue-600 border-blue-200",children:f.includes("*")?"All":f.length})]})]})]}),e.jsxs(k,{variant:"ghost",className:"w-full justify-start gap-2 h-8 text-left font-medium text-red-600 hover:text-red-700 hover:bg-red-50 mx-1 text-sm",onClick:()=>{s(),l(!1)},children:[e.jsx(ma,{className:"w-4 h-4"}),"Logout"]})]})]})}catch(u){return console.error("Navigation error:",u),e.jsx(V,{})}},V=()=>e.jsxs("div",{className:"flex flex-col h-full overflow-y-auto overflow-x-hidden",children:[e.jsx("nav",{className:"space-y-4 flex-1",children:S.map((u,v)=>e.jsxs("div",{children:[e.jsx("h3",{className:"px-3 text-xs font-semibold text-muted-foreground uppercase tracking-wide mb-1.5 lg:mb-2",children:u.title}),e.jsx("div",{className:"space-y-0.5",children:u.items.map(b=>{const M=a===b.id;return renderNavItem(b,M)})})]},v))}),e.jsxs("div",{className:"border-t pt-3 space-y-2 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-muted/30 rounded-lg mx-1",children:[e.jsx(va,{className:"w-8 h-8",children:e.jsx(Na,{className:"bg-primary text-primary-foreground font-semibold text-xs",children:"RF"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-xs truncate",children:"User"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:"Rio Fish Farm"})]})]}),e.jsxs(k,{variant:"ghost",className:"w-full justify-start gap-2 h-8 text-left font-medium text-destructive hover:text-destructive hover:bg-destructive/10 mx-1 text-sm",onClick:()=>{s(),l(!1)},children:[e.jsx(ma,{className:"w-4 h-4"}),"Logout"]})]})]});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden md:flex md:w-72 bg-card border-r flex-col fixed left-0 top-0 h-screen z-50 overflow-x-hidden",children:[e.jsx("div",{className:"p-6 border-b bg-gradient-to-r from-slate-50 to-gray-50 flex-shrink-0",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-52 h-20",children:e.jsx("img",{src:"/fish-management/build/riofish-logo.png",alt:"Rio Fish Logo",className:"w-full h-full object-contain drop-shadow-sm",style:{imageRendering:"crisp-edges"},onError:u=>{console.log("Logo failed to load, trying fallback");const v=u.target;v.src="https://riofish.co.ke/wp-content/uploads/2024/01/riofish_logo_copy-removed-background-white.png"}})})})}),e.jsx("div",{className:"p-3 flex-1 flex flex-col overflow-hidden overflow-x-hidden bg-gradient-to-b from-blue-50 to-blue-100",children:g?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsx(bs,{children:e.jsx(T,{})})})]}),e.jsx("div",{className:"md:hidden fixed top-0 left-0 right-0 z-50 bg-card border-b",children:e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-primary rounded-lg",children:e.jsx(Te,{className:"w-4 h-4 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-sm",children:"RIO FISH FARM"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Kenya Operations"})]})]}),e.jsxs(hi,{open:r,onOpenChange:l,children:[e.jsx(gi,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"sm",children:e.jsx(or,{className:"w-4 h-4"})})}),e.jsxs(Ta,{side:"left",className:"w-72 p-0 overflow-x-hidden",children:[e.jsx(pi,{className:"sr-only",children:"Navigation Menu"}),e.jsx("div",{className:"p-6 border-b bg-gradient-to-r from-slate-50 to-gray-50 flex-shrink-0",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-52 h-20",children:e.jsx("img",{src:"/fish-management/build/riofish-logo.png",alt:"Rio Fish Logo",className:"w-full h-full object-contain drop-shadow-sm",style:{imageRendering:"crisp-edges"},onError:u=>{console.log("Logo failed to load, trying fallback");const v=u.target;v.src="https://riofish.co.ke/wp-content/uploads/2024/01/riofish_logo_copy-removed-background-white.png"}})})})}),e.jsx("div",{className:"p-3 h-[calc(100vh-100px)] overflow-hidden bg-gradient-to-b from-blue-50 to-blue-100",children:e.jsx(T,{})})]})]})]})})]})}function U({className:a,...t}){return e.jsx("div",{"data-slot":"card",className:Ee("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",a),...t})}function Fe({className:a,...t}){return e.jsx("div",{"data-slot":"card-header",className:Ee("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",a),...t})}function Pe({className:a,...t}){return e.jsx("h4",{"data-slot":"card-title",className:Ee("leading-none",a),...t})}function H({className:a,...t}){return e.jsx("div",{"data-slot":"card-content",className:Ee("px-6 [&:last-child]:pb-6",a),...t})}const wi="/fish-management/build/papo1.jpg";function _s(a){const[t,s]=c.useState(!1),r=()=>{s(!0)},{src:l,alt:d,style:x,className:m,...g}=a;return t?e.jsx("div",{className:`inline-block bg-gray-100 text-center align-middle ${m??""}`,style:x,children:e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx("img",{src:wi,alt:"Error loading image",...g,"data-original-url":l})})}):e.jsx("img",{src:l,alt:d,className:m,style:x,...g,onError:r})}const ht=({size:a="md",showText:t=!0,className:s=""})=>{const r={sm:"w-20 h-12",md:"w-28 h-16",lg:"w-40 h-24",xl:"w-48 h-32"},l={sm:"text-xs",md:"text-sm",lg:"text-lg",xl:"text-xl"};return e.jsxs("div",{className:`flex items-center gap-3 ${s}`,children:[e.jsx("div",{className:`${r[a]} flex-shrink-0`,children:e.jsx("img",{src:"/fish-management/build/riofish-logo.png",alt:"Rio Fish Logo",className:"w-full h-full object-contain",style:{imageRendering:"crisp-edges"},onError:d=>{console.log("Logo failed to load, trying fallback");const x=d.target;x.src="https://riofish.co.ke/wp-content/uploads/2024/01/riofish_logo_copy-removed-background-white.png"}})}),t&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h1",{className:`${l[a]} font-bold bg-gradient-to-r from-blue-900 to-blue-700 bg-clip-text text-transparent`,children:"RIO FISH FARM"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Kenya Operations"})]})]})};function Si({onGetStarted:a}){const[t,s]=c.useState(0),[r,l]=c.useState(0),[d,x]=c.useState(0),[m,g]=c.useState(0),[f,n]=c.useState(!1),S=["/fish-management/build/login-image.jpeg","/fish-management/build/fishpic.jpg","/fish-management/build/papo1.jpg","/fish-management/build/papo2.jpg","/fish-management/build/papo4.png"],T={womenFarmers:500,womenTraders:500,totalFarmers:2e3};c.useEffect(()=>{const b=setInterval(()=>{s(M=>M===S.length-1?0:M+1)},5e3);return()=>clearInterval(b)},[S.length]),c.useEffect(()=>{const b=(X,Z,K,z)=>{const ae=performance.now(),re=O=>{const le=O-ae,W=Math.min(le/K,1),G=1-Math.pow(1-W,4),J=Math.floor(X+(Z-X)*G);z(J),W<1&&requestAnimationFrame(re)};requestAnimationFrame(re)},M=new IntersectionObserver(X=>{X.forEach(Z=>{Z.isIntersecting&&!f&&(n(!0),setTimeout(()=>b(0,T.womenFarmers,2e3,l),500),setTimeout(()=>b(0,T.womenTraders,2e3,x),1e3),setTimeout(()=>b(0,T.totalFarmers,2e3,g),1500))})},{threshold:.3}),R=document.getElementById("impact-section");return R&&M.observe(R),()=>{R&&M.unobserve(R)}},[f,T]);const V=[{icon:ts,title:"Sustainable Aquaculture",description:"Promoting sustainable fish farming practices that protect Lake Victoria's ecosystem while ensuring food security."},{icon:Ts,title:"Women Empowerment",description:"Empowering women fish farmers and traders with economic opportunities and breaking down gender barriers in aquaculture."},{icon:xa,title:"Market Access",description:"Connecting smallholder farmers directly to markets through our innovative digital platform and aggregation system."},{icon:ta,title:"Technology Innovation",description:"Leveraging cutting-edge technology to optimize supply chains and implement smart farming tools for better yields."}],u=[{icon:xa,title:"No Poverty (SDG 1)",description:"Creating sustainable livelihoods and economic opportunities for women in the fishing industry."},{icon:Wt,title:"Zero Hunger (SDG 2)",description:"Promoting sustainable fishing practices to ensure food security and improved nutrition."},{icon:Ts,title:"Gender Equality (SDG 5)",description:"Empowering women in aquaculture through leadership opportunities and economic independence."},{icon:cr,title:"Climate Action (SDG 13)",description:"Implementing climate-resilient practices that protect marine ecosystems and reduce carbon emissions."}],v=[{name:"Tilapia",description:"Mild, sweet flavor with lean, white flesh. Perfect for grilling, baking, or frying.",image:"/fish-management/build/tilapia.jpg"},{name:"Nile Perch",description:"Succulent and tender meat with rich taste and firm texture for gourmet meals.",image:"/fish-management/build/papo2.jpg"},{name:"Smoked Fish",description:"Traditional smoking process that enhances flavor while preserving nutritional value.",image:"/fish-management/build/papo4.png"},{name:"Fish Sausages",description:"Artisan fish sausages crafted with locally sourced fish and perfectly seasoned pastry.",image:"/fish-management/build/saus.jpeg"}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-50",children:[e.jsxs("div",{className:"relative overflow-hidden h-screen",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx(_s,{src:S[t],alt:"Fish farmers on Lake Victoria with traditional fishing boats",className:"w-full h-full object-cover opacity-30 transition-opacity duration-1000"}),e.jsx("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 flex space-x-3",children:S.map((b,M)=>e.jsx("button",{onClick:()=>s(M),className:`w-3 h-3 rounded-full transition-all duration-300 ${M===t?"bg-white shadow-lg":"bg-white/60 hover:bg-white/80"}`},M))})]}),e.jsx("div",{className:"relative container mx-auto px-4 py-12 md:py-20",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx(ht,{size:"xl",showText:!0,className:"justify-center"})}),e.jsxs("div",{className:"bg-black/40 backdrop-blur-sm rounded-2xl p-8 mb-8 border border-white/20",children:[e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-white mb-4 drop-shadow-2xl",children:"Nourishing Communities and Empowering Economies through Fish"}),e.jsx("p",{className:"text-lg md:text-xl text-blue-100 mb-6 max-w-3xl mx-auto drop-shadow-lg leading-relaxed",children:"We are dedicated to driving positive change at the intersection of innovation and sustainability. At Rio Fish, we are more than a company – we are a community of changemakers committed to shaping a brighter, more equitable future for all."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs(k,{size:"lg",onClick:a,className:"gap-2 bg-gradient-to-r from-blue-600 to-blue-800 hover:from-blue-700 hover:to-blue-900 text-white shadow-lg hover:shadow-xl transition-all duration-300 font-semibold",children:["Get Started",e.jsx(qs,{className:"w-4 h-4"})]}),e.jsxs(k,{size:"lg",variant:"outline",className:"gap-2 border-white/60 text-white hover:bg-white/20 hover:border-white/80 bg-white/10 backdrop-blur-sm font-semibold",onClick:()=>window.open("https://riofish.co.ke","_blank","noopener,noreferrer"),children:[e.jsx(Ft,{className:"w-4 h-4"}),"Learn More"]})]})]})})]}),e.jsx("div",{className:"py-16 bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Our Partners"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"Working together with leading organizations to transform Kenya's aquaculture sector"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-8 items-center justify-items-center",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-md hover:shadow-lg transition-all duration-300 w-full max-w-40 hover:scale-105",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-3 bg-gradient-to-br from-blue-100 to-blue-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:"Y"})}),e.jsx("div",{className:"text-sm font-semibold text-gray-800 mb-1",children:"Ygap"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Accelerator"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-md hover:shadow-lg transition-all duration-300 w-full max-w-40 hover:scale-105",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-3 bg-gradient-to-br from-green-100 to-green-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-bold text-green-600",children:"HB"})}),e.jsx("div",{className:"text-sm font-semibold text-gray-800 mb-1",children:"Homa Bay"}),e.jsx("div",{className:"text-xs text-gray-500",children:"County"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-md hover:shadow-lg transition-all duration-300 w-full max-w-40 hover:scale-105",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-3 bg-gradient-to-br from-purple-100 to-purple-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-bold text-purple-600",children:"K"})}),e.jsx("div",{className:"text-sm font-semibold text-gray-800 mb-1",children:"KMFRI"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Research"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-md hover:shadow-lg transition-all duration-300 w-full max-w-40 hover:scale-105",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-3 bg-gradient-to-br from-orange-100 to-orange-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-bold text-orange-600",children:"O"})}),e.jsx("div",{className:"text-sm font-semibold text-gray-800 mb-1",children:"OPES"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Development"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-md hover:shadow-lg transition-all duration-300 w-full max-w-40 hover:scale-105",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-3 bg-gradient-to-br from-red-100 to-red-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-bold text-red-600",children:"A"})}),e.jsx("div",{className:"text-sm font-semibold text-gray-800 mb-1",children:"AECF"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Foundation"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-md hover:shadow-lg transition-all duration-300 w-full max-w-40 hover:scale-105",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-3 bg-gradient-to-br from-indigo-100 to-indigo-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-bold text-indigo-600",children:"U"})}),e.jsx("div",{className:"text-sm font-semibold text-gray-800 mb-1",children:"USAID"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Kenya"})]})})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsx("p",{className:"text-gray-600 text-sm",children:"And many more organizations committed to sustainable aquaculture development"})})]})}),e.jsx("div",{id:"impact-section",className:"py-16 bg-gradient-to-r from-blue-600 to-blue-800 relative overflow-hidden",children:e.jsxs("div",{className:"container mx-auto px-4 relative z-10",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-white mb-4 drop-shadow-lg",children:"Our Impact"}),e.jsx("p",{className:"text-xl text-blue-100 max-w-2xl mx-auto drop-shadow-md",children:"Rio Fish delivers measurable impact, advancing food and nutrition security across Kenya"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-8 text-center",children:[e.jsxs("div",{className:"bg-white/20 backdrop-blur-md rounded-xl p-8 border border-white/20 shadow-2xl hover:bg-white/25 transition-all duration-300",children:[e.jsxs("div",{className:"text-5xl font-bold text-white mb-3 drop-shadow-lg",children:[r.toLocaleString(),"+"]}),e.jsx("div",{className:"text-blue-100 text-lg font-medium drop-shadow-md",children:"Women farmers recruited"})]}),e.jsxs("div",{className:"bg-white/20 backdrop-blur-md rounded-xl p-8 border border-white/20 shadow-2xl hover:bg-white/25 transition-all duration-300",children:[e.jsxs("div",{className:"text-5xl font-bold text-white mb-3 drop-shadow-lg",children:[d.toLocaleString(),"+"]}),e.jsx("div",{className:"text-blue-100 text-lg font-medium drop-shadow-md",children:"Women Traders Supplied"})]}),e.jsxs("div",{className:"bg-white/20 backdrop-blur-md rounded-xl p-8 border border-white/20 shadow-2xl hover:bg-white/25 transition-all duration-300",children:[e.jsxs("div",{className:"text-5xl font-bold text-white mb-3 drop-shadow-lg",children:[m.toLocaleString(),"+"]}),e.jsx("div",{className:"text-blue-100 text-lg font-medium drop-shadow-md",children:"Total farmers aggregated"})]})]})]})}),e.jsx("div",{className:"py-16 bg-white",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-12 items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-6",children:"The Challenge We Address"}),e.jsx("p",{className:"text-lg text-gray-600 mb-6",children:"Kenya faces a critical fish supply gap, with domestic production meeting only 30% of the nation's demand. This shortfall stems from multiple challenges: depleted water bodies due to overfishing, environmental degradation, climate change impacts, and inadequate aquaculture standards."}),e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 mb-4",children:[e.jsx(Wt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Combatting 'Jaboya' and HIV/AIDS Impact"})]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Our work actively combats 'jaboya' – a predatory practice where male fishermen sexually exploit women traders in exchange for access to scarce fish. Through our sustainable supply chain and direct market access, Rio Fish empowers women traders to operate independently and safely."})]}),e.jsxs("div",{className:"relative",children:[e.jsx(_s,{src:"https://images.unsplash.com/photo-1606844842584-4fb9bb2ec649?w=600&h=400&fit=crop&crop=center",alt:"Fresh fish processing facility",className:"rounded-lg shadow-xl w-full"}),e.jsx("div",{className:"absolute -bottom-6 -right-6 w-32 h-32 hidden md:block",children:e.jsx(_s,{src:"/fish-management/build/fishpic.jpg",alt:"Fish warehouse storage",className:"rounded-lg shadow-lg w-full h-full object-cover"})})]})]})})}),e.jsx("div",{className:"py-16 bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Our Strategies"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"A unique end-to-end model leveraging an integrated digital platform to transform Kenya's aquaculture sector."})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6",children:V.map((b,M)=>{const R=b.icon;return e.jsx(U,{className:"text-center p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1 border-0 bg-white/90 backdrop-blur-sm",children:e.jsxs(H,{className:"space-y-4",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-gradient-to-br from-blue-100 to-blue-200 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(R,{className:"w-6 h-6 text-blue-600"})}),e.jsx("h3",{className:"font-semibold text-gray-900",children:b.title}),e.jsx("p",{className:"text-gray-600 text-sm",children:b.description})]})},M)})})]})}),e.jsx("div",{className:"py-16 bg-white",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Sustainable Development Goals"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"Our commitment to advancing the United Nations Sustainable Development Goals through sustainable aquaculture."})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6",children:u.map((b,M)=>{const R=b.icon;return e.jsx(U,{className:"text-center p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1 border-0 bg-gradient-to-br from-green-50 to-blue-50",children:e.jsxs(H,{className:"space-y-4",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-gradient-to-br from-green-100 to-green-200 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(R,{className:"w-6 h-6 text-green-600"})}),e.jsx("h3",{className:"font-semibold text-gray-900",children:b.title}),e.jsx("p",{className:"text-gray-600 text-sm",children:b.description})]})},M)})})]})}),e.jsx("div",{className:"py-16 bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Discover the Finest Freshwater Fish"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"Pure, Local, Exceptional. We specialize in premium freshwater fish sourced from the region's pristine lakes and ponds."})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6",children:v.map((b,M)=>e.jsxs(U,{className:"overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-1 border-0 bg-white",children:[e.jsx("div",{className:"aspect-square overflow-hidden",children:e.jsx(_s,{src:b.image,alt:b.name,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300"})}),e.jsxs(H,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:b.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:b.description})]})]},M))})]})}),e.jsx("div",{className:"py-16 bg-white",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-center text-gray-900 mb-12",children:"Our Processing Operations"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(_s,{src:"/fish-management/build/5.jpg",alt:"Fish processing warehouse",className:"rounded-lg shadow-md w-full h-64 object-cover"}),e.jsx(_s,{src:"/fish-management/build/1.jpg",alt:"Fresh fish processing",className:"rounded-lg shadow-md w-full h-48 object-cover"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(_s,{src:"/fish-management/build/2.jpg",alt:"Cold storage facility",className:"rounded-lg shadow-md w-full h-48 object-cover"}),e.jsx(_s,{src:"/fish-management/build/3.jpeg",alt:"Quality control process",className:"rounded-lg shadow-md w-full h-64 object-cover"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(_s,{src:"/fish-management/build/process4.jpg",alt:"Fish warehouse operations",className:"rounded-lg shadow-md w-full h-64 object-cover"}),e.jsx(_s,{src:"/fish-management/build/fishpic.jpg",alt:"Fish distribution center",className:"rounded-lg shadow-md w-full h-48 object-cover"})]})]})]})}),e.jsx("div",{className:"py-16 bg-white",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Let's Talk Fish"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"At Rio Fish, we are passionate about connecting with our customers, partners, and fish enthusiasts. Whether you have questions about our freshwater fish, want to discuss a potential collaboration, or simply wish to learn more about our offerings, our team is ready to listen."})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-12 items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Get in Touch"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Ft,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Phone"}),e.jsx("p",{className:"text-gray-600",children:"+254700938040"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Wt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Email"}),e.jsx("p",{className:"text-gray-600",children:"info@riofish.co.ke"})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Join Our Team"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"We are always on the lookout for talented individuals who are passionate about our mission. We actively recruit from the communities we serve, building a diverse and inclusive environment."}),e.jsx(k,{variant:"outline",className:"border-blue-300 text-blue-700 hover:bg-blue-50",onClick:()=>window.open("https://riofish.co.ke/opportunities/","_blank","noopener,noreferrer"),children:"View Opportunities"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(_s,{src:"/fish-management/build/papo1.jpg",alt:"Rio Fish team and operations",className:"rounded-lg shadow-xl w-full"}),e.jsx("div",{className:"absolute -bottom-6 -left-6 w-32 h-32 hidden md:block",children:e.jsx(_s,{src:"/fish-management/build/papo2.jpg",alt:"Fresh fish processing",className:"rounded-lg shadow-lg w-full h-full object-cover"})})]})]})]})}),e.jsx("div",{className:"py-16 bg-gradient-to-r from-blue-600 to-blue-800",children:e.jsxs("div",{className:"container mx-auto px-4 text-center",children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-white mb-4",children:"Discover Our World"}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Ready to explore the world of premium freshwater fish? Visit our depots and immerse yourself in the Rio Fish experience. Our passionate team is eager to guide you through our selection."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs(k,{size:"lg",variant:"secondary",onClick:a,className:"gap-2 bg-white text-blue-600 hover:bg-blue-50 shadow-lg hover:shadow-xl transition-all duration-300",children:["Start Your Journey",e.jsx(qs,{className:"w-4 h-4"})]}),e.jsxs(k,{size:"lg",variant:"outline",className:"gap-2 border-white text-white hover:bg-white/10",onClick:()=>window.open("https://riofish.co.ke/gallery/","_blank","noopener,noreferrer"),children:[e.jsx(Ft,{className:"w-4 h-4"}),"View Gallery"]})]})]})})]})}function Se({className:a,type:t,...s}){return e.jsx("input",{type:t,"data-slot":"input",className:Ee("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",a),...s})}function B({className:a,...t}){return e.jsx(dr,{"data-slot":"label",className:Ee("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",a),...t})}function ki({onLogin:a,onBack:t}){const[s,r]=c.useState(!1),[l,d]=c.useState(""),[x,m]=c.useState(""),[g,f]=c.useState(!1),[n,S]=c.useState(!1),[T,V]=c.useState(null),u=async v=>{v.preventDefault(),S(!0),V(null);try{const b=await a(l,x);b.success||V(b.error||"Login failed. Please try again.")}catch(b){V(b.message||"Authentication failed. Please check your connection and try again.")}finally{S(!1)}};return e.jsxs("div",{className:"min-h-screen flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"lg:hidden relative h-80 w-full",children:[e.jsx(_s,{src:"/fish-management/build/login-image.jpeg",alt:"Fish farmers on Lake Victoria with traditional fishing boats",className:"absolute inset-0 w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-40"}),e.jsxs("div",{className:"relative z-10 p-6 text-white flex flex-col justify-center items-center text-center h-full",children:[e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"Welcome to RIO FISH FARM"}),e.jsx("p",{className:"text-lg opacity-90",children:"Professional fish processing management"})]})]}),e.jsxs("div",{className:"hidden lg:flex lg:w-3/4 relative",children:[e.jsx(_s,{src:"/fish-management/build/login-image.jpeg",alt:"Fish farmers on Lake Victoria with traditional fishing boats",className:"absolute inset-0 w-full h-full object-cover"}),e.jsxs("div",{className:"relative z-10 p-8 text-white flex flex-col justify-end",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Welcome to RIO FISH FARM"}),e.jsx("p",{className:"text-xl opacity-90 mb-2",children:"Professional fish processing management"}),e.jsx("p",{className:"opacity-75",children:"Streamline your fish processing operations with our management system."})]})]}),e.jsx("div",{className:"w-full lg:w-1/4 flex items-center justify-center p-4 bg-gray-50 lg:min-h-screen",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs(k,{variant:"ghost",onClick:t,className:"mb-6 gap-2 text-gray-600 hover:text-gray-900",children:[e.jsx(mr,{className:"w-4 h-4"}),"Back to Home"]}),e.jsxs(U,{className:"shadow-lg border-0",children:[e.jsxs(Fe,{className:"space-y-1 pb-6",children:[e.jsx("div",{className:"hidden lg:flex items-center justify-center mb-4",children:e.jsx(ht,{size:"lg",showText:!1})}),e.jsx(Pe,{className:"text-2xl text-center",children:g?"Create Account":"Welcome Back"}),e.jsx("p",{className:"text-center text-gray-600",children:g?"Start managing your fish operations":"Sign in to your account"})]}),e.jsx(H,{children:e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"email",children:"Email"}),e.jsx(Se,{id:"email",type:"email",placeholder:"john@example.com",value:l,onChange:v=>d(v.target.value),autoComplete:"email",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Se,{id:"password",type:s?"text":"password",placeholder:"Enter your password",value:x,onChange:v=>m(v.target.value),autoComplete:"current-password",required:!0}),e.jsx(k,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 p-0",onClick:()=>r(!s),children:s?e.jsx(xr,{className:"w-4 h-4"}):e.jsx(rs,{className:"w-4 h-4"})})]})]}),T&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-sm text-red-600",children:T})}),e.jsx(k,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700",disabled:n,children:n?"Please wait...":g?"Create Account":"Sign In"}),e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[g?"Already have an account?":"Don't have an account?"," ",e.jsx(k,{type:"button",variant:"link",className:"p-0 h-auto text-blue-600",onClick:()=>f(!g),children:g?"Sign in":"Sign up"})]})]})})]})]})})]})}const Ci=Zt("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function js({className:a,variant:t,...s}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:Ee(Ci({variant:t}),a),...s})}function ys({className:a,...t}){return e.jsx("div",{"data-slot":"alert-description",className:Ee("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",a),...t})}const Rs=({children:a,requiredRole:t,requiredRoles:s,requiredPermissions:r=[],requiredAnyPermission:l=[],requiredAllPermissions:d=[],resource:x,action:m="read",section:g,fallback:f,showFallback:n=!0})=>{const{user:S,userProfile:T,loading:V,hasPermission:u,hasAnyPermission:v,hasAllPermissions:b,canAccess:M,canPerform:R,isAdmin:X}=$t();return V?n?e.jsxs(js,{className:"border-blue-200 bg-blue-50",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx(ys,{className:"text-blue-800",children:"Loading permissions..."})]}):null:S?g&&!M(g)?n?f||e.jsxs(js,{className:"border-amber-200 bg-amber-50",children:[e.jsx(xs,{className:"h-4 w-4 text-amber-600"}),e.jsx(ys,{className:"text-amber-800",children:"You don't have permission to access this section."})]}):null:t&&T?.role!==t&&!X()?n?f||e.jsxs(js,{className:"border-amber-200 bg-amber-50",children:[e.jsx(xs,{className:"h-4 w-4 text-amber-600"}),e.jsxs(ys,{className:"text-amber-800",children:["You need ",t," role to access this content."]})]}):null:s&&!s.includes(T?.role||"")&&!X()?n?f||e.jsxs(js,{className:"border-amber-200 bg-amber-50",children:[e.jsx(xs,{className:"h-4 w-4 text-amber-600"}),e.jsxs(ys,{className:"text-amber-800",children:["You need one of these roles to access this content: ",s.join(", ")]})]}):null:r.length>0&&!r.every(Z=>u(Z))?n?f||e.jsxs(js,{className:"border-amber-200 bg-amber-50",children:[e.jsx(xs,{className:"h-4 w-4 text-amber-600"}),e.jsx(ys,{className:"text-amber-800",children:"You don't have the required permissions to access this content."})]}):null:l.length>0&&!v(l)?n?f||e.jsxs(js,{className:"border-amber-200 bg-amber-50",children:[e.jsx(xs,{className:"h-4 w-4 text-amber-600"}),e.jsx(ys,{className:"text-amber-800",children:"You need at least one of the required permissions to access this content."})]}):null:d.length>0&&!b(d)?n?f||e.jsxs(js,{className:"border-amber-200 bg-amber-50",children:[e.jsx(xs,{className:"h-4 w-4 text-amber-600"}),e.jsx(ys,{className:"text-amber-800",children:"You need all the required permissions to access this content."})]}):null:x&&!R(m,x)?n?f||e.jsxs(js,{className:"border-amber-200 bg-amber-50",children:[e.jsx(Qe,{className:"h-4 w-4 text-amber-600"}),e.jsxs(ys,{className:"text-amber-800",children:["You don't have permission to ",m," ",x,"."]})]}):null:e.jsx(e.Fragment,{children:a}):n?f||e.jsxs(js,{className:"border-red-200 bg-red-50",children:[e.jsx(Pa,{className:"h-4 w-4 text-red-600"}),e.jsx(ys,{className:"text-red-800",children:"You must be logged in to access this content."})]}):null},Ra=()=>e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(ht,{size:"xl",showText:!0})})}),e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full animate-bounce"}),e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"Loading application..."})]})}),wa=c.lazy(()=>ps(()=>Promise.resolve().then(()=>Qi),void 0).then(a=>({default:a.Dashboard})).catch(()=>({default:()=>e.jsx("div",{children:"Dashboard component failed to load"})}))),Di=c.lazy(()=>ps(()=>Promise.resolve().then(()=>en),void 0).catch(()=>({default:()=>e.jsx("div",{children:"Warehouse Entry component failed to load"})}))),zi=c.lazy(()=>ps(()=>Promise.resolve().then(()=>ln),void 0).catch(()=>({default:()=>e.jsx("div",{children:"Processing Management component failed to load"})}))),Oi=c.lazy(()=>ps(()=>Promise.resolve().then(()=>xn),void 0).catch(()=>({default:()=>e.jsx("div",{children:"Sorting Management component failed to load"})}))),Fi=c.lazy(()=>ps(()=>Promise.resolve().then(()=>un),void 0).catch(()=>({default:()=>e.jsx("div",{children:"Inventory Management component failed to load"})}))),Pi=c.lazy(()=>ps(()=>Promise.resolve().then(()=>bn),void 0).catch(()=>({default:()=>e.jsx("div",{children:"Transfer Reports component failed to load"})}))),Ei=c.lazy(()=>ps(()=>Promise.resolve().then(()=>yn),void 0).catch(()=>({default:()=>e.jsx("div",{children:"Disposal Management component failed to load"})}))),Ii=c.lazy(()=>ps(()=>Promise.resolve().then(()=>_n),void 0).catch(()=>({default:()=>e.jsx("div",{children:"Order Management component failed to load"})}))),qi=c.lazy(()=>ps(()=>Promise.resolve().then(()=>Sn),void 0).catch(()=>({default:()=>e.jsx("div",{children:"Dispatch Management component failed to load"})}))),Ti=c.lazy(()=>ps(()=>Promise.resolve().then(()=>Dn),void 0).catch(()=>({default:()=>e.jsx("div",{children:"Outlet Receiving component failed to load"})}))),Ai=c.lazy(()=>ps(()=>Promise.resolve().then(()=>Tn),void 0).catch(()=>({default:()=>e.jsx("div",{children:"Reports component failed to load"})}))),$i=c.lazy(()=>ps(()=>Promise.resolve().then(()=>Mn),void 0).catch(()=>({default:()=>e.jsx("div",{children:"User Management component failed to load"})}))),La=c.memo(({currentSection:a,selectedItemId:t,onNavigate:s})=>{const r=()=>e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});return(()=>{switch(a){case"dashboard":return e.jsx(bs,{children:e.jsx(c.Suspense,{fallback:e.jsx(r,{}),children:e.jsx(wa,{onNavigate:s})})});case"warehouse-entry":return e.jsx(Rs,{section:"warehouse-entry",requiredPermissions:["write:inventory"],children:e.jsx(bs,{children:e.jsx(c.Suspense,{fallback:e.jsx(r,{}),children:e.jsx(Di,{onNavigate:s})})})});case"processing":return e.jsx(Rs,{section:"processing",requiredPermissions:["write:processing"],children:e.jsx(bs,{children:e.jsx(c.Suspense,{fallback:e.jsx(r,{}),children:e.jsx(zi,{onNavigate:s})})})});case"sorting":return e.jsx(Rs,{section:"sorting",requiredPermissions:["write:processing"],children:e.jsx(bs,{children:e.jsx(c.Suspense,{fallback:e.jsx(r,{}),children:e.jsx(Oi,{onNavigate:s})})})});case"inventory":return e.jsx(Rs,{section:"inventory",requiredPermissions:["read:inventory"],children:e.jsx(bs,{children:e.jsx(c.Suspense,{fallback:e.jsx(r,{}),children:e.jsx(Fi,{onNavigate:s})})})});case"transfers":return e.jsx(Rs,{section:"transfers",requiredPermissions:["read:inventory"],children:e.jsx(bs,{children:e.jsx(c.Suspense,{fallback:e.jsx(r,{}),children:e.jsx(Pi,{onNavigate:s})})})});case"disposal":return e.jsx(Rs,{section:"disposal",requiredPermissions:["write:disposal"],children:e.jsx(bs,{children:e.jsx(c.Suspense,{fallback:e.jsx(r,{}),children:e.jsx(Ei,{onNavigate:s})})})});case"outlet-orders":return e.jsx(Rs,{section:"outlet-orders",requiredPermissions:["read:sales"],children:e.jsx(bs,{children:e.jsx(c.Suspense,{fallback:e.jsx(r,{}),children:e.jsx(Ii,{onNavigate:s})})})});case"dispatch":return e.jsx(Rs,{section:"dispatch",requiredPermissions:["write:logistics"],children:e.jsx(bs,{children:e.jsx(c.Suspense,{fallback:e.jsx(r,{}),children:e.jsx(qi,{onNavigate:s})})})});case"outlet-receiving":return e.jsx(Rs,{section:"outlet-receiving",requiredPermissions:["read:sales"],children:e.jsx(bs,{children:e.jsx(c.Suspense,{fallback:e.jsx(r,{}),children:e.jsx(Ti,{onNavigate:s})})})});case"reports":return e.jsx(Rs,{section:"reports",requiredPermissions:["read:basic"],children:e.jsx(bs,{children:e.jsx(c.Suspense,{fallback:e.jsx(r,{}),children:e.jsx(Ai,{onNavigate:s})})})});case"user-management":return e.jsx(Rs,{section:"user-management",requiredPermissions:["admin:*","write:users"],children:e.jsx(bs,{children:e.jsx(c.Suspense,{fallback:e.jsx(r,{}),children:e.jsx($i,{onNavigate:s})})})});default:return e.jsx(bs,{children:e.jsx(c.Suspense,{fallback:e.jsx(r,{}),children:e.jsx(wa,{onNavigate:s})})})}})()});La.displayName="AppContentRenderer";function Ri(){const{user:a,loading:t,signIn:s,signOut:r}=Js(),[l,d]=c.useState("dashboard"),[x,m]=c.useState(void 0),[g,f]=c.useState("landing");return console.log("AppContent - user:",a?JSON.stringify(a,null,2):"null"),console.log("AppContent - loading:",t),console.log("AppContent - appState:",g),console.log("AppContent - user exists:",!!a),console.log("AppContent - user role:",a?.role),t?e.jsx(Ra,{}):g==="landing"?e.jsx(Si,{onGetStarted:()=>f("login")}):g==="login"?e.jsx(ki,{onLogin:async(n,S)=>{const T=await s(n,S);return T.success?(f("app"),{success:!0}):{success:!1,error:T.error}},onBack:()=>f("landing")}):(console.log("AppContent: Rendering main app, user:",a,"appState:",g),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(_i,{currentSection:l,onNavigate:n=>d(n),onLogout:async()=>{await r(),f("landing")}}),e.jsx("main",{className:"md:ml-72 pt-16 md:pt-0 min-h-screen",children:e.jsx("div",{className:"p-4 md:p-6",children:e.jsx(La,{currentSection:l,selectedItemId:x,onNavigate:(n,S)=>{d(n),m(S)}})})})]}))}const Li=()=>e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Rio Fish Farm"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Kenya Operations"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading application..."})]})});function Wi(){try{return e.jsx(bs,{children:e.jsx(Ri,{})})}catch(a){return console.error("App render error:",a),e.jsx(Li,{})}}const Mi=({...a})=>{const t=()=>typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";return e.jsx(hr,{theme:t(),className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...a})},Ui=()=>{if("serviceWorker"in navigator){const a=new gr("/sw.js");a.addEventListener("controlling",()=>{console.log("Service worker is now controlling the page")}),a.addEventListener("waiting",()=>{console.log("New service worker is waiting"),confirm("New version available! Reload to update?")&&(a.addEventListener("controlling",()=>{window.location.reload()}),a.messageSkipWaiting())}),a.register().then(t=>{console.log("Service worker registered successfully:",t)}).catch(t=>{console.log("Service worker registration failed:",t)})}},Vi=()=>{let a;window.addEventListener("beforeinstallprompt",r=>{r.preventDefault(),a=r,t()}),window.addEventListener("appinstalled",()=>{console.log("PWA was installed"),s()});const t=()=>{let r=document.getElementById("pwa-install-button");r||(r=document.createElement("button"),r.id="pwa-install-button",r.innerHTML="📱 Install App",r.className="fixed bottom-4 right-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg hover:bg-blue-700 z-50",r.onclick=()=>{a&&(a.prompt(),a.userChoice.then(l=>{l.outcome==="accepted"?console.log("User accepted the install prompt"):console.log("User dismissed the install prompt"),a=null}))},document.body.appendChild(r))},s=()=>{const r=document.getElementById("pwa-install-button");r&&r.remove()}},Bi=()=>{const a=()=>{const t=navigator.onLine,s=document.getElementById("offline-status");if(s)s.textContent=t?"Online":"Offline",s.className=t?"fixed top-4 right-4 bg-green-500 text-white px-3 py-1 rounded text-sm z-50":"fixed top-4 right-4 bg-red-500 text-white px-3 py-1 rounded text-sm z-50";else if(!t){const r=document.createElement("div");r.id="offline-status",r.textContent="Offline",r.className="fixed top-4 right-4 bg-red-500 text-white px-3 py-1 rounded text-sm z-50",document.body.appendChild(r)}};window.addEventListener("online",a),window.addEventListener("offline",a),a()},Ki=()=>{Ui(),Vi(),Bi()};typeof window<"u"&&(window.React=ur,window.ReactDOM=pr);Ki();fr(document.getElementById("root")).render(e.jsx(c.Suspense,{fallback:e.jsx(Ra,{}),children:e.jsxs(Ni,{children:[e.jsx(Wi,{}),e.jsx(Mi,{})]})}));function Tt(){const[a,t]=c.useState([]);return c.useEffect(()=>{t([{id:"1",type:"success",icon:e.jsx(qe,{className:"h-5 w-5"}),text:"🎉 Fresh Tilapia Batch Processed - 2,500kg Ready for Distribution",bgColor:"bg-green-100",textColor:"text-green-800"},{id:"2",type:"info",icon:e.jsx(ts,{className:"h-5 w-5"}),text:"📊 Daily Production: 1,200kg Nile Perch | 800kg Tilapia | 600kg Catfish",bgColor:"bg-blue-100",textColor:"text-blue-800"},{id:"3",type:"achievement",icon:e.jsx(Qt,{className:"h-5 w-5"}),text:"🏆 Quality Excellence: 98.5% Grade A Fish This Month",bgColor:"bg-purple-100",textColor:"text-purple-800"},{id:"4",type:"info",icon:e.jsx(Ps,{className:"h-5 w-5"}),text:"📈 Revenue Growth: +15% This Quarter | New Outlets Added",bgColor:"bg-indigo-100",textColor:"text-indigo-800"},{id:"5",type:"warning",icon:e.jsx(ns,{className:"h-5 w-5"}),text:"⚠️ Temperature Alert: Cold Storage at Optimal 2°C",bgColor:"bg-yellow-100",textColor:"text-yellow-800"},{id:"6",type:"success",icon:e.jsx(aa,{className:"h-5 w-5"}),text:"⭐ Customer Satisfaction: 4.9/5 Rating | 50+ Happy Outlets",bgColor:"bg-emerald-100",textColor:"text-emerald-800"},{id:"7",type:"info",icon:e.jsx(ta,{className:"h-5 w-5"}),text:"⚡ Processing Speed: 3.2kg/minute | Efficiency Record Broken",bgColor:"bg-orange-100",textColor:"text-orange-800"},{id:"8",type:"achievement",icon:e.jsx(Qt,{className:"h-5 w-5"}),text:"🎯 Target Achieved: 15,000kg Monthly Production Goal Met",bgColor:"bg-rose-100",textColor:"text-rose-800"}])},[]),e.jsx("div",{className:"w-full bg-gradient-to-r from-slate-50 to-blue-50 border-b border-slate-200 shadow-sm overflow-hidden relative z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"relative py-2 overflow-hidden",children:e.jsxs("div",{className:"flex animate-marquee-simple whitespace-nowrap",children:[a.map(s=>e.jsxs("div",{className:`flex items-center gap-3 px-6 py-2 rounded-full ${s.bgColor} ${s.textColor} font-medium text-sm whitespace-nowrap mx-4 shadow-sm border flex-shrink-0`,children:[s.icon,e.jsx("span",{children:s.text})]},s.id)),a.map(s=>e.jsxs("div",{className:`flex items-center gap-3 px-6 py-2 rounded-full ${s.bgColor} ${s.textColor} font-medium text-sm whitespace-nowrap mx-4 shadow-sm border flex-shrink-0`,children:[s.icon,e.jsx("span",{children:s.text})]},`duplicate-${s.id}`))]})})})})}function Gi({onNavigate:a}){const{canAccess:t}=$t(),[s,r]=c.useState(null),[l,d]=c.useState(!0),[x,m]=c.useState(null),[g,f]=c.useState(new Date),n=async()=>{try{d(!0),m(null),console.log("Dashboard: Fetching enhanced stats from database...");const u=await vi.getEnhancedDashboardStats();console.log("Dashboard: Enhanced stats fetched from database:",u),u?console.log("Dashboard: Stats breakdown:",{totalWarehouseEntries:u.totalWarehouseEntries,totalWeight:u.totalWeight,totalOrders:u.totalOrders,totalFarmers:u.totalFarmers,recentActivity:u.recentActivity?.length||0}):console.warn("Dashboard: No stats data received from database"),r(u),f(new Date)}catch(u){console.error("Dashboard: Error fetching enhanced stats:",u),m(u instanceof Error?u.message:"Failed to fetch dashboard data")}finally{d(!1)}};c.useEffect(()=>{n()},[]);const S=u=>`KES ${u.toLocaleString()}`,T=(u,v=!0)=>v?e.jsx(Ps,{className:"h-4 w-4 text-green-500"}):e.jsx(Ea,{className:"h-4 w-4 text-red-500"}),V=u=>{switch(u){case"order":return e.jsx(Vs,{className:"h-4 w-4 text-blue-600"});case"entry":return e.jsx(Fs,{className:"h-4 w-4 text-green-600"});case"processing":return e.jsx(Ls,{className:"h-4 w-4 text-purple-600"});case"dispatch":return e.jsx(ks,{className:"h-4 w-4 text-orange-600"});default:return e.jsx(Te,{className:"h-4 w-4"})}};return l&&!s?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100",children:[e.jsx(Tt,{}),e.jsx("div",{className:"p-4 md:p-8 pt-2",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-3xl shadow-xl",children:e.jsx(ts,{className:"h-12 w-12 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-5xl font-bold bg-gradient-to-r from-blue-900 to-indigo-800 bg-clip-text text-transparent",children:"RIO FISH FARM"}),e.jsx("p",{className:"text-lg text-slate-600 mt-2",children:"Size-Based Fish Processing Management • Kenya Operations"})]})]}),e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"h-16 w-16 mx-auto mb-6 animate-spin text-blue-600"}),e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-blue-200"})]}),e.jsx("p",{className:"text-2xl font-semibold text-slate-700 mb-2",children:"Loading Dashboard..."}),e.jsx("p",{className:"text-slate-500 mb-4",children:"Fetching real-time data from your database"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-slate-400",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]})]})})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100",children:[e.jsx(Tt,{}),e.jsx("div",{className:"p-4 md:p-8 pt-2",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-6",children:e.jsx("div",{className:"w-64 h-40 flex-shrink-0",children:e.jsx("img",{src:"/fish-management/build/riofish-logo.png",alt:"Rio Fish Logo",className:"w-full h-full object-contain",style:{imageRendering:"crisp-edges"},onError:u=>{console.log("Logo failed to load, trying fallback");const v=u.target;v.src="https://riofish.co.ke/wp-content/uploads/2024/01/riofish_logo_copy-removed-background-white.png"}})})}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white/60 px-3 py-2 rounded-full",children:[e.jsx(gs,{className:"h-4 w-4"}),"Last updated: ",g.toLocaleTimeString()]}),x&&e.jsxs("div",{className:"flex items-center gap-2 bg-red-50 text-red-600 px-3 py-2 rounded-full",children:[e.jsx(ns,{className:"h-4 w-4"}),x]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(k,{onClick:n,disabled:l,variant:"outline",className:"px-6 py-3 rounded-xl font-semibold border-slate-300 hover:bg-slate-50",children:[e.jsx(Ze,{className:`h-5 w-5 mr-2 ${l?"animate-spin":""}`}),"Refresh"]}),t("warehouse-entry")&&e.jsxs(k,{variant:"outline",onClick:()=>a("warehouse-entry"),className:"px-6 py-3 rounded-xl font-semibold border-blue-300 hover:bg-blue-50",children:[e.jsx(Cs,{className:"h-5 w-5 mr-2"}),"New Entry"]}),t("reports")&&e.jsxs(k,{onClick:()=>a("reports"),className:"bg-gradient-to-r from-blue-600 to-blue-800 hover:from-blue-700 hover:to-blue-900 text-white px-6 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(Ws,{className:"h-5 w-5 mr-2"}),"Reports"]})]})]}),x&&e.jsx(U,{className:"border-red-200 bg-red-50 shadow-lg",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-red-600 rounded-xl",children:e.jsx(ns,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-red-800 font-semibold text-lg",children:"Error loading dashboard"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:x}),e.jsx("p",{className:"text-red-500 text-xs mt-2",children:"Please try refreshing or check your connection"})]}),e.jsxs(k,{onClick:n,variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-100",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-blue-50 to-blue-100 hover:shadow-2xl transition-all duration-300 group",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-blue-600 uppercase tracking-wide",children:"Total Weight"}),e.jsx("p",{className:"text-4xl font-bold text-blue-900 mt-2",children:l?"...":s?.totalWeight?.toFixed(1)||"0.0"}),e.jsx("p",{className:"text-sm text-blue-600",children:"kg"}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[T(s?.recentWeight||0),e.jsxs("span",{className:"text-sm text-green-600 font-medium",children:["+",s?.recentWeight?.toFixed(1)||0,"kg this week"]})]})]}),e.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-600 to-blue-800 rounded-2xl shadow-lg group-hover:scale-110 transition-transform duration-300",children:e.jsx(Ns,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-emerald-50 to-emerald-100 hover:shadow-2xl transition-all duration-300 group",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-emerald-600 uppercase tracking-wide",children:"Ready for Dispatch"}),e.jsx("p",{className:"text-4xl font-bold text-emerald-900 mt-2",children:l?"...":s?.totalReadyForDispatch||0}),e.jsx("p",{className:"text-sm text-emerald-600",children:"fish"}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[T(s?.recentProcessingCount||0),e.jsxs("span",{className:"text-sm text-green-600 font-medium",children:["+",s?.recentProcessingCount||0," processed this week"]})]})]}),e.jsx("div",{className:"p-4 bg-gradient-to-br from-emerald-600 to-emerald-800 rounded-2xl shadow-lg group-hover:scale-110 transition-transform duration-300",children:e.jsx(ks,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-purple-50 to-purple-100 hover:shadow-2xl transition-all duration-300 group",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-purple-600 uppercase tracking-wide",children:"Total Orders"}),e.jsx("p",{className:"text-4xl font-bold text-purple-900 mt-2",children:l?"...":s?.totalOrders||0}),e.jsx("p",{className:"text-sm text-purple-600",children:"orders"}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[T(s?.recentOrdersCount||0),e.jsxs("span",{className:"text-sm text-green-600 font-medium",children:["+",s?.recentOrdersCount||0," this week"]})]})]}),e.jsx("div",{className:"p-4 bg-gradient-to-br from-purple-600 to-purple-800 rounded-2xl shadow-lg group-hover:scale-110 transition-transform duration-300",children:e.jsx(Vs,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-orange-50 to-orange-100 hover:shadow-2xl transition-all duration-300 group",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-orange-600 uppercase tracking-wide",children:"Total Value"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900 mt-2",children:l?"...":S(s?.totalOrderValue||0)}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[T(s?.recentOrderValue||0),e.jsxs("span",{className:"text-sm text-green-600 font-medium",children:["+",S(s?.recentOrderValue||0)," this week"]})]})]}),e.jsx("div",{className:"p-4 bg-gradient-to-br from-orange-600 to-orange-800 rounded-2xl shadow-lg group-hover:scale-110 transition-transform duration-300",children:e.jsx(Hs,{className:"h-8 w-8 text-white"})})]})})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsx(U,{className:"p-4 bg-gradient-to-br from-cyan-50 to-cyan-100 border-0 shadow-lg hover:shadow-xl transition-all duration-300 group",children:e.jsx(H,{className:"p-0",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-cyan-600 to-cyan-800 rounded-xl w-fit mx-auto mb-2 group-hover:scale-110 transition-transform duration-300",children:e.jsx(Fs,{className:"h-5 w-5 text-white"})}),e.jsx("p",{className:"text-sm font-semibold text-cyan-600",children:"Warehouse Entries"}),e.jsx("p",{className:"text-2xl font-bold text-cyan-900",children:s?.totalWarehouseEntries||0})]})})}),e.jsx(U,{className:"p-4 bg-gradient-to-br from-pink-50 to-pink-100 border-0 shadow-lg hover:shadow-xl transition-all duration-300 group",children:e.jsx(H,{className:"p-0",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-pink-600 to-pink-800 rounded-xl w-fit mx-auto mb-2 group-hover:scale-110 transition-transform duration-300",children:e.jsx(Ls,{className:"h-5 w-5 text-white"})}),e.jsx("p",{className:"text-sm font-semibold text-pink-600",children:"Processing Records"}),e.jsx("p",{className:"text-2xl font-bold text-pink-900",children:s?.totalProcessingRecords||0})]})})}),e.jsx(U,{className:"p-4 bg-gradient-to-br from-indigo-50 to-indigo-100 border-0 shadow-lg hover:shadow-xl transition-all duration-300 group",children:e.jsx(H,{className:"p-0",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"p-2 bg-indigo-600 rounded-xl w-fit mx-auto mb-2 group-hover:scale-110 transition-transform duration-300",children:e.jsx(Te,{className:"h-5 w-5 text-white"})}),e.jsx("p",{className:"text-sm font-semibold text-indigo-600",children:"Inventory Items"}),e.jsx("p",{className:"text-2xl font-bold text-indigo-900",children:s?.totalInventoryItems||0})]})})}),e.jsx(U,{className:"p-4 bg-gradient-to-br from-teal-50 to-teal-100 border-0 shadow-lg hover:shadow-xl transition-all duration-300 group",children:e.jsx(H,{className:"p-0",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"p-2 bg-teal-600 rounded-xl w-fit mx-auto mb-2 group-hover:scale-110 transition-transform duration-300",children:e.jsx(As,{className:"h-5 w-5 text-white"})}),e.jsx("p",{className:"text-sm font-semibold text-teal-600",children:"Active Outlets"}),e.jsx("p",{className:"text-2xl font-bold text-teal-900",children:s?.activeOutletsCount||0})]})})}),e.jsx(U,{className:"p-4 bg-gradient-to-br from-amber-50 to-amber-100 border-0 shadow-lg hover:shadow-xl transition-all duration-300 group",children:e.jsx(H,{className:"p-0",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"p-2 bg-amber-600 rounded-xl w-fit mx-auto mb-2 group-hover:scale-110 transition-transform duration-300",children:e.jsx(Ts,{className:"h-5 w-5 text-white"})}),e.jsx("p",{className:"text-sm font-semibold text-amber-600",children:"Total Farmers"}),e.jsx("p",{className:"text-2xl font-bold text-amber-900",children:s?.totalFarmers||0})]})})}),e.jsx(U,{className:"p-4 bg-gradient-to-br from-red-50 to-red-100 border-0 shadow-lg hover:shadow-xl transition-all duration-300 group",children:e.jsx(H,{className:"p-0",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"p-2 bg-red-600 rounded-xl w-fit mx-auto mb-2 group-hover:scale-110 transition-transform duration-300",children:e.jsx(Qe,{className:"h-5 w-5 text-white"})}),e.jsx("p",{className:"text-sm font-semibold text-red-600",children:"Pending Dispatches"}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:s?.pendingDispatchesCount||0})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(U,{className:"border-0 shadow-2xl bg-white/90 backdrop-blur-sm",children:[e.jsx(Fe,{className:"pb-6 bg-gradient-to-r from-slate-50 to-slate-100 rounded-t-3xl",children:e.jsxs(Pe,{className:"text-xl font-bold text-slate-900 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-600 rounded-xl",children:e.jsx(br,{className:"h-5 w-5 text-white"})}),"Average Temperature"]})}),e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-bold text-red-600 mb-2",children:l?"...":`${s?.avgTemperature||0}°C`}),e.jsx("p",{className:"text-sm text-slate-500",children:"Current average temperature"}),e.jsx("div",{className:"mt-4 p-3 bg-red-50 rounded-xl",children:e.jsx("p",{className:"text-sm text-red-700",children:s?.avgTemperature&&s.avgTemperature>25?"⚠️ Temperature is high - monitor fish health":"✅ Temperature is within normal range"})})]})})]}),e.jsxs(U,{className:"border-0 shadow-2xl bg-white/90 backdrop-blur-sm",children:[e.jsx(Fe,{className:"pb-6 bg-gradient-to-r from-slate-50 to-slate-100 rounded-t-3xl",children:e.jsxs(Pe,{className:"text-xl font-bold text-slate-900 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-600 rounded-xl",children:e.jsx(ra,{className:"h-5 w-5 text-white"})}),"Fish Size Analysis"]})}),e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-bold text-blue-600 mb-2",children:l?"...":`${s?.avgFishSize||0}kg`}),e.jsx("p",{className:"text-sm text-slate-500",children:"Average fish size"}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-xl",children:e.jsx("p",{className:"text-sm text-blue-700",children:s?.avgFishSize&&s.avgFishSize>2?"🐟 Large fish - good for premium markets":"📏 Standard size - suitable for regular processing"})})]})})]})]}),e.jsxs(U,{className:"border-0 shadow-2xl bg-white/90 backdrop-blur-sm",children:[e.jsx(Fe,{className:"pb-6 bg-gradient-to-r from-slate-50 to-slate-100 rounded-t-3xl",children:e.jsxs(Pe,{className:"text-2xl font-bold text-slate-900 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-600 rounded-xl",children:e.jsx(yt,{className:"h-6 w-6 text-white"})}),"Quick Actions"]})}),e.jsx(H,{className:"p-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t("warehouse-entry")&&e.jsxs(k,{variant:"outline",className:"h-28 flex flex-col items-center justify-center gap-3 hover:bg-blue-50 hover:border-blue-300 transition-all duration-300 group",onClick:()=>a("warehouse-entry"),children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-600 to-blue-800 rounded-xl group-hover:scale-110 transition-transform duration-300",children:e.jsx(Fs,{className:"h-8 w-8 text-white"})}),e.jsx("span",{className:"text-sm font-medium",children:"Fish Entry"})]}),t("processing")&&e.jsxs(k,{variant:"outline",className:"h-28 flex flex-col items-center justify-center gap-3 hover:bg-orange-50 hover:border-orange-300 transition-all duration-300 group",onClick:()=>a("processing"),children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-orange-600 to-orange-800 rounded-xl group-hover:scale-110 transition-transform duration-300",children:e.jsx(Ls,{className:"h-8 w-8 text-white"})}),e.jsx("span",{className:"text-sm font-medium",children:"Processing"})]}),t("dispatch")&&e.jsxs(k,{variant:"outline",className:"h-28 flex flex-col items-center justify-center gap-3 hover:bg-green-50 hover:border-green-300 transition-all duration-300 group",onClick:()=>a("dispatch"),children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-green-600 to-green-800 rounded-xl group-hover:scale-110 transition-transform duration-300",children:e.jsx(ks,{className:"h-8 w-8 text-white"})}),e.jsx("span",{className:"text-sm font-medium",children:"Dispatch"})]}),t("outlet-orders")&&e.jsxs(k,{variant:"outline",className:"h-28 flex flex-col items-center justify-center gap-3 hover:bg-purple-50 hover:border-purple-300 transition-all duration-300 group",onClick:()=>a("outlet-orders"),children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-600 to-purple-800 rounded-xl group-hover:scale-110 transition-transform duration-300",children:e.jsx(Vs,{className:"h-8 w-8 text-white"})}),e.jsx("span",{className:"text-sm font-medium",children:"Orders"})]})]})})]}),e.jsxs(U,{className:"border-0 shadow-2xl bg-white/90 backdrop-blur-sm",children:[e.jsx(Fe,{className:"pb-6 bg-gradient-to-r from-slate-50 to-slate-100 rounded-t-3xl",children:e.jsxs(Pe,{className:"text-2xl font-bold text-slate-900 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-600 rounded-xl",children:e.jsx(Ps,{className:"h-6 w-6 text-white"})}),"Performance Summary"]})}),e.jsx(H,{className:"p-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center p-6 bg-gradient-to-br from-green-50 to-green-100 rounded-2xl",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-green-600 to-green-800 rounded-xl w-fit mx-auto mb-4",children:e.jsx(qe,{className:"h-8 w-8 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"Processing Efficiency"}),e.jsx("p",{className:"text-3xl font-bold text-green-900 mb-2",children:s?.totalProcessingRecords||0}),e.jsx("p",{className:"text-sm text-green-600",children:"Total processing records"}),e.jsx("div",{className:"mt-3 p-2 bg-green-200 rounded-lg",children:e.jsx("p",{className:"text-xs text-green-800",children:s?.totalReadyForDispatch&&s.totalReadyForDispatch>0?`✅ ${s.totalReadyForDispatch} fish ready for dispatch`:"📋 No fish ready for dispatch"})})]}),e.jsxs("div",{className:"text-center p-6 bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-600 to-blue-800 rounded-xl w-fit mx-auto mb-4",children:e.jsx(Te,{className:"h-8 w-8 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Inventory Health"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-900 mb-2",children:[s?.totalInventoryWeight?.toFixed(1)||"0.0","kg"]}),e.jsx("p",{className:"text-sm text-blue-600",children:"Total inventory weight"}),e.jsx("div",{className:"mt-3 p-2 bg-blue-200 rounded-lg",children:e.jsx("p",{className:"text-xs text-blue-800",children:s?.totalInventoryWeight&&s.totalInventoryWeight>100?"📦 Good inventory levels":"⚠️ Low inventory - consider restocking"})})]}),e.jsxs("div",{className:"text-center p-6 bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-600 to-purple-800 rounded-xl w-fit mx-auto mb-4",children:e.jsx(Hs,{className:"h-8 w-8 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-purple-800 mb-2",children:"Business Performance"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900 mb-2",children:s?.totalOrders||0}),e.jsx("p",{className:"text-sm text-purple-600",children:"Total orders"}),e.jsx("div",{className:"mt-3 p-2 bg-purple-200 rounded-lg",children:e.jsx("p",{className:"text-xs text-purple-800",children:s?.totalOrders&&s.totalOrders>0?`💰 KES ${s.totalOrderValue?.toLocaleString()||0} total value`:"📊 No orders yet"})})]})]})})]}),e.jsxs(U,{className:"border-0 shadow-2xl bg-white/90 backdrop-blur-sm",children:[e.jsx(Fe,{className:"pb-6 bg-gradient-to-r from-slate-50 to-slate-100 rounded-t-3xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Pe,{className:"text-2xl font-bold text-slate-900 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-green-600 to-green-800 rounded-xl",children:e.jsx(yt,{className:"h-6 w-6 text-white"})}),"Recent Activity"]}),s?.recentActivity&&s.recentActivity.length>0&&e.jsxs(k,{variant:"outline",className:"px-4 py-2 rounded-xl text-sm",onClick:()=>a("reports"),children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),"View All"]})]})}),e.jsxs(H,{className:"p-8",children:[e.jsx("div",{className:"space-y-4",children:s?.recentActivity&&s.recentActivity.length>0?s.recentActivity.slice(0,5).map((u,v)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-slate-200 rounded-2xl hover:shadow-md hover:border-slate-300 transition-all duration-300 bg-white/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-slate-100 rounded-xl",children:V(u?.type||"default")}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900",children:u?.action||"Unknown Action"}),e.jsx("p",{className:"text-sm text-slate-500",children:u?.details||"No details available"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-slate-600",children:u?.created_at?new Date(u.created_at).toLocaleDateString():"Unknown date"}),e.jsx("p",{className:"text-xs text-slate-400",children:u?.created_at?new Date(u.created_at).toLocaleTimeString():"Unknown time"})]})]},u?.id||v)):e.jsxs("div",{className:"text-center py-16 text-slate-500",children:[e.jsx("div",{className:"p-4 bg-slate-100 rounded-full w-fit mx-auto mb-6",children:e.jsx(Te,{className:"h-16 w-16 text-slate-400"})}),e.jsx("p",{className:"text-xl font-medium text-slate-700",children:"No recent activity"}),e.jsx("p",{className:"text-sm mt-2 text-slate-500",children:"Activity will appear here as you use the system"}),t("warehouse-entry")&&e.jsxs(k,{variant:"outline",className:"mt-6 px-6 py-3 rounded-xl",onClick:()=>a("warehouse-entry"),children:[e.jsx(Cs,{className:"h-4 w-4 mr-2"}),"Start with Fish Entry"]})]})}),s?.recentActivity&&s.recentActivity.length>5&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-sm text-slate-500",children:["Showing 5 of ",s.recentActivity.length," recent activities"]})})]})]})]})})]})}const Qi=Object.freeze(Object.defineProperty({__proto__:null,Dashboard:Gi},Symbol.toStringTag,{value:"Module"}));function os({...a}){return e.jsx(jr,{"data-slot":"select",...a})}function cs({...a}){return e.jsx(Nr,{"data-slot":"select-value",...a})}function ds({className:a,size:t="default",children:s,...r}){return e.jsxs(yr,{"data-slot":"select-trigger","data-size":t,className:Ee("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",a),...r,children:[s,e.jsx(vr,{asChild:!0,children:e.jsx(Gs,{className:"size-4 opacity-50"})})]})}function ms({className:a,children:t,position:s="popper",...r}){return e.jsx(_r,{children:e.jsxs(wr,{"data-slot":"select-content",className:Ee("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:s,...r,children:[e.jsx(Hi,{}),e.jsx(Sr,{className:Ee("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),e.jsx(Yi,{})]})})}function _e({className:a,children:t,...s}){return e.jsxs(kr,{"data-slot":"select-item",className:Ee("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",a),...s,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(Cr,{children:e.jsx(dt,{className:"size-4"})})}),e.jsx(Dr,{children:t})]})}function Hi({className:a,...t}){return e.jsx(zr,{"data-slot":"select-scroll-up-button",className:Ee("flex cursor-default items-center justify-center py-1",a),...t,children:e.jsx(Nt,{className:"size-4"})})}function Yi({className:a,...t}){return e.jsx(Or,{"data-slot":"select-scroll-down-button",className:Ee("flex cursor-default items-center justify-center py-1",a),...t,children:e.jsx(Gs,{className:"size-4"})})}function Ms({className:a,...t}){return e.jsx("textarea",{"data-slot":"textarea",className:Ee("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),...t})}const Xe=za,St=Oa,Ji=Da,Wa=c.forwardRef(({className:a,...t},s)=>e.jsx(Xt,{ref:s,className:Ee("fixed inset-0 z-50 bg-black/50 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...t}));Wa.displayName="DialogOverlay";const Ye=c.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(Ji,{children:[e.jsx(Wa,{}),e.jsxs(ea,{ref:r,className:Ee("fixed top-1/2 left-1/2 z-50 w-full max-w-[calc(100%-2rem)] sm:max-w-lg translate-x-[-50%] translate-y-[-50%] border rounded-lg bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,children:[t,e.jsx(Ca,{className:"absolute top-4 right-4 opacity-70 transition-opacity hover:opacity-100 rounded-sm focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none ring-offset-background data-[state=open]:bg-accent data-[state=open]:text-muted-foreground [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4","aria-label":"Close",children:e.jsx(Xs,{})})]})]}));Ye.displayName="DialogContent";const Je=c.forwardRef(({className:a,...t},s)=>e.jsx(Fa,{ref:s,className:Ee("text-lg font-semibold leading-none",a),...t}));Je.displayName="DialogTitle";const vs=c.forwardRef(({className:a,...t},s)=>e.jsx(Fr,{ref:s,className:Ee("text-sm text-muted-foreground",a),...t}));vs.displayName="DialogDescription";const es=({className:a,...t})=>e.jsx("div",{className:Ee("flex flex-col gap-2 text-center sm:text-left",a),...t}),at=({className:a,...t})=>e.jsx("div",{className:Ee("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",a),...t});async function Ma(){try{const{data:a,error:t}=await j.from("sorting_batches").select("batch_number").not("batch_number","is",null).order("batch_number",{ascending:!1}).limit(1).maybeSingle();if(t)return console.warn("Error fetching existing batch numbers:",t.message),t.message&&t.message.includes("relation")&&t.message.includes("does not exist")?(console.warn("sorting_batches table does not exist, using timestamp-based batch number"),`Batch${Date.now().toString().slice(-6)}`):`Batch${Date.now().toString().slice(-6)}`;let s=1;if(a?.batch_number){const l=a.batch_number.match(/^Batch(\d+)$/);l&&(s=parseInt(l[1],10)+1)}return`Batch${s.toString().padStart(4,"0")}`}catch(a){return console.error("Error generating batch number:",a),`Batch${Date.now().toString().slice(-6)}`}}async function vt(){try{const{data:a,error:t}=await j.from("warehouse_entries").select("entry_code").not("entry_code","is",null).order("entry_code",{ascending:!1}).limit(1).maybeSingle();if(t)return console.warn("Error fetching existing entry codes:",t.message),`WE${Date.now().toString().slice(-6)}`;let s=1;if(a?.entry_code){const l=a.entry_code.match(/^WE(\d+)$/);l&&(s=parseInt(l[1],10)+1)}return`WE${s.toString().padStart(3,"0")}`}catch(a){return console.error("Error generating unique entry code:",a),`WE${Date.now().toString().slice(-6)}`}}async function oa(a){try{const{data:t,error:s}=await j.from("warehouse_entries").select("entry_code").eq("id",a).single();if(s)return console.warn("Error fetching entry code:",s.message),await vt();if(t?.entry_code)return t.entry_code;const r=await vt(),{error:l}=await j.from("warehouse_entries").update({entry_code:r}).eq("id",a);return l&&console.warn("Error updating entry code:",l.message),r}catch(t){return console.error("Error getting/generating entry code:",t),await vt()}}async function It(){try{const{data:a,error:t}=await j.from("processing_records").select("processing_code").not("processing_code","is",null).order("processing_code",{ascending:!1}).limit(1).maybeSingle();if(t)return console.warn("Error fetching existing processing codes:",t.message),`PR${Date.now().toString().slice(-6)}`;let s=1;if(a?.processing_code){const l=a.processing_code.match(/^PR(\d+)$/);l&&(s=parseInt(l[1],10)+1)}return`PR${s.toString().padStart(3,"0")}`}catch(a){return console.error("Error generating unique processing code:",a),`PR${Date.now().toString().slice(-6)}`}}async function Ua(a){try{const{data:t,error:s}=await j.from("processing_records").select("processing_code").eq("id",a).single();if(s)return console.warn("Error fetching processing code:",s.message),await It();if(t?.processing_code)return t.processing_code;const r=await It(),{error:l}=await j.from("processing_records").update({processing_code:r}).eq("id",a);return l&&console.warn("Error updating processing code:",l.message),r}catch(t){return console.error("Error getting/generating processing code:",t),await It()}}const Zi=Object.freeze(Object.defineProperty({__proto__:null,generateUniqueBatchNumber:Ma,generateUniqueEntryCode:vt,generateUniqueProcessingCode:It,getOrGenerateEntryCode:oa,getOrGenerateProcessingCode:Ua},Symbol.toStringTag,{value:"Module"}));function Xi({onNavigate:a}){const[t,s]=c.useState([]),[r,l]=c.useState([]),[d,x]=c.useState(!1),[m,g]=c.useState(!1),[f,n]=c.useState(!1),[S,T]=c.useState(null),[V,u]=c.useState(null),[v,b]=c.useState({farmerId:"",totalWeight:"",totalPieces:"",pricePerKg:"",condition:"",fishType:"",notes:""}),[M,R]=c.useState({}),[X,Z]=c.useState(""),[K,z]=c.useState("all"),[ae,re]=c.useState(!0),[O,le]=c.useState(null),[W,G]=c.useState(new Set),[J,h]=c.useState(!0),Y=P=>{switch(P){case"excellent":return"excellent";case"good":return"good";case"fair":return"fair";default:return"good"}},q=P=>{switch(P){case"excellent":return"excellent";case"good":return"good";case"fair":return"fair";case"poor":return"poor";default:return"good"}},we=P=>{const be=r.find(ze=>ze.id===P);return be?be.name:`Farmer ID: ${P}`},Ce=P=>{const be=P.reduce((ze,Ie)=>{const ke=Ie.farmer_id;return ze[ke]||(ze[ke]={farmer:r.find(ye=>ye.id===ke)||{id:ke,name:`Farmer ID: ${ke}`,location:"Unknown"},entries:[],totalWeight:0,totalValue:0,totalPieces:0,entryCount:0}),ze[ke].entries.push(Ie),ze[ke].totalWeight+=Ie.total_weight,ze[ke].totalValue+=Ie.total_value,ze[ke].totalPieces+=Ie.total_pieces,ze[ke].entryCount+=1,ze},{});return Object.values(be).sort((ze,Ie)=>Ie.totalValue-ze.totalValue)},De=P=>{const be=new Set(W);be.has(P)?be.delete(P):be.add(P),G(be)},fe=async()=>{try{const{data:P,error:be}=await j.from("farmers").select("*").eq("status","active").order("name");if(be)throw be;l(P||[])}catch{l([])}},Me=async()=>{try{const{data:P,error:be}=await j.from("warehouse_entries").select(`
          *,
          farmers!inner(name)
        `).order("created_at",{ascending:!1}).limit(20);if(be)throw be;const ze=await Promise.all((P||[]).map(async Ie=>{const ke=Ie.entry_code||await oa(Ie.id);return{...Ie,farmer_name:Ie.farmers?.name||`Farmer ID: ${Ie.farmer_id}`,entry_code:ke}}));s(ze)}catch{s([])}};c.useEffect(()=>{fe(),Me()},[]);const y=()=>{const P={};return v.farmerId||(P.farmerId="Please select a farmer"),(!v.totalWeight||parseFloat(v.totalWeight)<=0)&&(P.totalWeight="Please enter a valid weight"),(!v.totalPieces||parseInt(v.totalPieces)<=0)&&(P.totalPieces="Please enter valid number of pieces"),(!v.pricePerKg||parseFloat(v.pricePerKg)<=0)&&(P.pricePerKg="Please enter a valid price per kg"),v.condition||(P.condition="Please select a grade/condition"),v.fishType||(P.fishType="Please select a fish type"),R(P),Object.keys(P).length===0},L=async(P,be,ze,Ie,ke)=>{try{const ye=JSON.parse(sessionStorage.getItem("currentUser")||"null");if(!ye)return;const Le={user_id:ye.id,action:P,table_name:be,record_id:ze,old_values:Ie?JSON.stringify(Ie):null,new_values:ke?JSON.stringify(ke):null,ip_address:null,user_agent:navigator.userAgent,created_at:new Date().toISOString()},{error:ls}=await j.from("audit_logs").insert([Le]);ls&&console.warn("Failed to log audit event:",ls)}catch(ye){console.warn("Failed to log audit event:",ye)}},je=async()=>{if(y()){n(!0),T(null),u(null);try{const P=r.find(ls=>ls.id.toString()===v.farmerId||ls.id===parseInt(v.farmerId));if(!P)throw new Error("Selected farmer not found");const be=parseFloat(v.totalWeight),ze=parseFloat(v.pricePerKg),Ie=await vt(),ke={entry_date:new Date().toISOString().split("T")[0],total_weight:be,total_pieces:parseInt(v.totalPieces),condition:Y(v.condition),fish_type:v.fishType,farmer_id:P.id,price_per_kg:ze,total_value:be*ze,notes:v.notes.trim()||"",entry_code:Ie},{data:ye,error:Le}=await j.from("warehouse_entries").insert([ke]).select();if(Le)throw Le;ye&&ye.length>0&&(s(ls=>[ye[0],...ls]),await L("INSERT","warehouse_entries",ye[0].id,null,ke)),b({farmerId:"",totalWeight:"",totalPieces:"",pricePerKg:"",condition:"",fishType:"",notes:""}),R({}),x(!1),u("Entry recorded successfully!"),setTimeout(()=>u(null),3e3)}catch(P){T("Failed to save entry: "+P.message)}finally{n(!1)}}},ce=P=>{switch(q(P)){case"excellent":return"bg-emerald-100 text-emerald-800 border-emerald-300";case"good":return"bg-blue-100 text-blue-800 border-blue-300";case"fair":return"bg-amber-100 text-amber-800 border-amber-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},N=P=>{switch(q(P)){case"excellent":case"good":return e.jsx(qe,{className:"h-4 w-4 text-green-600"});case"fair":return e.jsx(Qe,{className:"h-4 w-4 text-amber-600"});default:return e.jsx(qe,{className:"h-4 w-4 text-gray-600"})}},F=P=>`KES ${P.toLocaleString()}`,p=P=>new Date(P).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric"}),D=t.filter(P=>{const be=P.farmer_name?.toLowerCase().includes(X.toLowerCase())||P.entry_code?.toLowerCase().includes(X.toLowerCase())||P.notes?.toLowerCase().includes(X.toLowerCase()),ze=K==="all"||P.condition===K;return be&&ze}),A=(()=>{const P=t.reduce((ye,Le)=>ye+Le.total_weight,0),be=t.reduce((ye,Le)=>ye+Le.total_value,0),ze=t.reduce((ye,Le)=>ye+Le.total_pieces,0),Ie=t.length>0?be/P:0,ke=t.reduce((ye,Le)=>(ye[Le.condition]=(ye[Le.condition]||0)+1,ye),{});return{totalWeight:P,totalValue:be,totalPieces:ze,avgPricePerKg:Ie,conditionCounts:ke,totalEntries:t.length}})(),I=()=>{const P=[["Entry Code","Date","Farmer","Weight (kg)","Pieces","Price/kg","Total Value","Condition","Notes"],...D.map(ke=>[ke.entry_code||"",ke.entry_date,ke.farmer_name||"",ke.total_weight,ke.total_pieces,ke.price_per_kg,ke.total_value,ke.condition,ke.notes||""])].map(ke=>ke.join(",")).join(`
`),be=new Blob([P],{type:"text/csv"}),ze=window.URL.createObjectURL(be),Ie=document.createElement("a");Ie.href=ze,Ie.download=`warehouse-entries-${new Date().toISOString().split("T")[0]}.csv`,Ie.click(),window.URL.revokeObjectURL(ze)};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[V&&e.jsxs(js,{className:"border-green-200 bg-green-50 text-green-800",children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsx(ys,{children:V}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>u(null),className:"ml-auto h-6 w-6 p-0",children:e.jsx(Xs,{className:"h-4 w-4"})})]}),S&&e.jsxs(js,{className:"border-red-200 bg-red-50 text-red-800",children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsx(ys,{children:S}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>T(null),className:"ml-auto h-6 w-6 p-0",children:e.jsx(Xs,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(Fs,{className:"h-8 w-8 text-blue-600"}),"Warehouse Entry"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track fish deliveries and manage inventory"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(k,{variant:"outline",onClick:()=>re(!ae),children:[e.jsx(Ws,{className:"h-4 w-4 mr-2"}),ae?"Hide Stats":"Show Stats"]}),e.jsx(k,{variant:"outline",onClick:()=>a("dashboard"),children:"Dashboard"}),e.jsxs(Xe,{open:d,onOpenChange:x,children:[e.jsx(St,{asChild:!0,children:e.jsxs(k,{className:"bg-blue-600 hover:bg-blue-700 text-white",size:"lg",children:[e.jsx(Cs,{className:"h-5 w-5 mr-2"}),"New Entry"]})}),e.jsxs(Ye,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(es,{children:[e.jsxs(Je,{className:"text-2xl flex items-center gap-3",children:[e.jsx(ts,{className:"h-6 w-6 text-blue-600"}),"Record New Warehouse Entry"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Enter details for a new fish delivery from a farmer to the warehouse."})]}),e.jsxs("div",{className:"space-y-6 py-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(B,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(Pt,{className:"h-4 w-4"}),"Select Farmer *"]}),e.jsxs(os,{value:v.farmerId,onValueChange:P=>{b({...v,farmerId:P}),M.farmerId&&R({...M,farmerId:""})},children:[e.jsx(ds,{className:`h-12 ${M.farmerId?"border-red-300 focus:border-red-500":""}`,children:e.jsx(cs,{placeholder:"Choose a farmer..."})}),e.jsx(ms,{children:r.length>0?r.map(P=>e.jsx(_e,{value:P.id.toString(),children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:P.name}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(Ds,{className:"h-3 w-3"}),P.location]})]})})},P.id)):e.jsx(_e,{value:"no-farmers",disabled:!0,children:"No active farmers found"})})]}),M.farmerId&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[e.jsx(Qe,{className:"h-3 w-3"}),M.farmerId]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(B,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx($s,{className:"h-4 w-4"}),"Total Weight (kg) *"]}),e.jsx(Se,{type:"number",step:"0.1",placeholder:"e.g. 150.5",value:v.totalWeight,onChange:P=>{b({...v,totalWeight:P.target.value}),M.totalWeight&&R({...M,totalWeight:""})},className:`h-12 ${M.totalWeight?"border-red-300 focus:border-red-500":""}`}),M.totalWeight&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[e.jsx(Qe,{className:"h-3 w-3"}),M.totalWeight]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(B,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4"}),"Number of Pieces *"]}),e.jsx(Se,{type:"number",placeholder:"e.g. 75",value:v.totalPieces,onChange:P=>{b({...v,totalPieces:P.target.value}),M.totalPieces&&R({...M,totalPieces:""})},className:`h-12 ${M.totalPieces?"border-red-300 focus:border-red-500":""}`}),M.totalPieces&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[e.jsx(Qe,{className:"h-3 w-3"}),M.totalPieces]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(B,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(Hs,{className:"h-4 w-4"}),"Price per kg (KES) *"]}),e.jsx(Se,{type:"number",placeholder:"e.g. 450",value:v.pricePerKg,onChange:P=>{b({...v,pricePerKg:P.target.value}),M.pricePerKg&&R({...M,pricePerKg:""})},className:`h-12 ${M.pricePerKg?"border-red-300 focus:border-red-500":""}`}),M.pricePerKg&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[e.jsx(Qe,{className:"h-3 w-3"}),M.pricePerKg]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(B,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4"}),"Fish Type *"]}),e.jsxs(os,{value:v.fishType,onValueChange:P=>{b({...v,fishType:P}),M.fishType&&R({...M,fishType:""})},children:[e.jsx(ds,{className:`h-12 ${M.fishType?"border-red-300 focus:border-red-500":""}`,children:e.jsx(cs,{placeholder:"Select fish type..."})}),e.jsxs(ms,{children:[e.jsx(_e,{value:"Nile Tilapia",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-blue-600"}),"Nile Tilapia (0.35kg avg)"]})}),e.jsx(_e,{value:"Nile Perch",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-green-600"}),"Nile Perch (1.20kg avg)"]})}),e.jsx(_e,{value:"African Catfish",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-purple-600"}),"African Catfish (0.65kg avg)"]})}),e.jsx(_e,{value:"Silver Cyprinid",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-gray-600"}),"Silver Cyprinid (0.15kg avg)"]})}),e.jsx(_e,{value:"African Lungfish",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-orange-600"}),"African Lungfish (0.80kg avg)"]})}),e.jsx(_e,{value:"Blue-spotted Tilapia",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-cyan-600"}),"Blue-spotted Tilapia (0.30kg avg)"]})}),e.jsx(_e,{value:"Marbled Lungfish",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-red-600"}),"Marbled Lungfish (0.75kg avg)"]})}),e.jsx(_e,{value:"Electric Catfish",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-yellow-600"}),"Electric Catfish (0.55kg avg)"]})}),e.jsx(_e,{value:"Mixed Batch",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-indigo-600"}),"Mixed Batch (0.50kg avg)"]})})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Select the primary fish type. This helps with accurate processing and sorting."}),M.fishType&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[e.jsx(Qe,{className:"h-3 w-3"}),M.fishType]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(B,{className:"text-base font-medium",children:"Grade/Quality *"}),e.jsxs(os,{value:v.condition,onValueChange:P=>{b({...v,condition:P}),M.condition&&R({...M,condition:""})},children:[e.jsx(ds,{className:`h-12 ${M.condition?"border-red-300 focus:border-red-500":""}`,children:e.jsx(cs,{placeholder:"Select quality grade..."})}),e.jsxs(ms,{children:[e.jsx(_e,{value:"excellent",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4 text-green-600"}),"Excellent (Grade A)"]})}),e.jsx(_e,{value:"good",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4 text-blue-600"}),"Good (Grade B)"]})}),e.jsx(_e,{value:"fair",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4 text-amber-600"}),"Fair (Grade C)"]})})]})]}),M.condition&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[e.jsx(Qe,{className:"h-3 w-3"}),M.condition]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(B,{className:"text-base font-medium",children:"Additional Notes"}),e.jsx(Ms,{placeholder:"Any special notes about this delivery...",value:v.notes,onChange:P=>b({...v,notes:P.target.value}),className:"h-12 min-h-[48px]"})]})]}),v.totalWeight&&v.pricePerKg&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Total Value"}),e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:F(parseFloat(v.totalWeight)*parseFloat(v.pricePerKg))})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t",children:[e.jsx(k,{variant:"outline",onClick:()=>{x(!1),R({}),T(null)},disabled:f,children:"Cancel"}),e.jsx(k,{onClick:je,disabled:f,className:"bg-blue-600 hover:bg-blue-700",children:f?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}),"Recording..."]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Record Entry"]})})]})]})]})]})]})]}),ae&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(U,{children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Weight"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[A.totalWeight.toFixed(1)," kg"]})]}),e.jsx($s,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(U,{children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Value"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:F(A.totalValue)})]}),e.jsx(Hs,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(U,{children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Pieces"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.totalPieces.toLocaleString()})]}),e.jsx(Te,{className:"h-8 w-8 text-purple-600"})]})})}),e.jsx(U,{children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Price/kg"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:F(A.avgPricePerKg)})]}),e.jsx(Ps,{className:"h-8 w-8 text-orange-600"})]})})})]}),e.jsx(U,{children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(mt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(Se,{placeholder:"Search entries by farmer, code, or notes...",value:X,onChange:P=>Z(P.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(os,{value:K,onValueChange:z,children:[e.jsxs(ds,{className:"w-40",children:[e.jsx(wt,{className:"h-4 w-4 mr-2"}),e.jsx(cs,{placeholder:"Filter by condition"})]}),e.jsxs(ms,{children:[e.jsx(_e,{value:"all",children:"All Conditions"}),e.jsx(_e,{value:"excellent",children:"Excellent"}),e.jsx(_e,{value:"good",children:"Good"}),e.jsx(_e,{value:"fair",children:"Fair"})]})]}),e.jsxs(k,{variant:J?"default":"outline",size:"sm",onClick:()=>h(!J),className:"flex items-center gap-2",children:[e.jsx(Pt,{className:"h-4 w-4"}),J?"Group by Farmer":"List View"]}),e.jsxs(k,{variant:"outline",onClick:I,disabled:D.length===0,children:[e.jsx(xt,{className:"h-4 w-4 mr-2"}),"Export"]})]})]})})}),e.jsxs(U,{children:[e.jsx(Fe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Pe,{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-5 w-5 text-blue-600"}),"Warehouse Entries",e.jsxs(se,{variant:"secondary",children:[D.length," of ",t.length," entries"]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(k,{variant:"outline",size:"sm",onClick:I,disabled:D.length===0,children:[e.jsx(xt,{className:"h-4 w-4 mr-1"}),"Export"]})})]})}),e.jsx(H,{children:m?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(et,{className:"h-8 w-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading entries..."})]}):D.length>0?J?e.jsx("div",{className:"space-y-4",children:Ce(D).map(P=>e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 p-4 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>De(P.farmer.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pt,{className:"h-5 w-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:P.farmer.name}),e.jsx("p",{className:"text-sm text-gray-500",children:P.farmer.location})]})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"h-4 w-4"}),P.entryCount," entries"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($s,{className:"h-4 w-4"}),P.totalWeight.toFixed(1),"kg"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Hs,{className:"h-4 w-4"}),F(P.totalValue)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{variant:"outline",className:"text-xs",children:W.has(P.farmer.id)?"Collapse":"Expand"}),e.jsx(Gs,{className:`h-4 w-4 text-gray-400 transition-transform ${W.has(P.farmer.id)?"rotate-180":""}`})]})]})}),W.has(P.farmer.id)&&e.jsx("div",{className:"divide-y divide-gray-100",children:P.entries.map(be=>e.jsxs("div",{className:"p-4 hover:bg-gray-50 transition-colors bg-white",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[N(be.condition),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Bs,{className:"h-3 w-3"}),p(be.entry_date)]}),e.jsx(se,{variant:"outline",className:"font-medium",children:be.entry_code})]})})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsx(se,{className:`${ce(be.condition)} border`,children:be.condition}),e.jsxs("span",{className:"text-gray-600",children:[be.total_weight,"kg • ",be.total_pieces," pieces"]}),e.jsxs("span",{className:"text-gray-600",children:[F(be.price_per_kg),"/kg"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xl font-bold text-gray-900 mb-2",children:F(be.total_value)}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>le(be),children:[e.jsx(rs,{className:"h-3 w-3 mr-1"}),"View"]})})]})]}),be.notes&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded text-sm text-gray-600",children:[e.jsx("strong",{children:"Notes:"})," ",be.notes]})]},be.id))})]},P.farmer.id))}):e.jsx("div",{className:"divide-y divide-gray-100",children:D.map(P=>e.jsxs("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[N(P.condition),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:we(P.farmer_id)}),e.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-500 mt-1",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Bs,{className:"h-3 w-3"}),p(P.entry_date)]})})]})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsx(se,{variant:"outline",className:"font-medium",children:P.entry_code}),e.jsx(se,{className:`${ce(P.condition)} border`,children:P.condition}),e.jsxs("span",{className:"text-gray-600",children:[P.total_weight,"kg • ",P.total_pieces," pieces"]}),e.jsxs("span",{className:"text-gray-600",children:[F(P.price_per_kg),"/kg"]}),e.jsxs("span",{className:"text-gray-600 font-medium",children:["• ",P.farmer_name]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-3",children:F(P.total_value)}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>le(P),children:[e.jsx(rs,{className:"h-3 w-3 mr-1"}),"View"]})})]})]}),P.notes&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded text-sm text-gray-600",children:[e.jsx("strong",{children:"Notes:"})," ",P.notes]})]},P.id))}):X||K!=="all"?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(mt,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No entries match your search"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your search or filter criteria"}),e.jsxs("div",{className:"mt-4 flex gap-2 justify-center",children:[e.jsx(k,{variant:"outline",onClick:()=>{Z(""),z("all")},children:"Clear Filters"}),e.jsxs(k,{onClick:()=>x(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(Cs,{className:"h-4 w-4 mr-2"}),"New Entry"]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ts,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No warehouse entries yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Start by recording your first fish delivery"}),e.jsxs(k,{onClick:()=>x(!0),className:"mt-4 bg-blue-600 hover:bg-blue-700",size:"lg",children:[e.jsx(Cs,{className:"h-4 w-4 mr-2"}),"Record First Entry"]})]})})]}),e.jsx(Xe,{open:!!O,onOpenChange:()=>le(null),children:e.jsxs(Ye,{className:"max-w-2xl",children:[e.jsx(es,{children:e.jsxs(Je,{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"h-5 w-5 text-blue-600"}),"Entry Details"]})}),O&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-500",children:"Entry Code"}),e.jsx("p",{className:"text-lg font-semibold",children:O.entry_code})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-500",children:"Date"}),e.jsx("p",{className:"text-lg font-semibold",children:p(O.entry_date)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-500",children:"Farmer"}),e.jsx("p",{className:"text-lg font-semibold",children:O.farmer_name})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-500",children:"Condition"}),e.jsx(se,{className:`${ce(O.condition)} border`,children:O.condition})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-500",children:"Weight"}),e.jsxs("p",{className:"text-lg font-semibold",children:[O.total_weight," kg"]})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-500",children:"Pieces"}),e.jsx("p",{className:"text-lg font-semibold",children:O.total_pieces})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-500",children:"Price/kg"}),e.jsx("p",{className:"text-lg font-semibold",children:F(O.price_per_kg)})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx(B,{className:"text-sm font-medium text-gray-500",children:"Total Value"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:F(O.total_value)})]}),O.notes&&e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-500",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-700 bg-gray-50 p-3 rounded",children:O.notes})]}),e.jsx("div",{className:"flex justify-end gap-2 pt-4 border-t",children:e.jsx(k,{variant:"outline",onClick:()=>le(null),children:"Close"})})]})]})})]})})}const en=Object.freeze(Object.defineProperty({__proto__:null,default:Xi},Symbol.toStringTag,{value:"Module"})),Ot=a=>({A:"bg-green-500",B:"bg-yellow-500",C:"bg-orange-500"})[a]||"bg-gray-500",qt=a=>a>=80?"text-green-600":a>=70?"text-yellow-600":"text-red-600",sn=({data:a,dataKey:t})=>{if(!a||a.length===0)return e.jsx("div",{className:"flex items-center justify-center h-32 text-gray-500",children:"No data available"});const s=Math.max(...a.map(r=>r[t]||0));return e.jsx("div",{className:"flex items-end justify-between h-32 gap-1",children:a.map((r,l)=>e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("div",{className:"bg-blue-500 rounded-t w-full min-h-[4px]",style:{height:`${s>0?(r[t]||0)/s*100:0}%`}}),e.jsx("span",{className:"text-xs text-gray-600 mt-1 text-center",children:r.date?new Date(r.date).getDate():l+1})]},l))})},tn=({data:a,dataKey:t})=>{if(!a||a.length===0)return e.jsx("div",{className:"flex items-center justify-center h-32 text-gray-500",children:"No data available"});const s=a.map(x=>x[t]||0),r=Math.max(...s),l=Math.min(...s),d=r-l||1;return e.jsx("div",{className:"relative h-32",children:e.jsxs("svg",{width:"100%",height:"100%",className:"overflow-visible",children:[e.jsx("polyline",{fill:"none",stroke:"#8b5cf6",strokeWidth:"2",points:a.map((x,m)=>{const g=a.length>1?m/(a.length-1)*100:50,n=100-((x[t]||0)-l)/d*80,S=isNaN(n)?50:Math.max(0,Math.min(100,n));return`${g},${S}`}).join(" ")}),a.map((x,m)=>{const g=a.length>1?m/(a.length-1)*100:50,n=100-((x[t]||0)-l)/d*80,S=isNaN(n)?50:Math.max(0,Math.min(100,n));return e.jsx("circle",{cx:`${g}%`,cy:`${S}%`,r:"3",fill:"#8b5cf6"},m)})]})})},an=({stats:a,processingRecords:t})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsx(U,{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm",children:"Ready for Processing"}),e.jsx("p",{className:"text-3xl font-bold",children:a.readyForProcessing})]}),e.jsx(ns,{className:"h-8 w-8 text-blue-200"})]})})}),e.jsx(U,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-sm",children:"Total Processed"}),e.jsx("p",{className:"text-3xl font-bold",children:a.totalProcessed})]}),e.jsx(qe,{className:"h-8 w-8 text-green-200"})]})})}),e.jsx(U,{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm",children:"Average Yield"}),e.jsxs("p",{className:"text-3xl font-bold",children:[a.averageYield,"%"]})]}),e.jsx(Ps,{className:"h-8 w-8 text-purple-200"})]})})}),e.jsx(U,{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-100 text-sm",children:"Total Waste"}),e.jsxs("p",{className:"text-3xl font-bold",children:[a.totalWaste,"kg"]})]}),e.jsx(Ws,{className:"h-8 w-8 text-orange-200"})]})})})]}),rn=({selectedEntryId:a,setSelectedEntryId:t,warehouseEntries:s,processingRecords:r,formData:l,setFormData:d,selectedStorage:x,setSelectedStorage:m,storageLocations:g,isProcessing:f,onSubmit:n,onClose:S})=>{const T=s.filter(u=>!a||u.id===a).filter(u=>!r.some(v=>v.warehouse_entry_id===u.id)),V=(u,v)=>{d({...l,[u]:v})};return a?e.jsxs("div",{className:"py-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-1",children:"Selected Entry"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx(se,{variant:"outline",className:"bg-white",children:s.find(u=>u.id===a)?.entry_code}),e.jsxs("span",{className:"text-blue-700",children:[s.find(u=>u.id===a)?.total_weight,"kg - ",s.find(u=>u.id===a)?.total_pieces," pieces"]}),e.jsxs("span",{className:"text-blue-600",children:["• ",s.find(u=>u.id===a)?.farmer_name]})]})]}),e.jsx(k,{variant:"outline",size:"sm",onClick:()=>{t(""),d({})},children:"Change Entry"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Pre-Processing Weight (kg)"}),e.jsx(Se,{type:"number",value:s.find(u=>u.id===a)?.total_weight||"",readOnly:!0,className:"bg-gray-50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Post-Processing Weight (kg) *"}),e.jsx(Se,{type:"number",step:"0.1",value:l.post_processing_weight||"",onChange:u=>V("post_processing_weight",Number(u.target.value)),placeholder:"Enter weight after processing"})]})]}),l.post_processing_weight&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Processing Calculations"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Processing Waste"}),e.jsxs("p",{className:"text-xl font-bold text-red-600",children:[l.processing_waste||0,"kg"]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Processing Yield"}),e.jsxs("p",{className:`text-xl font-bold ${qt(l.processing_yield||0)}`,children:[l.processing_yield||0,"%"]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Weight Loss"}),e.jsxs("p",{className:"text-xl font-bold text-orange-600",children:[((l.processing_waste||0)/(s.find(u=>u.id===a)?.total_weight||1)*100).toFixed(1),"%"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Number of Fish"}),e.jsx(Se,{type:"number",value:s.find(u=>u.id===a)?.total_pieces||"",readOnly:!0,className:"bg-gray-50"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Inherited from warehouse entry"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Final Grade *"}),e.jsxs(os,{value:l.final_grade||"",onValueChange:u=>V("final_grade",u),children:[e.jsx(ds,{children:e.jsx(cs,{placeholder:"Select grade"})}),e.jsxs(ms,{children:[e.jsx(_e,{value:"A",children:"Grade A"}),e.jsx(_e,{value:"B",children:"Grade B"}),e.jsx(_e,{value:"C",children:"Grade C"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Size classification will be determined during sorting process"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Fish Type"}),e.jsx(Se,{value:s.find(u=>u.id===a)?.fish_type||"Not specified",readOnly:!0,className:"bg-gray-50"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Inherited from warehouse entry"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Te,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Next Step: Sorting"}),e.jsx("p",{className:"text-sm text-blue-700",children:"After processing, fish will be sorted into size classes and assigned to storage locations."})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(k,{variant:"outline",onClick:S,children:"Cancel"}),e.jsx(k,{onClick:n,className:"bg-blue-600 hover:bg-blue-700",disabled:!l.post_processing_weight||!l.final_grade||f,children:f?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):"Complete Processing"})]})]})]}):e.jsxs("div",{className:"py-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Te,{className:"h-8 w-8 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Select Warehouse Entry"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Choose a warehouse entry to begin processing"})]}),T.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ns,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No Entries Available"}),e.jsx("p",{className:"text-sm text-gray-400",children:s.length===0?"No warehouse entries found":"All warehouse entries have been processed"}),s.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:s.length})," total warehouse entries exist,",e.jsxs("strong",{children:[" ",r.length]})," have been processed"]})})]}):e.jsx("div",{className:"space-y-3",children:T.map(u=>e.jsx(U,{className:"p-4 hover:shadow-md transition-all duration-200 cursor-pointer border hover:border-blue-300",onClick:()=>t(u.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Ns,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(se,{variant:"outline",className:"font-medium",children:u.entry_code}),e.jsxs(se,{className:"bg-green-500 text-white font-medium",children:[u.total_pieces," pieces"]})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($s,{className:"h-4 w-4"}),u.total_weight,"kg"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Bs,{className:"h-4 w-4"}),new Date(u.entry_date).toLocaleDateString()]}),e.jsxs("span",{className:"flex items-center gap-1 font-medium text-gray-900",children:[e.jsx(Ds,{className:"h-4 w-4"}),u.farmer_name]})]})]})]}),e.jsx(k,{size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:v=>{v.stopPropagation(),t(u.id)},children:"Select"})]})},u.id))}),e.jsxs("div",{className:"flex justify-between pt-6 border-t mt-6",children:[e.jsxs(k,{variant:"outline",onClick:()=>{window.location.reload()},className:"text-blue-600 border-blue-300 hover:bg-blue-50",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Refresh Entries"]}),e.jsx(k,{variant:"outline",onClick:S,children:"Cancel"})]})]})};function nn({onNavigate:a}){const[t,s]=c.useState([]),[r,l]=c.useState([]),[d,x]=c.useState([]),[m,g]=c.useState([]),[f,n]=c.useState(""),[S,T]=c.useState(""),[V,u]=c.useState(!1),[v,b]=c.useState(null),[M,R]=c.useState(!1),[X,Z]=c.useState(!1),[K,z]=c.useState(!1),[ae,re]=c.useState(!1),[O,le]=c.useState({}),[W,G]=c.useState({totalProcessed:0,readyForProcessing:0,averageYield:0,totalWaste:0,gradeDistribution:{A:0,B:0,C:0},weeklyProcessing:[],yieldTrends:[]}),J=async()=>{const{data:y,error:L}=await j.from("warehouse_entries").select(`
        *,
        farmers!inner(name)
      `).order("entry_date",{ascending:!1});if(L)console.error("Error fetching warehouse entries:",L.message);else{const je=await Promise.all((y||[]).map(async ce=>{const N=ce.entry_code||await oa(ce.id);return{...ce,farmer_name:ce.farmers?.name||`Farmer ID: ${ce.farmer_id}`,entry_code:N}}));s(je)}},h=async()=>{const{data:y,error:L}=await j.from("processing_records").select(`
        *,
        warehouse_entries!inner(
          id,
          farmer_id,
          farmers!inner(name)
        )
      `).order("processing_date",{ascending:!1});if(L)console.error("Error fetching processing records:",L.message);else{const je=await Promise.all((y||[]).map(async ce=>{const N=ce.grading_results||{},F=ce.size_distribution||{},p=Object.keys(N)[0]||"A";Object.keys(F)[0];const D=ce.processing_code||await Ua(ce.id);return{...ce,farmer_name:ce.warehouse_entries?.farmers?.name||"Unknown Farmer",final_grade:p,final_size:null,storage_location:"Not specified",ready_for_dispatch:!1,processing_code:D}}));l(je),x(je.slice(0,5))}},Y=async()=>{try{const{data:y,error:L}=await j.from("storage_locations").select("*").eq("status","active").order("name");if(L)console.warn("Storage locations table not found, using default locations:",L.message),g([{id:"1",name:"Cold Storage A",capacity:2e3},{id:"2",name:"Cold Storage B",capacity:1500},{id:"3",name:"Freezer Unit 1",capacity:1e3},{id:"4",name:"Processing Area 1",capacity:500},{id:"5",name:"Processing Area 2",capacity:500}]);else{const{data:je,error:ce}=await j.from("processing_records").select("post_processing_weight"),N=new Map;if(je&&!ce){const E=je.reduce((A,I)=>A+(I.post_processing_weight||0),0)/(y?.length||1);y?.forEach(A=>{N.set(A.name,E)})}const p=(y?.map(D=>({id:D.id,name:D.name,capacity:D.capacity_kg,currentUsage:N.get(D.name)||0,availableCapacity:D.capacity_kg-(N.get(D.name)||0)}))||[]).filter(D=>D.availableCapacity>0);p.length===0?(console.warn("No available storage locations found, using defaults"),g([{id:"1",name:"Cold Storage A",capacity:2e3},{id:"2",name:"Cold Storage B",capacity:1500},{id:"3",name:"Freezer Unit 1",capacity:1e3},{id:"4",name:"Processing Area 1",capacity:500},{id:"5",name:"Processing Area 2",capacity:500}])):g(p)}}catch(y){console.warn("Error fetching storage locations, using defaults:",y),g([{id:"1",name:"Cold Storage A",capacity:2e3},{id:"2",name:"Cold Storage B",capacity:1500},{id:"3",name:"Freezer Unit 1",capacity:1e3},{id:"4",name:"Processing Area 1",capacity:500},{id:"5",name:"Processing Area 2",capacity:500}])}},q=async()=>{Z(!0);try{await Promise.all([J(),h(),Y()])}finally{Z(!1)}},we=()=>{const y=t.filter(D=>!r.some(E=>E.warehouse_entry_id===D.id)).length,L=r.reduce((D,E)=>D+(E.processing_yield||0),0),je=r.length>0?L/r.length:0,ce=r.reduce((D,E)=>D+(E.processing_waste||0),0),N=r.reduce((D,E)=>(E.final_grade&&["A","B","C"].includes(E.final_grade)&&D[E.final_grade]++,D),{A:0,B:0,C:0}),F=Array.from({length:7},(D,E)=>{const A=new Date;A.setDate(A.getDate()-E);const I=A.toISOString().split("T")[0],P=r.filter(be=>be.processing_date?.startsWith(I)).length;return{date:I,count:P}}).reverse(),p=r.slice(0,10).map(D=>({date:new Date(D.processing_date).toLocaleDateString(),yield:D.processing_yield||0})).reverse();G({totalProcessed:r.length,readyForProcessing:y,averageYield:Number(je.toFixed(1)),totalWaste:Number(ce.toFixed(1)),gradeDistribution:N,weeklyProcessing:F,yieldTrends:p})};c.useEffect(()=>{if(f&&t.length>0){const y=t.find(L=>L.id===f);y&&le(L=>({...L,warehouse_entry_id:y.id,pre_processing_weight:y.total_weight?Number(y.total_weight):0,post_processing_weight:0,final_grade:L.final_grade||"",processing_date:new Date().toISOString()}))}},[f,t]),c.useEffect(()=>{if(O.pre_processing_weight&&O.post_processing_weight!==void 0){const y=O.pre_processing_weight-O.post_processing_weight,L=O.pre_processing_weight>0?O.post_processing_weight/O.pre_processing_weight*100:0;le(je=>({...je,processing_waste:y,processing_yield:Number(L.toFixed(2))}))}},[O.pre_processing_weight,O.post_processing_weight]),c.useEffect(()=>{J(),h(),Y()},[]),c.useEffect(()=>{we()},[t,r]);const Ce=async()=>{if(!K){z(!0);try{const y=m.find(E=>E.name===S),L=t.find(E=>E.id===f),{data:je,error:ce}=await j.from("processing_records").select("id, processing_code").eq("warehouse_entry_id",f).single();if(ce&&ce.code!=="PGRST116")throw ce;if(je){alert(`This warehouse entry has already been processed! Processing Code: ${je.processing_code}`);return}const{generateUniqueProcessingCode:N}=await ps(async()=>{const{generateUniqueProcessingCode:E}=await Promise.resolve().then(()=>Zi);return{generateUniqueProcessingCode:E}},void 0),F=await N(),p={warehouse_entry_id:O.warehouse_entry_id,processing_date:new Date().toISOString().split("T")[0],processed_by:null,pre_processing_weight:O.pre_processing_weight,post_processing_weight:O.post_processing_weight,processing_waste:O.processing_waste,processing_yield:O.processing_yield,size_distribution:{},grading_results:{[O.final_grade||"A"]:O.post_processing_weight||0},final_value:(O.post_processing_weight||0)*450,total_pieces:L?.total_pieces||0,processing_code:F},{error:D}=await j.from("processing_records").insert([p]);if(D){if(D.code==="23505"&&D.message.includes("warehouse_entry_id")){alert("This warehouse entry has already been processed! Please refresh the page to see the updated list."),await h();return}throw D}await h(),De(),a("sorting")}catch(y){console.error("Error creating processing record:",y.message),alert(`Error creating processing record: ${y.message}`)}finally{z(!1)}}},De=()=>{u(!1),n(""),le({}),T(""),z(!1)},fe=y=>{b(y),R(!0)},Me=t.filter(y=>!r.some(L=>L.warehouse_entry_id===y.id));return e.jsx("div",{className:"min-h-screen bg-gray-50 p-4 md:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(Ls,{className:"h-6 w-6 md:h-8 md:w-8 text-blue-600"}),"Processing Management"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Monitor and manage fish processing operations"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(k,{variant:"outline",onClick:q,disabled:X,children:[e.jsx(Ze,{className:`h-4 w-4 mr-2 ${X?"animate-spin":""}`}),"Refresh"]}),e.jsxs(k,{variant:"outline",onClick:()=>a("dashboard"),children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Dashboard"]}),e.jsxs(Xe,{open:V,onOpenChange:y=>y?u(!0):De(),children:[e.jsx(St,{asChild:!0,children:e.jsxs(k,{className:"bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",disabled:Me.length===0,children:[e.jsx(Cs,{className:"h-4 w-4 mr-2"}),Me.length===0?"No Entries to Process":"Start Processing"]})}),e.jsxs(Ye,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(es,{children:e.jsxs(Je,{className:"flex items-center gap-2",children:[e.jsx(Ls,{className:"h-5 w-5 text-blue-600"}),"Start Fish Processing"]})}),e.jsx(rn,{selectedEntryId:f,setSelectedEntryId:n,warehouseEntries:Me,processingRecords:r,formData:O,setFormData:le,selectedStorage:S,setSelectedStorage:T,storageLocations:m,isProcessing:K,onSubmit:Ce,onClose:De})]})]})]})]}),e.jsx(an,{stats:W,processingRecords:r}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(U,{children:[e.jsx(Fe,{children:e.jsxs(Pe,{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"h-5 w-5 text-blue-600"}),"Weekly Processing Activity"]})}),e.jsxs(H,{children:[e.jsx(sn,{data:W.weeklyProcessing,dataKey:"count"}),e.jsx("div",{className:"mt-2 text-center",children:e.jsx("p",{className:"text-sm text-gray-600",children:"Last 7 days"})})]})]}),e.jsxs(U,{children:[e.jsx(Fe,{children:e.jsxs(Pe,{className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"h-5 w-5 text-purple-600"}),"Yield Trends"]})}),e.jsxs(H,{children:[W.yieldTrends.length>0?e.jsx(tn,{data:W.yieldTrends,dataKey:"yield"}):e.jsx("div",{className:"h-32 flex items-center justify-center text-gray-500",children:"No yield data available"}),e.jsx("div",{className:"mt-2 text-center",children:e.jsx("p",{className:"text-sm text-gray-600",children:"Recent processing yield %"})})]})]})]}),e.jsxs(U,{children:[e.jsx(Fe,{children:e.jsxs(Pe,{className:"flex items-center gap-2",children:[e.jsx(aa,{className:"h-5 w-5"}),"Quality Grade Distribution"]})}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-3 gap-4",children:Object.entries(W.gradeDistribution).map(([y,L])=>e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs(se,{className:`${Ot(y)} text-white mb-2`,children:["Grade ",y]}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:L}),e.jsxs("p",{className:"text-sm text-gray-600",children:[W.totalProcessed>0?(L/W.totalProcessed*100).toFixed(1):0,"%"]})]},y))})})]}),e.jsxs(U,{children:[e.jsx(Fe,{children:e.jsxs(Pe,{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-5 w-5"}),"Recent Processing Activity",e.jsxs(se,{variant:"secondary",className:"ml-auto",children:[d.length," recent"]})]})}),e.jsx(H,{children:d.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ls,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No recent processing activity"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Start by processing some warehouse entries"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3",children:d.map(y=>(t.find(L=>L.id===y.warehouse_entry_id),e.jsx(U,{className:"p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(se,{variant:"outline",children:t.find(L=>L.id===y.warehouse_entry_id)?.entry_code}),e.jsx(se,{className:"bg-purple-500 text-white",children:y.processing_code}),e.jsxs(se,{className:`${Ot(y.final_grade)} text-white`,children:["Grade ",y.final_grade]}),e.jsx("span",{className:"text-sm text-gray-600",children:"Size: To be sorted"}),e.jsx(se,{variant:"outline",className:"text-blue-600 border-blue-300",children:"Processing Complete"}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(y.processing_date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-4 text-sm",children:[e.jsxs("span",{children:["Pre: ",y.pre_processing_weight,"kg"]}),e.jsxs("span",{children:["Post: ",y.post_processing_weight,"kg"]}),e.jsxs("span",{children:["Waste: ",y.processing_waste,"kg"]}),e.jsxs("span",{className:qt(y.processing_yield),children:["Yield: ",y.processing_yield,"%"]})]}),e.jsxs("p",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Ds,{className:"h-3 w-3"}),e.jsx("strong",{children:y.storage_location||"Not assigned"})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>fe(y),children:[e.jsx(rs,{className:"h-3 w-3 mr-1"}),"Details"]})})]})},y.id)))}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs(k,{variant:"outline",onClick:()=>re(!ae),className:"w-full",children:["View All ",r.length," Records"]})})]})})]}),ae&&e.jsxs(U,{className:"mt-6",children:[e.jsx(Fe,{children:e.jsxs(Pe,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5"}),"All Processing Records (",r.length,")"]})}),e.jsxs(H,{children:[e.jsx("div",{className:"space-y-4",children:r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ls,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No processing records found"})]}):r.map(y=>(t.find(L=>L.id===y.warehouse_entry_id),e.jsx(U,{className:"p-4 border border-gray-200 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-start gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(se,{variant:"outline",className:"font-medium",children:t.find(L=>L.id===y.warehouse_entry_id)?.entry_code}),e.jsx(se,{className:"bg-purple-500 text-white font-medium",children:y.processing_code}),e.jsxs(se,{className:`${Ot(y.final_grade)} text-white font-medium`,children:["Grade ",y.final_grade]}),e.jsx(se,{className:"bg-purple-500 text-white font-medium",children:"Size: To be sorted"}),e.jsx(se,{variant:"outline",className:"text-blue-600 border-blue-300 font-medium",children:"Processing Complete"}),e.jsxs("span",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(Bs,{className:"h-4 w-4"}),new Date(y.processing_date).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-6 text-sm",children:[e.jsxs("span",{children:["Pre: ",y.pre_processing_weight,"kg"]}),e.jsxs("span",{children:["Post: ",y.post_processing_weight,"kg"]}),e.jsxs("span",{children:["Waste: ",y.processing_waste,"kg"]}),e.jsxs("span",{className:qt(y.processing_yield),children:["Yield: ",y.processing_yield,"%"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1 font-medium text-gray-900",children:[e.jsx(Ds,{className:"h-4 w-4"}),y.farmer_name]}),e.jsxs("span",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(Te,{className:"h-4 w-4"}),"Storage: ",y.storage_location||"Not assigned"]})]})]}),e.jsx("div",{className:"flex gap-2 flex-shrink-0",children:e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>fe(y),children:[e.jsx(rs,{className:"h-4 w-4 mr-1"}),"View Details"]})})]})},y.id)))}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(k,{variant:"outline",onClick:()=>re(!1),className:"w-full",children:"Show Less"})})]})]}),e.jsx(Xe,{open:M,onOpenChange:R,children:e.jsxs(Ye,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(es,{children:e.jsx(Je,{className:"text-2xl font-bold",children:"Processing Details"})}),v&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Entry Code"}),e.jsx("span",{className:"font-medium",children:t.find(y=>y.id===v.warehouse_entry_id)?.entry_code})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Processing Code"}),e.jsx("span",{className:"font-medium",children:v.processing_code})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Processing Date"}),e.jsx("span",{className:"font-medium",children:new Date(v.processing_date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Farmer"}),e.jsx("span",{className:"font-medium",children:v.farmer_name||"Unknown"})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Processed By"}),e.jsx("span",{className:"font-medium",children:v.processed_by||"Not specified"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Final Grade"}),e.jsxs(se,{className:`${Ot(v.final_grade)} text-white`,children:["Grade ",v.final_grade]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Size"}),e.jsx("span",{className:"font-medium",children:"To be sorted"})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Storage Location"}),e.jsx("span",{className:"font-medium",children:v.storage_location||"Not assigned"})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Status"}),e.jsx(se,{className:"bg-green-600 text-white",children:"Complete"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Weight Analysis"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[v.pre_processing_weight,"kg"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pre-Processing"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[v.post_processing_weight,"kg"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Post-Processing"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:[v.processing_waste,"kg"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Waste"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${qt(v.processing_yield)}`,children:[v.processing_yield,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Yield"})]})]})]}),v.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Notes"}),e.jsx("p",{className:"text-gray-700 bg-gray-50 p-4 rounded-lg",children:v.notes})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(k,{onClick:()=>R(!1),children:"Close"})})]})]})})]})})}const ln=Object.freeze(Object.defineProperty({__proto__:null,default:nn},Symbol.toStringTag,{value:"Module"}));class on{async getSizeClassThresholds(){try{const{data:t,error:s}=await ie(async()=>await j.from("size_class_thresholds").select("*").eq("is_active",!0).order("class_number"));return s?(console.warn("Permission denied for size_class_thresholds, returning empty array"),[]):t||[]}catch(t){return console.warn("Error fetching size class thresholds:",t),[]}}async updateSizeClassThresholds(t){try{const s=t.map(d=>({...d,updated_at:new Date().toISOString()})),{data:r,error:l}=await ie(async()=>await j.from("size_class_thresholds").upsert(s).select());if(l)throw l;return r||[]}catch(s){throw new Error(Ne(s,"updating size class thresholds"))}}async getSizeClassForWeight(t){try{const{data:s,error:r}=await ie(async()=>await j.rpc("get_size_class_for_weight",{weight_grams:t}));if(r)throw r;return s}catch(s){throw new Error(Ne(s,"determining size class for weight"))}}async createSortingBatch(t){try{const{data:s,error:r}=await ie(async()=>await j.rpc("create_sorting_batch",{p_processing_record_id:t.processing_record_id,p_batch_number:t.batch_number,p_sorted_by:null,p_storage_location_id:t.storage_location_id||null}));if(r)throw r;const{data:l,error:d}=await ie(async()=>await j.from("sorting_batches").select(`
            *,
            processing_record:processing_records(
              id,
              processing_date,
              post_processing_weight,
              ready_for_dispatch_count,
              processing_code
            )
          `).eq("id",s).single());if(d)throw d;return l}catch(s){throw new Error(Ne(s,"creating sorting batch"))}}async getSortingBatches(t){try{let s=j.from("sorting_batches").select(`
          *,
          processing_record:processing_records(
            id,
            processing_date,
            post_processing_weight,
            ready_for_dispatch_count,
            processing_code,
            fish_type,
            grading_results,
            final_value,
            processing_yield,
            processing_waste,
            size_distribution,
            total_pieces,
            warehouse_entry:warehouse_entries(
              id,
              farmer_id,
              farmer:farmers(
                id,
                name,
                phone,
                location,
                rating
              )
            )
          )
        `).order("created_at",{ascending:!1});t?.status&&(s=s.eq("status",t.status)),t?.processing_record_id&&(s=s.eq("processing_record_id",t.processing_record_id)),t?.date_from&&(s=s.gte("sorting_date",t.date_from)),t?.date_to&&(s=s.lte("sorting_date",t.date_to));const r=t?.limit||50;s=s.limit(r);const{data:l,error:d}=await ie(async()=>s);if(d)throw d;return l||[]}catch(s){throw new Error(Ne(s,"fetching sorting batches"))}}async getSortingBatch(t){try{const{data:s,error:r}=await ie(async()=>await j.from("sorting_batches").select(`
            *,
            processing_record:processing_records(
              id,
              processing_date,
              post_processing_weight,
              ready_for_dispatch_count,
              processing_code,
              fish_type,
              grading_results,
              final_value,
              processing_yield,
              processing_waste,
              size_distribution,
              total_pieces,
              warehouse_entry:warehouse_entries(
                id,
                farmer_id,
                farmer:farmers(
                  id,
                  name,
                  phone,
                  location,
                  rating
                )
              )
            )
          `).eq("id",t).single());if(r)throw r;const{data:l,error:d}=await ie(async()=>await j.from("sorting_results").select("*").eq("sorting_batch_id",t).order("size_class"));if(d)throw d;return{...s,results:l||[]}}catch(s){throw new Error(Ne(s,"fetching sorting batch"))}}async addSortedFishItem(t){try{const{data:s,error:r}=await ie(async()=>await j.rpc("add_sorted_fish_item",{p_sorting_batch_id:t.sorting_batch_id,p_weight_grams:t.weight_grams,p_length_cm:t.length_cm,p_grade:t.grade,p_quality_notes:t.quality_notes,p_storage_location_id:t.storage_location_id||null}));if(r)throw r;const{data:l,error:d}=await ie(async()=>await j.from("sorted_fish_items").select("*").eq("id",s).single());if(d)throw d;return l}catch(s){throw new Error(Ne(s,"adding sorted fish item"))}}async updateSortingBatch(t,s){try{const{data:r,error:l}=await ie(async()=>await j.from("sorting_batches").update({...s,updated_at:new Date().toISOString()}).eq("id",t).select(`
            *,
            processing_record:processing_records(
              id,
              processing_date,
              post_processing_weight,
              ready_for_dispatch_count,
              processing_code
            )
          `).single());if(l)throw l;return r}catch(r){throw new Error(Ne(r,"updating sorting batch"))}}async completeSortingBatch(t){try{const{data:s,error:r}=await ie(async()=>await j.rpc("complete_sorting_batch",{p_sorting_batch_id:t}));if(r)throw r;return s}catch(s){throw new Error(Ne(s,"completing sorting batch"))}}async getSortingResultsForInventory(t){try{const{data:s,error:r}=await ie(async()=>await j.rpc("get_sorting_results_for_inventory",{p_sorting_batch_id:t}));if(r)throw r;return s||[]}catch(s){throw new Error(Ne(s,"fetching sorting results for inventory"))}}async getSortingSummary(t){try{const s=await this.getSortingBatch(t),r={},l={};let d=0,x=0;s.results.forEach(g=>{r[g.size_class]={pieces:g.total_pieces,weight:g.total_weight_grams,average_weight:g.average_weight_grams},d+=g.total_pieces,x+=g.total_weight_grams,Object.entries(g.grade_distribution).forEach(([f,n])=>{l[f]=(l[f]||0)+n})});const m=s.total_pieces>0?Math.round(d/s.total_pieces*100):0;return{batch_id:s.id,batch_number:s.batch_number,total_items:d,total_weight:x,size_class_distribution:r,grade_distribution:l,completion_percentage:m}}catch(s){throw new Error(Ne(s,"generating sorting summary"))}}async validateProcessingRecordForSorting(t){try{const{data:s,error:r}=await ie(async()=>await j.from("processing_records").select("*").eq("id",t).single());if(r)throw r;if(!s)return{canSort:!1,reason:"Processing record not found"};const{data:l,error:d}=await ie(async()=>await j.from("sorting_batches").select("id, status").eq("processing_record_id",t).eq("status","completed"));if(d)throw d;return(l&&l.length>0?l[0]:null)?{canSort:!1,reason:"Processing record already sorted"}:!s.post_processing_weight||s.post_processing_weight<=0?{canSort:!1,reason:"Invalid post-processing weight"}:!s.ready_for_dispatch_count||s.ready_for_dispatch_count<=0?{canSort:!1,reason:"No fish ready for dispatch"}:{canSort:!0,processingRecord:s}}catch(s){throw new Error(Ne(s,"validating processing record for sorting"))}}async getProcessingRecordsReadyForSorting(){try{const{data:t,error:s}=await ie(async()=>await j.from("processing_records").select(`
            *,
            warehouse_entry:warehouse_entries(
              id,
              entry_date,
              total_weight,
              farmer_id,
              entry_code,
              farmer:farmers(
                id,
                name,
                phone,
                location,
                rating
              )
            ),
            sorting_batches!left(
              id,
              status
            )
          `).gt("post_processing_weight",0).order("processing_date",{ascending:!1}));if(s)throw s;return(t||[]).filter(d=>!d.sorting_batches?.some(m=>m.status==="completed"))}catch(t){throw new Error(Ne(t,"fetching processing records ready for sorting"))}}}const jt=new on;class cn{async getInventoryByStorage(){try{return console.log("🔍 Getting inventory by storage with capacity method (working approach)..."),await this.getInventoryByStorageWithCapacity()}catch(t){console.warn("⚠️ Error in capacity method, falling back to legacy method:",t);try{return await this.getInventoryByStorageFallback()}catch(s){return console.warn("❌ Error in fallback method:",s),[]}}}async getInventoryByStorageWithFIFO(){throw console.warn("⚠️ FIFO database function is not available, this method is disabled"),new Error("FIFO_FUNCTION_NOT_AVAILABLE")}async getInventoryByStorageWithCapacity(){try{console.log("🔍 Getting all storage locations with capacity data...");const{data:t,error:s}=await ie(async()=>await j.from("storage_locations").select("id, name, location_type, capacity_kg, current_usage_kg, status").order("name"));if(s)throw s;console.log("📊 Storage locations from database:",t);const{data:r,error:l}=await ie(async()=>await j.from("sorting_results").select(`
            id,
            size_class,
            total_pieces,
            total_weight_grams,
            storage_location_id,
            sorting_batch_id,
            transfer_source_storage_id,
            transfer_source_storage_name,
            transfer_id,
            sorting_batch:sorting_batches(
              id,
              batch_number,
              status,
              created_at,
              processing_record:processing_records(
                id,
                processing_date,
                warehouse_entry:warehouse_entries(
                  id,
                  entry_date,
                  farmer_id,
                  farmers(name, phone, location)
                )
              )
            )
          `).not("storage_location_id","is",null).gt("total_weight_grams",0).order("created_at",{ascending:!1}));if(l)throw l;const d=(r||[]).filter(n=>n.sorting_batch&&n.sorting_batch.status==="completed");console.log("📦 Filtered sorting results (completed only):",d.length,"out of",r?.length||0);const x=new Map;console.log("🗺️ Creating storage map from locations:",t),t?.forEach(n=>{console.log("📍 Adding storage location to map:",n.id,n.name),x.set(n.id,n)}),console.log("🗺️ Storage map created with",x.size,"locations");const m={};t?.forEach(n=>{m[n.id]={storage_location_id:n.id,storage_location_name:n.name,storage_location_type:n.location_type,status:n.status||"active",capacity_kg:n.capacity_kg||0,current_usage_kg:0,available_capacity_kg:n.capacity_kg||0,utilization_percent:0,sizes:{}}}),console.log("🔄 Processing sorting results:",d.length,"results"),d.forEach(n=>{const S=n.storage_location_id,T=x.get(S);if(console.log("🔍 Processing result for storage:",S,"found storage:",!!T),!T){console.warn("⚠️ No storage found for ID:",S,"available storage IDs:",Array.from(x.keys()));return}if(!m[S]){console.warn("⚠️ No storage aggregation found for ID:",S);return}const V=n.size_class,u=n.total_pieces||0,v=(n.total_weight_grams||0)/1e3;u>0&&(m[S].sizes[V]||(m[S].sizes[V]={total_quantity:0,total_weight_kg:0,batch_count:0,contributing_batches:[]}),m[S].sizes[V].total_quantity+=u,m[S].sizes[V].total_weight_kg+=v,m[S].sizes[V].batch_count+=1,m[S].sizes[V].contributing_batches.push({batch_id:n.sorting_batch_id,batch_number:n.sorting_batch?.batch_number||`BATCH-${n.sorting_batch_id?.slice(-8).toUpperCase()}`,quantity:u,weight_kg:v,storage_location_name:T.name,farmer_name:n.sorting_batch?.processing_record?.warehouse_entry?.farmers?.name||"Unknown",processing_date:n.sorting_batch?.processing_record?.processing_date||"Unknown",added_date:n.sorting_batch?.created_at||new Date().toISOString(),created_at:n.sorting_batch?.created_at||new Date().toISOString(),is_transfer:!!n.transfer_id,transfer_id:n.transfer_id,transfer_source_storage_id:n.transfer_source_storage_id,transfer_source_storage_name:n.transfer_source_storage_name}))}),Object.values(m).forEach(n=>{let S=0;Object.values(n.sizes).forEach(T=>{S+=T.total_weight_kg}),n.current_usage_kg=S,n.available_capacity_kg=Math.max(0,n.capacity_kg-S),n.utilization_percent=n.capacity_kg>0?Math.round(S/n.capacity_kg*100*100)/100:0});const g=[];Object.values(m).forEach(n=>{Object.keys(n.sizes).length===0?g.push({storage_location_id:n.storage_location_id,storage_location_name:n.storage_location_name,storage_location_type:n.storage_location_type,storage_status:n.status||"active",capacity_kg:n.capacity_kg,current_usage_kg:n.current_usage_kg,available_capacity_kg:n.available_capacity_kg,utilization_percent:n.utilization_percent,size:null,total_quantity:0,total_weight_kg:0,batch_count:0,contributing_batches:[]}):Object.entries(n.sizes).forEach(([S,T])=>{g.push({storage_location_id:n.storage_location_id,storage_location_name:n.storage_location_name,storage_location_type:n.storage_location_type,storage_status:n.status||"active",capacity_kg:n.capacity_kg,current_usage_kg:n.current_usage_kg,available_capacity_kg:n.available_capacity_kg,utilization_percent:n.utilization_percent,size:parseInt(S),total_quantity:T.total_quantity,total_weight_kg:T.total_weight_kg,batch_count:T.batch_count,contributing_batches:T.contributing_batches})})}),console.log("📦 Final inventory result with capacity:",g),console.log("📊 Storage aggregation with capacity:",m);const f=g.filter(n=>n.size===9);return console.log("🔍 Size 9 in final inventory result:",f),console.log("🔍 Size 9 by storage:",f.map(n=>({storage:n.storage_location_name,weight:n.total_weight_kg,hasBatches:n.contributing_batches&&n.contributing_batches.length>0}))),g.sort((n,S)=>n.storage_location_name!==S.storage_location_name?n.storage_location_name.localeCompare(S.storage_location_name):n.size===null&&S.size!==null?-1:n.size!==null&&S.size===null?1:n.size===null&&S.size===null?0:n.size-S.size)}catch(t){throw new Error(Ne(t,"fetching inventory with capacity tracking"))}}async getInventoryByStorageFallback(){try{console.log("🔍 Getting storage locations directly from storage_locations table...");const{data:t,error:s}=await ie(async()=>await j.from("storage_locations").select("id, name, status").order("name"));if(console.log("📊 Storage locations from table:",t),console.log("❌ Storage error:",s),s){console.warn("Could not fetch storage locations table:",s),console.log("🔄 Using known storage locations...");const l=new Map;return l.set("5cc7c667-8959-4dde-abe8-bd41d2b26d4e","Cold Storage A"),l.set("f0f53658-830a-45c2-8dd3-4d0639e408d0","Cold Storage B"),l.set("cfb34d85-6120-42fa-9af9-945d7d235ebc","Test Storage"),l.set("0714e394-2396-438b-bcbe-9701633ff5ac","Freezer Unit 1"),l.set("2bc2ab3f-a2fb-4822-aae5-05c92cc4e913","Processing Area 1"),l.set("92ef2abd-d1c5-4941-80ef-d4478cfb00a7","Processing Area 2"),this.getInventoryWithStorageMap(l)}const r=new Map;return t?.forEach(l=>{r.set(l.id,l.name)}),console.log("✅ Using storage locations from table:",r),this.getInventoryWithStorageMap(r)}catch(t){console.error("Error in getInventoryByStorageFallback:",t);const s=new Map;return s.set("5cc7c667-8959-4dde-abe8-bd41d2b26d4e","Cold Storage A"),s.set("f0f53658-830a-45c2-8dd3-4d0639e408d0","Cold Storage B"),s.set("cfb34d85-6120-42fa-9af9-945d7d235ebc","Test Storage"),s.set("0714e394-2396-438b-bcbe-9701633ff5ac","Freezer Unit 1"),s.set("2bc2ab3f-a2fb-4822-aae5-05c92cc4e913","Processing Area 1"),s.set("92ef2abd-d1c5-4941-80ef-d4478cfb00a7","Processing Area 2"),this.getInventoryWithStorageMap(s)}}async getInventorySummary(){try{const{data:t,error:s}=await ie(async()=>await j.from("inventory").select("*").order("size",{ascending:!0}));if(s)throw s;return(t||[]).map(r=>({size:r.size,quantity:r.quantity,total_weight_kg:this.getEstimatedWeightPerFish(r.size)*r.quantity}))}catch(t){throw new Error(Ne(t,"fetching inventory summary"))}}getEstimatedWeightPerFish(t){return{0:.2,1:.3,2:.4,3:.5,4:.6,5:.7,6:.8,7:.9,8:1,9:1.1,10:1.2}[t]||.5}async getOldestBatchForRemoval(){try{console.log("🔍 Getting oldest batch for removal using inventory data...");const t=await this.getInventoryByStorage();if(console.log("📦 Inventory data for FIFO:",t?.length||0),!t||t.length===0)return console.log("📦 No inventory data found"),[];const s=new Map;t.forEach(d=>{d.size!==null&&d.total_weight_kg>0&&d.contributing_batches&&d.contributing_batches.forEach(x=>{const m=x.batch_id,g=x.batch_number||`BATCH-${m?.substring(0,8)}`;if(!s.has(m)){const n=x.created_at,S=n?Math.floor((new Date().getTime()-new Date(n).getTime())/(1e3*60*60*24)):0;s.set(m,{batch_id:m,batch_number:g,size_class:d.size,total_weight_kg:0,storage_location_name:d.storage_location_name,created_at:n,processing_date:x.processing_date,farmer_name:x.farmer_name||"Unknown Farmer",days_in_storage:S,batch_status:x.status||"unknown"})}const f=s.get(m);f.total_weight_kg+=d.total_weight_kg})});const r=Array.from(s.values()).filter(d=>d.total_weight_kg>0).sort((d,x)=>{const m=new Date(d.created_at||0).getTime(),g=new Date(x.created_at||0).getTime();return m!==g?m-g:(d.batch_id||"").localeCompare(x.batch_id||"")}).slice(0,10);console.log("📦 FIFO batches from inventory data:",r.length),r.length>0&&console.log("📦 First FIFO batch:",r[0]);const l=r.filter(d=>d.size_class===9);return console.log("🔍 Size 9 batches in FIFO:",l),r}catch(t){return console.error("❌ Error in getOldestBatchForRemoval:",t),[]}}async getOldestBatchFallback(){try{console.log("🔍 Using fallback method for oldest batches...");const{data:t,error:s}=await j.from("sorting_results").select(`
          id,
          size_class,
          total_pieces,
          total_weight_grams,
          storage_location_id,
          sorting_batch_id,
          created_at,
          storage_location:storage_locations(name)
        `).not("storage_location_id","is",null).gt("total_weight_grams",0).gt("total_pieces",0).order("created_at",{ascending:!0}).limit(20);if(s)return console.warn("⚠️ Error in fallback query:",s),[];if(!t||t.length===0)return console.log("📦 No results from fallback query either"),[];const r=t.map(x=>{const m=x.created_at,g=m?Math.floor((new Date().getTime()-new Date(m).getTime())/(1e3*60*60*24)):0;return{batch_id:x.sorting_batch_id||x.id,batch_number:`BATCH-${(x.sorting_batch_id||x.id)?.substring(0,8)}`,size_class:x.size_class,total_pieces:x.total_pieces,total_weight_kg:x.total_weight_grams/1e3,storage_location_name:x.storage_location?.name||"Unknown Storage",created_at:m,processing_date:null,farmer_name:"Unknown Farmer",days_in_storage:g,batch_status:"unknown"}}),l=new Map;r.forEach(x=>{x.batch_id&&!l.has(x.batch_id)&&l.set(x.batch_id,x)});const d=Array.from(l.values()).slice(0,10);return console.log("📦 Fallback method found:",d.length,"batches"),d}catch(t){return console.error("❌ Error in fallback method:",t),[]}}async getBatchDetails(t){try{console.log("🔍 Getting batch details for:",t);const{data:s,error:r}=await ie(async()=>await j.from("sorting_batches").select(`
            id,
            batch_number,
            status,
            created_at,
            processing_record:processing_records(
              id,
              processing_date,
              warehouse_entry:warehouse_entries(
                id,
                entry_date,
                farmer_id,
                farmers(name, phone, location)
              )
            )
          `).eq("id",t).single());if(r)return console.warn("⚠️ Error fetching batch details:",r),null;const{data:l,error:d}=await ie(async()=>await j.from("sorting_results").select(`
            id,
            size_class,
            total_pieces,
            total_weight_grams,
            storage_location_id,
            storage_location:storage_locations(
              id,
              name
            )
          `).eq("sorting_batch_id",t).gt("total_pieces",0).order("size_class"));if(d)return console.warn("⚠️ Error fetching batch sizes:",d),null;const x={batch:s,sizes:(l||[]).map(m=>({size_class:m.size_class,total_pieces:m.total_pieces,total_weight_kg:m.total_weight_grams/1e3,storage_location_name:m.storage_location?.name}))};return console.log("📦 Batch details processed:",x),x}catch(s){return console.error("❌ Error in getBatchDetails:",s),null}}async getSizeDemandStatistics(){try{console.log("🔍 Getting size demand statistics from outlet orders...");const{data:t,error:s}=await ie(async()=>await j.from("outlet_orders").select(`
            id,
            requested_sizes,
            requested_quantity,
            requested_grade,
            order_date,
            status,
            outlet:outlets(
              id,
              name,
              location
            )
          `).not("requested_sizes","is",null).order("order_date",{ascending:!1}));if(s)return console.warn("⚠️ Error fetching outlet orders data:",s),[];console.log("📦 Raw outlet orders data:",t);const r=(t||[]).filter(x=>["confirmed","processing","dispatched","delivered"].includes(x.status)&&x.requested_quantity>0);console.log("📦 Valid outlet orders:",r);const l=new Map;r.forEach(x=>{x.requested_sizes&&Array.isArray(x.requested_sizes)&&x.requested_sizes.forEach(m=>{l.has(m)||l.set(m,{size_class:m,total_orders:0,total_weight_kg_requested:0,outlet_count:new Set,first_order_date:null,last_order_date:null,grade_preferences:new Map});const g=l.get(m);if(g.total_orders+=1,g.total_weight_kg_requested+=x.requested_quantity||0,g.outlet_count.add(x.outlet?.id),x.requested_grade){const n=g.grade_preferences.get(x.requested_grade)||0;g.grade_preferences.set(x.requested_grade,n+1)}const f=new Date(x.order_date);(!g.first_order_date||f<new Date(g.first_order_date))&&(g.first_order_date=x.order_date),(!g.last_order_date||f>new Date(g.last_order_date))&&(g.last_order_date=x.order_date)})});const d=Array.from(l.values()).map(x=>({size_class:x.size_class,total_orders:x.total_orders,total_weight_kg_requested:x.total_weight_kg_requested,unique_outlets:x.outlet_count.size,first_order_date:x.first_order_date,last_order_date:x.last_order_date,days_span:x.first_order_date&&x.last_order_date?Math.ceil((new Date(x.last_order_date).getTime()-new Date(x.first_order_date).getTime())/(1e3*60*60*24)):0,most_requested_grade:Array.from(x.grade_preferences.entries()).sort((m,g)=>g[1]-m[1])[0]?.[0]||"any"})).filter(x=>x.total_weight_kg_requested>0).sort((x,m)=>m.total_weight_kg_requested-x.total_weight_kg_requested);return console.log("📊 Size demand statistics from outlet orders:",d),d}catch(t){return console.error("❌ Error in getSizeDemandStatistics:",t),[]}}async getInventoryWithStorageMap(t){try{const{data:s,error:r}=await ie(async()=>await j.from("sorting_results").select(`
            id,
            size_class,
            total_pieces,
            total_weight_grams,
            storage_location_id,
            sorting_batch_id,
            transfer_source_storage_id,
            transfer_source_storage_name,
            transfer_id,
            sorting_batch:sorting_batches(
              id,
              batch_number,
              status,
              created_at,
              processing_record:processing_records(
                id,
                processing_date,
                warehouse_entry:warehouse_entries(
                  id,
                  entry_date,
                  farmer_id,
                  farmers(name, phone, location)
                )
              )
            )
          `).not("storage_location_id","is",null).order("created_at",{ascending:!1}));if(r)throw r;const l=(s||[]).filter(m=>m.sorting_batch&&m.sorting_batch.status==="completed");console.log("📦 Filtered sorting results (completed only):",l.length,"out of",s?.length||0);const d={};l.forEach(m=>{const g=m.storage_location_id||"unknown",f=t.get(g)||"Unknown Storage",n=m.size_class,S=m.total_pieces||0,T=(m.total_weight_grams||0)/1e3;if(S>0){d[g]||(d[g]={storage_location_id:g,storage_location_name:f,sizes:{}}),d[g].sizes[n]||(d[g].sizes[n]={total_quantity:0,total_weight_kg:0,batch_count:0,contributing_batches:[]}),d[g].sizes[n].total_quantity+=S,d[g].sizes[n].total_weight_kg+=T,d[g].sizes[n].batch_count+=1;const V=!!m.transfer_id&&m.transfer_source_storage_name;d[g].sizes[n].contributing_batches.push({batch_id:m.sorting_batch_id,batch_number:m.sorting_batch?.batch_number||`BATCH-${m.sorting_batch_id?.slice(-8).toUpperCase()}`,quantity:S,weight_kg:T,storage_location_name:f,farmer_name:V?`${m.sorting_batch?.processing_record?.warehouse_entry?.farmers?.name||"Unknown"} (Transferred from ${m.transfer_source_storage_name})`:m.sorting_batch?.processing_record?.warehouse_entry?.farmers?.name||"Unknown",processing_date:m.sorting_batch?.processing_record?.processing_date||"Unknown",added_date:m.sorting_batch?.created_at||new Date().toISOString(),created_at:m.sorting_batch?.created_at||new Date().toISOString(),...V&&{is_transfer:!0,transfer_id:m.transfer_id,transfer_source_storage_id:m.transfer_source_storage_id,transfer_source_storage_name:m.transfer_source_storage_name}})}});const x=[];return Object.values(d).forEach(m=>{Object.entries(m.sizes).forEach(([g,f])=>{x.push({storage_location_id:m.storage_location_id,storage_location_name:m.storage_location_name,size:parseInt(g),total_quantity:f.total_quantity,total_weight_kg:f.total_weight_kg,batch_count:f.batch_count,contributing_batches:f.contributing_batches})})}),console.log("📦 Final inventory result:",x),console.log("📊 Storage aggregation:",d),x.sort((m,g)=>m.storage_location_name!==g.storage_location_name?m.storage_location_name.localeCompare(g.storage_location_name):m.size-g.size)}catch(s){throw new Error(Ne(s,"fetching inventory with storage map"))}}async getInventoryFromSortingBatchesFallback(t){try{const{data:s,error:r}=await ie(async()=>await j.from("sorting_batches").select(`
            id,
            batch_number,
            size_distribution,
            created_at,
            storage_location_id,
            processing_record:processing_records(
              id,
              processing_date,
              warehouse_entry:warehouse_entries(
                id,
                farmer_id,
                farmers(name, phone, location)
              )
            )
          `).eq("status","completed").not("size_distribution","is",null).order("created_at",{ascending:!1}));if(r)throw r;const l={};return s?.forEach(d=>{d.size_distribution&&typeof d.size_distribution=="object"&&Object.entries(d.size_distribution).forEach(([x,m])=>{const g=parseInt(x),f=parseInt(m)||0;if(!isNaN(g)&&f>0){const n=this.getEstimatedWeightPerFish(g),S=f*n;l[g]||(l[g]={total_quantity:0,total_weight_kg:0,batch_count:0,contributing_batches:[],storage_locations:{}}),l[g].total_quantity+=f,l[g].total_weight_kg+=S,l[g].batch_count+=1,l[g].contributing_batches.push({batch_id:d.id,batch_number:d.batch_number||`BATCH-${d.id?.slice(-8).toUpperCase()}`,quantity:f,weight_kg:S,storage_location_id:d.storage_location_id,storage_location_name:t.get(d.storage_location_id)||"Unknown Storage",farmer_name:d.processing_record?.warehouse_entry?.farmers?.name||"Unknown",processing_date:d.processing_record?.processing_date||"Unknown",added_date:d.created_at,created_at:d.created_at}),d.storage_location_id&&(l[g].storage_locations[d.storage_location_id]={storage_location_name:t.get(d.storage_location_id)||"Unknown Storage",quantity:(l[g].storage_locations[d.storage_location_id]?.quantity||0)+f,weight_kg:(l[g].storage_locations[d.storage_location_id]?.weight_kg||0)+S})}})}),Object.entries(l).map(([d,x])=>({size:parseInt(d),quantity:x.total_quantity,total_weight_kg:x.total_weight_kg,batch_count:x.batch_count,storage_locations:x.storage_locations,contributing_batches:x.contributing_batches})).sort((d,x)=>d.size-x.size)}catch(s){throw new Error(Ne(s,"fetching inventory from sorting batches fallback"))}}async getBatchesForSize(t){try{const{data:s,error:r}=await ie(async()=>await j.rpc("get_batches_for_size",{p_size:t}));if(r)throw r;return s||[]}catch(s){throw new Error(Ne(s,"fetching batches for size"))}}async getStorageCapacityStatus(){try{const{data:t,error:s}=await ie(async()=>await j.rpc("get_storage_capacity_status"));if(s)throw s;return t||[]}catch(t){throw new Error(Ne(t,"fetching storage capacity status"))}}async getAvailableStorageLocationsForSorting(t=0){try{const{data:s,error:r}=await ie(async()=>await j.rpc("get_available_storage_locations_for_sorting",{p_required_weight_kg:t}));if(r)throw r;return s||[]}catch(s){throw new Error(Ne(s,"fetching available storage locations"))}}async validateStorageLocationForSorting(t,s=0){try{const{data:r,error:l}=await ie(async()=>await j.rpc("validate_storage_location_for_sorting",{p_storage_location_id:t,p_estimated_weight_kg:s}));if(l)throw l;return r?.[0]||{is_valid:!1,message:"Validation failed",storage_location_name:"",available_capacity_kg:0,utilization_percent:0}}catch(r){throw new Error(Ne(r,"validating storage location"))}}async getInventoryItems(){try{const{data:t,error:s}=await ie(async()=>await j.from("inventory").select("*").order("size",{ascending:!0}));if(s)throw s;return t||[]}catch(t){throw new Error(Ne(t,"fetching inventory items"))}}async getInventoryEntries(t=100){try{const{data:s,error:r}=await ie(async()=>await j.from("inventory_entries").select("*").order("created_at",{ascending:!1}).limit(t));if(r)throw r;return s||[]}catch(s){throw new Error(Ne(s,"fetching inventory entries"))}}async addStockFromSorting(t){try{const{data:s,error:r}=await ie(async()=>await j.rpc("add_stock_from_sorting",{p_sorting_batch_id:t}));if(r)throw r;return s||[]}catch(s){throw new Error(Ne(s,"adding stock from sorting batch"))}}async getSortingBatchesForInventory(){try{const{data:t,error:s}=await ie(async()=>await j.from("sorting_batches").select(`
            *,
            processing_record:processing_records(
              id,
              post_processing_weight,
              processing_date,
              warehouse_entry:warehouse_entries(
                id,
                entry_date,
                farmer_id,
                farmers(name, phone, location)
              )
            )
          `).eq("status","completed").order("created_at",{ascending:!1}));if(s)throw s;return await Promise.all((t||[]).map(async l=>{const{data:d,error:x}=await ie(async()=>await j.from("sorting_results").select("*").eq("sorting_batch_id",l.id).order("size_class"));return x?(console.warn(`Error fetching results for batch ${l.id}:`,x),{...l,results:[]}):{...l,results:d||[]}}))}catch(t){throw new Error(Ne(t,"fetching sorting batches for inventory"))}}async validateSortingBatchForInventory(t){try{const{data:s,error:r}=await ie(async()=>await j.rpc("validate_sorting_batch_for_inventory",{p_sorting_batch_id:t}));if(r)throw r;return s||{canAdd:!1,reason:"Unknown error"}}catch(s){throw new Error(Ne(s,"validating sorting batch for inventory"))}}async getInventoryBySize(t){try{const{data:s,error:r}=await ie(async()=>await j.from("inventory").select("*").eq("size",t).single());if(r&&r.code!=="PGRST116")throw r;return s||null}catch(s){throw new Error(Ne(s,`fetching inventory for size ${t}`))}}async getInventoryStats(){try{const{data:t,error:s}=await ie(async()=>await j.rpc("get_inventory_statistics"));if(s)throw s;return t||{total_quantity:0,total_weight:0,size_distribution:{},last_updated:new Date().toISOString()}}catch(t){throw new Error(Ne(t,"fetching inventory statistics"))}}async createInventoryAdjustment(t,s,r){try{const{data:l,error:d}=await ie(async()=>await j.from("inventory_entries").insert({size:t,quantity_change:s,entry_type:"adjustment",notes:r}).select().single());if(d)throw d;return l}catch(l){throw new Error(Ne(l,"creating inventory adjustment"))}}async updateInventory(t,s){try{const{data:r,error:l}=await ie(async()=>await j.from("inventory").update({quantity:s,updated_at:new Date().toISOString()}).eq("id",t).select().single());if(l)throw l;return r}catch(r){throw new Error(Ne(r,"updating inventory item"))}}async processFIFOOrderFulfillment(t,s,r,l){try{const{data:d,error:x}=await ie(async()=>await j.rpc("process_fifo_order_fulfillment",{p_order_id:t,p_size:s,p_required_quantity:r,p_required_weight_kg:l}));if(x){if(x.code==="PGRST202"||x.message?.includes("Could not find the function"))return console.warn("⚠️ FIFO order fulfillment function not found. Please run the database script: db/ensure_inventory_storage_accuracy.sql"),{success:!1,message:"FIFO functions not available. Please run the database setup script.",allocatedBatches:[],remainingQuantity:r,remainingWeightKg:l};throw x}return d?.[0]||{success:!1,message:"Unknown error",allocatedBatches:[],remainingQuantity:0,remainingWeightKg:0}}catch(d){throw new Error(Ne(d,"processing FIFO order fulfillment"))}}async reduceInventoryOnOrderApproval(t,s,r,l){try{const{data:d,error:x}=await ie(async()=>await j.rpc("reduce_inventory_on_order_approval",{p_order_id:t,p_size:s,p_quantity:r,p_weight_kg:l}));if(x){if(x.code==="PGRST202"||x.message?.includes("Could not find the function"))return console.warn("⚠️ FIFO inventory reduction function not found. Please run the database script: db/ensure_inventory_storage_accuracy.sql"),{success:!1,message:"FIFO functions not available. Please run the database setup script.",reducedBatches:[]};throw x}return d?.[0]||{success:!1,message:"Unknown error",reducedBatches:[]}}catch(d){throw new Error(Ne(d,"reducing inventory on order approval"))}}async transferInventoryBetweenStorage(t,s,r,l,d){try{const{data:x,error:m}=await ie(async()=>await j.rpc("transfer_inventory_between_storage",{p_from_storage_location_id:t,p_to_storage_location_id:s,p_size:r,p_quantity:l,p_notes:d||null}));if(m){if(m.code==="PGRST202"||m.message?.includes("Could not find the function"))return console.warn("⚠️ Transfer function not found. Please run the database script: db/fix_inventory_storage_integration.sql"),{success:!1,message:"Transfer function not available. Please run the database setup script.",from_remaining:0,to_new_total:0};throw m}return x?.[0]||{success:!1,message:"Unknown error",from_remaining:0,to_new_total:0}}catch(x){throw new Error(Ne(x,"transferring inventory between storage locations"))}}async createTransfer(t,s,r,l,d,x){try{const{data:m,error:g}=await ie(async()=>await j.rpc("create_transfer",{p_from_storage_location_id:t,p_to_storage_location_id:s,p_size:r,p_quantity:l,p_weight_kg:d,p_notes:x||null}));if(g)throw g;return{success:!0,transferId:m,message:"Transfer created successfully"}}catch(m){throw new Error(Ne(m,"creating transfer"))}}async createTransferRequest(t,s,r,l,d,x){const m=await this.createTransfer(t,s,r,l,d,x);return{success:m.success,requestId:m.transferId,message:m.message}}async createBatchTransfer(t,s,r,l,d){try{const{data:x,error:m}=await ie(async()=>await j.from("transfers").select("id, size_class, quantity, weight_kg, notes").eq("from_storage_location_id",t).eq("to_storage_location_id",s).eq("status","pending"));if(m)console.warn("Could not check for existing transfers:",m);else if(x&&x.length>0&&r.some(S=>x.some(T=>T.size_class===S.size&&T.quantity===S.quantity&&Math.abs(T.weight_kg-S.weightKg)<.01)))throw new Error("A transfer request for these items already exists. Please check the transfer approvals section.");console.log("🔍 [InventoryService] Creating batch transfer with data:",{fromStorageLocationId:t,toStorageLocationId:s,sizeData:r,notes:l});const{data:g,error:f}=await ie(async()=>await j.rpc("create_batch_transfer",{p_from_storage_location_id:t,p_to_storage_location_id:s,p_size_data:r,p_notes:l||null,p_requested_by:d||null}));if(console.log("📊 [InventoryService] Batch transfer creation result:",{data:g,error:f}),f)throw f.code==="23505"?new Error("A transfer request for these items already exists. Please check the transfer approvals section."):f.message&&f.message.includes("function create_batch_transfer")?new Error("Transfer system not properly set up. Please run the database migration script: QUICK_TRANSFER_FIX.sql"):f;return{success:!0,transferId:g,message:`Batch transfer created successfully for ${r.length} sizes`}}catch(x){throw new Error(Ne(x,"creating batch transfer"))}}async approveTransfer(t,s){try{const{data:r,error:l}=await ie(async()=>await j.from("transfers").select("from_storage_location_id, to_storage_location_id, created_at, notes").eq("id",t).single());if(l)throw l;const{data:d,error:x}=await ie(async()=>await j.from("transfers").select("id",{count:"exact"}).eq("from_storage_location_id",r.from_storage_location_id).eq("to_storage_location_id",r.to_storage_location_id).eq("created_at",r.created_at).eq("notes",r.notes).eq("status","pending"));if(x)throw x;const m=(d?.length||0)>1,g=m?"approve_batch_transfer":"approve_transfer";console.log(`🔍 [InventoryService] ${m?"Batch":"Single"} transfer approval for ID: ${t}`);const{data:f,error:n}=await ie(async()=>await j.rpc(g,{p_transfer_id:t,p_approved_by:s}));if(n)throw n;return f?.[0]||{success:!1,message:"Unknown error"}}catch(r){throw new Error(Ne(r,"approving transfer"))}}async approveTransferRequest(t,s){return await this.approveTransfer(t,s)}async declineTransfer(t,s){try{const{data:r,error:l}=await ie(async()=>await j.from("transfers").select("from_storage_location_id, to_storage_location_id, created_at, notes").eq("id",t).single());if(l)throw l;const{data:d,error:x}=await ie(async()=>await j.from("transfers").select("id",{count:"exact"}).eq("from_storage_location_id",r.from_storage_location_id).eq("to_storage_location_id",r.to_storage_location_id).eq("created_at",r.created_at).eq("notes",r.notes).eq("status","pending"));if(x)throw x;const m=(d?.length||0)>1,g=m?"decline_batch_transfer":"decline_transfer";console.log(`🔍 [InventoryService] ${m?"Batch":"Single"} transfer decline for ID: ${t}`);const{data:f,error:n}=await ie(async()=>await j.rpc(g,{p_transfer_id:t,p_approved_by:s}));if(n)throw n;return f?.[0]||{success:!1,message:"Unknown error"}}catch(r){throw new Error(Ne(r,"declining transfer"))}}async completeTransfer(t,s){try{console.log(`🔍 [InventoryService] Marking transfer as completed for ID: ${t}`);const{data:r,error:l}=await ie(async()=>await j.rpc("complete_transfer",{p_transfer_id:t,p_completed_by:s}));if(l)throw l;return r?.[0]||{success:!1,message:"Unknown error"}}catch(r){throw new Error(Ne(r,"completing transfer"))}}async declineTransferRequest(t,s){return await this.declineTransfer(t,s)}async getPendingTransfers(){try{console.log("🔍 [InventoryService] Fetching pending transfers...");const{data:t,error:s}=await ie(async()=>await j.from("transfers").select("*").eq("status","pending").order("created_at",{ascending:!1}));return console.log("📊 [InventoryService] Pending transfers result:",{data:t,error:s,count:t?.length||0}),s?(console.warn("⚠️ [InventoryService] Error fetching pending transfers:",s),[]):t||[]}catch(t){return console.error("❌ [InventoryService] Error in getPendingTransfers:",t),[]}}async getPendingTransferRequests(){return await this.getPendingTransfers()}async getAvailableStorageLocationsForTransfer(t){try{const{data:s,error:r}=await ie(async()=>{let d=j.from("storage_locations").select("id, name, location_type, capacity_kg, current_usage_kg, status").eq("status","active").order("name");return t&&(d=d.neq("id",t)),await d});if(r)throw r;return await Promise.all((s||[]).map(async d=>{const{data:x,error:m}=await ie(async()=>await j.from("sorting_results").select("total_weight_grams").eq("storage_location_id",d.id));if(m)return console.warn(`Error calculating usage for ${d.name}:`,m),{...d,current_usage_kg:d.current_usage_kg||0,available_capacity_kg:(d.capacity_kg||0)-(d.current_usage_kg||0),utilization_percent:d.capacity_kg>0?(d.current_usage_kg||0)/d.capacity_kg*100:0};const g=(x||[]).reduce((S,T)=>S+(T.total_weight_grams||0)/1e3,0),f=Math.max(0,(d.capacity_kg||0)-g),n=d.capacity_kg>0?g/d.capacity_kg*100:0;return console.log(`Storage ${d.name}: Capacity=${d.capacity_kg}kg, Usage=${g.toFixed(2)}kg, Available=${f.toFixed(2)}kg`),{...d,current_usage_kg:g,available_capacity_kg:f,utilization_percent:n}}))}catch(s){throw new Error(Ne(s,"fetching available storage locations for transfer"))}}async getTransferHistory(t=100){try{console.log("🔍 [InventoryService] Fetching transfer history from transfers table...");const{data:s,error:r}=await ie(async()=>await j.from("transfers").select("*").order("created_at",{ascending:!1}).limit(t));if(console.log("📊 [InventoryService] Transfers table result:",{data:s,error:r,count:s?.length||0}),r)return console.error("❌ [InventoryService] Error accessing transfers table:",r),[];if(!s||s.length===0)return console.log("⚠️ [InventoryService] No transfer data found in transfers table"),[];const l=s.map(d=>({id:d.id,from_storage:d.from_storage_name||"Unknown",to_storage:d.to_storage_name||"Unknown",size:d.size_class,quantity:d.quantity,weight_kg:d.weight_kg||0,notes:d.notes||"",status:d.status,created_at:d.created_at,created_by:d.requested_by?`User ${d.requested_by.slice(0,8)}`:"System",approved_by:d.approved_by?`User ${d.approved_by.slice(0,8)}`:null,is_bulk:!1,batch_size:1}));return l.sort((d,x)=>new Date(x.created_at).getTime()-new Date(d.created_at).getTime()),console.log("📊 [InventoryService] Processed transfer data with bulk grouping:",l),l}catch(s){return console.error("Error fetching transfer history:",s),[]}}}const zs=new cn;async function Sa(a){try{const{data:t,error:s}=await a;if(s){if(s.message&&s.message.includes("406")){console.warn("406 error detected, trying alternative query approach");const{data:r,error:l}=await j.from("sorting_batches").select("*").limit(1);return l?(console.error("Fallback query also failed:",l),{data:null,error:l}):(console.warn("Fallback query succeeded, original query structure may be problematic"),{data:null,error:new Error("Query structure incompatible with current RLS policies")})}return{data:t,error:s}}return{data:t,error:s}}catch(t){return console.error("Unexpected error in safeQuerySortingBatches:",t),{data:null,error:t}}}function dn(a,t){if(console.error(`Supabase ${t} error:`,a),a&&typeof a=="object"){if(a.message&&a.message.includes("406"))return"Access denied. Please check your permissions or contact your administrator.";if(a.message&&a.message.includes("401"))return"Authentication required. Please log in again.";if(a.message&&a.message.includes("403"))return"Access forbidden. You do not have permission to perform this action.";if(a.message&&a.message.includes("JWT"))return"Authentication error. Please log in again.";if(a.message&&a.message.includes("relation")&&a.message.includes("does not exist"))return"Database table not found. Please contact your administrator.";if(a.message&&a.message.includes("permission denied"))return"Permission denied. Please check your user permissions.";if(a.message&&typeof a.message=="string")return a.message}return"An unexpected error occurred. Please try again."}const mn=({onNavigate:a})=>{const{user:t}=Js(),[s,r]=c.useState([]),[l,d]=c.useState([]),[x,m]=c.useState([]),[g,f]=c.useState([]),[n,S]=c.useState(!1),[T,V]=c.useState(null),[u,v]=c.useState(!1),[b,M]=c.useState(!1),[R,X]=c.useState(!1),[Z,K]=c.useState(!1),[z,ae]=c.useState(!1),[re,O]=c.useState(!1),[le,W]=c.useState(!1),[G,J]=c.useState(null),[h,Y]=c.useState(null),[q,we]=c.useState({batch_number:"",size_distribution:{},total_weight_kg:0,remaining_weight_kg:0,notes:"",storage_location_id:""}),Ce=c.useCallback(async()=>{S(!0),V(null);try{const[N,F,p]=await Promise.all([jt.getSizeClassThresholds(),jt.getSortingBatches({status:"completed",limit:20}),jt.getProcessingRecordsReadyForSorting()]);m(N),d(F),r(p);try{const{data:D,error:E}=await j.from("storage_locations").select("*").eq("status","active").order("name");E?(console.warn("Could not fetch storage locations:",E.message),f([{id:"default-1",name:"Cold Storage A",capacity_kg:1e3,current_usage_kg:0,location_type:"cold_storage"},{id:"default-2",name:"Cold Storage B",capacity_kg:1e3,current_usage_kg:0,location_type:"cold_storage"}])):f(D||[])}catch(D){console.warn("Error fetching storage locations:",D),f([{id:"default-1",name:"Cold Storage A",capacity_kg:1e3,current_usage_kg:0,location_type:"cold_storage"},{id:"default-2",name:"Cold Storage B",capacity_kg:1e3,current_usage_kg:0,location_type:"cold_storage"}])}}catch(N){console.error("Error loading sorting data:",N),V("Failed to load sorting data. Please try again."),m([]),d([]),r([]),f([])}finally{S(!1)}},[]);c.useEffect(()=>{Ce()},[Ce]);const De=c.useCallback(async()=>{v(!0),await Ce(),v(!1)},[]),fe=c.useMemo(()=>l.reduce((N,F)=>N+(F.total_weight_grams?F.total_weight_grams/1e3:0),0),[l]);c.useMemo(()=>s.reduce((N,F)=>N+(F.post_processing_weight||0),0),[s]);const Me=async N=>{try{if(console.log("Starting sorting for record:",N.id),!t){console.error("No user found in AuthContext"),ee.error("Please log in to continue.");return}console.log("User authenticated via AuthContext:",t.email);const F=j.from("sorting_batches").select("id, batch_number, status").eq("processing_record_id",N.id).eq("status","completed").maybeSingle(),{data:p,error:D}=await Sa(F);if(D){if(console.warn("Could not check for existing sorting batches:",D),D.message&&D.message.includes("406")){ee.error("Access denied. Please check your permissions or contact your administrator.");return}if(D.message&&D.message.includes("relation")&&D.message.includes("does not exist")){ee.error("Sorting functionality is not properly set up. Please contact your administrator.");return}console.warn("Continuing despite check error:",D.message)}if(p&&p.length>0){ee.error(`This processing record has already been sorted! Batch: ${p[0].batch_number}`);return}J(N);let E;try{E=await Ma()}catch(I){console.warn("Error generating batch number, using fallback:",I),E=`Batch${Date.now().toString().slice(-6)}`}const A=N.post_processing_weight||0;we({batch_number:E,size_distribution:{},total_weight_kg:A,remaining_weight_kg:A,notes:"",storage_location_id:""}),ae(!0)}catch(F){console.error("Error starting sorting:",F);const p=dn(F,"starting sorting");ee.error(p)}},y=(N,F)=>{const p={...q.size_distribution};F===0?delete p[N]:p[N]=F;const D=Object.values(p).reduce((A,I)=>A+I,0),E=q.total_weight_kg-D;we({...q,size_distribution:p,remaining_weight_kg:E})},L=async()=>{try{if(!G||Z)return;if(K(!0),q.remaining_weight_kg!==0){ee.error(`Please distribute all ${q.total_weight_kg}kg. ${q.remaining_weight_kg}kg remaining.`),K(!1);return}if(!q.storage_location_id){ee.error("Please select a storage location"),K(!1);return}const N=j.from("sorting_batches").select("id, batch_number, status").eq("processing_record_id",G.id).eq("status","completed").maybeSingle(),{data:F,error:p}=await Sa(N);if(p&&(console.warn("Could not check for existing sorting batches:",p),p.message&&p.message.includes("406"))){ee.error("Access denied. Please check your permissions or contact your administrator."),K(!1);return}if(F&&F.length>0){ee.error(`This processing record has already been sorted! Batch: ${F[0].batch_number}`),K(!1);return}const{error:D}=await j.from("processing_records").update({size_distribution:q.size_distribution,updated_at:new Date().toISOString()}).eq("id",G.id);if(D)throw console.error("Error updating processing record:",D),D;const E={processing_record_id:G.id,batch_number:q.batch_number,notes:q.notes,status:"completed",total_pieces:G.ready_for_dispatch_count||0,total_weight_grams:q.total_weight_kg*1e3,sorting_date:new Date().toISOString().split("T")[0],storage_location_id:q.storage_location_id,size_distribution:q.size_distribution};console.log("Creating batch with size distribution:",E.size_distribution);const{data:A,error:I}=await j.from("sorting_batches").insert([E]).select("id").single();if(I){if(I.code==="23505"&&I.message.includes("sorting_batches_one_completed_per_processing_record")){ee.error("This processing record has already been sorted! Please refresh the page to see the updated list."),await Ce(),K(!1);return}throw console.error("Error creating sorting batch:",I),I}if(A){try{const{data:P,error:be}=await j.from("storage_locations").select("current_usage_kg").eq("id",q.storage_location_id).single();if(be)console.warn("Could not fetch current storage usage:",be);else{const ze=(P.current_usage_kg||0)+q.total_weight_kg,{error:Ie}=await j.from("storage_locations").update({current_usage_kg:ze,updated_at:new Date().toISOString()}).eq("id",q.storage_location_id);Ie?console.warn("Could not update storage location capacity:",Ie):console.log("Updated storage location capacity:",q.storage_location_id)}}catch(P){console.warn("Error updating storage capacity:",P)}try{await zs.addStockFromSorting(A.id),console.log("Automatically added to inventory:",A.id)}catch(P){console.warn("Could not automatically add to inventory:",P),ee.error("Sorting completed but failed to add to inventory. Please add manually from inventory management.")}}ee.success("Fish sorted and batch created successfully!"),ae(!1),J(null),we({batch_number:"",size_distribution:{},total_weight_kg:0,remaining_weight_kg:0,notes:"",storage_location_id:""}),await Ce()}catch(N){ee.error("Failed to complete sorting"),console.error("Sorting error:",N)}finally{K(!1)}},je=()=>{O(!0)},ce=async N=>{try{console.log("Viewing batch details:",N),console.log("Batch size distribution:",N.size_distribution);const F=await jt.getSortingBatch(N.id);console.log("Fresh batch data:",F),Y(F),W(!0)}catch(F){console.error("Error fetching fresh batch data:",F),Y(N),W(!0)}};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Sorting Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Sort fish into size classes and manage sorting operations"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(k,{variant:"outline",onClick:De,disabled:u,className:"flex items-center gap-2",children:[e.jsx(Ze,{className:`w-4 h-4 ${u?"animate-spin":""}`}),"Refresh"]}),e.jsxs(k,{onClick:()=>a("inventory"),className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2",children:[e.jsx(Ks,{className:"w-4 h-4"}),"Go to Inventory"]})]})]})}),T&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-800",children:"Error Loading Data"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:T}),e.jsx(k,{onClick:De,variant:"outline",size:"sm",className:"mt-2",children:"Try Again"})]})]})}),e.jsx("div",{className:"px-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(U,{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm font-medium",children:"Processing Records"}),e.jsx("p",{className:"text-3xl font-bold",children:s.length})]}),e.jsx(Te,{className:"w-8 h-8 text-blue-200"})]})})}),e.jsx(U,{className:"bg-gradient-to-r from-green-500 to-green-600 text-white",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-sm font-medium",children:"Total Sorted"}),e.jsxs("p",{className:"text-3xl font-bold",children:[fe.toFixed(1),"kg"]}),e.jsxs("p",{className:"text-green-200 text-xs mt-1",children:[l.length," batches"]})]}),e.jsx(qe,{className:"w-8 h-8 text-green-200"})]})})}),e.jsx(U,{className:"bg-gradient-to-r from-purple-500 to-purple-600 text-white",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm font-medium",children:"Size Classes"}),e.jsx("p",{className:"text-3xl font-bold",children:x.length})]}),e.jsx(Ns,{className:"w-8 h-8 text-purple-200"})]})})})]})}),e.jsxs(U,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(Fe,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-b",children:e.jsxs(Pe,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Te,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xl font-semibold",children:"Processing Records Ready for Sorting"}),e.jsx("p",{className:"text-sm text-gray-600 font-normal mt-1",children:"Fish that have been processed and are ready to be sorted into size classes"})]})]})}),e.jsx(H,{className:"p-6",children:n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading processing records..."})]})}):s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"p-4 bg-blue-50 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:e.jsx(Te,{className:"w-10 h-10 text-blue-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Processing Records"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No fish have been processed yet"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-500",children:[e.jsx(qs,{className:"w-4 h-4"}),e.jsx("span",{children:"Process fish first, then they'll appear here for sorting"})]})]}):e.jsxs("div",{className:"space-y-4",children:[(R?s:s.slice(0,3)).map(N=>e.jsx("div",{className:"group p-6 border border-gray-200 rounded-xl hover:border-blue-300 hover:shadow-md transition-all duration-200 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg group-hover:bg-blue-200 transition-colors",children:e.jsx(ts,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("h4",{className:"font-semibold text-gray-900",children:["Processing Record ",N.processing_code||N.id]})}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($s,{className:"w-4 h-4"}),e.jsxs("span",{children:[N.post_processing_weight||N.total_weight||0,"kg"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ts,{className:"w-4 h-4"}),e.jsxs("span",{children:[N.ready_for_dispatch_count||N.fish_count||0," fish"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Bs,{className:"w-4 h-4"}),e.jsx("span",{children:new Date(N.processing_date||N.processed_at).toLocaleDateString()})]})]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(k,{onClick:()=>Me(N),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(wt,{className:"w-4 h-4 mr-2"}),"Sort Fish"]})})]})},N.id)),s.length>3&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(k,{variant:"outline",onClick:()=>X(!R),className:"text-blue-600 border-blue-300 hover:bg-blue-50",children:R?e.jsxs(e.Fragment,{children:[e.jsx(Nt,{className:"w-4 h-4 mr-2"}),"Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(Gs,{className:"w-4 h-4 mr-2"}),"View All (",s.length," records)"]})})})]})})]}),e.jsxs(U,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(Fe,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-b",children:e.jsxs(Pe,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(qe,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xl font-semibold",children:"Sorted Batches"}),e.jsx("p",{className:"text-sm text-gray-600 font-normal mt-1",children:"Completed sorting operations with size distribution"})]})]})}),e.jsx(H,{className:"p-6",children:l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"p-4 bg-green-50 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:e.jsx(qe,{className:"w-10 h-10 text-green-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Sorted Batches"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No fish have been sorted yet"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-500",children:[e.jsx(qs,{className:"w-4 h-4"}),e.jsx("span",{children:"Sort fish from processing records above to create batches"})]})]}):e.jsxs("div",{className:"space-y-4",children:[(b?l:l.slice(0,3)).map(N=>e.jsx("div",{className:"group p-6 border border-gray-200 rounded-xl hover:border-green-300 hover:shadow-md transition-all duration-200 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg group-hover:bg-green-200 transition-colors",children:e.jsx(qe,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("h4",{className:"font-semibold text-gray-900",children:["Sorted Batch #",N.batch_number||N.id.slice(-8).toUpperCase()]})}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Bs,{className:"w-4 h-4"}),e.jsxs("span",{children:["Created: ",new Date(N.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($s,{className:"w-4 h-4"}),e.jsxs("span",{children:[N.total_weight_grams?(N.total_weight_grams/1e3).toFixed(1):0,"kg"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ts,{className:"w-4 h-4"}),e.jsxs("span",{children:[N.total_pieces||0," pieces"]})]}),N.processing_record?.fish_type&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{children:N.processing_record.fish_type})]})]}),N.processing_record?.warehouse_entry?.farmer&&e.jsx("div",{className:"flex items-center gap-1 mt-2 text-xs text-gray-500",children:e.jsxs("span",{children:["Farmer: ",N.processing_record.warehouse_entry.farmer.name]})})]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(k,{size:"sm",onClick:()=>ce(N),className:"bg-orange-600 hover:bg-orange-700 text-white shadow-lg font-medium",children:[e.jsx(rs,{className:"w-4 h-4 mr-2"}),"View Details"]})})]})},N.id)),l.length>3&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(k,{variant:"outline",onClick:()=>M(!b),className:"text-green-600 border-green-300 hover:bg-green-50",children:b?e.jsxs(e.Fragment,{children:[e.jsx(Nt,{className:"w-4 h-4 mr-2"}),"Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(Gs,{className:"w-4 h-4 mr-2"}),"View All (",l.length," batches)"]})})})]})})]}),e.jsxs(U,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(Fe,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Pe,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(Ns,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xl font-semibold",children:"Size Class Thresholds"}),e.jsx("p",{className:"text-sm text-gray-600 font-normal mt-1",children:"Configure weight ranges for each size class (0-10)"})]})]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:je,children:[e.jsx(ia,{className:"w-4 h-4 mr-2"}),"Manage"]})]})}),e.jsx(H,{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map(N=>e.jsxs("div",{className:"group p-4 border border-gray-200 rounded-xl hover:border-green-300 hover:shadow-md transition-all duration-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs(se,{variant:"outline",className:`w-16 justify-center font-semibold ${N.class_number<=2?"border-blue-200 text-blue-700 bg-blue-50":N.class_number<=5?"border-green-200 text-green-700 bg-green-50":N.class_number<=8?"border-orange-200 text-orange-700 bg-orange-50":"border-red-200 text-red-700 bg-red-50"}`,children:["Class ",N.class_number]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:je,children:e.jsx(nt,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:N.description}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx($s,{className:"w-4 h-4"}),e.jsxs("span",{children:[N.min_weight_grams,"g - ",N.max_weight_grams===999999.99?"∞":`${N.max_weight_grams}g`]})]})]})]},N.class_number))})})]}),e.jsx(Xe,{open:le,onOpenChange:W,children:e.jsxs(Ye,{className:"w-[95vw] max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(es,{children:e.jsx(Je,{children:h?"Sorted Batch Details":"Sorting Details"})}),h?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 text-xs text-gray-600",children:[e.jsxs("span",{children:["Data refreshed: ",new Date().toLocaleTimeString()]}),e.jsxs("span",{children:["Batch ID: ",h.id.slice(-8).toUpperCase()]})]})}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-3",children:"Batch Information"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-blue-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Batch Number:"}),e.jsx("span",{className:"ml-2 font-mono text-xs",children:h.batch_number||h.id.slice(-8).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Code:"}),e.jsx("span",{className:"ml-2 font-mono text-xs",children:h.processing_record?.processing_code||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx(se,{variant:"outline",className:"ml-2",children:h.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Weight:"}),e.jsxs("span",{className:"ml-2 text-green-600 font-semibold",children:[h.total_weight_grams?(h.total_weight_grams/1e3).toFixed(1):0,"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Pieces:"}),e.jsx("span",{className:"ml-2 text-green-600 font-semibold",children:h.total_pieces||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Created Date:"}),e.jsx("span",{className:"ml-2",children:new Date(h.created_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Sorting Date:"}),e.jsx("span",{className:"ml-2",children:new Date(h.sorting_date).toLocaleDateString()})]})]})]}),h.processing_record&&e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-purple-900 mb-3",children:"Processing Record Details"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-purple-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Record ID:"}),e.jsx("span",{className:"ml-2 font-mono text-xs",children:h.processing_record.id?.slice(-8).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Date:"}),e.jsx("span",{className:"ml-2",children:new Date(h.processing_record.processing_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Post-Processing Weight:"}),e.jsxs("span",{className:"ml-2 text-green-600 font-semibold",children:[h.processing_record.post_processing_weight||0,"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Ready for Dispatch:"}),e.jsxs("span",{className:"ml-2 text-green-600 font-semibold",children:[h.processing_record.ready_for_dispatch_count||0," pieces"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fish Type:"}),e.jsx("span",{className:"ml-2",children:h.processing_record.fish_type||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Final Value:"}),e.jsx("span",{className:"ml-2",children:h.processing_record.final_value||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Yield:"}),e.jsxs("span",{className:"ml-2",children:[h.processing_record.processing_yield||0,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Waste:"}),e.jsxs("span",{className:"ml-2",children:[h.processing_record.processing_waste||0,"kg"]})]})]})]}),h.processing_record?.warehouse_entry?.farmer&&e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-900 mb-3",children:"Farmer Information"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-orange-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Farmer Name:"}),e.jsx("span",{className:"ml-2",children:h.processing_record.warehouse_entry.farmer.name})]}),h.processing_record.warehouse_entry.farmer.phone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"}),e.jsx("span",{className:"ml-2",children:h.processing_record.warehouse_entry.farmer.phone})]}),h.processing_record.warehouse_entry.farmer.location&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Location:"}),e.jsx("span",{className:"ml-2",children:h.processing_record.warehouse_entry.farmer.location})]}),h.processing_record.warehouse_entry.farmer.rating&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Rating:"}),e.jsxs("span",{className:"ml-2",children:[h.processing_record.warehouse_entry.farmer.rating,"/5"]})]})]})]}),h.storage_location_id&&e.jsxs("div",{className:"p-4 bg-indigo-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-indigo-900 mb-3",children:"Storage Information"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-indigo-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Storage Location ID:"}),e.jsx("span",{className:"ml-2 font-mono text-xs",children:h.storage_location_id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Stored Date:"}),e.jsx("span",{className:"ml-2",children:new Date(h.created_at).toLocaleDateString()})]})]})]}),h.size_distribution&&Object.keys(h.size_distribution).length>0||h.processing_record&&h.processing_record.size_distribution&&Object.keys(h.processing_record.size_distribution).length>0?e.jsxs("div",{children:[e.jsx(B,{className:"text-lg font-semibold",children:"Size Distribution"}),e.jsxs("div",{className:"mt-4 bg-gray-50 rounded-lg p-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-4",children:"Distribution Chart"}),e.jsx("div",{className:"space-y-3",children:Object.entries(h.size_distribution||h.processing_record?.size_distribution||{}).filter(([N,F])=>F>0).sort(([N],[F])=>parseInt(N)-parseInt(F)).map(([N,F])=>{const p=h.total_weight_grams?h.total_weight_grams/1e3:0,D=p>0?F/p*100:0;return e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsxs("div",{className:"w-12 sm:w-16 text-sm font-medium text-gray-700",children:["Size ",N]}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-6 sm:h-8 relative overflow-hidden",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-full rounded-full transition-all duration-300 flex items-center justify-end pr-2",style:{width:`${Math.min(D,100)}%`},children:D>15&&e.jsxs("span",{className:"text-xs font-medium text-white",children:[F,"kg"]})})}),e.jsxs("div",{className:"text-xs text-gray-600 w-12 text-right",children:[D.toFixed(1),"%"]})]},N)})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-3",children:"Detailed Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:Object.entries(h.size_distribution||h.processing_record?.size_distribution||{}).filter(([N,F])=>F>0).sort(([N],[F])=>parseInt(N)-parseInt(F)).map(([N,F])=>{const p=h.total_weight_grams?h.total_weight_grams/1e3:0,D=p>0?F/p*100:0;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-blue-700 text-sm",children:N})}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold text-gray-900",children:["Size ",N]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[D.toFixed(1),"% of total"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:[F,"kg"]})})]},N)})})]})]}):e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-yellow-800",children:"No size distribution data available for this batch"})]})}),(h.size_distribution&&Object.keys(h.size_distribution).length>0||h.processing_record&&h.processing_record.size_distribution&&Object.keys(h.processing_record.size_distribution).length>0)&&e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 mb-3",children:"Sorting Summary"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-green-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Sizes:"}),e.jsx("span",{className:"ml-2",children:Object.keys(h.size_distribution||h.processing_record?.size_distribution||{}).length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Distributed:"}),e.jsxs("span",{className:"ml-2 font-semibold",children:[Object.values(h.size_distribution||h.processing_record?.size_distribution||{}).reduce((N,F)=>N+F,0).toFixed(2),"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Largest Size:"}),e.jsxs("span",{className:"ml-2",children:["Size ",Object.entries(h.size_distribution||h.processing_record?.size_distribution||{}).reduce((N,[F,p])=>p>N.weight?{size:F,weight:p}:N,{size:"0",weight:0}).size]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Smallest Size:"}),e.jsxs("span",{className:"ml-2",children:["Size ",Object.entries(h.size_distribution||h.processing_record?.size_distribution||{}).reduce((N,[F,p])=>p<N.weight?{size:F,weight:p}:N,{size:"0",weight:1/0}).size]})]})]})]}),h.notes&&e.jsxs("div",{children:[e.jsx(B,{className:"text-lg font-semibold",children:"Batch Notes"}),e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:h.notes})})]}),h.sorted_by_user&&e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-900 mb-3",children:"Sorted By"}),e.jsxs("div",{className:"text-sm text-orange-700",children:[e.jsx("span",{className:"font-medium",children:"User:"}),e.jsx("span",{className:"ml-2",children:h.sorted_by_user.email})]})]})]}):G?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-3",children:"Processing Record Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-blue-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Record ID:"}),e.jsx("span",{className:"ml-2 font-mono text-xs",children:G.id?.slice(-8).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Date:"}),e.jsx("span",{className:"ml-2",children:new Date(G.processing_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Weight:"}),e.jsxs("span",{className:"ml-2 text-green-600 font-semibold",children:[G.post_processing_weight||0,"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Pieces:"}),e.jsx("span",{className:"ml-2 text-green-600 font-semibold",children:G.ready_for_dispatch_count||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fish Type:"}),e.jsx("span",{className:"ml-2",children:G.fish_type||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Final Grade:"}),e.jsx("span",{className:"ml-2",children:G.final_grade||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Yield:"}),e.jsxs("span",{className:"ml-2",children:[G.processing_yield||0,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Waste:"}),e.jsxs("span",{className:"ml-2",children:[G.processing_waste||0,"kg"]})]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Debug Information"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Size Distribution Type:"})," ",typeof G.size_distribution]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Size Distribution Value:"})," ",JSON.stringify(G.size_distribution)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Has Size Distribution:"})," ",G.size_distribution?"Yes":"No"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Size Distribution Keys:"})," ",G.size_distribution?Object.keys(G.size_distribution).join(", "):"None"]})]})]}),G.size_distribution&&Object.keys(G.size_distribution).length>0?e.jsxs("div",{children:[e.jsx(B,{className:"text-lg font-semibold",children:"Size Distribution"}),e.jsxs("div",{className:"mt-4 bg-gray-50 rounded-lg p-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-4",children:"Distribution Chart"}),e.jsx("div",{className:"space-y-3",children:Object.entries(G.size_distribution).filter(([N,F])=>F>0).sort(([N],[F])=>parseInt(N)-parseInt(F)).map(([N,F])=>{const p=G.post_processing_weight>0?F/G.post_processing_weight*100:0;return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"w-16 text-sm font-medium text-gray-700",children:["Size ",N]}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-8 relative overflow-hidden",children:e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-green-600 h-full rounded-full transition-all duration-300 flex items-center justify-between px-3",style:{width:`${Math.min(p,100)}%`},children:[e.jsxs("span",{className:"text-sm font-medium text-white",children:[F,"kg"]}),e.jsxs("span",{className:"text-xs text-green-100",children:[p.toFixed(1),"%"]})]})})]},N)})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-3",children:"Detailed Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.entries(G.size_distribution).filter(([N,F])=>F>0).sort(([N],[F])=>parseInt(N)-parseInt(F)).map(([N,F])=>{const p=G.post_processing_weight>0?F/G.post_processing_weight*100:0;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-green-100 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-green-700 text-sm",children:N})}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold text-gray-900",children:["Size ",N]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[p.toFixed(1),"% of total"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[F,"kg"]})})]},N)})})]})]}):e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-yellow-800",children:"No size distribution data available for this record"})]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-2",children:"This record may not have been sorted yet, or the size distribution data is missing."})]}),G.size_distribution&&Object.keys(G.size_distribution).length>0?e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 mb-3",children:"Sorting Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-green-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Sizes:"}),e.jsx("span",{className:"ml-2",children:Object.keys(G.size_distribution).length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Distributed:"}),e.jsxs("span",{className:"ml-2 font-semibold",children:[Object.values(G.size_distribution).reduce((N,F)=>N+F,0).toFixed(2),"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Largest Size:"}),e.jsxs("span",{className:"ml-2",children:["Size ",Object.entries(G.size_distribution).reduce((N,[F,p])=>p>N.weight?{size:F,weight:p}:N,{size:"0",weight:0}).size]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Smallest Size:"}),e.jsxs("span",{className:"ml-2",children:["Size ",Object.entries(G.size_distribution).reduce((N,[F,p])=>p<N.weight?{size:F,weight:p}:N,{size:"0",weight:1/0}).size]})]})]})]}):e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Sorting Status"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:"This processing record has not been sorted yet."}),e.jsx("p",{className:"mt-2",children:'Use the "Sort Fish" button to distribute the fish into size classes.'})]})]}),(G.notes||G.processing_notes)&&e.jsxs("div",{children:[e.jsx(B,{className:"text-lg font-semibold",children:"Notes & Comments"}),e.jsxs("div",{className:"mt-3 space-y-3",children:[G.notes&&e.jsxs("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-yellow-900 mb-1",children:"Processing Notes"}),e.jsx("p",{className:"text-sm text-yellow-800",children:G.notes})]}),G.processing_notes&&e.jsxs("div",{className:"p-3 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-purple-900 mb-1",children:"Additional Notes"}),e.jsx("p",{className:"text-sm text-purple-800",children:G.processing_notes})]})]})]}),G.farmer_name&&e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-900 mb-3",children:"Farmer Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-orange-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Farmer Name:"}),e.jsx("span",{className:"ml-2",children:G.farmer_name})]}),G.farmer_phone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"}),e.jsx("span",{className:"ml-2",children:G.farmer_phone})]}),G.farmer_location&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Location:"}),e.jsx("span",{className:"ml-2",children:G.farmer_location})]}),G.farmer_rating&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Rating:"}),e.jsxs("span",{className:"ml-2",children:[G.farmer_rating,"/5"]})]})]})]})]}):null,e.jsx(at,{children:e.jsx(k,{variant:"outline",onClick:()=>W(!1),children:"Close"})})]})}),e.jsx(Xe,{open:re,onOpenChange:O,children:e.jsxs(Ye,{className:"sm:max-w-4xl",children:[e.jsx(es,{children:e.jsx(Je,{children:"Manage Size Class Thresholds"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Configure the weight ranges for each size class. Fish will be automatically sorted into these classes based on their weight."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto",children:x.map(N=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-medium",children:["Class ",N.class_number]}),e.jsx(se,{variant:"outline",children:N.is_active?"Active":"Inactive"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:N.description}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Range:"})," ",N.min_weight_grams,"g - ",N.max_weight_grams===999999.99?"∞":`${N.max_weight_grams}g`]})]},N.class_number))})]}),e.jsxs(at,{children:[e.jsx(k,{variant:"outline",onClick:()=>O(!1),children:"Close"}),e.jsx(k,{onClick:()=>O(!1),children:"Save Changes"})]})]})}),e.jsx(Xe,{open:z,onOpenChange:ae,children:e.jsxs(Ye,{className:"w-[95vw] max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(es,{children:[e.jsx(Je,{className:"text-xl font-semibold",children:"Sort Fish into Size Classes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Distribute the processed fish across different size classes"})]}),e.jsxs("div",{className:"space-y-6",children:[G&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ts,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h4",{className:"font-semibold text-blue-900",children:"Processing Record Summary"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Total Weight:"}),e.jsxs("p",{className:"text-blue-900 font-semibold",children:[G.post_processing_weight||0,"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Total Pieces:"}),e.jsx("p",{className:"text-blue-900 font-semibold",children:G.ready_for_dispatch_count||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Fish Type:"}),e.jsx("p",{className:"text-blue-900 font-semibold",children:G.fish_type||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Processing Date:"}),e.jsx("p",{className:"text-blue-900 font-semibold",children:new Date(G.processing_date).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Size Distribution"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Remaining:"}),e.jsxs("span",{className:`font-medium px-2 py-1 rounded ${q.remaining_weight_kg===0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[q.remaining_weight_kg.toFixed(1),"kg"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:Array.from({length:11},(N,F)=>F).map(N=>{const F=q.size_distribution[N.toString()]||0,p=F>0,D=q.total_weight_kg>0?F/q.total_weight_kg*100:0;return e.jsxs("div",{className:`p-3 rounded-lg border transition-all hover:shadow-sm ${p?"bg-blue-50 border-blue-200 shadow-sm":"bg-gray-50 border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(B,{htmlFor:`size-${N}`,className:`text-sm font-medium ${p?"text-blue-700":"text-gray-600"}`,children:["Size ",N]}),p&&e.jsxs("span",{className:"text-xs text-blue-600 font-medium",children:[D.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{id:`size-${N}`,type:"number",min:"0",max:q.total_weight_kg,step:"0.1",value:F||"",onChange:E=>y(N.toString(),parseFloat(E.target.value)||0),placeholder:"0.0",className:`flex-1 text-sm ${p?"border-blue-300 focus:border-blue-500 bg-white":"border-gray-200"}`}),e.jsx("span",{className:"text-xs text-gray-500 whitespace-nowrap",children:"kg"})]}),p&&e.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-1",children:e.jsx("div",{className:"bg-blue-500 h-1 rounded-full transition-all duration-300",style:{width:`${Math.min(D,100)}%`}})})]},N)})}),q.remaining_weight_kg!==0&&e.jsx("div",{className:`p-3 rounded-lg border ${q.remaining_weight_kg>0?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:`w-4 h-4 ${q.remaining_weight_kg>0?"text-yellow-600":"text-red-600"}`}),e.jsx("span",{className:`text-sm ${q.remaining_weight_kg>0?"text-yellow-800":"text-red-800"}`,children:q.remaining_weight_kg>0?`${q.remaining_weight_kg.toFixed(1)}kg remaining to distribute`:`Over-distributed by ${Math.abs(q.remaining_weight_kg).toFixed(1)}kg`})]})}),q.remaining_weight_kg===0&&Object.keys(q.size_distribution).filter(N=>q.size_distribution[N]>0).length>0&&e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm text-green-800",children:["✓ All ",q.total_weight_kg,"kg distributed across ",Object.keys(q.size_distribution).filter(N=>q.size_distribution[N]>0).length," size classes"]})]})})]}),Object.keys(q.size_distribution).filter(N=>q.size_distribution[N]>0).length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Distribution Preview"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[Object.keys(q.size_distribution).filter(N=>q.size_distribution[N]>0).length," sizes"]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-100",children:e.jsx("div",{className:"space-y-2",children:Object.entries(q.size_distribution).filter(([N,F])=>F>0).sort(([N],[F])=>parseInt(N)-parseInt(F)).map(([N,F])=>{const p=q.total_weight_kg>0?F/q.total_weight_kg*100:0;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 text-sm font-medium text-gray-700",children:["Size ",N]}),e.jsx("div",{className:"flex-1 bg-white rounded-full h-4 relative overflow-hidden border border-gray-200",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-full rounded-full transition-all duration-300 flex items-center justify-end pr-2",style:{width:`${Math.min(p,100)}%`},children:p>20&&e.jsxs("span",{className:"text-xs font-medium text-white",children:[F,"kg"]})})}),e.jsxs("div",{className:"text-xs text-gray-600 w-12 text-right font-medium",children:[p.toFixed(1),"%"]})]},N)})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"storage-location",className:"text-sm font-medium",children:"Storage Location *"}),e.jsxs(os,{value:q.storage_location_id,onValueChange:N=>we({...q,storage_location_id:N}),children:[e.jsx(ds,{className:"mt-1",children:e.jsx(cs,{placeholder:"Select storage location"})}),e.jsx(ms,{children:(()=>{const N=g.filter(F=>(F.capacity_kg-(F.current_usage_kg||0),(F.capacity_kg>0?(F.current_usage_kg||0)/F.capacity_kg*100:0)<100));return N.length===0?e.jsx("div",{className:"p-3 text-center text-gray-500 text-sm",children:"No storage locations available - all units are full"}):N.map(F=>{const p=F.capacity_kg-(F.current_usage_kg||0),D=p<q.total_weight_kg;return e.jsx(_e,{value:F.id,children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("span",{className:D?"text-red-600":"",children:F.name}),e.jsxs("span",{className:`text-xs ml-2 ${D?"text-red-500":"text-gray-500"}`,children:[p,"kg available"]})]})},F.id)})})()})]}),q.storage_location_id&&(()=>{const N=g.find(D=>D.id===q.storage_location_id);if(!N)return null;const F=N.capacity_kg-(N.current_usage_kg||0);return F<q.total_weight_kg?e.jsxs("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-700",children:["⚠️ Insufficient capacity (",F,"kg available, ",q.total_weight_kg,"kg needed)"]}):e.jsxs("div",{className:"mt-2 p-2 bg-green-50 border border-green-200 rounded text-xs text-green-700",children:["✓ ",F-q.total_weight_kg,"kg remaining after storage"]})})()]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"sorting-notes",className:"text-sm font-medium",children:"Notes (Optional)"}),e.jsx(Ms,{id:"sorting-notes",value:q.notes,onChange:N=>we({...q,notes:N.target.value}),placeholder:"Add any notes about this sorting operation...",rows:3,className:"mt-1"})]})]})]})]}),e.jsxs(at,{className:"mt-6",children:[e.jsx(k,{variant:"outline",onClick:()=>ae(!1),children:"Cancel"}),e.jsx(k,{onClick:L,disabled:(()=>{if(Z||q.remaining_weight_kg!==0||!q.storage_location_id)return!0;const N=g.find(F=>F.id===q.storage_location_id);return!!(N&&N.capacity_kg-(N.current_usage_kg||0)<q.total_weight_kg)})(),className:"bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:Z?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Complete Sorting"]})})]})]})})]})})},xn=Object.freeze(Object.defineProperty({__proto__:null,default:mn},Symbol.toStringTag,{value:"Module"}));function gt({className:a,...t}){return e.jsx(Pr,{"data-slot":"checkbox",className:Ee("peer border bg-input-background dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",a),...t,children:e.jsx(Er,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(dt,{className:"size-3.5"})})})}function hn({isOpen:a,onClose:t,sourceStorage:s,itemsToTransfer:r,onTransferComplete:l}){const{user:d}=Js(),[x,m]=c.useState([]),[g,f]=c.useState(""),[n,S]=c.useState(""),[T,V]=c.useState(!1),[u,v]=c.useState(null),[b,M]=c.useState(null),[R,X]=c.useState(!1),[Z,K]=c.useState(new Set);c.useEffect(()=>{if(a){const h=new Set(r.map(Y=>Y.size));K(h),v(null),M(null)}},[a,s.id,r]),c.useEffect(()=>{a&&Z.size>0&&W()},[Z,a,s.id]);const z=r.filter(h=>Z.has(h.size)).reduce((h,Y)=>h+Y.total_weight,0),ae=r.filter(h=>Z.has(h.size)).reduce((h,Y)=>h+Y.quantity,0),re=h=>{K(h?new Set(r.map(Y=>Y.size)):new Set)},O=(h,Y)=>{const q=new Set(Z);Y?q.add(h):q.delete(h),K(q)},le=Z.size===r.length;Z.size>0;const W=async()=>{V(!0),v(null);try{const h=await zs.getAvailableStorageLocationsForTransfer(s.id),Y=r.filter(we=>Z.has(we.size)).reduce((we,Ce)=>we+Ce.total_weight,0),q=h.filter(we=>{const Ce=we.available_capacity_kg>=Y;return console.log(`${we.name}: ${we.available_capacity_kg}kg available, need ${Y.toFixed(1)}kg - ${Ce?"SUITABLE":"NOT ENOUGH SPACE"}`),Ce});console.log(`Found ${q.length} suitable storage locations for ${Y.toFixed(1)}kg transfer`),console.log("Suitable storages:",q),m(q),q.length===0?v(`No storage locations have enough capacity for this transfer. Total weight to transfer: ${Y.toFixed(1)}kg`):console.log(`Found ${q.length} suitable storage locations for transfer`)}catch(h){console.error("Error loading available storages:",h),v(h.message||"Failed to load available storage locations")}finally{V(!1)}},G=async()=>{if(!R){if(!g){v("Please select a destination storage location");return}if(Z.size===0){v("Please select at least one size to transfer");return}X(!0),v(null);try{console.log("Creating transfer request..."),console.log("Source storage:",s),console.log("Destination storage ID:",g),console.log("Selected sizes:",Array.from(Z)),console.log("Items to transfer:",r.filter(De=>Z.has(De.size)));const h=r.filter(De=>Z.has(De.size)),Y=h.reduce((De,fe)=>De+fe.quantity,0),q=h.reduce((De,fe)=>De+fe.total_weight,0);console.log(`Creating batch transfer for ${h.length} selected size classes, total quantity: ${Y}, total weight: ${q}kg`);const we=h.map(De=>({size:De.size,quantity:De.quantity,weightKg:De.total_weight})),Ce=await zs.createBatchTransfer(s.id,g,we,`Transfer from ${s.name} - Sizes: ${Array.from(Z).sort().join(", ")} - ${n||"No notes"}`,d?.id);console.log("Batch transfer created:",Ce),M(`Transfer request created successfully for ${h.length} size${h.length!==1?"s":""}! Awaiting approval.`),setTimeout(()=>{l(),t()},2e3)}catch(h){console.error("Error creating transfer request:",h),h.message&&(h.message.includes("already exists")||h.message.includes("409"))?v("A transfer request for these items already exists. Please check the 'Transfer Approvals' section to review pending requests."):h.message&&h.message.includes("ERR_CONNECTION_CLOSED")?v("Connection error. Please check your internet connection and try again."):h.message&&h.message.includes("500")?v("Server error. Please try again in a moment."):h.message&&h.message.includes("insufficient")?v("Insufficient inventory for this transfer. Please check available quantities."):v(h.message||"Failed to create transfer request. Please try again.")}finally{X(!1)}}},J=x.find(h=>h.id===g);return e.jsx(Xe,{open:a,onOpenChange:t,children:e.jsxs(Ye,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(es,{children:e.jsxs(Je,{className:"flex items-center gap-2",children:[e.jsx(qs,{className:"w-5 h-5"}),"Transfer Stock from ",s.name]})}),e.jsxs("div",{className:"space-y-6 overflow-y-auto flex-1 pr-2",children:[e.jsx(U,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(Ks,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:s.location_type.replace("_"," ")})]}),e.jsx(se,{variant:"destructive",children:"Inactive"})]})})}),e.jsx(U,{children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ns,{className:"w-4 h-4"}),"Fish to Transfer (by Weight)"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(gt,{id:"select-all",checked:le,onCheckedChange:re}),e.jsx("label",{htmlFor:"select-all",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Select All"})]})]}),e.jsxs("div",{className:"space-y-2",children:[r.map((h,Y)=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${Z.has(h.size)?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(gt,{id:`size-${h.size}`,checked:Z.has(h.size),onCheckedChange:q=>O(h.size,q)}),e.jsxs(se,{variant:"outline",className:"w-16 justify-center",children:["Size ",h.size]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[h.total_weight.toFixed(1),"kg"]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[h.quantity," pieces"]})]},Y)),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Total Weight"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[ae," pieces selected"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"font-bold text-green-600 text-lg",children:[z.toFixed(1),"kg"]})]})]})]})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Ks,{className:"w-4 h-4"}),"Available Storage Locations"]}),T?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(et,{className:"w-6 h-6 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading available storage locations..."})]}):u?e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-1 bg-red-100 rounded-full",children:e.jsx(ns,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-1",children:"Transfer Request Failed"}),e.jsx("p",{className:"text-sm text-red-700",children:u}),u.includes("already exists")&&e.jsx("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded",children:e.jsxs("p",{className:"text-xs text-blue-700",children:["💡 ",e.jsx("strong",{children:"Tip:"}),' Navigate to "Transfer Approvals" to review and approve existing requests.']})})]})]})}):x.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ns,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No suitable storage locations found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"All active storage locations are at capacity or don't have enough space"})]}):e.jsx("div",{className:"space-y-3",children:x.map(h=>e.jsx("div",{className:`p-4 border rounded-lg transition-all ${g===h.id?"border-blue-300 bg-blue-50 cursor-pointer":"border-gray-200 hover:border-blue-300 hover:bg-gray-50 cursor-pointer"}`,onClick:()=>{f(h.id)},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 ${g===h.id?"border-blue-600 bg-blue-600":"border-gray-300"}`,children:g===h.id&&e.jsx(qe,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:h.name}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:h.location_type.replace("_"," ")})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ns,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[h.available_capacity_kg.toFixed(1),"kg available"]})]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-1",children:[h.current_usage_kg.toFixed(1),"kg / ",h.capacity_kg.toFixed(1),"kg used"]}),e.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["Need: ",z.toFixed(1),"kg"]}),e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2 mt-1",children:e.jsx("div",{className:`h-2 rounded-full ${h.utilization_percent>=90?"bg-red-500":h.utilization_percent>=70?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(h.utilization_percent,100)}%`}})})]})]})},h.id))})]})}),b&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-1 bg-green-100 rounded-full",children:e.jsx(qe,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-1",children:"Transfer Request Created"}),e.jsx("p",{className:"text-sm text-green-700",children:b})]})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-4",children:[e.jsx(B,{htmlFor:"transfer-notes",className:"text-sm font-medium text-gray-700",children:"Transfer Notes (Optional)"}),e.jsx(Ms,{id:"transfer-notes",placeholder:"Add notes about this transfer...",value:n,onChange:h=>S(h.target.value),className:"mt-2",rows:3})]})}),J&&e.jsx(U,{className:"border-blue-200 bg-blue-50",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-blue-600"}),"Selected Destination"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:J.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Will have ",(J.available_capacity_kg-z).toFixed(1),"kg remaining after transfer"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-1",children:["Transfer: ",z.toFixed(1),"kg"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Current: ",J.utilization_percent.toFixed(1),"% used"]})]})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t",children:[e.jsx(k,{variant:"outline",onClick:t,disabled:R,children:"Cancel"}),e.jsx(k,{onClick:G,disabled:!g||R||x.length===0||Z.size===0,className:"bg-blue-600 hover:bg-blue-700",children:R?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 mr-2 animate-spin"}),"Transferring..."]}):e.jsxs(e.Fragment,{children:[e.jsx(qs,{className:"w-4 h-4 mr-2"}),"Transfer Stock"]})})]})]})})}function gn({onNavigate:a}){const[t,s]=c.useState([]),[r,l]=c.useState([]),[d,x]=c.useState([]),[m,g]=c.useState(null),[f,n]=c.useState(""),[S,T]=c.useState(!1),[V,u]=c.useState(null),[v,b]=c.useState(!1),[M,R]=c.useState(null),[X,Z]=c.useState(null),[K,z]=c.useState(!1),[ae,re]=c.useState(null),[O,le]=c.useState([]),[W,G]=c.useState(new Set),[J,h]=c.useState(!1),[Y,q]=c.useState("grid"),[we,Ce]=c.useState("name"),[De,fe]=c.useState([]),[Me,y]=c.useState(null),[L,je]=c.useState(null),[ce,N]=c.useState(!1),[F,p]=c.useState([]),[D,E]=c.useState([]),A=c.useCallback(async()=>{T(!0),u(null);try{console.log("🔍 Fetching inventory data..."),console.log("🔗 Testing database connection...");try{const oe=await zs.getInventorySummary();console.log("✅ Database connection successful, test data:",oe)}catch(oe){console.error("❌ Database connection failed:",oe)}const w=await zs.getInventoryByStorage();if(console.log("📦 Raw inventory data received:",w),console.log("📊 Data structure analysis:",{totalItems:w?.length||0,hasStorageLocationId:w?.some(oe=>oe.storage_location_id)||!1,hasSize:w?.some(oe=>oe.size!==null)||!1,hasQuantity:w?.some(oe=>oe.total_quantity>0)||!1,hasContributingBatches:w?.some(oe=>oe.contributing_batches&&oe.contributing_batches.length>0)||!1,itemsWithBatches:w?.filter(oe=>oe.contributing_batches&&oe.contributing_batches.length>0).length||0,itemsWithoutBatches:w?.filter(oe=>oe.size!==null&&oe.total_quantity>0&&(!oe.contributing_batches||oe.contributing_batches.length===0)).length||0,sampleItem:w?.[0]||null,sampleItemWithBatches:w?.find(oe=>oe.contributing_batches&&oe.contributing_batches.length>0)||null,sampleItemWithoutBatches:w?.find(oe=>oe.size!==null&&oe.total_quantity>0&&(!oe.contributing_batches||oe.contributing_batches.length===0))||null}),w&&w.length>0){console.log("🔍 Detailed data analysis:"),console.log("🔍 Raw data structure check:",{isArray:Array.isArray(w),length:w.length,firstItem:w[0],firstItemKeys:w[0]?Object.keys(w[0]):null}),w.forEach((ge,_)=>{_<3&&console.log(`Item ${_+1}:`,{storage_location_id:ge.storage_location_id,storage_location_name:ge.storage_location_name,size:ge.size,total_quantity:ge.total_quantity,total_weight_kg:ge.total_weight_kg,batch_count:ge.batch_count,contributing_batches_count:ge.contributing_batches?.length||0,contributing_batches:ge.contributing_batches,capacity_kg:ge.capacity_kg,current_usage_kg:ge.current_usage_kg,utilization_percent:ge.utilization_percent,status:ge.status,allKeys:Object.keys(ge)})});const oe=w.filter(ge=>ge&&typeof ge=="object").reduce((ge,_)=>{try{const ne=_.storage_location_name||_.storage_location_id||"Unknown";if(!ne||typeof ne!="string")return console.warn("⚠️ Invalid storage key:",ne,"for item:",_),ge;ge[ne]||(ge[ne]={totalItems:0,totalWeight:0,totalBatches:0,sizes:new Set,status:_.status||"unknown",capacity:_.capacity_kg||0,utilization:_.utilization_percent||0}),ge[ne]&&(ge[ne].totalItems+=1,ge[ne].totalWeight+=_.total_weight_kg||0,ge[ne].totalBatches+=_.batch_count||0,_.size!==null&&_.size!==void 0&&ge[ne].sizes.add(_.size))}catch(ne){console.error("❌ Error processing storage summary item:",ne,"item:",_)}return ge},{});console.log("📊 Storage location summary:",oe),console.log("✅ Data validation results:");const he={hasValidData:w.length>0,hasStorageLocations:w.some(ge=>ge.storage_location_id),hasSizeData:w.some(ge=>ge.size!==null),hasWeightData:w.some(ge=>ge.total_weight_kg>0),hasBatchData:w.some(ge=>ge.contributing_batches&&ge.contributing_batches.length>0),totalWeight:w.reduce((ge,_)=>ge+(_.total_weight_kg||0),0),totalBatches:w.reduce((ge,_)=>ge+(_.batch_count||0),0),uniqueSizes:[...new Set(w.map(ge=>ge.size).filter(ge=>ge!==null))].length,uniqueStorageLocations:[...new Set(w.map(ge=>ge.storage_location_name))].length};console.log("📋 Validation results:",he)}l(w||[]);const xe=await jt.getSortingBatches();console.log("📦 Sorting batches received:",xe),x(xe||[]);const $e=await zs.getOldestBatchForRemoval();console.log("📦 Oldest batches received:",$e),console.log("📦 Oldest batches count:",$e?.length||0),$e&&$e.length>0&&console.log("📦 First oldest batch:",$e[0]),fe($e||[]);const Re=await zs.getSizeDemandStatistics();console.log("📊 Size demand statistics received:",Re),p(Re||[]);const de=await zs.getPendingTransfers();console.log("📦 Pending transfers received:",de),E(de||[])}catch(w){console.error("❌ Error fetching inventory:",w),console.error("❌ Error details:",{message:w.message,stack:w.stack,error:w}),u(w.message||"Failed to fetch inventory data"),l([]),x([])}finally{T(!1)}},[]),I=async()=>{b(!0),await A(),b(!1)},P=w=>{if(w.status==="inactive"&&w.items.length>0){if(ze(w.location_id)){const $e=Ie(w.location_id);u($e);return}const xe=w.items.map($e=>({size:$e.size,quantity:$e.quantity,total_weight:$e.total_weight}));re({id:w.location_id,name:w.location,location_type:w.location_type}),le(xe),z(!0)}},be=async()=>{await A(),z(!1),re(null),le([]),console.log("Transfer request created successfully!")},ze=w=>D.some(xe=>xe.from_storage_location_id===w&&xe.status==="pending"),Ie=w=>{const xe=D.filter($e=>$e.from_storage_location_id===w&&$e.status==="pending").length;return xe>0?`Contact your admin for approval. ${xe} transfer request${xe>1?"s":""} already pending.`:""},ke=async w=>{try{y(w),N(!0);const xe=await zs.getBatchDetails(w.batch_id);je(xe)}catch(xe){console.error("Error fetching batch details:",xe),je(null)}};c.useEffect(()=>{A()},[A]);const ye=c.useMemo(()=>{const w=new Map;r.forEach(o=>{o.storage_location_id&&!w.has(o.storage_location_id)&&w.set(o.storage_location_id,{id:o.storage_location_id,name:o.storage_location_name,type:o.storage_location_type,status:o.storage_status||"active",capacity_kg:o.capacity_kg||0,current_usage_kg:o.current_usage_kg||0,utilization_percent:o.utilization_percent||0})});const xe=Array.from(w.values()),$e=xe.length,Re=xe.filter(o=>o.status==="active").length,de=xe.reduce((o,C)=>o+(C.capacity_kg||0),0),oe=xe.reduce((o,C)=>o+(C.current_usage_kg||0),0),he=r.filter(o=>o.size!==null&&o.total_quantity>0&&o.contributing_batches&&o.contributing_batches.length>0).length,ge=$e>0?xe.reduce((o,C)=>o+(C.utilization_percent||0),0)/$e:0,_=r.reduce((o,C)=>(C.size!==null&&C.total_weight_kg>0&&(o[C.size]=(o[C.size]||0)+C.total_weight_kg),o),{});console.log("📊 Size distribution (total across all storage):",_),console.log("🔍 Size 9 total weight:",_[9]||"NOT FOUND"),console.log("🔍 All sizes found:",Object.keys(_).map(Number).sort((o,C)=>o-C));const ne=r.filter(o=>o.size===9);console.log("🔍 Size 9 items by storage:",ne.map(o=>({storage:o.storage_location_name,weight:o.total_weight_kg})));const We=new Map;r.forEach(o=>{if(o.storage_location_id&&o.total_weight_kg>0){const C=o.storage_location_id;We.has(C)||We.set(C,{storage_location_id:o.storage_location_id,storage_location_name:o.storage_location_name,total_weight_kg:0,utilization_percent:o.utilization_percent||0,capacity_kg:o.capacity_kg||0}),We.get(C).total_weight_kg+=o.total_weight_kg}});const is=Array.from(We.values()).sort((o,C)=>C.total_weight_kg-o.total_weight_kg).slice(0,3);console.log("🏆 Top storage units by total weight:",is);const as=[];return ge>85&&as.push({type:"warning",message:"High overall utilization"}),Re<$e*.8&&as.push({type:"info",message:"Some storage units inactive"}),oe>de*.9&&as.push({type:"error",message:"Near capacity limit"}),{totalStorage:$e,activeStorage:Re,totalCapacity:de,totalUsed:oe,totalItems:he,avgUtilization:ge,sizeDistribution:_,topStorage:is,alerts:as}},[r]),Le=c.useMemo(()=>{const w={};r.forEach(de=>{const oe=de.storage_location_id||"unknown";if(w[oe]||(w[oe]={location:de.storage_location_name||"Unknown Storage",location_id:de.storage_location_id||"unknown",location_type:de.storage_location_type||"unknown",status:de.storage_status||"active",capacity_kg:de.capacity_kg||0,current_usage_kg:de.current_usage_kg||0,available_capacity_kg:de.available_capacity_kg||0,utilization_percent:de.utilization_percent||0,items:[]}),de.size===null||de.size!==null&&de.size!==void 0&&de.total_quantity>0){if(de.size===null)return;if(de.contributing_batches&&de.contributing_batches.length>0){const ge=w[oe].items.findIndex(_=>_.size===de.size);ge>=0?(w[oe].items[ge].quantity+=de.total_quantity,w[oe].items[ge].total_weight+=de.total_weight_kg||0,w[oe].items[ge].contributing_batches=[...w[oe].items[ge].contributing_batches||[],...de.contributing_batches],w[oe].items[ge].batch_count=(w[oe].items[ge].batch_count||0)+(de.batch_count||0)):w[oe].items.push({id:`${oe}-${de.size}`,size:de.size,quantity:de.total_quantity,total_weight:de.total_weight_kg||0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),batch_count:de.batch_count||0,contributing_batches:de.contributing_batches||[]})}else console.warn("⚠️ Skipping inventory item without proper batch data:",{storage_location_id:de.storage_location_id,size:de.size,quantity:de.total_quantity,hasContributingBatches:de.contributing_batches&&de.contributing_batches.length>0,contributingBatchesCount:de.contributing_batches?.length||0})}}),Object.values(w).forEach(de=>{de.items.sort((oe,he)=>oe.size-he.size)});const xe=Object.values(w),$e=xe.map(de=>de.location_id),Re=$e.filter((de,oe)=>$e.indexOf(de)!==oe);return Re.length>0&&console.warn("⚠️ Duplicate location IDs found:",Re),console.log("🏭 Processed storage units:",{totalUnits:xe.length,unitsWithItems:xe.filter(de=>de.items.length>0).length,totalItems:xe.reduce((de,oe)=>de+oe.items.length,0),itemsWithBatches:xe.reduce((de,oe)=>de+oe.items.filter(he=>he.contributing_batches&&he.contributing_batches.length>0).length,0),sampleUnit:xe[0]||null,sampleItemWithBatches:xe.find(de=>de.items.some(oe=>oe.contributing_batches&&oe.contributing_batches.length>0))?.items.find(de=>de.contributing_batches&&de.contributing_batches.length>0)||null,locationIds:$e,duplicateIds:Re}),console.log("🔍 Detailed processing analysis:"),xe.forEach((de,oe)=>{oe<2&&console.log(`Storage Unit ${oe+1} (${de.location}):`,{location_id:de.location_id,status:de.status,capacity_kg:de.capacity_kg,current_usage_kg:de.current_usage_kg,utilization_percent:de.utilization_percent,totalItems:de.items.length,items:de.items.map(he=>({size:he.size,quantity:he.quantity,total_weight:he.total_weight,batch_count:he.batch_count,contributing_batches_count:he.contributing_batches?.length||0}))})}),xe},[r]),{user:ls}=Js();return S&&r.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-blue-600 font-medium",children:"Loading inventory..."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 sm:p-6 pt-20 sm:pt-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(Te,{className:"h-6 w-6 md:h-8 md:w-8 text-blue-600"}),"Inventory Management"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage fish inventory across storage locations"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(k,{onClick:()=>a("transfers"),variant:"outline",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(Ys,{className:"w-4 h-4"}),"Transfer Approvals"]}),e.jsxs(k,{onClick:()=>a("dashboard"),variant:"outline",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(Ks,{className:"w-4 h-4"}),"Dashboard"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Storage"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:ye.totalStorage})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(Te,{className:"w-6 h-6 text-blue-600"})})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm",children:[e.jsxs("span",{className:"text-green-600 font-medium",children:[ye.activeStorage," active"]}),e.jsx("span",{className:"text-gray-400 mx-2",children:"•"}),e.jsxs("span",{className:"text-gray-500",children:[ye.totalStorage-ye.activeStorage," inactive"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Capacity"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[ye.totalCapacity.toFixed(1),"kg"]})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(Ns,{className:"w-6 h-6 text-green-600"})})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[ye.totalUsed.toFixed(1),"kg used"]}),e.jsx("span",{className:"text-gray-400 mx-2",children:"•"}),e.jsxs("span",{className:"text-gray-500",children:[(ye.totalCapacity-ye.totalUsed).toFixed(1),"kg available"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Utilization"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:[ye.avgUtilization.toFixed(1),"%"]})]}),e.jsx("div",{className:"p-3 bg-orange-100 rounded-lg",children:e.jsx(Ps,{className:"w-6 h-6 text-orange-600"})})]}),e.jsx("div",{className:"mt-2 flex items-center text-sm",children:ye.avgUtilization>85?e.jsxs("span",{className:"text-red-600 font-medium flex items-center",children:[e.jsx(ns,{className:"w-4 h-4 mr-1"}),"High usage"]}):ye.avgUtilization>70?e.jsxs("span",{className:"text-yellow-600 font-medium flex items-center",children:[e.jsx(ns,{className:"w-4 h-4 mr-1"}),"Moderate usage"]}):e.jsxs("span",{className:"text-green-600 font-medium flex items-center",children:[e.jsx(qe,{className:"w-4 h-4 mr-1"}),"Optimal usage"]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Items"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:ye.totalItems})]}),e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(ut,{className:"w-6 h-6 text-purple-600"})})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Size classes"}),e.jsx("span",{className:"text-gray-400 mx-2",children:"•"}),e.jsxs("span",{className:"text-gray-500",children:["Across ",ye.totalStorage," locations"]})]})]})]}),ye.alerts.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ir,{className:"w-5 h-5 text-amber-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"System Alerts"})]}),e.jsx("div",{className:"space-y-2",children:ye.alerts.map((w,xe)=>e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg ${w.type==="error"?"bg-red-50 border border-red-200":w.type==="warning"?"bg-yellow-50 border border-yellow-200":"bg-blue-50 border border-blue-200"}`,children:[e.jsx(ns,{className:`w-4 h-4 ${w.type==="error"?"text-red-600":w.type==="warning"?"text-yellow-600":"text-blue-600"}`}),e.jsx("span",{className:`text-sm font-medium ${w.type==="error"?"text-red-800":w.type==="warning"?"text-yellow-800":"text-blue-800"}`,children:w.message})]},xe))})]}),V&&e.jsx("div",{className:`border rounded-lg p-4 ${V.includes("Contact your admin")?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:`w-5 h-5 ${V.includes("Contact your admin")?"text-yellow-600":"text-red-600"}`}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-medium ${V.includes("Contact your admin")?"text-yellow-800":"text-red-800"}`,children:V.includes("Contact your admin")?"Transfer Request Pending":"Error Loading Data"}),e.jsx("p",{className:`text-sm mt-1 ${V.includes("Contact your admin")?"text-yellow-700":"text-red-700"}`,children:V}),!V.includes("Contact your admin")&&e.jsx(k,{onClick:A,variant:"outline",size:"sm",className:"mt-2",children:"Try Again"}),V.includes("Contact your admin")&&e.jsx(k,{onClick:()=>a("transfers"),variant:"outline",size:"sm",className:"mt-2",children:"View Transfer Approvals"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsx("div",{className:"flex-1 w-full sm:max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(mt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Se,{placeholder:"Search storage locations...",value:f,onChange:w=>n(w.target.value),className:"pl-10 w-full"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(wt,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:we,onChange:w=>Ce(w.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"capacity",children:"Sort by Capacity"}),e.jsx("option",{value:"utilization",children:"Sort by Utilization"}),e.jsx("option",{value:"items",children:"Sort by Items"})]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden",children:[e.jsx(k,{onClick:()=>q("grid"),variant:Y==="grid"?"default":"ghost",size:"sm",className:"rounded-none border-0 hover:bg-blue-50",title:"Grid View",children:e.jsx(ut,{className:"w-4 h-4"})}),e.jsx(k,{onClick:()=>q("list"),variant:Y==="list"?"default":"ghost",size:"sm",className:"rounded-none border-0 hover:bg-green-50",title:"List View",children:e.jsx(Ys,{className:"w-4 h-4"})}),e.jsx(k,{onClick:()=>q("analytics"),variant:Y==="analytics"?"default":"ghost",size:"sm",className:"rounded-none border-0 hover:bg-purple-50",title:"Analytics View",children:e.jsx(Ws,{className:"w-4 h-4"})})]}),e.jsxs(k,{onClick:I,variant:"outline",size:"sm",disabled:v,className:"flex-1 sm:flex-none",children:[e.jsx(Ze,{className:`w-4 h-4 mr-2 ${v?"animate-spin":""}`}),"Refresh"]})]})]})}),Y==="analytics"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ia,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Size Distribution"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Total across all storage locations"})]})]}),e.jsx("div",{className:"space-y-3",children:Object.entries(ye.sizeDistribution).sort(([,w],[,xe])=>xe-w).slice(0,12).map(([w,xe])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:w})}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Size ",w]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${xe/Math.max(...Object.values(ye.sizeDistribution).map($e=>$e))*100}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-600 w-16 text-right",children:[xe.toFixed(1),"kg"]})]})]},w))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(gs,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Oldest Batches (FIFO)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Next batches to be removed"})]})]}),e.jsxs("div",{className:"space-y-3",children:[De.slice(0,5).map((w,xe)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 rounded-lg border border-orange-200 cursor-pointer hover:bg-orange-100 transition-colors",onClick:()=>ke(w),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-semibold text-orange-600",children:["#",xe+1]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Batch ",w.batch_number]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Size ",w.size_class," • ",w.days_in_storage," days old"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-orange-600",children:[w.total_weight_kg?.toFixed(1),"kg"]}),e.jsx("p",{className:"text-xs text-orange-500 mt-1",children:"Click to view details"})]})]},w.batch_id)),De.length===0&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(gs,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No batches available for removal"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Check console for debugging info"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ps,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Size Demand Statistics"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Based on outlet orders (most requested first)"})]})]}),e.jsxs("div",{className:"space-y-3",children:[F.slice(0,8).map((w,xe)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-semibold text-purple-600",children:["#",xe+1]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Size ",w.size_class]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[w.total_orders," orders • ",w.unique_outlets," outlets •",w.days_span>0?`${w.days_span} days span`:"Recent"]}),e.jsxs("p",{className:"text-xs text-purple-600",children:["Grade ",w.most_requested_grade," preferred"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-purple-600",children:[w.total_weight_kg_requested.toFixed(1),"kg"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"total requested"})]})]},w.size_class)),F.length===0&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(Ps,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No size demand data available"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Qt,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Top Storage Units"}),e.jsx("p",{className:"text-xs text-gray-500",children:"By total weight across all sizes"})]})]}),e.jsx("div",{className:"space-y-3",children:ye.topStorage.map((w,xe)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${xe===0?"bg-yellow-100 text-yellow-600":xe===1?"bg-gray-100 text-gray-600":"bg-orange-100 text-orange-600"}`,children:e.jsxs("span",{className:"text-sm font-bold",children:["#",xe+1]})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:w.storage_location_name||`Storage Unit ${xe+1}`}),e.jsxs("p",{className:"text-sm text-gray-500",children:[w.utilization_percent?.toFixed(1),"% utilized"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-600",children:[w.total_weight_kg?.toFixed(1),"kg"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"total weight"})]})]},`top-storage-${w.storage_location_id}-${xe}`))})]})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:Le.filter(w=>!f||w.location.toLowerCase().includes(f.toLowerCase())).sort((w,xe)=>{switch(we){case"capacity":return xe.capacity_kg-w.capacity_kg;case"utilization":return xe.utilization_percent-w.utilization_percent;case"items":return xe.items.length-w.items.length;default:return w.location.localeCompare(xe.location)}}).map((w,xe)=>{const $e=W.has(w.location_id);return e.jsxs(U,{className:"card-shadow",children:[e.jsxs("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>{const Re=new Set(W);$e?Re.delete(w.location_id):Re.add(w.location_id),G(Re)},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[$e?e.jsx(Gs,{className:"w-5 h-5 text-gray-400"}):e.jsx(na,{className:"w-5 h-5 text-gray-400"}),e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Te,{className:"w-5 h-5 text-blue-600"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:w.location}),ze(w.location_id)&&e.jsxs(se,{variant:"destructive",className:"text-xs",children:[D.filter(Re=>Re.from_storage_location_id===w.location_id&&Re.status==="pending").length," Pending"]})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[w.location_type," • ",w.items.length," size classes"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[w.current_usage_kg.toFixed(1),"kg / ",w.capacity_kg,"kg"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[w.utilization_percent.toFixed(1),"% utilized"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[w.utilization_percent>90&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs",children:[e.jsx(ns,{className:"w-3 h-3"}),e.jsx("span",{children:"Full"})]}),e.jsx(se,{variant:w.status==="active"?"default":"secondary",className:w.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:w.status}),w.status==="inactive"&&w.items.length>0&&e.jsxs(k,{onClick:Re=>{Re.stopPropagation(),P(w)},variant:"outline",size:"sm",className:`${ze(w.location_id)?"text-red-600 border-red-200 hover:bg-red-50":"text-orange-600 border-orange-200 hover:bg-orange-50"}`,children:[e.jsx(qs,{className:"w-4 h-4 mr-1"}),ze(w.location_id)?"Pending Transfer":"Transfer"]}),w.status==="active"&&w.items.length>0&&e.jsxs(k,{onClick:Re=>{if(Re.stopPropagation(),ze(w.location_id)){const oe=Ie(w.location_id);u(oe);return}const de=w.items.map(oe=>({size:oe.size,quantity:oe.quantity,total_weight:oe.total_weight}));re({id:w.location_id,name:w.location,location_type:w.location_type}),le(de),z(!0)},variant:"outline",size:"sm",className:`${ze(w.location_id)?"text-red-600 border-red-200 hover:bg-red-50":"text-blue-600 border-blue-200 hover:bg-blue-50"}`,children:[e.jsx(ta,{className:"w-4 h-4 mr-1"}),ze(w.location_id)?"Pending Transfer":"Quick Transfer"]})]})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Capacity"}),e.jsxs("span",{className:`text-xs font-medium ${w.utilization_percent>90?"text-red-600":w.utilization_percent>70?"text-yellow-600":"text-green-600"}`,children:[w.utilization_percent.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-500 ease-out ${w.utilization_percent>90?"bg-gradient-to-r from-red-400 to-red-600":w.utilization_percent>70?"bg-gradient-to-r from-yellow-400 to-yellow-600":"bg-gradient-to-r from-green-400 to-green-600"}`,style:{width:`${Math.min(w.utilization_percent,100)}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsx("span",{children:"0kg"}),e.jsxs("span",{children:[w.capacity_kg,"kg"]})]})]})]}),$e&&e.jsx("div",{className:"border-t border-gray-100 p-4",children:w.items.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Te,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No inventory items"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Inventory Items"}),w.items.map(Re=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>g(Re),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:Re.size})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Size ",Re.size]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[Re.batch_count," batch",Re.batch_count!==1?"es":""]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-600",children:[Re.total_weight.toFixed(1),"kg"]}),e.jsx(rs,{className:"w-4 h-4 text-gray-400"})]})]},Re.id))]})})]},`${w.location_id}-${xe}`)})}),m&&e.jsx(Xe,{open:!!m,onOpenChange:()=>g(null),children:e.jsxs(Ye,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(es,{children:e.jsxs(Je,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5"}),"Size ",m.size," - Inventory Details"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(U,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Quantity"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.quantity})]})]})})}),e.jsx(U,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Weight"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[m.total_weight.toFixed(1),"kg"]})]})]})})}),e.jsx(U,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"w-4 h-4 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Weight/Fish"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[m.quantity>0?(m.total_weight/m.quantity).toFixed(2):"0.00","kg"]})]})]})})}),e.jsx(U,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ut,{className:"w-4 h-4 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Contributing Batches"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.batch_count||m.contributing_batches?.length||0})]})]})})})]}),e.jsxs(U,{children:[e.jsx(Fe,{children:e.jsxs(Pe,{className:"flex items-center gap-2",children:[e.jsx(ut,{className:"w-5 h-5"}),"Contributing Batches",m.contributing_batches&&m.contributing_batches.length>6&&e.jsx("span",{className:"text-sm text-gray-500 font-normal ml-2",children:"(scroll to see all)"})]})}),e.jsx(H,{children:e.jsx("div",{className:"border border-gray-200 rounded-lg bg-gray-50 max-h-[500px] overflow-y-auto",children:e.jsx("div",{className:"p-4 space-y-4",children:m.contributing_batches&&m.contributing_batches.length>0?m.contributing_batches.map((w,xe)=>e.jsx("div",{className:"p-4 border border-gray-300 rounded-lg bg-white shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Batch Number"}),e.jsx("p",{className:"font-semibold text-gray-900",children:w.batch_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Weight Added"}),e.jsxs("p",{className:"font-semibold text-green-600 text-lg",children:[w.weight_kg?.toFixed(1),"kg"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Quantity Added"}),e.jsxs("p",{className:"font-semibold text-gray-500",children:["Batch #",w.batch_number]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Storage Location"}),e.jsx("p",{className:"font-semibold text-gray-900",children:w.storage_location_name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Farmer"}),e.jsx("p",{className:"font-semibold text-gray-900",children:w.farmer_name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Processing Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:w.processing_date||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Added Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:new Date(w.added_date).toLocaleDateString()})]})]})},w.batch_id||xe)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ut,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No contributing batches found"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"This may indicate that the data is still being processed or there's an issue with the batch tracking."})]})})})})]})]})]})}),K&&ae&&e.jsx(hn,{isOpen:K,onClose:()=>{z(!1),re(null),le([])},sourceStorage:ae,itemsToTransfer:O,onTransferComplete:be}),ce&&e.jsx(Xe,{open:ce,onOpenChange:N,children:e.jsxs(Ye,{className:"max-w-2xl",children:[e.jsx(es,{children:e.jsxs(Je,{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"w-5 h-5 text-orange-600"}),"Batch Details - ",Me?.batch_number]})}),L?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Batch Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Batch Number"}),e.jsx("p",{className:"font-semibold text-gray-900",children:L.batch?.batch_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Created Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:L.batch?.created_at?new Date(L.batch.created_at).toLocaleDateString():"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Processing Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:L.batch?.processing_record?.processing_date||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Farmer"}),e.jsx("p",{className:"font-semibold text-gray-900",children:L.batch?.processing_record?.warehouse_entry?.farmers?.name||"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Remaining Sizes"}),e.jsxs("div",{className:"space-y-3",children:[L.sizes?.map((w,xe)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:w.size_class})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Size ",w.size_class]}),e.jsx("p",{className:"text-sm text-gray-500",children:w.storage_location_name})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-blue-600",children:[w.total_weight_kg?.toFixed(1),"kg"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:[w.total_pieces," pieces"]})]})]},xe)),(!L.sizes||L.sizes.length===0)&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(Te,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No sizes remaining in this batch"})]})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(et,{className:"w-8 h-8 mx-auto mb-2 text-gray-400 animate-spin"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading batch details..."})]})]})})]})})}const un=Object.freeze(Object.defineProperty({__proto__:null,default:gn},Symbol.toStringTag,{value:"Module"}));function lt({className:a,...t}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:Ee("w-full caption-bottom text-sm",a),...t})})}function ot({className:a,...t}){return e.jsx("thead",{"data-slot":"table-header",className:Ee("[&_tr]:border-b",a),...t})}function ct({className:a,...t}){return e.jsx("tbody",{"data-slot":"table-body",className:Ee("[&_tr:last-child]:border-0",a),...t})}function Is({className:a,...t}){return e.jsx("tr",{"data-slot":"table-row",className:Ee("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",a),...t})}function Ue({className:a,...t}){return e.jsx("th",{"data-slot":"table-head",className:Ee("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...t})}function Ve({className:a,...t}){return e.jsx("td",{"data-slot":"table-cell",className:Ee("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...t})}function pn({isOpen:a,onClose:t,transferRequest:s,onApprove:r,onDecline:l,currentUserId:d}){const[x,m]=c.useState(""),[g,f]=c.useState(!1),[n,S]=c.useState(null),T=async()=>{f(!0),S(null);try{await r(s.id,d),t()}catch(u){S(u.message||"Failed to approve transfer")}finally{f(!1)}},V=async()=>{f(!0),S(null);try{await l(s.id,d),t()}catch(u){S(u.message||"Failed to decline transfer")}finally{f(!1)}};return e.jsx(Xe,{open:a,onOpenChange:t,children:e.jsxs(Ye,{className:"max-w-2xl",children:[e.jsx(es,{children:e.jsxs(Je,{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-5 h-5 text-amber-600"}),"Transfer Approval Required"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(U,{children:e.jsxs(H,{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4"}),"Transfer Request Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"From Storage"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.from_storage_name})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"To Storage"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.to_storage_name})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Size Class"}),e.jsx(se,{variant:"outline",className:"w-auto justify-center",children:s.is_bulk?s.size_class:`Size ${s.size_class}`}),s.is_bulk&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[s.batch_size," size",s.batch_size!==1?"s":""," in batch"]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Total Weight"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"w-5 h-5 text-green-600"}),e.jsxs("span",{className:"font-bold text-green-600 text-lg",children:[s.weight_kg.toFixed(1),"kg"]})]})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Piece Count"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.quantity.toLocaleString()," pieces"]})]}),s.notes&&e.jsxs("div",{className:"col-span-2",children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-700 bg-gray-50 p-2 rounded",children:s.notes})]})]})]})}),e.jsx(U,{children:e.jsxs(H,{className:"p-4",children:[e.jsx(B,{htmlFor:"approval-notes",className:"text-sm font-medium text-gray-700",children:"Approval Notes (Optional)"}),e.jsx(Ms,{id:"approval-notes",placeholder:"Add any notes about this approval decision...",value:x,onChange:u=>m(u.target.value),className:"mt-2",rows:3})]})}),n&&e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(ns,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-red-700",children:n})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t",children:[e.jsxs(k,{variant:"outline",onClick:V,disabled:g,className:"text-red-600 border-red-300 hover:bg-red-50",children:[g?e.jsx(et,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(_t,{className:"w-4 h-4 mr-2"}),"Decline Transfer"]}),e.jsxs(k,{onClick:T,disabled:g,className:"bg-green-600 hover:bg-green-700 text-white",children:[g?e.jsx(et,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Approve & Complete"]})]})]})]})})}function fn({onNavigate:a}={}){const{user:t}=Js(),[s,r]=c.useState([]),[l,d]=c.useState(!1),[x,m]=c.useState(null),[g,f]=c.useState(""),[n,S]=c.useState(!1),[T,V]=c.useState("all"),[u,v]=c.useState(!1),[b,M]=c.useState(null),R=h=>{const Y=new Map,q=[];return h.forEach(we=>{const Ce=`${we.from_storage}-${we.to_storage}-${we.created_at}-${we.notes||""}`;Y.has(Ce)||Y.set(Ce,[]),Y.get(Ce).push(we)}),Y.forEach(we=>{if(we.length>1){const Ce=we[0],De=we.reduce((L,je)=>L+je.quantity,0),fe=we.reduce((L,je)=>L+je.weight_kg,0),Me=we.map(L=>L.size).sort((L,je)=>L-je),y={...Ce,id:`batch-${Ce.id}`,is_batch:!0,batch_sizes:Me,total_batch_quantity:De,total_batch_weight:fe,batch_transfers:we,size:Me[0]};q.push(y)}else q.push(we[0])}),q.sort((we,Ce)=>new Date(Ce.created_at).getTime()-new Date(we.created_at).getTime())},X=async()=>{d(!0),m(null);try{console.log("🔍 Fetching transfer history...");const h=await zs.getTransferHistory(200);console.log("📊 Transfer history data received:",h),console.log("📋 Data analysis:",{totalTransfers:h?.length||0,hasData:h&&h.length>0,sampleTransfer:h?.[0]||null,allTransfers:h});const Y=R(h);console.log("📦 Grouped transfers:",Y),r(Y)}catch(h){console.error("Error fetching transfer history:",h),m(h.message||"Failed to fetch transfer history")}finally{d(!1)}},Z=async()=>{S(!0),await X(),S(!1)},K=async(h,Y)=>{try{const q=h.startsWith("batch-")?h.replace("batch-",""):h;await zs.approveTransfer(q,Y),await X(),v(!1),M(null)}catch(q){throw console.error("Error approving transfer:",q),q}},z=async(h,Y)=>{try{const q=h.startsWith("batch-")?h.replace("batch-",""):h;await zs.declineTransfer(q,Y),await X(),v(!1),M(null)}catch(q){throw console.error("Error declining transfer:",q),q}},ae=h=>{M(h),v(!0)};c.useEffect(()=>{X()},[]);const re=s.filter(h=>{const Y=!g||h.from_storage.toLowerCase().includes(g.toLowerCase())||h.to_storage.toLowerCase().includes(g.toLowerCase())||h.notes.toLowerCase().includes(g.toLowerCase())||h.size.toString().includes(g),q=T==="all"||h.status===T;return Y&&q}),O=h=>{switch(h){case"pending":return e.jsxs(se,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:[e.jsx(gs,{className:"w-3 h-3 mr-1"}),"Pending"]});case"approved":return e.jsxs(se,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[e.jsx(qe,{className:"w-3 h-3 mr-1"}),"Approved"]});case"completed":return e.jsxs(se,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[e.jsx(qe,{className:"w-3 h-3 mr-1"}),"Completed"]});case"declined":return e.jsxs(se,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:[e.jsx(_t,{className:"w-3 h-3 mr-1"}),"Denied"]});default:return e.jsx(se,{variant:"outline",className:"bg-gray-50 text-gray-700 border-gray-200",children:h})}},W=(()=>{const h=s.length,Y=s.filter(Ce=>Ce.status==="pending").length,q=s.filter(Ce=>Ce.status==="approved").length,we=s.filter(Ce=>Ce.status==="declined").length;return{all:h,pending:Y,approved:q,declined:we}})(),G=()=>{const h=["Date","From Storage","To Storage","Size Class","Weight (kg)","Pieces","Notes","Created By"],Y=re.map(fe=>[new Date(fe.created_at).toLocaleDateString(),fe.from_storage,fe.to_storage,fe.size,fe.weight_kg?.toFixed(1)||"0.0",fe.quantity,fe.notes,fe.created_by||"System"]),q=[h.join(","),...Y.map(fe=>fe.map(Me=>`"${Me}"`).join(","))].join(`
`),we=new Blob([q],{type:"text/csv;charset=utf-8;"}),Ce=document.createElement("a"),De=URL.createObjectURL(we);Ce.setAttribute("href",De),Ce.setAttribute("download",`transfer-reports-${new Date().toISOString().split("T")[0]}.csv`),Ce.style.visibility="hidden",document.body.appendChild(Ce),Ce.click(),document.body.removeChild(Ce)},J=()=>{const h=window.open("","_blank");if(!h)return;const Y=`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Transfer Reports - ${new Date().toLocaleDateString()}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            h1 { color: #2563eb; margin-bottom: 20px; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            th { background-color: #f5f5f5; font-weight: bold; }
            .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
            .summary { background-color: #f8fafc; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>Fish Inventory Transfer Reports</h1>
            <p>Generated: ${new Date().toLocaleString()}</p>
          </div>
          
          <div class="summary">
            <h3>Summary</h3>
            <p><strong>Total Transfers:</strong> ${re.length}</p>
            <p><strong>Total Quantity Transferred:</strong> ${re.reduce((q,we)=>q+we.quantity,0)} pieces</p>
            <p><strong>Date Range:</strong> ${re.length>0?`${new Date(Math.min(...re.map(q=>new Date(q.created_at).getTime()))).toLocaleDateString()} - ${new Date(Math.max(...re.map(q=>new Date(q.created_at).getTime()))).toLocaleDateString()}`:"No transfers found"}</p>
          </div>

          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>From Storage</th>
                <th>To Storage</th>
                <th>Size Class</th>
                <th>Quantity</th>
                <th>Notes</th>
                <th>Created By</th>
              </tr>
            </thead>
            <tbody>
              ${re.map(q=>`
                <tr>
                  <td>${new Date(q.created_at).toLocaleDateString()}</td>
                  <td>${q.from_storage}</td>
                  <td>${q.to_storage}</td>
                  <td>Size ${q.size}</td>
                  <td>${q.quantity}</td>
                  <td>${q.notes}</td>
                  <td>${q.created_by||"System"}</td>
                </tr>
              `).join("")}
            </tbody>
          </table>
        </body>
      </html>
    `;h.document.write(Y),h.document.close(),h.print()};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 sm:p-6 pt-20 sm:pt-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(Ys,{className:"h-6 w-6 md:h-8 md:w-8 text-blue-600"}),"Transfer Reports & Approvals"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage and approve fish transfer requests"})]}),a&&e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:e.jsxs(k,{onClick:()=>a("inventory"),variant:"outline",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(Ks,{className:"w-4 h-4"}),"Back to Inventory"]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(mt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Se,{placeholder:"Search transfers...",value:g,onChange:h=>f(h.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:Z,variant:"outline",size:"sm",disabled:n,children:[e.jsx(Ze,{className:`w-4 h-4 mr-2 ${n?"animate-spin":""}`}),"Refresh"]}),e.jsxs(k,{onClick:G,variant:"outline",size:"sm",disabled:re.length===0,children:[e.jsx(xt,{className:"w-4 h-4 mr-2"}),"Export CSV"]}),e.jsxs(k,{onClick:J,variant:"outline",size:"sm",disabled:re.length===0,children:[e.jsx(Ys,{className:"w-4 h-4 mr-2"}),"Export PDF"]})]})]})}),W.pending>0&&e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-amber-200 p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(ns,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-amber-800",children:"Pending Transfers Require Approval"}),e.jsxs("p",{className:"text-sm text-amber-700",children:["You have ",W.pending," transfer request",W.pending!==1?"s":"",' waiting for approval. Click the "Review" button in the table below to approve or decline transfers.']})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(k,{variant:T==="all"?"default":"outline",size:"sm",onClick:()=>V("all"),className:`flex items-center gap-2 ${T==="all"?"bg-blue-600 hover:bg-blue-700 text-white":"bg-white hover:bg-gray-50 text-gray-700 border-gray-300"}`,children:[e.jsx(Ys,{className:"h-4 w-4"}),"All (",W.all,")"]}),e.jsxs(k,{variant:T==="pending"?"default":"outline",size:"sm",onClick:()=>V("pending"),className:`flex items-center gap-2 ${T==="pending"?"bg-yellow-600 hover:bg-yellow-700 text-white":"bg-white hover:bg-gray-50 text-gray-700 border-gray-300"}`,children:[e.jsx(gs,{className:"h-4 w-4"}),"Pending (",W.pending,")"]}),e.jsxs(k,{variant:T==="approved"?"default":"outline",size:"sm",onClick:()=>V("approved"),className:`flex items-center gap-2 ${T==="approved"?"bg-green-600 hover:bg-green-700 text-white":"bg-white hover:bg-gray-50 text-gray-700 border-gray-300"}`,children:[e.jsx(qe,{className:"h-4 w-4"}),"Approved (",W.approved,")"]}),e.jsxs(k,{variant:T==="declined"?"default":"outline",size:"sm",onClick:()=>V("declined"),className:`flex items-center gap-2 ${T==="declined"?"bg-red-600 hover:bg-red-700 text-white":"bg-white hover:bg-gray-50 text-gray-700 border-gray-300"}`,children:[e.jsx(_t,{className:"h-4 w-4"}),"Denied (",W.declined,")"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Transfers"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:re.length})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(qs,{className:"w-6 h-6 text-blue-600"})})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm",children:[e.jsxs("span",{className:"text-green-600 font-medium",children:[W.approved," approved"]}),e.jsx("span",{className:"text-gray-400 mx-2",children:"•"}),e.jsxs("span",{className:"text-gray-500",children:[W.pending," pending"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Quantity"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:re.reduce((h,Y)=>h+Y.quantity,0)})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(Te,{className:"w-6 h-6 text-green-600"})})]}),e.jsx("div",{className:"mt-2 flex items-center text-sm",children:e.jsx("span",{className:"text-gray-600",children:"Total pieces transferred"})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Weight"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:[re.reduce((h,Y)=>h+(Y.weight_kg||0),0).toFixed(1),"kg"]})]}),e.jsx("div",{className:"p-3 bg-orange-100 rounded-lg",children:e.jsx(Ns,{className:"w-6 h-6 text-orange-600"})})]}),e.jsx("div",{className:"mt-2 flex items-center text-sm",children:e.jsx("span",{className:"text-gray-600",children:"Total weight transferred"})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Reviews"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:W.pending})]}),e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(gs,{className:"w-6 h-6 text-purple-600"})})]}),e.jsx("div",{className:"mt-2 flex items-center text-sm",children:W.pending>0?e.jsxs("span",{className:"text-amber-600 font-medium flex items-center",children:[e.jsx(ns,{className:"w-4 h-4 mr-1"}),"Needs attention"]}):e.jsxs("span",{className:"text-green-600 font-medium flex items-center",children:[e.jsx(qe,{className:"w-4 h-4 mr-1"}),"All caught up"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-4 sm:p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Transfer History"}),e.jsx("p",{className:"text-sm text-gray-600",children:"View and manage all transfer requests"})]}),e.jsx("div",{className:"p-0",children:l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(et,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading transfer history..."})]})}):x?e.jsxs("div",{className:"flex items-center gap-2 p-8 bg-red-50 border border-red-200 rounded-lg m-6",children:[e.jsx(ns,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-800",children:"Error Loading Data"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:x}),e.jsx(k,{onClick:X,variant:"outline",size:"sm",className:"mt-2",children:"Try Again"})]})]}):re.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"p-4 bg-gray-50 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:e.jsx(qs,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Transfers Found"}),e.jsx("p",{className:"text-gray-600",children:g?"No transfers match your search criteria":"No transfers have been recorded yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(lt,{children:[e.jsx(ot,{children:e.jsxs(Is,{children:[e.jsx(Ue,{children:"Date"}),e.jsx(Ue,{children:"From Storage"}),e.jsx(Ue,{children:"To Storage"}),e.jsx(Ue,{children:"Size Class"}),e.jsx(Ue,{children:"Weight (kg)"}),e.jsx(Ue,{children:"Pieces"}),e.jsx(Ue,{children:"Status"}),e.jsx(Ue,{children:"Notes"}),e.jsx(Ue,{children:"Created By"}),e.jsx(Ue,{children:"Actions"})]})}),e.jsx(ct,{children:re.map(h=>e.jsxs(Is,{children:[e.jsx(Ve,{className:"font-medium",children:new Date(h.created_at).toLocaleDateString()}),e.jsx(Ve,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-red-100 rounded",children:e.jsx(qs,{className:"w-3 h-3 text-red-600"})}),e.jsx("span",{className:"font-medium",children:h.from_storage})]})}),e.jsx(Ve,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-green-100 rounded",children:e.jsx(qs,{className:"w-3 h-3 text-green-600 rotate-180"})}),e.jsx("span",{className:"font-medium",children:h.to_storage})]})}),e.jsx(Ve,{children:e.jsx("div",{className:"flex flex-col items-center gap-1",children:h.is_batch?e.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[e.jsx(se,{variant:"secondary",className:"text-xs",children:"Batch"}),h.batch_sizes?.map((Y,q)=>e.jsxs(se,{variant:"outline",className:"text-xs",children:["Size ",Y]},q))]}):e.jsxs(se,{variant:"outline",className:"w-auto justify-center",children:["Size ",h.size]})})}),e.jsx(Ve,{className:"font-semibold text-blue-600",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ns,{className:"w-4 h-4"}),h.is_batch?`${h.total_batch_weight?.toFixed(1)||"0.0"}kg`:`${h.weight_kg?.toFixed(1)||"0.0"}kg`]})}),e.jsx(Ve,{className:"text-sm text-gray-500",children:h.is_batch?`${h.total_batch_quantity||0} pieces`:`${h.quantity} pieces`}),e.jsx(Ve,{children:O(h.status)}),e.jsx(Ve,{className:"max-w-xs truncate",children:h.notes||"-"}),e.jsx(Ve,{className:"text-sm text-gray-500",children:h.created_by||"System"}),e.jsxs(Ve,{children:[h.status==="pending"&&e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>ae(h),className:"text-blue-600 border-blue-200 hover:bg-blue-50",children:[e.jsx(qe,{className:"w-4 h-4 mr-1"}),"Review"]}),h.status!=="pending"&&e.jsx("span",{className:"text-sm text-gray-400",children:"-"})]})]},h.id))})]})})})]}),u&&b&&e.jsx(pn,{isOpen:u,onClose:()=>{v(!1),M(null)},transferRequest:{id:b.id,from_storage_name:b.from_storage,to_storage_name:b.to_storage,size_class:b.is_batch?0:b.size,quantity:b.is_batch?b.total_batch_quantity||0:b.quantity,weight_kg:b.is_batch?b.total_batch_weight||0:b.weight_kg,notes:b.notes,created_at:b.created_at,is_bulk:b.is_batch||b.is_bulk,batch_size:b.is_batch?b.batch_sizes?.length||0:b.batch_size,batch_transfers:b.batch_transfers,is_batch:b.is_batch,batch_sizes:b.batch_sizes,total_batch_quantity:b.total_batch_quantity,total_batch_weight:b.total_batch_weight},onApprove:K,onDecline:z,currentUserId:t?.id||""})]})})}const bn=Object.freeze(Object.defineProperty({__proto__:null,default:fn},Symbol.toStringTag,{value:"Module"}));function jn({onNavigate:a}){const{user:t}=Js(),[s,r]=c.useState([]),[l,d]=c.useState([]),[x,m]=c.useState([]),[g,f]=c.useState(!0),[n,S]=c.useState(!1),[T,V]=c.useState(""),[u,v]=c.useState("all"),[b,M]=c.useState([]),[R,X]=c.useState(!1),[Z,K]=c.useState(!1),[z,ae]=c.useState(!1),[re,O]=c.useState(null),[le,W]=c.useState(null),[G,J]=c.useState([]),[h,Y]=c.useState(""),[q,we]=c.useState("waste"),[Ce,De]=c.useState(""),[fe,Me]=c.useState(0),[y,L]=c.useState(""),[je,ce]=c.useState(30),[N,F]=c.useState(!0),[p,D]=c.useState(""),[E,A]=c.useState(""),[I,P]=c.useState(new Set),be=[{value:"waste",label:"Waste Disposal",description:"General waste disposal"},{value:"compost",label:"Compost",description:"Convert to compost"},{value:"donation",label:"Donation",description:"Donate to charity"},{value:"return_to_farmer",label:"Return to Farmer",description:"Return to original farmer"}];c.useEffect(()=>{ze()},[]);const ze=async()=>{try{f(!0),await Promise.all([Ie(),ke(),ye()])}catch(_){console.error("Error loading disposal data:",_),ee.error("Failed to load disposal data")}finally{f(!1)}},Ie=async()=>{const{data:_,error:ne}=await j.from("disposal_records").select(`
        *,
        disposal_reason:disposal_reasons(*)
      `).order("created_at",{ascending:!1});if(ne)throw console.error("Error loading disposal records:",ne),ne;r(_||[])},ke=async()=>{const{data:_,error:ne}=await j.from("disposal_reasons").select("*").eq("is_active",!0).order("name");if(ne)throw ne;d(_||[])},ye=async()=>{try{console.log("Loading inventory with days old threshold:",je);const{data:_,error:ne}=await j.rpc("get_inventory_for_disposal",{p_days_old:je,p_include_storage_issues:!0});if(ne)throw console.error("Supabase error:",ne),ne;console.log("Raw data from function:",_);let We=_||[];if((p||E)&&(We=We.filter(is=>{const as=new Date(is.processing_date),o=p?new Date(p):null,C=E?new Date(E):null;return!(o&&as<o||C&&as>C)})),console.log("Filtered data:",We),We.length===0){console.log("No data from function, trying direct query for inactive storages...");const{data:is,error:as}=await j.from("sorting_results").select(`
            id,
            size_class,
            total_weight_grams,
            batch_number,
            storage_location_name,
            farmer_name,
            processing_date,
            quality_notes,
            storage_locations!inner(status)
          `).eq("status","available").gte("total_weight_grams",0);if(!as&&is){const o=is.map(C=>({sorting_result_id:C.id,size_class:C.size_class,total_weight_grams:C.total_weight_grams,batch_number:C.batch_number,storage_location_name:C.storage_location_name,storage_status:C.storage_locations?.status||"active",farmer_name:C.farmer_name,processing_date:C.processing_date,days_in_storage:Math.floor((new Date().getTime()-new Date(C.processing_date).getTime())/864e5),disposal_reason:C.storage_locations?.status==="inactive"?"Storage Inactive":"Age",quality_notes:C.quality_notes}));console.log("Direct query data:",o),m(o)}else m(We)}else m(We)}catch(_){console.error("Error loading inventory for disposal:",_),m([])}},Le=async()=>{if(!h||b.length===0){ee.error("Please select a reason and at least one item");return}if(n){ee.error("Please wait, operation in progress...");return}S(!0);try{const{data:_,error:ne}=await j.rpc("generate_disposal_number");if(ne)throw console.error("Error generating disposal number:",ne),ne;const{data:We,error:is}=await j.from("disposal_records").insert({disposal_number:_,disposal_reason_id:h,disposal_method:q,disposal_location:Ce||null,disposal_cost:fe,notes:y||null,disposed_by:null,status:"pending",total_weight_kg:0}).select().single();if(is)throw console.error("Error creating disposal record:",is),is;const as=x.filter(Q=>b.includes(Q.sorting_result_id));let o=0;for(const Q of as){const ue=Q.total_weight_grams/1e3;o+=ue,console.log(`Adding item to disposal: ${Q.batch_number} Size ${Q.size_class} - ${ue}kg (${Q.total_weight_grams}g)`);const{error:ve}=await j.from("disposal_items").insert({disposal_record_id:We.id,sorting_result_id:Q.sorting_result_id,size_class:Q.size_class,weight_kg:ue,batch_number:Q.batch_number,storage_location_name:Q.storage_location_name,farmer_name:Q.farmer_name,processing_date:Q.processing_date,quality_notes:Q.quality_notes,disposal_reason:Q.disposal_reason});if(ve)throw console.error("Error creating disposal item:",ve),ve}console.log(`Updating disposal record ${We.id} with total weight: ${o}kg`);const{error:C}=await j.from("disposal_records").update({total_weight_kg:o}).eq("id",We.id);if(C)throw console.error("Error updating disposal record:",C),C;ee.success(`Disposal created successfully! ${b.length} items added (${o.toFixed(2)} kg)`),X(!1),de(),ze()}catch(_){console.error("Error creating disposal:",_),ee.error("Failed to create disposal record")}finally{S(!1)}},ls=async _=>{W(_),ae(!0);try{const{data:ne,error:We}=await j.from("disposal_items").select("*").eq("disposal_record_id",_.id);We?(console.error("Error loading disposal items:",We),J([])):J(ne||[])}catch(ne){console.error("Error loading disposal items:",ne),J([])}},w=async _=>{O(_),K(!0);try{const{data:ne,error:We}=await j.from("disposal_items").select("*").eq("disposal_record_id",_.id);We?(console.error("Error loading disposal items:",We),J([])):J(ne||[])}catch(ne){console.error("Error loading disposal items:",ne),J([])}},xe=async _=>{try{const{error:ne}=await j.rpc("complete_disposal",{p_disposal_id:_});if(ne)throw ne;ee.success("Disposal completed successfully"),ze()}catch(ne){console.error("Error completing disposal:",ne),ee.error("Failed to complete disposal")}},$e=async()=>{if(le)try{S(!0);const{error:_}=await j.from("disposal_records").update({status:"completed",approved_by:null}).eq("id",le.id);if(_)throw _;const{error:ne}=await j.from("disposal_items").select("sorting_result_id").eq("disposal_record_id",le.id);if(ne)throw ne;if(G&&G.length>0){const We=G.map(as=>as.sorting_result_id);console.log(`Removing ${We.length} items from inventory:`,We);const{error:is}=await j.from("sorting_results").update({total_weight_grams:0,total_pieces:0}).in("id",We);if(is)throw console.error("Error removing items from inventory:",is),is;console.log(`Successfully removed ${We.length} items from inventory`)}ee.success("Disposal completed and items removed from storage"),ae(!1),W(null),ze()}catch(_){console.error("Error approving disposal:",_),ee.error("Failed to approve disposal")}finally{S(!1)}},Re=async()=>{if(le)try{S(!0),console.log(`Attempting to decline disposal: ${le.id}`);const{error:_}=await j.from("disposal_records").update({status:"cancelled",notes:(le.notes||"")+`

[Declined by user]`}).eq("id",le.id);if(_)throw console.error("Error updating disposal record:",_),_;console.log(`Declining disposal record ${le.id}`),ee.success("Disposal declined and marked as cancelled"),ae(!1),W(null),ze()}catch(_){console.error("Error declining disposal:",_),ee.error("Failed to decline disposal")}finally{S(!1)}},de=()=>{Y(""),we("waste"),De(""),Me(0),L(""),M([]),D(""),A("")},oe=_=>{switch(_){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},he=s.filter(_=>{const ne=_.disposal_number.toLowerCase().includes(T.toLowerCase())||_.disposal_reason?.name.toLowerCase().includes(T.toLowerCase()),We=u==="all"||_.status===u;return ne&&We}),ge=x.reduce((_,ne)=>_+ne.total_weight_grams/1e3,0);return g?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-blue-600 font-medium",children:"Loading disposal management..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[e.jsx(Tt,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Disposal Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage fish disposal and waste handling"})]}),e.jsxs(Xe,{open:R,onOpenChange:X,children:[e.jsx(St,{asChild:!0,children:e.jsxs(k,{className:"bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(Cs,{className:"w-4 h-4 mr-2"}),"Create Disposal"]})}),e.jsxs(Ye,{className:"max-w-5xl w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(es,{children:[e.jsx(Je,{className:"text-xl font-semibold",children:"Create New Disposal Record"}),e.jsx(vs,{children:"Configure disposal criteria and select items for disposal"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:[e.jsxs(U,{children:[e.jsx(Fe,{className:"pb-3",children:e.jsx(Pe,{className:"text-lg",children:"Filter Items for Disposal"})}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"daysOld",className:"text-sm font-medium",children:"Days Old Threshold"}),e.jsx(Se,{id:"daysOld",type:"number",value:je,onChange:_=>ce(Number(_.target.value)),placeholder:"30",className:"mt-1",min:"0"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(gt,{id:"includeStorageIssues",checked:N,onCheckedChange:F}),e.jsx(B,{htmlFor:"includeStorageIssues",className:"text-sm",children:"Include Storage Issues"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"fromDate",className:"text-sm font-medium",children:"From Date (Optional)"}),e.jsx(Se,{id:"fromDate",type:"date",value:p,onChange:_=>D(_.target.value),className:"mt-1",max:new Date().toISOString().split("T")[0]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty to show all items"})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"toDate",className:"text-sm font-medium",children:"To Date (Optional)"}),e.jsx(Se,{id:"toDate",type:"date",value:E,onChange:_=>A(_.target.value),className:"mt-1",max:new Date().toISOString().split("T")[0]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty to show all items"})]})]})]})]}),e.jsxs(U,{children:[e.jsx(Fe,{className:"pb-3",children:e.jsx(Pe,{className:"text-lg",children:"Disposal Details"})}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"reason",className:"text-sm font-medium",children:"Disposal Reason *"}),e.jsxs(os,{value:h,onValueChange:Y,children:[e.jsx(ds,{className:"mt-1",children:e.jsx(cs,{placeholder:"Select reason"})}),e.jsx(ms,{children:l.map(_=>e.jsx(_e,{value:_.id,children:_.name},_.id))})]})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"method",className:"text-sm font-medium",children:"Disposal Method *"}),e.jsxs(os,{value:q,onValueChange:we,children:[e.jsx(ds,{className:"mt-1",children:e.jsx(cs,{placeholder:"Select method"})}),e.jsx(ms,{children:be.map(_=>e.jsx(_e,{value:_.value,children:_.label},_.value))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"location",className:"text-sm font-medium",children:"Disposal Location"}),e.jsx(Se,{id:"location",value:Ce,onChange:_=>De(_.target.value),placeholder:"e.g., Waste Management Facility",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"cost",className:"text-sm font-medium",children:"Disposal Cost (KSh)"}),e.jsx(Se,{id:"cost",type:"number",value:fe,onChange:_=>Me(Number(_.target.value)),placeholder:"0",className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"notes",className:"text-sm font-medium",children:"Notes"}),e.jsx(Ms,{id:"notes",value:y,onChange:_=>L(_.target.value),placeholder:"Additional disposal notes...",rows:3,className:"mt-1"})]})]})]})]}),e.jsxs(U,{children:[e.jsxs(Fe,{className:"pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Pe,{className:"text-lg",children:"Select Items for Disposal"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>M(x.map(_=>_.sorting_result_id)),className:"text-green-600 hover:text-green-700",children:[e.jsx(dt,{className:"w-4 h-4 mr-1"}),"Select All"]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>M([]),className:"text-gray-600 hover:text-gray-700",children:[e.jsx(Xs,{className:"w-4 h-4 mr-1"}),"Clear All"]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:ye,className:"text-blue-600 hover:text-blue-700",children:[e.jsx(Ze,{className:"w-4 h-4 mr-1"}),"Refresh"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("span",{className:"font-medium",children:["Selected: ",b.length," items"]}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsxs("span",{className:"font-medium",children:["Total Weight: ",x.filter(_=>b.includes(_.sorting_result_id)).reduce((_,ne)=>_+ne.total_weight_grams/1e3,0).toFixed(2)," kg"]})]}),e.jsxs(se,{variant:"outline",className:"text-xs",children:["Showing items ",je===0?"of any age":`${je}+ days old`]})]}),b.length>0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Size Distribution: ",Object.entries(x.filter(_=>b.includes(_.sorting_result_id)).reduce((_,ne)=>(_[ne.size_class]=(_[ne.size_class]||0)+ne.total_weight_grams/1e3,_),{})).map(([_,ne])=>`Size ${_}: ${ne.toFixed(1)}kg`).join(" | ")]})]}),e.jsxs(H,{children:[e.jsx("div",{className:"border rounded-lg max-h-60 overflow-y-auto",children:Object.entries(x.reduce((_,ne)=>{const We=ne.storage_location_name;return _[We]||(_[We]=[]),_[We].push(ne),_},{})).map(([_,ne])=>{const We=I.has(_),is=ne.reduce((o,C)=>o+C.total_weight_grams/1e3,0),as=ne.filter(o=>b.includes(o.sorting_result_id)).length;return e.jsxs("div",{className:"border-b last:border-b-0",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 cursor-pointer",onClick:()=>{const o=new Set(I);We?o.delete(_):o.add(_),P(o)},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(As,{className:"w-4 h-4 text-gray-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:_}),ne[0]?.storage_status==="inactive"&&e.jsx(se,{variant:"destructive",className:"text-xs",children:"Inactive"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[ne.length," batches • ",is.toFixed(1),"kg",as>0&&` • ${as} selected`]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{variant:ne[0]?.disposal_reason==="Storage Inactive"?"destructive":"secondary",children:ne[0]?.disposal_reason}),e.jsx(Gs,{className:`w-4 h-4 transition-transform ${We?"rotate-180":""}`})]})]}),We&&e.jsx("div",{className:"p-3 bg-white",children:e.jsx("div",{className:"grid grid-cols-1 gap-2",children:ne.map(o=>e.jsx("div",{className:`flex items-center justify-between p-2 rounded border ${b.includes(o.sorting_result_id)?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(gt,{checked:b.includes(o.sorting_result_id),onCheckedChange:C=>{M(C?[...b,o.sorting_result_id]:b.filter(Q=>Q!==o.sorting_result_id))}}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-blue-600",children:o.batch_number}),e.jsxs(se,{variant:"outline",className:"text-xs",children:["Size ",o.size_class]}),e.jsxs(se,{variant:o.days_in_storage>30?"destructive":"secondary",className:"text-xs",children:[o.days_in_storage," days"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[o.farmer_name," • ",(o.total_weight_grams/1e3).toFixed(1),"kg"]})]})]})},o.sorting_result_id))})})]},_)})}),x.length===0&&e.jsxs(js,{className:"mt-4",children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsx(ys,{children:"No items found for disposal with current criteria."})]})]})]})]}),e.jsxs(at,{children:[e.jsx(k,{variant:"outline",onClick:()=>X(!1),children:"Cancel"}),e.jsx(k,{onClick:Le,className:"bg-red-600 hover:bg-red-700",disabled:n,children:n?"Processing...":"Create Disposal"})]})]})]}),e.jsx(Xe,{open:z,onOpenChange:ae,children:e.jsxs(Ye,{className:"max-w-2xl",children:[e.jsxs(es,{children:[e.jsxs(Je,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5 text-orange-500"}),"Confirm Disposal"]}),e.jsx(vs,{children:"Please review the disposal details and confirm or decline the action."})]}),le&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Disposal Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Disposal Number:"}),e.jsx("p",{className:"text-gray-600",children:le.disposal_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Method:"}),e.jsx("p",{className:"text-gray-600 capitalize",children:le.disposal_method})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Weight:"}),e.jsxs("p",{className:"text-gray-600",children:[le.total_weight_kg.toFixed(2)," kg"]})]})]}),le.notes&&e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:le.notes})]})]}),e.jsxs("div",{className:"bg-white border rounded-lg",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("h4",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4"}),"Items Being Disposed (",G.length," items)"]})}),e.jsx("div",{className:"max-h-60 overflow-y-auto",children:G.length>0?e.jsx("div",{className:"space-y-2",children:G.map((_,ne)=>e.jsx("div",{className:"border rounded-lg p-3 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-medium text-blue-600 text-lg",children:_.batch_number}),e.jsxs(se,{variant:"outline",className:"text-sm",children:["Size ",_.size_class||"Unknown"]})]}),e.jsxs("span",{className:"text-lg font-semibold text-gray-700",children:[_.weight_kg.toFixed(2)," kg"]})]})},ne))}):e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx(Te,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"Loading disposal items..."})]})})]}),e.jsxs(js,{children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsxs(ys,{children:[e.jsx("strong",{children:"Warning:"})," Approving this disposal will permanently remove the ",G.length," items shown above from storage. This action cannot be undone."]})]})]}),e.jsxs(at,{className:"gap-2",children:[e.jsx(k,{variant:"outline",onClick:Re,disabled:n,className:"text-red-600 hover:text-red-700",children:n?"Processing...":"Decline"}),e.jsx(k,{onClick:$e,disabled:n,className:"bg-green-600 hover:bg-green-700",children:n?"Processing...":"Approve & Remove from Storage"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(U,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Disposals"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.length})]}),e.jsx(us,{className:"h-8 w-8 text-gray-400"})]})})}),e.jsx(U,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:s.filter(_=>_.status==="pending").length})]}),e.jsx(gs,{className:"h-8 w-8 text-yellow-400"})]})})}),e.jsx(U,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Available Items"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:x.length})]}),e.jsx(Te,{className:"h-8 w-8 text-orange-400"})]})})}),e.jsx(U,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Weight"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[ge.toFixed(1),"kg"]})]}),e.jsx($s,{className:"h-8 w-8 text-blue-400"})]})})})]}),e.jsx(U,{className:"mb-6",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Se,{placeholder:"Search disposal records...",value:T,onChange:_=>V(_.target.value),className:"max-w-md"})}),e.jsxs(os,{value:u,onValueChange:v,children:[e.jsx(ds,{className:"w-40",children:e.jsx(cs,{placeholder:"Status"})}),e.jsxs(ms,{children:[e.jsx(_e,{value:"all",children:"All"}),e.jsx(_e,{value:"pending",children:"Pending"}),e.jsx(_e,{value:"approved",children:"Approved"}),e.jsx(_e,{value:"completed",children:"Completed"}),e.jsx(_e,{value:"cancelled",children:"Cancelled"})]})]})]})})}),e.jsxs(U,{children:[e.jsx(Fe,{children:e.jsxs(Pe,{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-5 w-5"}),"Disposal Records"]})}),e.jsxs(H,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(lt,{children:[e.jsx(ot,{children:e.jsxs(Is,{children:[e.jsx(Ue,{children:"Number"}),e.jsx(Ue,{children:"Date"}),e.jsx(Ue,{children:"Reason"}),e.jsx(Ue,{children:"Weight"}),e.jsx(Ue,{children:"Status"}),e.jsx(Ue,{children:"Actions"})]})}),e.jsx(ct,{children:he.map(_=>e.jsxs(Is,{className:"hover:bg-gray-50",children:[e.jsx(Ve,{className:"font-medium",children:_.disposal_number}),e.jsx(Ve,{children:new Date(_.disposal_date).toLocaleDateString()}),e.jsx(Ve,{children:_.disposal_reason?.name}),e.jsxs(Ve,{children:[_.total_weight_kg.toFixed(1),"kg"]}),e.jsx(Ve,{children:e.jsx(se,{className:oe(_.status),children:_.status})}),e.jsx(Ve,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>w(_),title:"View Details",children:e.jsx(rs,{className:"w-4 h-4"})}),_.status==="pending"&&e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>ls(_),className:"text-blue-600 hover:text-blue-700",title:"Review & Approve Disposal",children:e.jsx(dt,{className:"w-4 h-4"})}),_.status==="approved"&&e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>xe(_.id),className:"text-green-600 hover:text-green-700",title:"Complete Disposal",children:e.jsx(qe,{className:"w-4 h-4"})})]})})]},_.id))})]})}),he.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(us,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:"No disposal records found"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Create your first disposal record to get started"})]})]})]}),e.jsx(Xe,{open:Z,onOpenChange:K,children:e.jsxs(Ye,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(es,{children:[e.jsxs(Je,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(rs,{className:"w-5 h-5"}),"Disposal Details"]}),e.jsx(vs,{children:"View detailed information about this disposal record"})]}),re&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(U,{children:[e.jsx(Fe,{children:e.jsx(Pe,{className:"text-lg",children:"Basic Information"})}),e.jsx(H,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Disposal Number"}),e.jsx("p",{className:"text-lg font-semibold",children:re.disposal_number})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Status"}),e.jsx("div",{className:"mt-1",children:e.jsx(se,{className:oe(re.status),children:re.status})})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Date"}),e.jsx("p",{className:"text-gray-900",children:new Date(re.disposal_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Method"}),e.jsx("p",{className:"text-gray-900 capitalize",children:re.disposal_method})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Location"}),e.jsx("p",{className:"text-gray-900",children:re.disposal_location||"Not specified"})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Cost"}),e.jsxs("p",{className:"text-gray-900",children:["KSh ",re.disposal_cost.toFixed(2)]})]})]})})]}),e.jsxs(U,{children:[e.jsx(Fe,{children:e.jsx(Pe,{className:"text-lg",children:"Disposal Reason"})}),e.jsx(H,{children:e.jsx("p",{className:"text-gray-900",children:re.disposal_reason?.name||"Not specified"})})]}),e.jsxs(U,{children:[e.jsx(Fe,{children:e.jsx(Pe,{className:"text-lg",children:"Summary"})}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($s,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Weight"}),e.jsxs("p",{className:"text-xl font-semibold",children:[re.total_weight_kg.toFixed(2)," kg"]})]})]})})})]}),re.notes&&e.jsxs(U,{children:[e.jsx(Fe,{children:e.jsx(Pe,{className:"text-lg",children:"Notes"})}),e.jsx(H,{children:e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:re.notes})})]}),e.jsxs(U,{children:[e.jsx(Fe,{children:e.jsx(Pe,{className:"text-lg",children:"Disposal Items"})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Total Weight"}),e.jsxs("p",{className:"text-lg font-semibold",children:[re.total_weight_kg.toFixed(2)," kg"]})]})}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Disposal Location"}),e.jsx("p",{className:"text-gray-900 font-medium",children:re.disposal_location||"Not specified"})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Disposal Method"}),e.jsx("p",{className:"text-gray-900 font-medium capitalize",children:re.disposal_method.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-600",children:"Disposal Cost"}),e.jsxs("p",{className:"text-gray-900 font-medium",children:["KSh ",re.disposal_cost.toFixed(2)]})]})]})})]}),G.length>0&&e.jsxs(U,{children:[e.jsx(Fe,{children:e.jsx(Pe,{className:"text-lg",children:"Detailed Items Breakdown"})}),e.jsx(H,{children:e.jsx("div",{className:"space-y-3",children:G.map((_,ne)=>e.jsx("div",{className:"border rounded-lg p-3 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-medium text-blue-600 text-lg",children:_.batch_number}),e.jsxs(se,{variant:"outline",className:"text-sm",children:["Size ",_.size_class||"Unknown"]})]}),e.jsxs("span",{className:"text-lg font-semibold text-gray-700",children:[_.weight_kg.toFixed(2)," kg"]})]})},ne))})})]})]}),e.jsx(at,{children:e.jsx(k,{variant:"outline",onClick:()=>K(!1),children:"Close"})})]})})]})]})}const yn=Object.freeze(Object.defineProperty({__proto__:null,default:jn},Symbol.toStringTag,{value:"Module"})),vn=[{size:0,label:"Size 0 - Premium Large",description:"2.5+ kg each"},{size:1,label:"Size 1 - Extra Large",description:"2.0-2.5 kg each"},{size:2,label:"Size 2 - Large",description:"1.5-2.0 kg each"},{size:3,label:"Size 3 - Medium-Large",description:"1.2-1.5 kg each"},{size:4,label:"Size 4 - Medium",description:"1.0-1.2 kg each"},{size:5,label:"Size 5 - Medium-Small",description:"0.8-1.0 kg each"},{size:6,label:"Size 6 - Small-Medium",description:"0.6-0.8 kg each"},{size:7,label:"Size 7 - Small",description:"0.4-0.6 kg each"},{size:8,label:"Size 8 - Extra Small",description:"0.3-0.4 kg each"},{size:9,label:"Size 9 - Mini",description:"0.2-0.3 kg each"},{size:10,label:"Size 10 - Tiny",description:"0.1-0.2 kg each"}];function Nn({onNavigate:a}){const{user:t}=Js(),[s,r]=c.useState([]),[l,d]=c.useState([]),[x,m]=c.useState([]),[g,f]=c.useState(!0),[n,S]=c.useState(!1),[T,V]=c.useState(!1),[u,v]=c.useState(!1),[b,M]=c.useState(null),[R,X]=c.useState(!1),[Z,K]=c.useState(null),z=async(o,C,Q,ue,ve)=>{try{const me=JSON.parse(sessionStorage.getItem("currentUser")||"null");if(!me)return;const pe={user_id:me.id,action:o,table_name:C,record_id:Q,old_values:ue?JSON.stringify(ue):null,new_values:ve?JSON.stringify(ve):null,ip_address:null,user_agent:navigator.userAgent,created_at:new Date().toISOString()},{error:Be}=await j.from("audit_logs").insert([pe]);Be&&console.warn("Failed to log audit event:",Be)}catch(me){console.warn("Failed to log audit event:",me)}},[ae,re]=c.useState("all"),[O,le]=c.useState({outlet_id:"",requested_quantity:"",requested_grade:"",price_per_kg:"",requested_sizes:[],size_quantities:{},use_any_size:!1,delivery_date:"",notes:""}),[W,G]=c.useState({}),[J,h]=c.useState(!1),[Y,q]=c.useState({confirmedBy:"",notes:"",action:"approve"}),[we,Ce]=c.useState(!1),[De,fe]=c.useState([]),[Me,y]=c.useState(null),[L,je]=c.useState([]),[ce,N]=c.useState(!1),[F,p]=c.useState({}),D=(o,C)=>{le(Q=>({...Q,size_quantities:{...Q.size_quantities,[o]:C}}))},E=o=>{le(C=>({...C,use_any_size:o,requested_sizes:o?[]:C.requested_sizes,size_quantities:o?{}:C.size_quantities}))},A=async o=>{N(!0);try{const C=await zs.getInventoryByStorage();if(!C||C.length===0){console.log("No inventory data available"),je([]),p({});return}const Q=new Set,ue={};C.forEach(ve=>{const me=ve.size;!isNaN(me)&&ve.total_quantity>0&&(Q.add(me),ue[me]||(ue[me]={quantity:0,storageLocation:ve.storage_location_name||"Unknown Storage",grade:"A",totalWeight:0}),ue[me].quantity+=ve.total_quantity,ue[me].totalWeight+=ve.total_weight_kg,ue[me].storageLocation==="Unknown Storage"&&(ue[me].storageLocation=ve.storage_location_name||"Unknown Storage"))}),je(Array.from(Q).sort((ve,me)=>ve-me)),p(ue)}catch(C){console.error("Error fetching available sizes:",C),ee.error("Failed to fetch available sizes",{description:"Please try again or check your connection",duration:5e3}),je([]),p({})}finally{N(!1)}},I=async()=>{try{const{data:o,error:C}=await j.from("processing_records").select(`
          *,
          warehouse_entries!inner(
            entry_date,
            total_weight,
            total_pieces,
            condition,
            temperature,
            price_per_kg,
            total_value,
            notes,
            farmers!inner(
              name,
              phone,
              location,
              rating,
              reliability
            )
          )
        `).gt("ready_for_dispatch_count",0).order("processing_date",{ascending:!1});if(C)throw C;const ue=(o?.map(me=>{let pe=0;if(me.size_distribution&&typeof me.size_distribution=="object"){const He=Object.keys(me.size_distribution);He.length>0&&(pe=parseInt(He[0])||0)}let Be="Unknown";if(me.grading_results&&typeof me.grading_results=="object"){const He=Object.keys(me.grading_results);He.length>0&&(Be=He[0])}const ss=me.warehouse_entries,Ke=ss?.farmers;return{...me,final_grade:Be,final_size:pe,storage_location:"Processing Area",farmer_name:Ke?.name||"Unknown Farmer",entry_date:ss?.entry_date,total_pieces:ss?.total_pieces,condition:ss?.condition,temperature:ss?.temperature,price_per_kg:ss?.price_per_kg,total_value:ss?.total_value,notes:ss?.notes,farmer_phone:Ke?.phone,farmer_location:Ke?.location,farmer_rating:Ke?.rating,farmer_reliability:Ke?.reliability}})||[]).reduce((me,pe)=>{const Be=pe.final_size,ss=pe.storage_location,Ke=`${Be}_${ss}`;me[Ke]||(me[Ke]={id:`grouped_${Ke}`,final_size:Be,final_grade:pe.final_grade,storage_location:ss,total_quantity:0,total_weight:0,total_value:0,processing_records:[],farmers:new Set,entry_dates:new Set,conditions:new Set,temperatures:[],processed_by_names:new Set,ready_for_dispatch_count:0,warehouse_entry_id:pe.warehouse_entry_id,processing_date:pe.processing_date,processed_by:pe.processed_by,pre_processing_weight:pe.pre_processing_weight,post_processing_weight:pe.post_processing_weight,processing_waste:pe.processing_waste,processing_yield:pe.processing_yield,size_distribution:pe.size_distribution,grading_results:pe.grading_results,final_value:pe.final_value,created_at:pe.created_at,updated_at:pe.updated_at,farmer_name:pe.farmer_name,entry_date:pe.entry_date,total_pieces:pe.total_pieces,condition:pe.condition,temperature:pe.temperature,price_per_kg:pe.price_per_kg,notes:pe.notes,farmer_phone:pe.farmer_phone,farmer_location:pe.farmer_location,farmer_rating:pe.farmer_rating,farmer_reliability:pe.farmer_reliability});const He=pe.size_distribution||{},fs=He[Be]||0;me[Ke].total_quantity+=fs;const hs=Object.values(He).reduce((Us,Rt)=>Us+(Number(Rt)||0),0),Es=hs>0?pe.post_processing_weight/hs:0,Zs=fs*Es;return me[Ke].total_weight+=Zs,me[Ke].total_value+=pe.final_value||0,me[Ke].processing_records.push(pe.id),me[Ke].farmers.add(pe.farmer_name),me[Ke].entry_dates.add(pe.entry_date),me[Ke].conditions.add(pe.condition),pe.temperature&&me[Ke].temperatures.push(pe.temperature),me[Ke].ready_for_dispatch_count+=pe.ready_for_dispatch_count||0,me},{}),ve=Object.values(ue).map(me=>({...me,farmers:Array.from(me.farmers).join(", "),entry_dates:Array.from(me.entry_dates).join(", "),conditions:Array.from(me.conditions).join(", "),average_temperature:me.temperatures.length>0?(me.temperatures.reduce((pe,Be)=>pe+Be,0)/me.temperatures.length).toFixed(1):null,processing_count:me.processing_records.length}));ve.sort((me,pe)=>me.final_size!==pe.final_size?me.final_size-pe.final_size:me.storage_location.localeCompare(pe.storage_location)),m(ve)}catch(o){console.error("Error fetching inventory:",o),ee.error("Failed to fetch inventory data",{description:"Please refresh the page or try again later",duration:5e3}),m([])}},P=async()=>{try{f(!0);const[o,C]=await Promise.allSettled([_a.getOutletOrders(),yi.getOutlets()]);r(o.status==="fulfilled"?o.value:[]),d(C.status==="fulfilled"?C.value:[]),await I(),o.status==="rejected"&&console.warn("Outlet orders table not available yet:",o.reason),C.status==="rejected"&&console.warn("Outlets table not available yet:",C.reason)}catch(o){console.error("Error fetching data:",o),ee.error("Failed to load order data",{description:"Please refresh the page or check your connection",duration:5e3}),r([]),d([]),m([])}finally{f(!1)}};c.useEffect(()=>{P()},[]);const be=o=>{switch(o){case"pending":return"bg-amber-500 text-white";case"confirmed":return"bg-blue-500 text-white";case"dispatched":return"bg-emerald-500 text-white";case"completed":return"bg-green-600 text-white";default:return"bg-gray-500 text-white"}},ze=o=>{switch(o){case"pending":return e.jsx(gs,{className:"h-4 w-4"});case"confirmed":return e.jsx(qe,{className:"h-4 w-4"});case"dispatched":return e.jsx(qe,{className:"h-4 w-4"});case"completed":return e.jsx(qe,{className:"h-4 w-4"});default:return e.jsx(gs,{className:"h-4 w-4"})}},Ie=o=>`KES ${o.toLocaleString()}`,ke=o=>{if(o.length===0)return"No sizes selected";const C=o.sort((Q,ue)=>Q-ue);return C.length===1?`Size ${C[0]}`:`Sizes ${C[0]}-${C[C.length-1]}`},ye=o=>{le(C=>({...C,requested_sizes:C.requested_sizes.includes(o)?C.requested_sizes.filter(Q=>Q!==o):[...C.requested_sizes,o].sort((Q,ue)=>Q-ue),requested_grade:""}))},Le=()=>{const o={};if(O.outlet_id||(o.outlet_id="Please select an outlet"),O.use_any_size)(!O.requested_quantity||parseFloat(O.requested_quantity)<=0)&&(o.requested_quantity="Please enter a valid total quantity (greater than 0)");else if(O.requested_sizes.length===0)o.requested_sizes="Please select at least one fish size";else{Object.values(O.size_quantities).reduce((Q,ue)=>Q+ue,0)<=0&&(o.requested_sizes="Please specify quantities for selected sizes");for(const Q of O.requested_sizes){const ue=O.size_quantities[Q]||0,ve=F[Q],me=ve?ve.totalWeight:0;if(ue>me){o.requested_sizes=`Size ${Q}: Requested ${ue}kg exceeds available ${me.toFixed(1)}kg`;break}}}return(!O.price_per_kg||parseFloat(O.price_per_kg)<=0)&&(o.price_per_kg="Please enter a valid price per kg (greater than 0)"),O.requested_grade||(o.requested_grade="Please select a grade preference"),O.delivery_date&&new Date(O.delivery_date)<new Date&&(o.delivery_date="Delivery date cannot be in the past"),G(o),Object.keys(o).length===0},ls=async()=>{try{const{data:o,error:C}=await j.from("outlet_orders").select("order_number").not("order_number","is",null).order("created_at",{ascending:!1}).limit(1);if(C)throw C;let Q=1;if(o&&o.length>0){const ve=o[0].order_number?.match(/INV(\d+)/);ve&&(Q=parseInt(ve[1])+1)}return`INV${Q.toString().padStart(3,"0")}`}catch(o){return console.error("Error generating order number:",o),`INV${Date.now().toString().slice(-6)}`}},w=async()=>{if(Le()){h(!0);try{const o=await ls();let C,Q;O.use_any_size?(C=parseFloat(O.requested_quantity),Q=[]):(C=Object.values(O.size_quantities).reduce((pe,Be)=>pe+Be,0),Q=O.requested_sizes);const ue=C*parseFloat(O.price_per_kg),ve={outlet_id:O.outlet_id,order_date:new Date().toISOString().split("T")[0],delivery_date:O.delivery_date||null,requested_sizes:Q,requested_quantity:C,requested_grade:O.requested_grade==="any"?null:O.requested_grade,price_per_kg:parseFloat(O.price_per_kg),total_value:ue,status:"pending",notes:O.notes,order_number:o,size_quantities:O.use_any_size?{}:O.size_quantities,use_any_size:O.use_any_size};console.log("Creating order with data:",ve);const me=await _a.createOutletOrder(ve);r([me,...s]),le({outlet_id:"",requested_quantity:"",requested_grade:"",price_per_kg:"",requested_sizes:[],size_quantities:{},use_any_size:!1,delivery_date:"",notes:""}),G({}),S(!1),ee.success(`Order ${o} created successfully!`,{description:`Order Number: ${o}`,duration:5e3})}catch(o){console.error("Error creating order:",o),ee.error("Failed to create order",{description:o.message||"Unknown error occurred",duration:5e3})}finally{h(!1)}}},xe=o=>{const C=s.find(Q=>Q.id===o);C&&(K(C),X(!0),q({confirmedBy:t?.email||"Current User",notes:"",action:"approve"}))},$e=async()=>{if(!Z){ee.error("No order selected for confirmation");return}Ce(!0);try{if(Y.action==="approve"){const{error:o}=await j.from("outlet_orders").update({status:"confirmed",confirmed_date:new Date().toISOString().split("T")[0],notes:Y.notes||Z.notes}).eq("id",Z.id);if(o)throw o;await z("UPDATE","outlet_orders",Z.id,{status:Z.status},{status:"confirmed",confirmed_date:new Date().toISOString().split("T")[0]}),await Re(Z),await de(Z),r(C=>C.map(Q=>Q.id===Z.id?{...Q,status:"confirmed",confirmedDate:new Date().toISOString().split("T")[0]}:Q)),ee.success(`Order ${Z.order_number||Z.id} approved, confirmed, and moved to dispatch!`)}else{const{error:o}=await j.from("outlet_orders").update({status:"cancelled",notes:`Order discarded by ${t?.email||"Current User"}. ${Y.notes||""}`.trim()}).eq("id",Z.id);if(o)throw o;await z("UPDATE","outlet_orders",Z.id,{status:Z.status},{status:"cancelled",notes:`Order discarded by ${t?.email||"Current User"}. ${Y.notes||""}`.trim()}),r(C=>C.map(Q=>Q.id===Z.id?{...Q,status:"cancelled"}:Q)),ee.success(`Order ${Z.order_number||Z.id} has been discarded.`)}X(!1),K(null)}catch(o){console.error("Error processing order confirmation:",o),ee.error("Failed to process order confirmation",{description:"Please try again or contact support if the issue persists",duration:5e3})}finally{Ce(!1)}},Re=async o=>{try{const{data:C,error:Q}=await j.from("sorting_results").select(`
          *,
          sorting_batch:sorting_batches!inner(
            id,
            status
          )
        `).eq("sorting_batch.status","completed").gt("total_weight_grams",0);if(Q)throw Q;if(!C||C.length===0)throw new Error("No available inventory found for order confirmation");let ve=o.requested_quantity||0;const me=[];if(o.size_quantities&&Object.keys(o.size_quantities).length>0)for(const[pe,Be]of Object.entries(o.size_quantities)){const ss=parseInt(pe),Ke=Be,He=C.filter(hs=>hs.size_class===ss&&hs.total_weight_grams>0);let fs=Ke;for(const hs of He){if(fs<=0)break;const Es=Math.min(fs,hs.total_weight_grams/1e3),{error:Zs}=await j.from("sorting_results").update({total_weight_grams:hs.total_weight_grams-Es*1e3,total_pieces:Math.max(0,hs.total_pieces-Math.ceil(Es))}).eq("id",hs.id);if(Zs)throw Zs;try{const{error:Us}=await j.from("inventory_entries").insert({size:ss,quantity_change:-Math.ceil(Es),entry_type:"order_dispatch",reference_id:o.id,notes:`Order dispatch - Size ${ss}, Weight: ${Es.toFixed(2)}kg`});Us&&console.warn("Could not create inventory entry:",Us)}catch(Us){console.warn("Inventory entries table might not exist:",Us)}me.push({size:ss,weight_deducted:Es,remaining_stock:(hs.total_weight_grams-Es*1e3)/1e3}),fs-=Es}}else for(const pe of C){if(ve<=0)break;const Be=Math.min(ve,pe.total_weight_grams/1e3),{error:ss}=await j.from("sorting_results").update({total_weight_grams:pe.total_weight_grams-Be*1e3,total_pieces:Math.max(0,pe.total_pieces-Math.ceil(Be))}).eq("id",pe.id);if(ss)throw ss;try{const{error:Ke}=await j.from("inventory_entries").insert({size:pe.size_class||0,quantity_change:-Math.ceil(Be),entry_type:"order_dispatch",reference_id:o.id,notes:`Order dispatch - Size ${pe.size_class||0}, Weight: ${Be.toFixed(2)}kg`});Ke&&console.warn("Could not create inventory entry:",Ke)}catch(Ke){console.warn("Inventory entries table might not exist:",Ke)}me.push({size:pe.size_class||0,weight_deducted:Be,remaining_stock:(pe.total_weight_grams-Be*1e3)/1e3}),ve-=Be}return console.log("Inventory deducted for order confirmation:",me),me}catch(C){throw console.error("Error deducting inventory on order confirmation:",C),C}},de=async o=>{try{const Q=l.find(ss=>ss.id===o.outlet_id)?.name||"Unknown Outlet",ue=o.requested_quantity||0,ve=o.requested_quantity||0,me=o.size_quantities||{},{data:pe,error:Be}=await j.from("dispatch_records").insert({outlet_order_id:o.id,fish_ids:[],destination:Q,dispatch_date:new Date().toISOString().split("T")[0],total_weight:ue,total_pieces:ve,size_breakdown:me,total_value:o.total_value||0,status:"scheduled",notes:`Auto-created dispatch for confirmed order ${o.order_number||o.id}`,dispatched_by:t?.id||null}).select().single();if(Be)throw console.error("Error creating dispatch record:",Be),Be;return console.log("Automatic dispatch record created:",pe),pe}catch(C){console.error("Failed to create automatic dispatch record:",C),ee.warning("Order confirmed but dispatch record creation failed. Please create dispatch manually.")}},oe=async()=>{if(!Me||De.length===0){ee.error("Please select items from inventory");return}try{const o=De.map(He=>He.inventoryItem.id),{error:C}=await j.from("processing_records").update({ready_for_dispatch_count:0}).in("id",o);if(C)throw C;const Q=De.reduce((He,fs)=>He+fs.weight,0),ue=De.reduce((He,fs)=>He+fs.quantity,0),ve=De.reduce((He,fs)=>{const hs=fs.inventoryItem.final_size||0;return He[hs]=(He[hs]||0)+fs.quantity,He},{}),me=s.find(He=>He.id===Me),pe=l.find(He=>He.id===me?.outlet_id),{data:Be,error:ss}=await j.from("dispatch_records").insert({outlet_order_id:Me,fish_ids:o,destination:pe?.name||"Unknown",dispatch_date:new Date().toISOString().split("T")[0],total_weight:Q,total_pieces:ue,size_breakdown:ve,total_value:me?.total_value||0,status:"dispatched",notes:`Inventory picked for order ${me?.order_number||Me}`,dispatched_by:t?.id||null}).select().single();if(ss)throw ss;const{error:Ke}=await j.from("outlet_orders").update({status:"dispatched",dispatch_date:new Date().toISOString().split("T")[0]}).eq("id",Me);if(Ke)throw Ke;await P(),await I(),V(!1),y(null),fe([]),ee.success("Order dispatched successfully!",{description:`Order ${me?.order_number||Me} has been dispatched with ${ue} pieces`,duration:5e3})}catch(o){console.error("Error dispatching order:",o),ee.error("Failed to dispatch order",{description:"Please try again or contact support if the issue persists",duration:5e3})}},he=()=>{switch(ae){case"pending":return s.filter(o=>o.status==="pending");case"confirmed":return s.filter(o=>o.status==="confirmed");case"cancelled":return s.filter(o=>o.status==="cancelled");case"all":default:return s}},ge=o=>{const C=s.find(Q=>Q.id===o);C&&(M(C),v(!0))},_=(o,C)=>{const Q=De.findIndex(ue=>ue.inventoryItem.id===o.id);if(Q>=0){const ue=[...De];ue[Q].quantity+=C,ue[Q].weight=ue[Q].quantity*(o.post_processing_weight/(o.total_pieces||1)),fe(ue)}else{const ue=C*(o.post_processing_weight/(o.total_pieces||1));fe(ve=>[...ve,{inventoryItem:o,quantity:C,weight:ue}])}},ne=o=>{fe(C=>C.filter(Q=>Q.inventoryItem.id!==o))},We=(o,C)=>{if(C<=0){ne(o);return}fe(Q=>Q.map(ue=>{if(ue.inventoryItem.id===o){const ve=C*(ue.inventoryItem.post_processing_weight/(ue.inventoryItem.total_pieces||1));return{...ue,quantity:C,weight:ve}}return ue}))},is=o=>x.filter(C=>!(!C.total_quantity||C.total_quantity<=0||C.ready_for_dispatch_count<=0||o.requested_sizes&&o.requested_sizes.length>0&&!o.requested_sizes.includes(C.final_size||0)||o.requested_grade&&o.requested_grade!=="any"&&C.final_grade!==o.requested_grade)),as={totalOrders:s.length,pendingOrders:s.filter(o=>o.status==="pending").length,confirmedOrders:s.filter(o=>o.status==="confirmed").length,totalValue:s.reduce((o,C)=>o+C.total_value,0),totalQuantity:s.reduce((o,C)=>o+(C.requested_quantity||0),0)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4 md:p-8",children:[e.jsx(Tt,{}),e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h1",{className:"text-4xl font-bold text-gray-900 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl shadow-lg",children:e.jsx(Vs,{className:"h-10 w-10 text-white"})}),"Order Management"]}),e.jsx("p",{className:"text-xl text-gray-600 ml-16",children:"Manage fish orders from outlets across Kenya • Size-based selection"})]}),e.jsxs(Xe,{open:n,onOpenChange:o=>{console.log("Dialog state changing to:",o),S(o)},children:[e.jsx(St,{asChild:!0,children:e.jsxs(k,{onClick:()=>{console.log("New Order button clicked"),S(!0)},className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-8 py-4 rounded-2xl font-semibold text-lg shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:scale-105",children:[e.jsx(ha,{className:"h-6 w-6 mr-3"}),"New Order"]})}),e.jsxs(Ye,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(es,{className:"pb-4",children:[e.jsxs(Je,{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg",children:e.jsx(ha,{className:"h-5 w-5 text-white"})}),"Create New Order"]}),e.jsx(vs,{className:"text-gray-600",children:"Create a new order for your outlet with real-time inventory validation"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(gs,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-700 font-medium",children:"FIFO System Active: Orders will automatically use oldest batches first"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(B,{className:"text-base font-semibold text-gray-700",children:"Select Outlet *"}),e.jsxs(os,{value:O.outlet_id,onValueChange:o=>{le({...O,outlet_id:o,requested_sizes:[]}),W.outlet_id&&G({...W,outlet_id:""}),A()},children:[e.jsx(ds,{className:`h-12 ${W.outlet_id?"border-red-500":"border-gray-300"}`,children:e.jsx(cs,{placeholder:"Choose an outlet..."})}),e.jsx(ms,{children:l.map(o=>e.jsx(_e,{value:o.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:o.name}),e.jsx("span",{className:"text-sm text-gray-500",children:o.location})]})},o.id))})]}),W.outlet_id&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsx("span",{children:W.outlet_id})]})]}),O.outlet_id&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(B,{className:"text-base font-semibold text-gray-700",children:"Select Fish Sizes *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gt,{id:"any-size",checked:O.use_any_size,onCheckedChange:E,className:"h-4 w-4"}),e.jsx("label",{htmlFor:"any-size",className:"text-sm text-gray-600 cursor-pointer",children:"Use any available size"})]})]}),O.use_any_size?e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(qe,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-800",children:"Any Size Selected"})]}),e.jsx("p",{className:"text-xs text-green-700",children:"The system will automatically select the best available sizes based on inventory and your total quantity requirement."})]}):e.jsxs(e.Fragment,{children:[ce?e.jsxs("div",{className:"p-6 text-center border border-gray-200 rounded-lg bg-gray-50",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Loading available sizes..."})]}):e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 max-h-60 overflow-y-auto p-3 border border-gray-200 rounded-lg bg-gray-50",children:[vn.filter(o=>L.includes(o.size)).map(o=>{const C=F[o.size];return e.jsxs("div",{className:`p-3 rounded-lg border-2 transition-all ${O.requested_sizes.includes(o.size)?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-blue-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(gt,{id:`size-${o.size}`,checked:O.requested_sizes.includes(o.size),onCheckedChange:()=>ye(o.size),className:"h-4 w-4"}),e.jsxs("label",{htmlFor:`size-${o.size}`,className:"cursor-pointer text-sm font-medium",children:["Size ",o.size]})]}),C&&e.jsxs("div",{className:"text-xs text-gray-600 pl-6 mb-2",children:[e.jsxs("div",{children:[C.quantity," pcs"]}),e.jsxs("div",{children:[C.totalWeight?C.totalWeight.toFixed(1):"0.0"," kg"]})]})]},o.size)}),L.length===0&&e.jsxs("div",{className:"col-span-full text-center py-4 text-gray-500",children:[e.jsx(Te,{className:"h-6 w-6 mx-auto mb-1 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No sizes available"})]})]})}),O.requested_sizes.length>0&&e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("p",{className:"text-sm font-medium text-blue-800 mb-3",children:["Selected: ",ke(O.requested_sizes)," (",O.requested_sizes.length," size",O.requested_sizes.length!==1?"s":"",")"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-blue-700 font-medium",children:"Specify quantity (kg) for each size:"}),O.requested_sizes.map(o=>{const C=F[o],Q=C?C.totalWeight:0,ue=O.size_quantities[o]||0;return e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-blue-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-700",children:["Size ",o]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Available: ",Q.toFixed(1)," kg"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{type:"number",placeholder:"0.0",min:"0.1",max:Q,step:"0.1",className:"h-8 text-sm flex-1",value:ue||"",onChange:ve=>D(o,parseFloat(ve.target.value)||0)}),e.jsx("span",{className:"text-xs text-gray-500",children:"kg"})]}),ue>Q&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600 text-xs mt-1",children:[e.jsx(Qe,{className:"h-3 w-3"}),e.jsx("span",{children:"Exceeds available stock"})]})]},o)}),e.jsx("div",{className:"pt-2 border-t border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-blue-800",children:"Total Requested:"}),e.jsxs("span",{className:"font-bold text-blue-600",children:[Object.values(O.size_quantities).reduce((o,C)=>o+C,0).toFixed(1)," kg"]})]})})]})]})]}),W.requested_sizes&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsx("span",{children:W.requested_sizes})]})]}),(O.requested_sizes.length>0||O.use_any_size)&&e.jsxs("div",{className:"space-y-4",children:[O.use_any_size?e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm font-medium text-gray-700",children:"Total Quantity (kg) *"}),e.jsx(Se,{type:"number",placeholder:"100",min:"1",step:"0.1",className:`h-10 ${W.requested_quantity?"border-red-500":"border-gray-300"}`,value:O.requested_quantity,onChange:o=>{le({...O,requested_quantity:o.target.value}),W.requested_quantity&&G({...W,requested_quantity:""})}}),W.requested_quantity&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Qe,{className:"h-3 w-3"}),e.jsx("span",{children:W.requested_quantity})]})]}):e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Total Quantity:"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:[Object.values(O.size_quantities).reduce((o,C)=>o+C,0).toFixed(1)," kg"]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Calculated from individual size quantities above"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm font-medium text-gray-700",children:"Price per kg (KES) *"}),e.jsx(Se,{type:"number",placeholder:"500",min:"1",step:"0.01",className:`h-10 ${W.price_per_kg?"border-red-500":"border-gray-300"}`,value:O.price_per_kg,onChange:o=>{le({...O,price_per_kg:o.target.value}),W.price_per_kg&&G({...W,price_per_kg:""})}}),W.price_per_kg&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Qe,{className:"h-3 w-3"}),e.jsx("span",{children:W.price_per_kg})]})]})]}),(O.requested_sizes.length>0||O.use_any_size)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm font-medium text-gray-700",children:"Grade Preference"}),e.jsxs(os,{value:O.requested_grade,onValueChange:o=>{le({...O,requested_grade:o}),W.requested_grade&&G({...W,requested_grade:""})},children:[e.jsx(ds,{className:`h-10 ${W.requested_grade?"border-red-500":"border-gray-300"}`,children:e.jsx(cs,{placeholder:"Select grade preference"})}),e.jsxs(ms,{children:[e.jsx(_e,{value:"any",children:"Any Grade Available"}),e.jsx(_e,{value:"A",children:"Grade A (Premium)"}),e.jsx(_e,{value:"B",children:"Grade B (Standard)"}),e.jsx(_e,{value:"C",children:"Grade C (Economy)"})]})]}),W.requested_grade&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Qe,{className:"h-3 w-3"}),e.jsx("span",{children:W.requested_grade})]})]}),O.requested_sizes.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm font-medium text-gray-700",children:"Delivery Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(Bs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Se,{type:"date",className:`h-10 pl-10 ${W.delivery_date?"border-red-500":"border-gray-300"}`,value:O.delivery_date,min:new Date().toISOString().split("T")[0],onChange:o=>{le({...O,delivery_date:o.target.value}),W.delivery_date&&G({...W,delivery_date:""})}})]}),W.delivery_date&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Qe,{className:"h-3 w-3"}),e.jsx("span",{children:W.delivery_date})]})]}),O.requested_sizes.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm font-medium text-gray-700",children:"Notes (Optional)"}),e.jsx(Ms,{placeholder:"Special requirements, delivery instructions, etc...",className:"h-20 border-gray-300 resize-none",value:O.notes,onChange:o=>le({...O,notes:o.target.value})})]}),W.inventory&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-5 w-5 text-red-600"}),e.jsx("p",{className:"text-red-800 font-medium",children:"Inventory Insufficient"})]}),e.jsx("p",{className:"text-red-700 text-sm mt-1",children:W.inventory})]}),(O.use_any_size&&O.requested_quantity||!O.use_any_size&&O.requested_sizes.length>0)&&O.price_per_kg&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6 border border-blue-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-xl",children:e.jsx(Ys,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Order Summary"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Review your order details"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Quantity"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:O.use_any_size?`${O.requested_quantity} kg`:`${Object.values(O.size_quantities).reduce((o,C)=>o+C,0).toFixed(1)} kg`})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Price per kg"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["KES ",parseFloat(O.price_per_kg||"0").toLocaleString()]})]}),e.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl border border-blue-200 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Total Value"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-600",children:["KES ",((O.use_any_size?parseFloat(O.requested_quantity||"0"):Object.values(O.size_quantities).reduce((o,C)=>o+C,0))*parseFloat(O.price_per_kg||"0")).toLocaleString()]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-gray-200",children:[e.jsx(k,{variant:"outline",onClick:()=>{S(!1),G({})},className:"px-8 py-3 text-base border-gray-300 hover:bg-gray-50",disabled:J,children:"Cancel"}),e.jsx(k,{onClick:w,disabled:J||!O.outlet_id||!O.use_any_size&&O.requested_sizes.length===0||!O.price_per_kg||!O.requested_grade,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 px-8 py-3 text-base disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:J?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creating Order..."]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Create Order"]})})]})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-blue-50 to-blue-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-blue-600 uppercase tracking-wide",children:"Total Orders"}),e.jsx("p",{className:"text-4xl font-bold text-blue-900 mt-2",children:as.totalOrders})]}),e.jsx("div",{className:"p-4 bg-blue-600 rounded-2xl shadow-lg",children:e.jsx(Vs,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-amber-50 to-amber-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-amber-600 uppercase tracking-wide",children:"Pending"}),e.jsx("p",{className:"text-4xl font-bold text-amber-900 mt-2",children:as.pendingOrders})]}),e.jsx("div",{className:"p-4 bg-amber-600 rounded-2xl shadow-lg",children:e.jsx(gs,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-emerald-50 to-emerald-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-emerald-600 uppercase tracking-wide",children:"Confirmed"}),e.jsx("p",{className:"text-4xl font-bold text-emerald-900 mt-2",children:as.confirmedOrders})]}),e.jsx("div",{className:"p-4 bg-emerald-600 rounded-2xl shadow-lg",children:e.jsx(qe,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-purple-50 to-purple-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-purple-600 uppercase tracking-wide",children:"Total Quantity"}),e.jsx("p",{className:"text-4xl font-bold text-purple-900 mt-2",children:as.totalQuantity}),e.jsx("p",{className:"text-sm text-purple-600",children:"kg"})]}),e.jsx("div",{className:"p-4 bg-purple-600 rounded-2xl shadow-lg",children:e.jsx(ts,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-green-50 to-green-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-green-600 uppercase tracking-wide",children:"Total Value"}),e.jsx("p",{className:"text-3xl font-bold text-green-900 mt-2",children:Ie(as.totalValue)})]}),e.jsx("div",{className:"p-4 bg-green-600 rounded-2xl shadow-lg",children:e.jsx(aa,{className:"h-8 w-8 text-white"})})]})})})]}),e.jsxs(U,{className:"border-0 shadow-2xl bg-white/80 backdrop-blur-sm",children:[e.jsx(Fe,{className:"pb-6 bg-gradient-to-r from-gray-50 to-gray-100 rounded-t-3xl",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs(Pe,{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(ra,{className:"h-8 w-8 text-purple-600"}),"Orders Management"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(k,{variant:ae==="all"?"default":"outline",size:"sm",onClick:()=>re("all"),className:`flex items-center gap-2 ${ae==="all"?"bg-blue-600 hover:bg-blue-700 text-white":"bg-white hover:bg-gray-50 text-gray-700 border-gray-300"}`,children:[e.jsx(Te,{className:"h-4 w-4"}),"All Orders (",s.length,")"]}),e.jsxs(k,{variant:ae==="pending"?"default":"outline",size:"sm",onClick:()=>re("pending"),className:`flex items-center gap-2 ${ae==="pending"?"bg-yellow-600 hover:bg-yellow-700 text-white":"bg-white hover:bg-gray-50 text-gray-700 border-gray-300"}`,children:[e.jsx(gs,{className:"h-4 w-4"}),"Pending (",s.filter(o=>o.status==="pending").length,")"]}),e.jsxs(k,{variant:ae==="confirmed"?"default":"outline",size:"sm",onClick:()=>re("confirmed"),className:`flex items-center gap-2 ${ae==="confirmed"?"bg-green-600 hover:bg-green-700 text-white":"bg-white hover:bg-gray-50 text-gray-700 border-gray-300"}`,children:[e.jsx(dt,{className:"h-4 w-4"}),"Approved (",s.filter(o=>o.status==="confirmed").length,")"]}),e.jsxs(k,{variant:ae==="cancelled"?"default":"outline",size:"sm",onClick:()=>re("cancelled"),className:`flex items-center gap-2 ${ae==="cancelled"?"bg-red-600 hover:bg-red-700 text-white":"bg-white hover:bg-gray-50 text-gray-700 border-gray-300"}`,children:[e.jsx(Mt,{className:"h-4 w-4"}),"Discarded (",s.filter(o=>o.status==="cancelled").length,")"]})]})]})}),e.jsx(H,{className:"p-8",children:he().length===0?e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"p-4 bg-gray-100 rounded-full",children:e.jsx(Te,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:["No ",ae==="all"?"":ae," orders found"]}),e.jsx("p",{className:"text-gray-500",children:ae==="all"?"No orders have been created yet.":`No ${ae} orders at the moment.`})]})]})}):e.jsx("div",{className:"space-y-6",children:he().map(o=>e.jsx("div",{className:`border-2 rounded-3xl p-8 hover:shadow-xl transition-all duration-300 ${o.status==="dispatched"?"border-green-200 bg-gradient-to-r from-green-50 to-emerald-50 hover:from-green-100 hover:to-emerald-100":"border-gray-100 bg-gradient-to-r from-white to-gray-50 hover:from-blue-50 hover:to-purple-50"}`,children:e.jsxs("div",{className:"flex flex-col xl:flex-row justify-between items-start xl:items-center gap-6",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[ze(o.status),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["Order #",o.order_number||o.id]}),o.status==="dispatched"&&e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Dispatched"})]})]}),e.jsx(se,{className:`text-sm font-semibold px-4 py-2 rounded-xl ${be(o.status)}`,children:o.status.toUpperCase()}),o.requested_grade!=="any"&&e.jsxs(se,{variant:"secondary",className:"text-sm px-3 py-1 bg-indigo-100 text-indigo-700 rounded-xl",children:["Grade ",o.requested_grade]}),e.jsx(se,{variant:"outline",className:"text-sm px-3 py-1 bg-orange-100 text-orange-700 border-orange-200 rounded-xl",children:ke(o.requested_sizes||[])})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-gray-700",children:[e.jsx(Ds,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:o.outlet?.name||"Unknown Outlet"}),e.jsx("div",{className:"text-sm text-gray-500",children:o.outlet?.location||"Unknown Location"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-700",children:[e.jsx(Et,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:o.outlet?.phone||"Unknown Phone"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-700",children:[e.jsx(Bs,{className:"h-5 w-5 text-purple-500"}),e.jsx("span",{className:"text-sm font-medium",children:new Date(o.order_date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-700",children:[e.jsx(ts,{className:"h-5 w-5 text-cyan-500"}),e.jsxs("span",{className:"text-sm font-medium",children:[o.requested_quantity,"kg requested"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-base text-gray-700",children:[e.jsxs("span",{className:"bg-gray-100 px-4 py-2 rounded-xl",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Sizes:"})," ",o.requested_sizes?.join(", ")||"Any"]}),e.jsxs("span",{className:"bg-gray-100 px-4 py-2 rounded-xl",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Quantity:"})," ",o.requested_quantity,"kg"]}),e.jsxs("span",{className:"bg-gray-100 px-4 py-2 rounded-xl",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Price:"})," ",Ie(o.price_per_kg||0),"/kg"]})]}),o.notes&&e.jsxs("div",{className:"text-base text-gray-700 bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-2xl border-l-4 border-blue-400",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Notes:"})," ",o.notes]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-4 min-w-fit",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:Ie(o.total_value)}),e.jsx("div",{className:"text-sm text-gray-500 font-medium",children:"Total Value"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>ge(o.id),className:"px-3 py-2 border-gray-300 hover:bg-gray-50",children:[e.jsx(rs,{className:"h-4 w-4 mr-1"}),"View"]}),o.status==="pending"&&e.jsx(k,{size:"sm",onClick:()=>xe(o.id),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2",children:"Confirm"}),o.status==="confirmed"&&e.jsxs(k,{size:"sm",onClick:()=>a("dispatch",o.id),className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-2",children:[e.jsx(rs,{className:"h-4 w-4 mr-1"}),"View Dispatch"]})]})]})]})},o.id))})})]})]}),e.jsx(Xe,{open:T,onOpenChange:V,children:e.jsxs(Ye,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(es,{children:[e.jsxs(Je,{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Te,{className:"h-6 w-6 text-orange-600"}),"Pick Items from Inventory"]}),e.jsx(vs,{children:"Select items from available inventory to fulfill this order. Items will be deducted from inventory automatically."})]}),Me&&e.jsxs("div",{className:"space-y-6 py-4",children:[(()=>{const o=s.find(C=>C.id===Me);return o?e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-xl border border-blue-200",children:[e.jsxs("h3",{className:"font-bold text-lg text-blue-900 mb-4 flex items-center gap-2",children:[e.jsx(Vs,{className:"h-5 w-5"}),"Order Requirements"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Outlet:"}),e.jsx("span",{className:"text-gray-900 font-semibold",children:o.outlet?.name||"Unknown Outlet"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Requested Quantity:"}),e.jsxs("span",{className:"text-gray-900 font-semibold",children:[o.requested_quantity,"kg"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Requested Sizes:"}),e.jsx("span",{className:"text-gray-900 font-semibold",children:o.requested_sizes?.join(", ")||"Any"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Grade:"}),e.jsxs(se,{className:o.requested_grade==="A"?"bg-green-100 text-green-800":o.requested_grade==="B"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800",children:["Grade ",o.requested_grade]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Price per kg:"}),e.jsx("span",{className:"text-gray-900 font-semibold",children:Ie(o.price_per_kg||0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Total Value:"}),e.jsx("span",{className:"text-gray-900 font-semibold",children:Ie(o.total_value)})]})]})]}):null})(),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-bold text-lg text-gray-900 flex items-center gap-2",children:[e.jsx(Fs,{className:"h-5 w-5 text-green-600"}),"Available Inventory"]}),(()=>{const o=s.find(ue=>ue.id===Me);if(!o)return null;const Q=is(o).reduce((ue,ve)=>ue+(ve.total_quantity||0),0);return e.jsx("div",{className:"bg-green-50 px-3 py-1 rounded-full",children:e.jsxs("span",{className:"text-sm font-medium text-green-800",children:[Q," pieces available"]})})})()]}),e.jsx("div",{className:"grid gap-4 max-h-96 overflow-y-auto",children:(()=>{const o=s.find(Q=>Q.id===Me);if(!o)return null;const C=is(o);return C.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Te,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No inventory items match the order requirements"})]}):C.map(Q=>e.jsx("div",{className:"border border-gray-200 rounded-xl p-4 bg-white hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 text-lg",children:["Size ",Q.final_size||"Unknown"," Fish"]}),e.jsxs(se,{className:Q.final_grade==="A"?"bg-green-100 text-green-800":Q.final_grade==="B"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800",children:["Grade ",Q.final_grade||"Unknown"]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Available Quantity:"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-bold text-blue-900",children:[Q.total_quantity||0," pieces"]}),e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["(",Q.total_weight?Q.total_weight.toFixed(1):"0.0"," kg)"]}),Q.total_quantity&&Q.total_quantity<=10&&e.jsx(se,{className:"bg-orange-100 text-orange-800 border-orange-200 text-xs",children:"Low Stock"})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ds,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Storage Location:"})]}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:Q.storage_location||"Processing Area"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-500 text-xs font-medium",children:"Processing Date"}),e.jsx("span",{className:"text-gray-900 font-semibold",children:Q.processing_date?new Date(Q.processing_date).toLocaleDateString():"N/A"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-500 text-xs font-medium",children:"Farmer"}),e.jsx("span",{className:"text-gray-900 font-semibold truncate",children:Q.farmer_name||"Unknown"})]})]})]}),e.jsx("div",{className:"flex items-center gap-3 ml-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{size:"sm",variant:"outline",onClick:()=>_(Q,1),className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:e.jsx(Cs,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-sm font-medium min-w-[2rem] text-center",children:De.find(ue=>ue.inventoryItem.id===Q.id)?.quantity||0}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>{const ue=De.find(ve=>ve.inventoryItem.id===Q.id);ue&&ue.quantity>0&&We(Q.id,ue.quantity-1)},className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:e.jsx(Xs,{className:"h-4 w-4"})})]})})]})},Q.id))})()})]}),De.length>0&&e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200",children:[e.jsxs("h3",{className:"font-bold text-lg text-green-900 mb-4 flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5"}),"Selected Items Summary"]}),e.jsxs("div",{className:"space-y-3",children:[De.map(o=>e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-medium text-gray-900",children:["Size ",o.inventoryItem.final_size||"Unknown"," - Grade ",o.inventoryItem.final_grade||"Unknown"]}),e.jsxs(se,{variant:"outline",className:"bg-blue-50 text-blue-700",children:[o.quantity," pieces"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[o.weight.toFixed(1),"kg"]}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>ne(o.inventoryItem.id),className:"border-red-200 text-red-700 hover:bg-red-50",children:e.jsx(Xs,{className:"h-4 w-4"})})]})]},o.inventoryItem.id)),e.jsx("div",{className:"border-t pt-3 mt-3",children:e.jsxs("div",{className:"flex justify-between items-center font-semibold text-green-900",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:[De.reduce((o,C)=>o+C.quantity,0)," pieces • "," ",De.reduce((o,C)=>o+C.weight,0).toFixed(1),"kg"]})]})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-4 pt-4 border-t",children:[e.jsx(k,{variant:"outline",onClick:()=>{V(!1),fe([]),y(null)},className:"px-6 py-2",children:"Cancel"}),e.jsxs(k,{onClick:oe,disabled:De.length===0,className:"px-6 py-2 bg-orange-600 hover:bg-orange-700 text-white disabled:bg-gray-300 disabled:cursor-not-allowed",children:[e.jsx(ks,{className:"h-4 w-4 mr-2"}),"Dispatch Order"]})]})]})]})}),e.jsx(Xe,{open:u,onOpenChange:v,children:e.jsxs(Ye,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(es,{children:[e.jsxs(Je,{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Ys,{className:"h-6 w-6 text-blue-600"})}),"Order Details - ",b?.order_number||b?.id]}),e.jsx(vs,{className:"text-gray-600",children:"Complete information for this outlet order"})]}),b&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[ze(b.status),e.jsx(se,{className:`text-sm font-semibold px-4 py-2 rounded-xl ${be(b.status)}`,children:b.status.toUpperCase()}),b.requested_grade!=="any"&&e.jsxs(se,{variant:"secondary",className:"text-sm px-3 py-1 bg-indigo-100 text-indigo-700 rounded-xl",children:["Grade ",b.requested_grade]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:Ie(b.total_value)}),e.jsx("div",{className:"text-sm text-gray-500 font-medium",children:"Total Value"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bs,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Order Date:"}),e.jsx("span",{className:"text-sm text-gray-900",children:new Date(b.order_date).toLocaleDateString()})]}),b.delivery_date&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Delivery Date:"}),e.jsx("span",{className:"text-sm text-gray-900",children:new Date(b.delivery_date).toLocaleDateString()})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-cyan-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Quantity:"}),e.jsxs("span",{className:"text-sm text-gray-900",children:[b.requested_quantity,"kg"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Price per kg:"}),e.jsx("span",{className:"text-sm text-gray-900",children:Ie(b.price_per_kg||0)})]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(As,{className:"h-5 w-5 text-blue-600"}),"Outlet Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Outlet Name:"}),e.jsx("p",{className:"text-sm text-gray-900 font-semibold",children:b.outlet?.name||"Unknown Outlet"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Location:"}),e.jsx("p",{className:"text-sm text-gray-900",children:b.outlet?.location||"Unknown Location"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Phone:"}),e.jsx("p",{className:"text-sm text-gray-900",children:b.outlet?.phone||"Unknown Phone"})]}),b.outlet?.manager_name&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Manager:"}),e.jsx("p",{className:"text-sm text-gray-900",children:b.outlet.manager_name})]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-orange-600"}),"Order Specifications"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Requested Sizes:"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:b.requested_sizes&&b.requested_sizes.length>0?b.requested_sizes.map((o,C)=>e.jsxs(se,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200",children:["Size ",o]},C)):e.jsx(se,{variant:"outline",className:"bg-gray-50 text-gray-700",children:"Any Size"})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Grade Preference:"}),e.jsx("p",{className:"text-sm text-gray-900 mt-1",children:b.requested_grade==="any"?"Any Grade Available":`Grade ${b.requested_grade}`})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Quantity Breakdown:"}),e.jsxs("div",{className:"mt-2 bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Weight:"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[b.requested_quantity,"kg"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Price per kg:"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:Ie(b.price_per_kg||0)})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1 pt-2 border-t border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Total Value:"}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:Ie(b.total_value)})]})]})]})})]})]}),b.notes&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ys,{className:"h-5 w-5 text-gray-600"}),"Order Notes"]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-gray-700",children:b.notes})})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx(k,{variant:"outline",onClick:()=>v(!1),className:"flex-1",children:"Close"}),b.status==="pending"&&e.jsx(k,{onClick:()=>{xe(b.id),v(!1)},className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",children:"Confirm Order"}),b.status==="confirmed"&&e.jsxs(k,{onClick:()=>{a("dispatch",b.id),v(!1)},className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),"View Dispatch"]}),b.status==="dispatched"&&e.jsxs(k,{onClick:()=>{a("dispatch",b.id),v(!1)},className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),"Check Dispatch Page"]})]})]})]})}),e.jsx(Xe,{open:R,onOpenChange:X,children:e.jsxs(Ye,{className:"max-w-2xl",children:[e.jsxs(es,{children:[e.jsxs(Je,{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ga,{className:"h-6 w-6 text-blue-600"})}),"Confirm Order"]}),e.jsx(vs,{className:"text-gray-600",children:"Review and confirm this order. Select who is confirming and choose to approve or discard."})]}),Z&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Order Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Order Number:"}),e.jsx("span",{className:"ml-2 font-medium",children:Z.order_number||Z.id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Outlet:"}),e.jsx("span",{className:"ml-2 font-medium",children:l.find(o=>o.id===Z.outlet_id)?.name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Quantity:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[Z.requested_quantity," kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total Value:"}),e.jsxs("span",{className:"ml-2 font-medium",children:["KES ",Z.total_value.toLocaleString()]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm font-medium text-gray-700",children:"Confirmed By"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ga,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t?.email||"Current User"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Logged in user"})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm font-medium text-gray-700",children:"Action *"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",id:"approve",name:"action",value:"approve",checked:Y.action==="approve",onChange:o=>q(C=>({...C,action:o.target.value})),className:"h-4 w-4 text-green-600"}),e.jsxs(B,{htmlFor:"approve",className:"flex items-center gap-2 text-green-700",children:[e.jsx(qe,{className:"h-4 w-4"}),"Approve Order"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",id:"discard",name:"action",value:"discard",checked:Y.action==="discard",onChange:o=>q(C=>({...C,action:o.target.value})),className:"h-4 w-4 text-red-600"}),e.jsxs(B,{htmlFor:"discard",className:"flex items-center gap-2 text-red-700",children:[e.jsx(Mt,{className:"h-4 w-4"}),"Discard Order"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm font-medium text-gray-700",children:"Notes (Optional)"}),e.jsx(Ms,{placeholder:"Add any notes about this confirmation...",className:"h-20 resize-none",value:Y.notes,onChange:o=>q(C=>({...C,notes:o.target.value}))})]})]}),e.jsxs(at,{className:"flex gap-3",children:[e.jsx(k,{variant:"outline",onClick:()=>X(!1),disabled:we,className:"flex-1",children:"Cancel"}),e.jsx(k,{onClick:$e,disabled:we,className:`flex-1 ${Y.action==="approve"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"} text-white`,children:we?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):e.jsx(e.Fragment,{children:Y.action==="approve"?e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Approve Order"]}):e.jsxs(e.Fragment,{children:[e.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Discard Order"]})})})]})]})]})})]})}const _n=Object.freeze(Object.defineProperty({__proto__:null,default:Nn},Symbol.toStringTag,{value:"Module"}));function wn({onNavigate:a}){const[t,s]=c.useState([]),[r,l]=c.useState([]),[d,x]=c.useState([]),[m,g]=c.useState(!0),[f,n]=c.useState([]),[S,T]=c.useState(!1),[V,u]=c.useState([]),[v,b]=c.useState(null),[M,R]=c.useState(!1),[X,Z]=c.useState([]),[K,z]=c.useState({driverId:"",notes:"",pickingDate:"",pickingTime:""}),[ae,re]=c.useState(!1),[O,le]=c.useState(null),W=async()=>{try{const{data:y,error:L}=await j.from("outlet_orders").select(`
          *,
          outlet:outlets(
            id,
            name,
            location,
            phone,
            manager_name,
            status
          )
        `).eq("status","confirmed").order("order_date",{ascending:!1});if(L)throw L;s(y||[])}catch(y){console.error("Error fetching confirmed orders:",y),ee.error("Failed to fetch confirmed orders",{description:"Please refresh the page or try again later",duration:5e3})}},G=async()=>{try{const{data:y,error:L}=await j.from("outlet_orders").select(`
          *,
          outlet:outlets(
            id,
            name,
            location,
            phone,
            manager_name,
            status
          )
        `).eq("status","dispatched").order("dispatch_date",{ascending:!1});if(L)throw L;if(y&&y.length>0){const je=y.map(F=>F.id),{data:ce,error:N}=await j.from("dispatch_records").select("*").in("outlet_order_id",je);if(!N&&ce){const F=y.map(p=>{const D=ce.find(E=>E.outlet_order_id===p.id);return{...p,dispatch_record:D||null}});l(F)}else console.warn("Could not fetch dispatch records:",N),l(y)}else l([])}catch(y){console.error("Error fetching dispatched orders:",y),ee.error("Failed to fetch dispatched orders",{description:"Please refresh the page or try again later",duration:5e3})}},J=async()=>{try{const{data:y,error:L}=await j.from("outlets").select("*").order("name");if(L)throw L;x(y||[])}catch(y){console.error("Error fetching outlets:",y),ee.error("Failed to fetch outlets",{description:"Please refresh the page or try again later",duration:5e3})}},h=async()=>{try{const{data:y,error:L}=await j.from("profiles").select("id, first_name, last_name").eq("role","driver").order("first_name");if(L)throw L;const je=(y||[]).map(ce=>({id:ce.id,name:`${ce.first_name} ${ce.last_name}`}));Z(je)}catch(y){console.error("Error fetching drivers:",y),ee.error("Failed to fetch drivers",{description:"Please refresh the page or try again later",duration:5e3})}},Y=async()=>{try{const{data:y,error:L}=await j.from("processing_records").select(`
          id,
          post_processing_weight,
          ready_for_dispatch_count,
          processing_date,
          final_value
        `).gt("ready_for_dispatch_count",0).order("processing_date",{ascending:!1});if(L)throw L;n(y||[])}catch(y){console.error("Error fetching inventory:",y),ee.error("Failed to fetch inventory",{description:"Please refresh the page or try again later",duration:5e3}),n([])}},q=y=>{b(y),z({driverId:"",notes:"",pickingDate:"",pickingTime:""}),R(!0)},we=async()=>{if(!v||!K.driverId){ee.error("Please select a driver");return}if(!K.pickingDate||!K.pickingTime){ee.error("Please select picking date and time");return}try{const L=X.find(I=>I.id===K.driverId)?.name||"Unknown Driver",je=t.find(I=>I.id===v),ce=d.find(I=>I.id===je?.outlet_id),N=je?.requested_quantity||0,F=je?.requested_quantity||0,p=je?.size_quantities||{},{data:D,error:E}=await j.from("dispatch_records").insert({outlet_order_id:v,fish_ids:[],destination:ce?.name||"Unknown",dispatch_date:new Date().toISOString().split("T")[0],total_weight:N,total_pieces:F,size_breakdown:p,total_value:je?.total_value||0,status:"scheduled",notes:K.notes,picking_date:K.pickingDate,picking_time:K.pickingTime,assigned_driver:L,assigned_date:new Date().toISOString().split("T")[0]}).select().single();if(E)throw E;const{error:A}=await j.from("outlet_orders").update({status:"dispatched",dispatch_date:new Date().toISOString().split("T")[0],notes:K.notes}).eq("id",v);if(A)throw A;R(!1),b(null),await Promise.all([W(),G()]),ee.success("Dispatch approved successfully!",{description:`Driver ${L} assigned to order for picking on ${K.pickingDate} at ${K.pickingTime}`,duration:5e3})}catch(y){console.error("Error approving dispatch:",y),ee.error("Failed to approve dispatch",{description:"Please try again or contact support if the issue persists",duration:5e3})}},Ce=y=>{le(y),re(!0)},De=()=>{re(!1),le(null)},fe=()=>{window.print()},Me=async()=>{if(!v||V.length===0){ee.error("Please select items from inventory");return}try{const y=V.map(A=>A.inventoryItem.id),{error:L}=await j.from("processing_records").update({ready_for_dispatch_count:0}).in("id",y);if(L)throw L;const je=V.reduce((A,I)=>A+I.weight,0),ce=V.reduce((A,I)=>A+I.quantity,0),N=V.reduce((A,I)=>{const P=I.inventoryItem.final_size||0;return A[P]=(A[P]||0)+I.quantity,A},{}),F=t.find(A=>A.id===v),{data:p,error:D}=await j.from("dispatch_records").update({fish_ids:y,total_weight:je,total_pieces:ce,size_breakdown:N,status:"dispatched",notes:`Inventory picked for order ${F?.order_number||v}`}).eq("outlet_order_id",v).select().single();if(D)throw D;const{error:E}=await j.from("outlet_orders").update({status:"dispatched",dispatch_date:new Date().toISOString().split("T")[0]}).eq("id",v);if(E)throw E;await Promise.all([W(),G(),Y()]),T(!1),b(null),u([]),ee.success("Order dispatched successfully!",{description:`Order ${F?.order_number||v} has been dispatched with ${ce} pieces`,duration:5e3})}catch(y){console.error("Error dispatching order:",y),ee.error("Failed to dispatch order",{description:"Please try again or contact support if the issue persists",duration:5e3})}};return c.useEffect(()=>{(async()=>{g(!0),await Promise.all([W(),G(),J(),Y(),h()]),g(!1)})()},[]),e.jsxs(e.Fragment,{children:[e.jsx("style",{jsx:"true",global:"true",children:`
        @media print {
          body * {
            visibility: hidden;
          }
          .printable-invoice, .printable-invoice * {
            visibility: visible;
          }
          .printable-invoice {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            background: white !important;
            color: black !important;
            box-shadow: none !important;
            border: none !important;
            margin: 0 !important;
            padding: 20px !important;
            max-height: none !important;
            overflow: visible !important;
          }
          .printable-invoice .bg-gradient-to-r {
            background: #2563eb !important;
            color: white !important;
          }
          .printable-invoice .bg-green-600 {
            background: #16a34a !important;
            color: white !important;
          }
          .printable-invoice .bg-gray-50 {
            background: #f9fafb !important;
          }
          .printable-invoice .bg-yellow-50 {
            background: #fefce8 !important;
          }
          .printable-invoice .text-white {
            color: white !important;
          }
          .printable-invoice .text-blue-100 {
            color: #dbeafe !important;
          }
          .printable-invoice .text-green-100 {
            color: #dcfce7 !important;
          }
          .printable-invoice .border {
            border: 1px solid #d1d5db !important;
          }
          .printable-invoice .rounded-lg,
          .printable-invoice .rounded-xl,
          .printable-invoice .rounded-2xl {
            border-radius: 4px !important;
          }
          .printable-invoice .shadow-2xl,
          .printable-invoice .shadow-lg {
            box-shadow: none !important;
          }
          .printable-invoice .p-8 {
            padding: 16px !important;
          }
          .printable-invoice .p-6 {
            padding: 12px !important;
          }
          .printable-invoice .p-4 {
            padding: 8px !important;
          }
          .printable-invoice .p-3 {
            padding: 6px !important;
          }
          .printable-invoice .text-3xl {
            font-size: 24px !important;
          }
          .printable-invoice .text-2xl {
            font-size: 20px !important;
          }
          .printable-invoice .text-lg {
            font-size: 16px !important;
          }
          .printable-invoice .mb-6 {
            margin-bottom: 12px !important;
          }
          .printable-invoice .mb-4 {
            margin-bottom: 8px !important;
          }
          .printable-invoice .mb-2 {
            margin-bottom: 4px !important;
          }
          .printable-invoice .mb-1 {
            margin-bottom: 2px !important;
          }
          .printable-invoice .mt-4 {
            margin-top: 8px !important;
          }
          .printable-invoice .gap-6 {
            gap: 12px !important;
          }
          .printable-invoice .max-h-[60vh] {
            max-height: none !important;
          }
          .printable-invoice .overflow-hidden {
            overflow: visible !important;
          }
          .printable-invoice .overflow-y-auto {
            overflow: visible !important;
          }
          .printable-invoice .flex {
            display: block !important;
          }
          .printable-invoice .grid {
            display: block !important;
          }
          .printable-invoice .grid > * {
            margin-bottom: 8px !important;
          }
          .printable-invoice .hidden {
            display: none !important;
          }
          .printable-invoice table {
            width: 100% !important;
            border-collapse: collapse !important;
          }
          .printable-invoice th,
          .printable-invoice td {
            padding: 8px !important;
            text-align: left !important;
            border-bottom: 1px solid #d1d5db !important;
          }
        }
      `}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4 md:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl p-6 text-white shadow-lg",children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(ht,{size:"lg",showText:!1})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(ks,{className:"h-8 w-8"}),"Dispatch Management"]}),e.jsx("p",{className:"text-white/80 mt-2",children:"Assign drivers to confirmed orders and manage dispatch operations"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-white/70",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold",children:t.length+r.length})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-white/70",children:"Awaiting Dispatch"}),e.jsx("p",{className:"text-2xl font-bold text-orange-200",children:t.length})]})]})]})}),!m&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Awaiting Dispatch"}),e.jsx("p",{className:"text-3xl font-bold text-orange-800",children:t.length})]}),e.jsx("div",{className:"p-3 bg-orange-100 rounded-full",children:e.jsx(gs,{className:"h-6 w-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Dispatched"}),e.jsx("p",{className:"text-3xl font-bold text-green-800",children:r.length})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx(ks,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Orders"}),e.jsx("p",{className:"text-3xl font-bold text-blue-800",children:t.length+r.length})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx(As,{className:"h-6 w-6 text-blue-600"})})]})})]}),m&&e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-3 text-muted-foreground",children:"Loading dispatch data..."})]}),!m&&e.jsxs(U,{className:"shadow-lg border-0",children:[e.jsx(Fe,{className:"bg-gradient-to-r from-orange-50 to-amber-50 border-b",children:e.jsxs(Pe,{className:"flex items-center gap-2 text-orange-800",children:[e.jsx(gs,{className:"h-5 w-5"}),"Orders Awaiting Driver Assignment (",t.length,")"]})}),e.jsx(H,{className:"p-6",children:t.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("div",{className:"bg-orange-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4",children:e.jsx(ks,{className:"h-10 w-10 text-orange-600"})}),e.jsx("p",{className:"text-lg font-medium",children:"No orders awaiting dispatch"}),e.jsx("p",{className:"text-sm",children:"Confirmed orders will appear here for driver assignment"})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:t.map(y=>e.jsxs("div",{className:"bg-white border border-orange-200 rounded-xl p-5 hover:shadow-xl transition-all duration-300 hover:border-orange-400 hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(se,{className:"bg-orange-100 text-orange-800 text-xs font-medium px-2 py-1",children:"AWAITING DRIVER"})}),e.jsx(k,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-blue-50",children:e.jsx(rs,{className:"h-4 w-4 text-gray-600"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(As,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-900 text-sm",children:y.outlet?.name||"Unknown Outlet"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(Ds,{className:"h-3 w-3"}),e.jsx("span",{children:y.outlet?.location||"Unknown Location"})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Order ID:"}),e.jsx("span",{className:"font-medium text-gray-900",children:y.order_number||y.id})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Quantity:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[y.requested_quantity,"kg"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Sizes:"}),e.jsx("span",{className:"font-medium text-gray-900",children:y.requested_sizes?.join(", ")||"Any"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(y.order_date).toLocaleDateString()})]})]}),e.jsx("div",{className:"border-t border-gray-100 pt-3 mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Value"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["KES ",y.total_value?.toLocaleString()||"0"]})]})}),e.jsx("div",{className:"space-y-2",children:e.jsxs(k,{size:"sm",onClick:()=>q(y.id),className:"w-full bg-green-600 hover:bg-green-700 text-white text-xs",children:[e.jsx(qe,{className:"h-3 w-3 mr-1"}),"Approve Dispatch"]})})]},y.id))})})]}),!m&&e.jsxs(U,{className:"shadow-lg border-0",children:[e.jsx(Fe,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-b",children:e.jsxs(Pe,{className:"flex items-center gap-2 text-green-800",children:[e.jsx(ks,{className:"h-5 w-5"}),"Dispatched Orders (",r.length,")"]})}),e.jsx(H,{className:"p-6",children:r.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("div",{className:"bg-green-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4",children:e.jsx(ks,{className:"h-10 w-10 text-green-600"})}),e.jsx("p",{className:"text-lg font-medium",children:"No dispatched orders"}),e.jsx("p",{className:"text-sm",children:"Orders that have been dispatched will appear here"})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:r.map(y=>e.jsxs("div",{className:"bg-white border border-green-200 rounded-xl p-5 hover:shadow-xl transition-all duration-300 hover:border-green-400 hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(se,{className:"bg-green-100 text-green-800 text-xs font-medium px-2 py-1",children:"DISPATCHED"})}),e.jsx(k,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-blue-50",onClick:()=>Ce(y),title:"View Invoice Details",children:e.jsx(rs,{className:"h-4 w-4 text-gray-600"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(As,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-900 text-sm",children:y.outlet?.name||"Unknown Outlet"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(Ds,{className:"h-3 w-3"}),e.jsx("span",{children:y.outlet?.location||"Unknown Location"})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Order ID:"}),e.jsx("span",{className:"font-medium text-gray-900",children:y.order_number||y.id})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Quantity:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[y.requested_quantity,"kg"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Sizes:"}),e.jsx("span",{className:"font-medium text-gray-900",children:y.requested_sizes?.join(", ")||"Any"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Dispatched:"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(y.dispatch_date||y.order_date).toLocaleDateString()})]}),(y.dispatch_record?.picking_date||y.dispatch_record?.notes?.includes("Picking:"))&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Picking Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:y.dispatch_record?.picking_date?new Date(y.dispatch_record.picking_date).toLocaleDateString():y.dispatch_record?.notes?.match(/Picking: ([^ ]+)/)?.[1]||"Not specified"})]}),(y.dispatch_record?.picking_time||y.dispatch_record?.notes?.includes("at "))&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Picking Time:"}),e.jsx("span",{className:"font-medium text-gray-900",children:y.dispatch_record?.picking_time||y.dispatch_record?.notes?.match(/at ([^.]+)/)?.[1]||"Not specified"})]}),(y.dispatch_record?.assigned_driver||y.dispatch_record?.notes?.includes("Driver:"))&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Driver:"}),e.jsx("span",{className:"font-medium text-gray-900",children:y.dispatch_record?.assigned_driver||y.dispatch_record?.notes?.match(/Driver: ([^,]+)/)?.[1]||"Not assigned"})]}),y.dispatch_record?.total_weight&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Weight:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[y.dispatch_record.total_weight," kg"]})]})]}),e.jsx("div",{className:"border-t border-gray-100 pt-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Value"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["KES ",y.total_value?.toLocaleString()||"0"]})]})})]},y.id))})})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Pick Inventory for Order"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Select items from inventory to fulfill this order"})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:f.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Te,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No inventory available"}),e.jsx("p",{className:"text-sm",children:"No items are ready for dispatch"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:f.map(y=>{const L=V.some(ce=>ce.inventoryItem.id===y.id),je=V.find(ce=>ce.inventoryItem.id===y.id);return e.jsxs("div",{className:`border rounded-lg p-4 ${L?"border-orange-500 bg-orange-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium text-gray-900",children:["Size ",y.final_size]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Available: ",y.ready_for_dispatch_count," pieces"]})]}),e.jsx(se,{className:L?"bg-orange-500":"bg-gray-500",children:L?"Picked":"Available"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("p",{children:["Weight: ",y.total_weight,"kg"]}),e.jsxs("p",{children:["Storage: ",y.storage_location||"Unknown"]}),e.jsxs("p",{children:["Farmer: ",y.farmer_name||"Unknown"]})]}),L?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"1",max:y.ready_for_dispatch_count,value:je?.quantity||1,onChange:ce=>{const N=parseInt(ce.target.value)||1;u(F=>F.map(p=>p.inventoryItem.id===y.id?{...p,quantity:N,weight:N*(y.total_weight/y.ready_for_dispatch_count)}:p))},className:"w-20 px-2 py-1 border rounded text-sm"}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>{u(ce=>ce.filter(N=>N.inventoryItem.id!==y.id))},className:"text-red-600 hover:text-red-700",children:"Remove"})]}):e.jsx(k,{size:"sm",onClick:()=>{u(ce=>[...ce,{inventoryItem:y,quantity:1,weight:y.total_weight/y.ready_for_dispatch_count}])},className:"w-full bg-orange-600 hover:bg-orange-700 text-white",children:"Add to Pick List"})]})]},y.id)})})}),e.jsxs("div",{className:"p-6 border-t bg-gray-50 flex justify-between items-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:V.length>0&&e.jsxs("p",{children:["Selected: ",V.reduce((y,L)=>y+L.quantity,0)," pieces,",V.reduce((y,L)=>y+L.weight,0).toFixed(2),"kg"]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{variant:"outline",onClick:()=>{T(!1),b(null),u([])},children:"Cancel"}),e.jsx(k,{onClick:Me,disabled:V.length===0,className:"bg-orange-600 hover:bg-orange-700 text-white",children:"Dispatch Order"})]})]})]})}),M&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Approve Dispatch"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Assign a driver and approve this dispatch"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-700",children:"Select Driver"}),e.jsxs(os,{onValueChange:y=>z(L=>({...L,driverId:y})),children:[e.jsx(ds,{className:"mt-1",children:e.jsx(cs,{placeholder:"Choose a driver"})}),e.jsx(ms,{children:X.map(y=>e.jsx(_e,{value:y.id,children:y.name},y.id))})]})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-700",children:"Picking Date *"}),e.jsx("input",{type:"date",value:K.pickingDate,onChange:y=>z(L=>({...L,pickingDate:y.target.value})),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-700",children:"Picking Time *"}),e.jsx("input",{type:"time",value:K.pickingTime,onChange:y=>z(L=>({...L,pickingTime:y.target.value})),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium text-gray-700",children:"Notes (Optional)"}),e.jsx("textarea",{value:K.notes,onChange:y=>z(L=>({...L,notes:y.target.value})),placeholder:"Add any notes for this dispatch...",className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]})]}),e.jsxs("div",{className:"p-6 border-t bg-gray-50 flex justify-end gap-3",children:[e.jsx(k,{variant:"outline",onClick:()=>{R(!1),b(null),z({driverId:"",notes:"",pickingDate:"",pickingTime:""})},children:"Cancel"}),e.jsxs(k,{onClick:we,disabled:!K.driverId,className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Approve Dispatch"]})]})]})}),ae&&O&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"printable-invoice bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl",children:e.jsx(ht,{size:"lg",showText:!1})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Dispatch Invoice"}),e.jsxs("p",{className:"text-blue-100 text-lg mt-1",children:["Order #",O.order_number||O.id.slice(0,8)]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{variant:"outline",size:"sm",onClick:fe,className:"bg-white/10 border-white/30 text-white hover:bg-white/20 px-4 py-2 rounded-xl font-semibold",children:"Print"}),e.jsx(k,{variant:"outline",size:"sm",onClick:De,className:"bg-white/10 border-white/30 text-white hover:bg-white/20 px-4 py-2 rounded-xl font-semibold",children:"Close"})]})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-2",children:"From:"}),e.jsx("p",{className:"text-gray-700",children:"Rio Fish Management"}),e.jsx("p",{className:"text-gray-700",children:"Nairobi, Kenya"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-2",children:"To:"}),e.jsx("p",{className:"text-gray-700 font-medium",children:O.outlet?.name||"Unknown Outlet"}),e.jsx("p",{className:"text-gray-700",children:O.outlet?.location||"Unknown Location"})]})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("th",{className:"text-left py-2 font-semibold text-gray-700",children:"Item"}),e.jsx("th",{className:"text-left py-2 font-semibold text-gray-700",children:"Details"})]})}),e.jsxs("tbody",{className:"text-sm",children:[e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Order #"}),e.jsx("td",{className:"py-2 font-medium",children:O.order_number||O.id.slice(0,8)})]}),e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Date"}),e.jsx("td",{className:"py-2 font-medium",children:new Date(O.order_date).toLocaleDateString()})]}),e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Quantity"}),e.jsxs("td",{className:"py-2 font-medium",children:[O.requested_quantity," kg"]})]}),e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Sizes"}),e.jsx("td",{className:"py-2 font-medium",children:O.requested_sizes?.join(", ")||"Any Size"})]}),e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Driver"}),e.jsx("td",{className:"py-2 font-medium",children:O.dispatch_record?.assigned_driver||O.dispatch_record?.notes?.match(/Driver: ([^,]+)/)?.[1]||"Not assigned"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Price/kg"}),e.jsxs("td",{className:"py-2 font-medium",children:["KES ",O.price_per_kg?.toLocaleString()||"0"]})]})]})]})}),e.jsxs("div",{className:"bg-green-600 rounded-lg p-4 text-white text-center",children:[e.jsx("p",{className:"text-green-100 text-sm mb-1",children:"Total Amount"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KES ",O.total_value?.toLocaleString()||"0"]})]}),O.notes&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Notes:"})," ",O.notes]})})]})]})})]})})]})}const Sn=Object.freeze(Object.defineProperty({__proto__:null,default:wn},Symbol.toStringTag,{value:"Module"}));class Os{static async logEvent(t){try{const s=JSON.parse(sessionStorage.getItem("currentUser")||"null");if(!s){console.warn("No authenticated user found for audit logging");return}const r={user_id:s.id,action:t.action,table_name:t.table_name,record_id:t.record_id,old_values:t.old_values?JSON.stringify(t.old_values):null,new_values:t.new_values?JSON.stringify(t.new_values):null,ip_address:t.ip_address||null,user_agent:t.user_agent||navigator.userAgent,created_at:new Date().toISOString()},l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBncGF6d2xlamh5c3hhYnRraWZ6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Mzg2MTQ4OSwiZXhwIjoyMDY5NDM3NDg5fQ.wnB6HLpF6vLuwDIWrHgZzU4PubvOqrzHxbLc3qgxIh8";let d=null;l&&(d=(await sa("https://pgpazwlejhysxabtkifz.supabase.co",l,{auth:{autoRefreshToken:!1,persistSession:!1,detectSessionInUrl:!1}}).from("audit_logs").insert([r])).error),d&&console.warn("Failed to log audit event:",d)}catch(s){console.warn("Failed to log audit event:",s)}}static async logCreate(t,s,r){await Os.logEvent({action:"CREATE",table_name:t,record_id:s,new_values:r})}static async logUpdate(t,s,r,l){await Os.logEvent({action:"UPDATE",table_name:t,record_id:s,old_values:r,new_values:l})}static async logDelete(t,s,r){await Os.logEvent({action:"DELETE",table_name:t,record_id:s,old_values:r})}static async logLogin(t,s){await Os.logEvent({action:"LOGIN",table_name:"profiles",record_id:t,new_values:{login_time:new Date().toISOString()},user_agent:s})}static async logLogout(t){await Os.logEvent({action:"LOGOUT",table_name:"profiles",record_id:t,new_values:{logout_time:new Date().toISOString()}})}static async logCustomAction(t,s,r,l){await Os.logEvent({action:t,table_name:s,record_id:r,new_values:l})}}const kn={create:Os.logCreate,update:Os.logUpdate,delete:Os.logDelete,login:Os.logLogin,logout:Os.logLogout,custom:Os.logCustomAction};function Cn({onNavigate:a}){const{user:t}=Js(),[s,r]=c.useState([]),[l,d]=c.useState(!1),[x,m]=c.useState(!0),[g,f]=c.useState(!1),[n,S]=c.useState(!1),[T,V]=c.useState([]),[u,v]=c.useState(null),[b,M]=c.useState(null),[R,X]=c.useState(!1),[Z,K]=c.useState(new Set),[z,ae]=c.useState({dispatchId:"",outletId:"",actualWeight:"",actualValue:"",condition:"",receivedBy:t?`${t.first_name} ${t.last_name}`:"",notes:"",sizeDiscrepancies:{}});c.useEffect(()=>{t&&ae(p=>({...p,receivedBy:`${t.first_name} ${t.last_name}`}))},[t]);const re=p=>`REC${String(p+1).padStart(4,"0")}`,O=p=>{const D={};return p.forEach((E,A)=>{const I=E.dispatch?.outlet_order?.outlet?.name||"Unknown Outlet";D[I]||(D[I]=[]),D[I].push({...E,displayIndex:A})}),D},le=p=>{const D=new Set(Z);D.has(p)?D.delete(p):D.add(p),K(D)},W=p=>{M(p),X(!0)},G=async()=>{try{m(!0);const p=Ut(t?.id),{data:D,error:E}=await ie(async()=>await p.from("outlet_receiving").select(`
            *,
            dispatch_records!inner(
              id,
              destination,
              dispatch_date,
              outlet_orders!inner(
                id,
                order_number,
                outlets!inner(
                  id,
                  name,
                  location
                )
              )
            )
          `).order("received_date",{ascending:!1}));if(E)throw E;const A=(D||[]).map(I=>({id:I.id,dispatch_id:I.dispatch_id,outlet_order_id:I.outlet_order_id,received_date:I.received_date,received_by:I.received_by,expected_weight:parseFloat(I.expected_weight)||0,actual_weight_received:parseFloat(I.actual_weight_received)||0,expected_value:parseFloat(I.expected_value)||0,actual_value_received:parseFloat(I.actual_value_received)||0,condition:I.condition||"good",size_discrepancies:I.size_discrepancies||null,discrepancy_notes:I.discrepancy_notes||null,status:I.status||"confirmed",outlet_name:I.outlet_name||"Unknown",outlet_location:I.outlet_location||"Unknown",created_at:I.created_at,updated_at:I.updated_at,dispatch:{id:I.dispatch_records?.id||I.dispatch_id,destination:I.dispatch_records?.destination||"Unknown",dispatch_date:I.dispatch_records?.dispatch_date,outlet_order:{order_number:I.dispatch_records?.outlet_orders?.order_number||"N/A",outlet:{name:I.dispatch_records?.outlet_orders?.outlets?.name||I.outlet_name||"Unknown",location:I.dispatch_records?.outlet_orders?.outlets?.location||I.outlet_location||"Unknown"}}}}));r(A)}catch(p){const D=Ne(p,"fetching receiving records");ee.error(D),r([])}finally{m(!1)}},J=async()=>{try{const p=Ut(t?.id),{data:D,error:E}=await ie(async()=>await p.from("dispatch_records").select(`
            id,
            outlet_order_id,
            destination,
            total_weight,
            total_value,
            size_breakdown,
            status,
            dispatch_date,
            notes,
            picking_date,
            picking_time,
            assigned_driver,
            outlet_order:outlet_orders(
              id,
              order_number,
              total_value,
              outlet:outlets(name, location, phone)
            )
          `).in("status",["in-transit","dispatched","scheduled"]).order("dispatch_date",{ascending:!1}));if(E)throw E;return console.log("Fetched dispatches:",D),D?.forEach((A,I)=>{console.log(`Dispatch ${I} size breakdown:`,A.size_breakdown)}),D||[]}catch(p){return console.error("Error fetching dispatches:",p),[]}},h=()=>{if(!u?.size_breakdown)return 0;let p=0;return Object.entries(u.size_breakdown).forEach(([D,E])=>{const A=z.sizeDiscrepancies[parseInt(D)]||0,I=E+A;p+=I}),p},Y=()=>{const p=h(),D=parseFloat(z.actualWeight)||0,E=u?.size_breakdown&&Object.keys(u.size_breakdown).length>0,A=Object.keys(z.sizeDiscrepancies).length>0;return!!(z.dispatchId&&u&&z.actualWeight&&z.actualWeight.trim()!==""&&parseFloat(z.actualWeight)>0&&z.actualValue&&z.actualValue.trim()!==""&&parseFloat(z.actualValue)>0&&z.condition&&z.condition.trim()!==""&&t&&t.id&&(!E||A)&&(p===0||Math.abs(p-D)<=.1))},q=()=>{const p=[];(!z.dispatchId||!u)&&p.push("Please select a valid dispatch");const D=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(z.dispatchId&&!D.test(z.dispatchId)&&(p.push("Invalid dispatch ID format. Please refresh and select a dispatch again."),console.error("Invalid dispatch ID:",z.dispatchId)),!z.actualWeight||z.actualWeight.trim()===""?p.push("Please enter the weight received"):parseFloat(z.actualWeight)<=0?p.push("Weight received must be greater than 0"):parseFloat(z.actualWeight)<.1&&p.push("Weight received seems too low (<0.1kg). Please verify the value"),!z.actualValue||z.actualValue.trim()===""?p.push("Please enter the value received"):parseFloat(z.actualValue)<=0&&p.push("Value received must be greater than 0"),(!z.condition||z.condition.trim()==="")&&p.push("Please select the condition of received items"),(!t||!t.id)&&p.push("User session expired. Please refresh and try again"),u){const E=u.total_weight||0,A=u.total_value||0;E>1e4&&console.warn(`⚠️ WARNING: Expected weight (${E}kg) seems unrealistic. Please verify dispatch data.`),A>1e6&&console.warn(`⚠️ WARNING: Expected value (KES ${A.toLocaleString()}) seems unrealistic. Please verify dispatch data.`)}if(u&&u.total_weight>0){const E=u.total_weight||0,A=parseFloat(z.actualWeight)||0,I=Math.abs(A-E),P=E>0?I/E*100:0;P>20&&console.warn(`Weight discrepancy is ${P.toFixed(1)}% - please verify the received weight`)}if(z.actualWeight&&isNaN(parseFloat(z.actualWeight))&&p.push("Weight received must be a valid number"),z.actualValue&&isNaN(parseFloat(z.actualValue))&&p.push("Value received must be a valid number"),u?.size_breakdown&&Object.keys(u.size_breakdown).length>0)if(!(Object.keys(z.sizeDiscrepancies).length>0))p.push("This dispatch has size breakdown data. Please fill in the size discrepancies section below.");else{const A=h(),I=parseFloat(z.actualWeight)||0,P=Math.abs(A-I);P>.1&&p.push(`Size breakdown total (${A.toFixed(1)}kg) does not match total weight received (${I.toFixed(1)}kg). Difference: ${P.toFixed(1)}kg`)}return p},we=async(p,D,E,A,I)=>{try{await kn.custom(p,D,E,{old_values:A,new_values:I})}catch(P){console.warn("Failed to log audit event:",P)}},Ce=async()=>{if(n){ee.warning("Please wait, submission in progress...");return}try{S(!0);const p=q();if(p.length>0){p.forEach(P=>ee.error(P));return}if(u){const P=u.total_weight||0,be=u.total_value||0,ze=parseFloat(z.actualWeight)||0;P>1e4&&ee.warning(`⚠️ Large expected weight: ${P}kg`),be>1e6&&ee.warning(`⚠️ Large expected value: KES ${be.toLocaleString()}`),ze>P&&ze>1e4&&ee.warning(`⚠️ Received weight (${ze}kg) is larger than expected (${P}kg)`);const Ie=P>0?Math.abs(ze-P)/P*100:0;Ie>20&&ee.warning(`⚠️ Large discrepancy: ${Ie.toFixed(1)}%`)}const D={dispatch_id:z.dispatchId,outlet_order_id:u.outlet_order_id,received_date:new Date().toISOString().split("T")[0],received_by:t?.id||null,expected_weight:parseFloat((u.total_weight||0).toString()),actual_weight_received:parseFloat(z.actualWeight)||0,expected_pieces:0,actual_pieces_received:0,expected_value:parseFloat((u.total_value||u.outlet_order?.total_value||0).toString()),actual_value_received:parseFloat(z.actualValue)||0,condition:z.condition||"good",size_discrepancies:Object.keys(z.sizeDiscrepancies).length>0?z.sizeDiscrepancies:null,discrepancy_notes:z.notes||null,status:"confirmed",outlet_name:u.outlet_order?.outlet?.name||u.destination,outlet_location:u.outlet_order?.outlet?.location||"Unknown"};console.log("Creating receiving record with data:",D),console.log("Form data dispatchId:",z.dispatchId),console.log("Form data dispatchId type:",typeof z.dispatchId),console.log("Selected dispatch:",u),console.log("Selected dispatch ID:",u?.id),console.log("Selected dispatch ID type:",typeof u?.id);const E=Ut(t?.id),{data:A,error:I}=await ie(async()=>await E.from("outlet_receiving").insert([D]).select("id").single());if(I)throw I;await E.from("dispatch_records").update({status:"delivered",updated_at:new Date().toISOString()}).eq("id",z.dispatchId);try{await we("INSERT","outlet_receiving",A.id,null,{...D,entry_code:`RCV-${Date.now()}`,fish_type:u.fish_type||"Tilapia",condition:D.condition,weight_received:D.actual_weight_received,outlet_id:u.outlet_order?.outlet_id,receiving_date:D.received_date})}catch(P){console.warn("Audit logging failed (non-critical):",P)}ee.success("Receiving record created successfully"),ae({dispatchId:"",outletId:"",actualWeight:"",actualValue:"",condition:"",receivedBy:t?`${t.first_name} ${t.last_name}`:"",notes:"",sizeDiscrepancies:{}}),v(null),d(!1),await G()}catch(p){const D=Ne(p,"creating receiving record");ee.error(D)}finally{S(!1)}},De=async()=>{try{const p=await J();console.log("Fetched dispatches:",p),V(p)}catch(p){console.error("Error loading dispatches:",p),ee.error("Failed to load available dispatches")}};c.useEffect(()=>{console.log("Available dispatches updated:",T),T.forEach((p,D)=>{console.log(`Dispatch ${D}:`,{id:p.id,idType:typeof p.id,destination:p.destination,total_weight:p.total_weight,size_breakdown:p.size_breakdown})})},[T]);const fe=p=>{console.log("Selected dispatch ID:",p),console.log("Available dispatches:",T);const D=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(!D.test(p)){console.error("Invalid dispatch ID format:",p),ee.error("Invalid dispatch selection. Please refresh and try again.");return}const E=T.find(A=>A.id===p);if(console.log("Found dispatch:",E),!E){console.error("Dispatch not found for ID:",p),ee.error("Selected dispatch not found. Please refresh and try again.");return}if(!E.id||!D.test(E.id)){console.error("Dispatch has invalid ID:",E.id),ee.error("Selected dispatch has invalid ID. Please refresh and try again.");return}v(E),console.log("Selected dispatch size breakdown:",E.size_breakdown),console.log("Size breakdown keys:",E.size_breakdown?Object.keys(E.size_breakdown):"No size breakdown"),console.log("Size breakdown entries:",E.size_breakdown?Object.entries(E.size_breakdown):"No size breakdown"),ae(A=>({...A,dispatchId:E.id,outletId:E.outlet_order?.outlet?.name||"",actualWeight:E.total_weight?.toString()||"",actualValue:E.total_value?.toString()||"",condition:"good"}))},Me=async()=>{f(!0),await G(),f(!1)};c.useEffect(()=>{G()},[]),c.useEffect(()=>{l&&De()},[l]);const y=p=>{switch(p){case"confirmed":return"bg-emerald-500 text-white";case"disputed":return"bg-red-500 text-white";case"pending":return"bg-amber-500 text-white";default:return"bg-gray-500 text-white"}},L=p=>{switch(p){case"excellent":return"bg-green-500 text-white";case"good":return"bg-blue-500 text-white";case"fair":return"bg-orange-500 text-white";case"poor":return"bg-red-500 text-white";default:return"bg-gray-500 text-white"}},je=p=>`KES ${p.toLocaleString()}`,ce=(p,D)=>{const E=D-p,A=p>0?(E/p*100).toFixed(1):"0";return{diff:E,percentage:A}},N=p=>{if(!p)return"No size discrepancies";const D=Object.entries(p).filter(([E,A])=>A!==0).map(([E,A])=>`Size ${E}: ${A>0?"+":""}${A}`);return D.length>0?D.join(", "):"No size discrepancies"},F={totalReceivings:s.length,confirmed:s.filter(p=>p.status==="confirmed").length,disputed:s.filter(p=>p.status==="disputed").length,totalValue:s.reduce((p,D)=>p+(D.actual_value_received||0),0),totalWeight:s.reduce((p,D)=>p+(D.actual_weight_received||0),0)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-blue-50 p-4 md:p-8",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h1",{className:"text-4xl font-bold text-gray-900 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-green-500 to-blue-600 rounded-2xl shadow-lg",children:e.jsx(bt,{className:"h-10 w-10 text-white"})}),"Outlet Receiving Records"]}),e.jsx("p",{className:"text-xl text-gray-600 ml-16",children:"Track what outlets received • Size-based verification • Quality control"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(k,{variant:"outline",onClick:Me,disabled:g,className:"px-6 py-3 rounded-2xl font-semibold",children:[e.jsx(Ze,{className:`h-5 w-5 mr-2 ${g?"animate-spin":""}`}),"Refresh"]}),e.jsxs(Xe,{open:l,onOpenChange:d,children:[e.jsx(St,{asChild:!0,children:e.jsxs(k,{className:"bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 text-white px-8 py-4 rounded-2xl font-semibold text-lg shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:scale-105",children:[e.jsx(Cs,{className:"h-6 w-6 mr-3"}),"Record Receiving"]})}),e.jsxs(Ye,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(es,{children:[e.jsx(Je,{className:"text-2xl font-bold text-gray-900",children:"Record Outlet Receiving"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required"]})]}),e.jsxs("div",{className:"space-y-6 py-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(B,{className:"text-base font-semibold text-gray-700",children:["Select Dispatch ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(os,{value:z.dispatchId,onValueChange:fe,children:[e.jsx(ds,{className:"h-14 text-base",children:e.jsx(cs,{placeholder:"Select dispatch to receive"})}),e.jsx(ms,{children:T.map(p=>e.jsxs(_e,{value:p.id,children:[p.outlet_order?.order_number||`ORD-${p.id?.slice(-6)}`," - ",p.destination,p.total_weight>0?` (${p.total_weight}kg)`:" (Not picked yet)"," ","- ",p.status.toUpperCase()]},p.id))})]})]}),u&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-2xl border-l-4 border-blue-400",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Dispatch Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Outlet:"})," ",u.outlet_order?.outlet?.name||u.destination]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Location:"})," ",u.outlet_order?.outlet?.location||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Order Number:"})," ",u.outlet_order?.order_number||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx("span",{className:`ml-1 px-2 py-1 rounded text-xs font-medium ${u.status==="dispatched"?"bg-green-100 text-green-800":u.status==="in-transit"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:u.status.toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Expected Weight:"}),e.jsxs("span",{className:`font-medium ${u.total_weight>1e4?"text-red-600":"text-green-600"}`,children:[u.total_weight,"kg",u.total_weight>1e4&&e.jsx("span",{className:"text-xs text-red-500 ml-1",children:"⚠️"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Expected Value:"}),e.jsxs("span",{className:`font-medium ${(u.total_value||0)>1e6?"text-red-600":"text-gray-900"}`,children:["KES ",(u.total_value||u.outlet_order?.total_value||0).toLocaleString(),(u.total_value||0)>1e6&&e.jsx("span",{className:"text-xs text-red-500 ml-1",children:"⚠️"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Dispatch Date:"})," ",new Date(u.dispatch_date).toLocaleDateString()]}),u.assigned_driver&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Driver:"})," ",u.assigned_driver]}),u.picking_date&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Picking Date:"})," ",new Date(u.picking_date).toLocaleDateString()]})]}),u.size_breakdown&&Object.keys(u.size_breakdown).length>0?e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold text-blue-900",children:"Size Breakdown Available:"}),e.jsxs("span",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs font-medium",children:[Object.keys(u.size_breakdown).length," sizes"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(u.size_breakdown).map(([p,D])=>e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-md text-sm font-medium border border-blue-300",children:["Size ",p,": ",D,"kg"]},p))}),e.jsx("div",{className:"mt-2 text-xs text-blue-700",children:"⚠️ Size discrepancies must be filled below before submitting"})]}):e.jsx("div",{className:"mt-3 p-2 bg-gray-50 border border-gray-200 rounded text-sm text-gray-600",children:"No size breakdown data available for this dispatch"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(B,{className:"text-base font-semibold text-gray-700",children:["Weight Received (kg) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Se,{type:"number",step:"0.1",placeholder:"202.5",className:"h-14 text-base",value:z.actualWeight,onChange:p=>ae({...z,actualWeight:p.target.value})}),u&&z.actualWeight&&e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"text-gray-600",children:["Expected: ",u.total_weight,"kg"]}),(()=>{const p=u.total_weight||0,D=parseFloat(z.actualWeight)||0,E=p-D,A=D-p,I=p>0?(A/p*100).toFixed(1):"0",P=Math.abs(A)>p*.1;return e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:`${P?"text-orange-600 font-medium":"text-green-600"}`,children:A>0?`+${A.toFixed(1)}kg (${I}% over)`:A<0?`${A.toFixed(1)}kg (${I}% under)`:"Exact match"}),e.jsxs("div",{className:"text-blue-600 font-medium",children:["Remaining: ",E>0?E.toFixed(1):0,"kg"]})]})})()]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(B,{className:"text-base font-semibold text-gray-700",children:["Value Received (KES) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Se,{type:"number",placeholder:"101250",className:"h-14 text-base",value:z.actualValue,onChange:p=>ae({...z,actualValue:p.target.value})}),u&&z.actualValue&&e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Expected: KES ",u.total_value?.toLocaleString()]}),(()=>{const p=u.total_value||0,E=(parseFloat(z.actualValue)||0)-p,A=p>0?(E/p*100).toFixed(1):"0",I=Math.abs(E)>p*.1;return e.jsxs("span",{className:`ml-2 ${I?"text-orange-600 font-medium":"text-green-600"}`,children:["(",E>0?"+":"","KES ",E.toLocaleString(),", ",A,"%)"]})})()]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(B,{className:"text-base font-semibold text-gray-700",children:["Quality Condition ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(os,{value:z.condition,onValueChange:p=>ae({...z,condition:p}),children:[e.jsx(ds,{className:"h-14 text-base",children:e.jsx(cs,{placeholder:"Select condition"})}),e.jsxs(ms,{children:[e.jsx(_e,{value:"excellent",children:"🟢 Excellent - Perfect condition"}),e.jsx(_e,{value:"good",children:"🔵 Good - Minor issues"}),e.jsx(_e,{value:"fair",children:"🟡 Fair - Some quality concerns"}),e.jsx(_e,{value:"poor",children:"🔴 Poor - Significant quality issues"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(B,{className:"text-base font-semibold text-gray-700",children:"Received By"}),e.jsx(Se,{placeholder:"Staff member name",className:"h-14 text-base bg-gray-50",value:z.receivedBy,readOnly:!0,title:"Automatically set to logged-in user"})]}),u?.size_breakdown&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs(B,{className:"text-base font-semibold text-gray-700",children:["Size Discrepancies ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4 text-blue-600"}),e.jsx("div",{className:"text-sm text-blue-800 font-medium",children:"This dispatch has size breakdown data. Please fill in the actual quantities received for each size."})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:Object.entries(u.size_breakdown).map(([p,D])=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(B,{className:"text-sm font-medium text-gray-600",children:["Size ",p," (Expected: ",D,"kg)"]}),e.jsx(Se,{type:"number",step:"0.1",placeholder:"Actual received",className:"h-10 text-sm",onChange:E=>{const I=(parseFloat(E.target.value)||0)-D;ae(P=>({...P,sizeDiscrepancies:{...P.sizeDiscrepancies,[parseInt(p)]:I}}))}})]},p))}),Object.keys(z.sizeDiscrepancies).length>0&&e.jsxs("div",{className:"mt-4 p-3 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Size Breakdown Total:"}),e.jsxs("span",{className:"text-sm font-bold text-blue-600",children:[h().toFixed(1)," kg"]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Total Weight Received:"}),e.jsxs("span",{className:"text-sm font-bold text-green-600",children:[parseFloat(z.actualWeight||"0").toFixed(1)," kg"]})]}),(()=>{const p=h(),D=parseFloat(z.actualWeight||"0"),E=Math.abs(p-D),A=E<=.1;return e.jsxs("div",{className:`flex items-center justify-between p-2 rounded ${A?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[e.jsx("span",{className:"text-sm font-medium",children:"Match Status:"}),e.jsx("span",{className:`text-sm font-bold ${A?"text-green-600":"text-red-600"}`,children:A?"✅ Match":`❌ ${E.toFixed(1)}kg difference`})]})})()]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(B,{className:"text-base font-semibold text-gray-700",children:"Quality & Discrepancy Notes"}),e.jsx(Ms,{placeholder:"Any quality issues, missing items, or other discrepancies...",className:"h-24 text-base",value:z.notes,onChange:p=>ae({...z,notes:p.target.value})})]}),e.jsxs("div",{className:"flex flex-col gap-4 pt-6",children:[!Y()&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4 text-amber-600"}),e.jsx("div",{className:"text-sm text-amber-800 font-medium",children:(()=>{const p=h(),D=parseFloat(z.actualWeight||"0"),E=Math.abs(p-D),A=u?.size_breakdown&&Object.keys(u.size_breakdown).length>0,I=Object.keys(z.sizeDiscrepancies).length>0;return A&&!I?"This dispatch has size breakdown data. Please fill in the size discrepancies section below.":p>0&&E>.1?`Size breakdown total (${p.toFixed(1)}kg) does not match total weight (${D.toFixed(1)}kg). Please adjust the values.`:"Please fill in all required fields to continue"})()})]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(k,{variant:"outline",onClick:()=>d(!1),className:"px-8 py-3 text-base",children:"Cancel"}),e.jsx(k,{onClick:Ce,disabled:n||!Y(),className:"bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 px-8 py-3 text-base disabled:opacity-50 disabled:cursor-not-allowed",children:n?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"w-4 h-4 mr-2 animate-spin"}),"Recording..."]}):"Record Receiving"})]})]})]})]})]})]})," "]}),"   ",e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-green-50 to-emerald-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-green-600 uppercase tracking-wide",children:"Total Records"}),e.jsx("p",{className:"text-4xl font-bold text-green-900 mt-2",children:F.totalReceivings})]}),e.jsx("div",{className:"p-4 bg-green-600 rounded-2xl shadow-lg",children:e.jsx(bt,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-emerald-50 to-green-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-emerald-600 uppercase tracking-wide",children:"Confirmed"}),e.jsx("p",{className:"text-4xl font-bold text-emerald-900 mt-2",children:F.confirmed})]}),e.jsx("div",{className:"p-4 bg-emerald-600 rounded-2xl shadow-lg",children:e.jsx(qe,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-red-50 to-red-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-red-600 uppercase tracking-wide",children:"Disputed"}),e.jsx("p",{className:"text-4xl font-bold text-red-900 mt-2",children:F.disputed})]}),e.jsx("div",{className:"p-4 bg-red-600 rounded-2xl shadow-lg",children:e.jsx(Qe,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-blue-50 to-blue-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-blue-600 uppercase tracking-wide",children:"Total Weight"}),e.jsx("p",{className:"text-4xl font-bold text-blue-900 mt-2",children:F.totalWeight.toFixed(1)}),e.jsx("p",{className:"text-sm text-blue-600",children:"kg"})]}),e.jsx("div",{className:"p-4 bg-blue-600 rounded-2xl shadow-lg",children:e.jsx(Ns,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-purple-50 to-purple-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-purple-600 uppercase tracking-wide",children:"Total Value"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900 mt-2",children:je(F.totalValue)})]}),e.jsx("div",{className:"p-4 bg-purple-600 rounded-2xl shadow-lg",children:e.jsx(qr,{className:"h-8 w-8 text-white"})})]})})})]}),e.jsxs(U,{className:"border-0 shadow-2xl bg-white/80 backdrop-blur-sm",children:[e.jsx(Fe,{className:"pb-6 bg-gradient-to-r from-gray-50 to-gray-100 rounded-t-3xl",children:e.jsxs(Pe,{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(ra,{className:"h-8 w-8 text-green-600"}),"Receiving Records by Size"]})}),e.jsx(H,{className:"p-8",children:x?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-4",children:"Loading receiving records..."})]}):s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(bt,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No receiving records found"}),e.jsx("p",{className:"text-gray-500",children:"Start by recording your first outlet receiving"})]}):e.jsx("div",{className:"space-y-6",children:Object.entries(O(s)).map(([p,D])=>e.jsxs("div",{className:"border-2 border-gray-100 rounded-3xl p-6 hover:shadow-xl transition-all duration-300 bg-gradient-to-r from-white to-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>le(p),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ds,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:p}),e.jsx("p",{className:"text-sm text-gray-500",children:D[0]?.dispatch?.outlet_order?.outlet?.location||"Unknown Location"})]})]}),e.jsxs(se,{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full",children:[D.length," ",D.length===1?"Order":"Orders"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Total Received: ",D.reduce((E,A)=>E+(A.actual_weight_received||0),0).toFixed(1)," kg"]}),e.jsx(Gs,{className:`h-5 w-5 text-gray-400 transition-transform duration-200 ${Z.has(p)?"rotate-180":""}`})]})]}),Z.has(p)&&e.jsx("div",{className:"mt-6 space-y-4",children:D.map((E,A)=>{const I=ce(E.expected_weight||0,E.actual_weight_received||0),P=ce(E.expected_value||0,E.actual_value_received||0);return e.jsx("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 hover:shadow-lg transition-all duration-200",children:e.jsxs("div",{className:"flex flex-col xl:flex-row justify-between items-start xl:items-center gap-6",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(bt,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-lg font-bold text-gray-900",children:re(E.displayIndex||A)})]}),e.jsx(se,{className:`text-sm font-semibold px-3 py-1 rounded-xl ${y(E.status)}`,children:E.status.toUpperCase()}),e.jsx(se,{className:`text-sm font-semibold px-3 py-1 rounded-xl ${L(E.condition)}`,children:E.condition.toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-gray-700",children:[e.jsx(ts,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",children:["Order: ",E.dispatch?.outlet_order?.order_number||`ORD-${E.dispatch_id?.slice(-6)}`]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Dispatch: ",E.dispatch?.destination||`DSP-${E.dispatch_id?.slice(-6)}`]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-700",children:[e.jsx(qe,{className:"h-4 w-4 text-purple-500"}),e.jsxs("span",{className:"text-sm font-medium",children:["By: ",E.received_by_user?`${E.received_by_user.first_name} ${E.received_by_user.last_name}`:"Unknown"]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-700",children:[e.jsx(gs,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{className:"text-sm font-medium",children:new Date(E.received_date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-700",children:[e.jsx($s,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{className:"text-sm font-medium",children:[E.actual_weight_received||0," kg"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx($s,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-900 text-sm",children:"Weight"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Expected:"}),e.jsxs("span",{className:"font-medium",children:[E.expected_weight||0," kg"]})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Received:"}),e.jsxs("span",{className:"font-medium text-green-600",children:[E.actual_weight_received||0," kg"]})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Diff:"}),e.jsxs("span",{className:`font-medium ${I.diff>=0?"text-green-600":"text-red-600"}`,children:[I.diff>=0?"+":"",I.diff.toFixed(2)," kg"]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Hs,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"font-semibold text-gray-900 text-sm",children:"Value"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Expected:"}),e.jsxs("span",{className:"font-medium",children:["KSh ",(E.expected_value||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Received:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["KSh ",(E.actual_value_received||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Diff:"}),e.jsxs("span",{className:`font-medium ${P.diff>=0?"text-green-600":"text-red-600"}`,children:[P.diff>=0?"+":"","KSh ",P.diff.toLocaleString()]})]})]})]})]}),E.discrepancy_notes&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Qe,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-yellow-800 text-sm mb-1",children:"Discrepancy Notes"}),e.jsx("div",{className:"text-xs text-yellow-700",children:E.discrepancy_notes})]})]})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",className:"h-10 px-4 border-2 border-blue-200 text-blue-700 hover:bg-blue-50 hover:border-blue-300",onClick:()=>W(E),children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),"View Details"]}),e.jsxs(k,{variant:"outline",size:"sm",className:"h-10 px-4 border-2 border-green-200 text-green-700 hover:bg-green-50 hover:border-green-300",children:[e.jsx(nt,{className:"h-4 w-4 mr-2"}),"Edit"]})]})]})},E.id)})})]},p))})})]})]}),e.jsx(Xe,{open:R,onOpenChange:X,children:e.jsxs(Ye,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(es,{children:e.jsxs(Je,{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(rs,{className:"h-6 w-6 text-blue-600"}),"Receiving Record Details - ",b&&re(0)]})}),b&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"Outlet Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",b.dispatch?.outlet_order?.outlet?.name||"Unknown"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Location:"})," ",b.dispatch?.outlet_order?.outlet?.location||"Unknown"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Order Number:"})," ",b.dispatch?.outlet_order?.order_number||"N/A"]})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-xl",children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-3",children:"Receiving Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Received By:"})," ",b.received_by_user?`${b.received_by_user.first_name} ${b.received_by_user.last_name}`:"Unknown"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",new Date(b.received_date).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",e.jsx(se,{className:y(b.status),children:b.status.toUpperCase()})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx($s,{className:"h-5 w-5 text-blue-600"}),"Weight Details"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Expected Weight:"}),e.jsxs("span",{className:"font-medium",children:[b.expected_weight||0," kg"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Actual Weight:"}),e.jsxs("span",{className:"font-medium text-green-600",children:[b.actual_weight_received||0," kg"]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"text-gray-600",children:"Difference:"}),e.jsxs("span",{className:`font-medium ${(b.actual_weight_received||0)>=(b.expected_weight||0)?"text-green-600":"text-red-600"}`,children:[(b.actual_weight_received||0)-(b.expected_weight||0)>=0?"+":"",((b.actual_weight_received||0)-(b.expected_weight||0)).toFixed(2)," kg"]})]})]})]})}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-xl",children:[e.jsxs("h3",{className:"font-semibold text-purple-900 mb-3 flex items-center gap-2",children:[e.jsx(Hs,{className:"h-5 w-5 text-purple-600"}),"Value Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Expected Value"}),e.jsxs("div",{className:"text-lg font-bold text-gray-900",children:["KSh ",(b.expected_value||0).toLocaleString()]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Actual Value"}),e.jsxs("div",{className:"text-lg font-bold text-green-600",children:["KSh ",(b.actual_value_received||0).toLocaleString()]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Difference"}),e.jsxs("div",{className:`text-lg font-bold ${(b.actual_value_received||0)-(b.expected_value||0)>=0?"text-green-600":"text-red-600"}`,children:[(b.actual_value_received||0)-(b.expected_value||0)>=0?"+":"","KSh ",((b.actual_value_received||0)-(b.expected_value||0)).toLocaleString()]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-orange-50 p-4 rounded-xl",children:[e.jsx("h3",{className:"font-semibold text-orange-900 mb-3",children:"Condition"}),e.jsx(se,{className:L(b.condition),children:b.condition.toUpperCase()})]}),b.discrepancy_notes&&e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-xl",children:[e.jsxs("h3",{className:"font-semibold text-yellow-900 mb-3 flex items-center gap-2",children:[e.jsx(Qe,{className:"h-5 w-5 text-yellow-600"}),"Discrepancy Notes"]}),e.jsx("p",{className:"text-sm text-yellow-800",children:b.discrepancy_notes})]})]}),b.size_discrepancies&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Size Discrepancies"}),e.jsx("div",{className:"text-sm text-gray-700",children:N(b.size_discrepancies)})]})]})]})})]})}const Dn=Object.freeze(Object.defineProperty({__proto__:null,default:Cn},Symbol.toStringTag,{value:"Module"}));function Va({className:a,...t}){return e.jsx(Tr,{"data-slot":"tabs",className:Ee("flex flex-col gap-2",a),...t})}function Ba({className:a,...t}){return e.jsx(Ar,{"data-slot":"tabs-list",className:Ee("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",a),...t})}function ws({className:a,...t}){return e.jsx($r,{"data-slot":"tabs-trigger",className:Ee("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",a),...t})}function Ss({className:a,...t}){return e.jsx(Rr,{"data-slot":"tabs-content",className:Ee("flex-1 outline-none",a),...t})}function zn({className:a,classNames:t,showOutsideDays:s=!0,...r}){return e.jsx(Lr,{showOutsideDays:s,className:Ee("p-3",a),classNames:{months:"flex flex-col sm:flex-row gap-2",month:"flex flex-col gap-4",caption:"flex justify-center pt-1 relative items-center w-full",caption_label:"text-sm font-medium",nav:"flex items-center gap-1",nav_button:Ee(Yt({variant:"outline"}),"size-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-x-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:Ee("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-range-end)]:rounded-r-md",r.mode==="range"?"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md":"[&:has([aria-selected])]:rounded-md"),day:Ee(Yt({variant:"ghost"}),"size-8 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start aria-selected:bg-primary aria-selected:text-primary-foreground",day_range_end:"day-range-end aria-selected:bg-primary aria-selected:text-primary-foreground",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({className:l,...d})=>e.jsx(Wr,{className:Ee("size-4",l),...d}),IconRight:({className:l,...d})=>e.jsx(na,{className:Ee("size-4",l),...d})},...r})}function On({...a}){return e.jsx(Mr,{"data-slot":"popover",...a})}function Fn({...a}){return e.jsx(Ur,{"data-slot":"popover-trigger",...a})}function Pn({className:a,align:t="center",sideOffset:s=4,...r}){return e.jsx(Vr,{children:e.jsx(Br,{"data-slot":"popover-content",align:t,sideOffset:s,className:Ee("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",a),...r})})}class En{async getOverallStats(t){try{const{startDate:s,endDate:r}=t||{},{data:l,error:d}=await ie(async()=>{let W=j.from("warehouse_entries").select("total_weight, total_pieces, total_value");return s&&(W=W.gte("entry_date",s)),r&&(W=W.lte("entry_date",r)),await W},2,1e3);if(d)throw d;const{data:x,error:m}=await ie(async()=>{let W=j.from("processing_records").select("pre_processing_weight, post_processing_weight, processing_waste, processing_yield");return s&&(W=W.gte("processing_date",s)),r&&(W=W.lte("processing_date",r)),await W});if(m)throw m;const{data:g,error:f}=await ie(async()=>{let W=j.from("outlet_orders").select("total_value, status");return s&&(W=W.gte("order_date",s)),r&&(W=W.lte("order_date",r)),await W});if(f)throw f;const{data:n,error:S}=await ie(async()=>{let W=j.from("dispatch_records").select("status, dispatch_date");return s&&(W=W.gte("dispatch_date",s)),r&&(W=W.lte("dispatch_date",r)),await W});if(S)throw S;const T=l?.length||0,V=l?.reduce((W,G)=>W+(G.total_weight||0),0)||0,u=l?.reduce((W,G)=>W+(G.total_value||0),0)||0,v=x?.length||0,b=x?.length>0?x.reduce((W,G)=>W+(G.processing_yield||0),0)/x.length:0,M=x?.reduce((W,G)=>W+(G.processing_waste||0),0)||0,R=x?.reduce((W,G)=>W+(G.pre_processing_weight||0),0)||0,X=R>0?M/R*100:0,Z=g?.length||0,K=n?.length||0,z=n?.filter(W=>W.status==="delivered").length||0,ae=K>0?z/K*100:0,{data:re,error:O}=await ie(async()=>await j.from("fish_inventory").select("size, weight"));let le=0;if(!O&&re&&re.length>0){const W=re.reduce((J,h)=>J+h.size*h.weight,0),G=re.reduce((J,h)=>J+h.weight,0);le=G>0?W/G:0}return{totalEntries:T,totalWeight:Number(V.toFixed(2)),totalValue:Number(u.toFixed(2)),totalProcessed:v,averageSize:Number(le.toFixed(2)),processingEfficiency:Number(b.toFixed(2)),wastePercentage:Number(X.toFixed(2)),totalOrders:Z,totalDispatches:K,onTimeDelivery:Number(ae.toFixed(2))}}catch(s){throw new Error(Ne(s,"fetching overall stats"))}}async getDailyProcessingData(t){try{const{startDate:s,endDate:r}=t||{},{data:l,error:d}=await ie(async()=>{let m=j.from("processing_records").select("processing_date, pre_processing_weight, post_processing_weight, processing_yield").order("processing_date",{ascending:!0});return s&&(m=m.gte("processing_date",s)),r&&(m=m.lte("processing_date",r)),await m});if(d)throw d;const x=(l||[]).reduce((m,g)=>{const f=g.processing_date;return m[f]||(m[f]={date:f,weight:0,pieces:0,efficiency:0,count:0}),m[f].weight+=g.pre_processing_weight||0,m[f].pieces+=1,m[f].efficiency+=g.processing_yield||0,m[f].count+=1,m},{});return Object.values(x).map(m=>({date:m.date,weight:Number(m.weight.toFixed(2)),pieces:m.pieces,efficiency:Number((m.efficiency/m.count).toFixed(2))}))}catch(s){throw new Error(Ne(s,"fetching daily processing data"))}}async getSizeDistributionData(t){try{const{startDate:s,endDate:r}=t||{},{data:l,error:d}=await ie(async()=>{let g=j.from("processing_records").select("size_distribution, post_processing_weight, processing_date").not("size_distribution","is",null);return s&&(g=g.gte("processing_date",s)),r&&(g=g.lte("processing_date",r)),await g});if(d)throw d;const x={};(l||[]).forEach(g=>{const f=g.size_distribution;f&&typeof f=="object"&&Object.entries(f).forEach(([n,S])=>{const T=parseInt(n),V=g.post_processing_weight||0;x[T]||(x[T]={size:T,quantity:0,weight:0}),x[T].quantity+=S||0;const u=Object.values(f).reduce((v,b)=>v+(b||0),0);u>0&&(x[T].weight+=V*(S||0)/u)})});const m=Object.values(x).reduce((g,f)=>g+f.quantity,0);return Object.values(x).sort((g,f)=>g.size-f.size).map(g=>({size:g.size,quantity:g.quantity,weight:Number(g.weight.toFixed(2)),percentage:m>0?Number((g.quantity/m*100).toFixed(2)):0}))}catch(s){throw new Error(Ne(s,"fetching size distribution data"))}}async getGradeDistributionData(t){try{const{startDate:s,endDate:r}=t||{},{data:l,error:d}=await ie(async()=>{let f=j.from("processing_records").select("grading_results, post_processing_weight, processing_date").not("grading_results","is",null);return s&&(f=f.gte("processing_date",s)),r&&(f=f.lte("processing_date",r)),await f});if(d)throw d;const x={};(l||[]).forEach(f=>{const n=f.grading_results;n&&typeof n=="object"&&Object.entries(n).forEach(([S,T])=>{x[S]||(x[S]={grade:S,quantity:0}),x[S].quantity+=T||0})});const m=Object.values(x).reduce((f,n)=>f+n.quantity,0),g=["#10b981","#3b82f6","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#84cc16","#f97316"];return Object.values(x).sort((f,n)=>f.grade.localeCompare(n.grade)).map((f,n)=>({grade:f.grade,quantity:f.quantity,percentage:m>0?Number((f.quantity/m*100).toFixed(2)):0,color:g[n%g.length]}))}catch(s){throw new Error(Ne(s,"fetching grade distribution data"))}}async getFarmerPerformanceData(t){try{const{startDate:s,endDate:r}=t||{},{data:l,error:d}=await ie(async()=>await j.from("farmers").select(`
            id,
            name,
            location,
            rating,
            reliability,
            warehouse_entries(
              entry_date,
              total_weight,
              total_value,
              total_pieces
            )
          `));if(d)throw d;const x=new Map;return(l||[]).forEach(m=>{const g=m.id;x.has(g)||x.set(g,{id:m.id,name:m.name,location:m.location,rating:m.rating||0,reliability:m.reliability||"fair",deliveries:0,totalWeight:0,totalValue:0,totalPieces:0,lastDelivery:null});const f=x.get(g);m.warehouse_entries&&Array.isArray(m.warehouse_entries)&&m.warehouse_entries.forEach(n=>{s&&n.entry_date<s||r&&n.entry_date>r||(f.deliveries+=1,f.totalWeight+=n.total_weight||0,f.totalValue+=n.total_value||0,f.totalPieces+=n.total_pieces||0,(!f.lastDelivery||n.entry_date>f.lastDelivery)&&(f.lastDelivery=n.entry_date))})}),Array.from(x.values()).filter(m=>m.deliveries>0).map(m=>({id:m.id,name:m.name,location:m.location,deliveries:m.deliveries,totalWeight:Number(m.totalWeight.toFixed(2)),totalValue:Number(m.totalValue.toFixed(2)),avgSize:m.totalPieces>0?Number((m.totalWeight/m.totalPieces).toFixed(2)):0,rating:Number(m.rating.toFixed(1)),reliability:m.reliability,lastDelivery:m.lastDelivery})).sort((m,g)=>g.totalValue-m.totalValue)}catch(s){throw new Error(Ne(s,"fetching farmer performance data"))}}async getOutletPerformanceData(t){try{const{startDate:s,endDate:r}=t||{},{data:l,error:d}=await ie(async()=>await j.from("outlets").select(`
            id,
            name,
            location,
            outlet_orders(
              order_date,
              total_value,
              requested_quantity,
              status,
              dispatch_date,
              completed_date
            )
          `));if(d)throw d;const x=new Map;return(l||[]).forEach(m=>{const g=m.id;x.has(g)||x.set(g,{id:m.id,name:m.name,location:m.location,orders:0,totalWeight:0,totalValue:0,totalQuantity:0,onTimeDeliveries:0,totalDeliveries:0,lastOrder:null});const f=x.get(g);m.outlet_orders&&Array.isArray(m.outlet_orders)&&m.outlet_orders.forEach(n=>{if(!(s&&n.order_date<s)&&!(r&&n.order_date>r)&&(f.orders+=1,f.totalValue+=n.total_value||0,f.totalQuantity+=n.requested_quantity||0,(!f.lastOrder||n.order_date>f.lastOrder)&&(f.lastOrder=n.order_date),n.dispatch_date&&n.completed_date)){f.totalDeliveries+=1;const S=new Date(n.dispatch_date),T=new Date(n.completed_date);Math.abs(T.getTime()-S.getTime())/(1e3*60*60*24)<=1&&(f.onTimeDeliveries+=1)}})}),Array.from(x.values()).filter(m=>m.orders>0).map(m=>({id:m.id,name:m.name,location:m.location,orders:m.orders,totalWeight:Number(m.totalQuantity.toFixed(2)),totalValue:Number(m.totalValue.toFixed(2)),avgOrderSize:m.orders>0?Number((m.totalQuantity/m.orders).toFixed(2)):0,onTimeDelivery:m.totalDeliveries>0?Number((m.onTimeDeliveries/m.totalDeliveries*100).toFixed(2)):0,lastOrder:m.lastOrder})).sort((m,g)=>g.totalValue-m.totalValue)}catch(s){throw new Error(Ne(s,"fetching outlet performance data"))}}async getInventoryData(t){try{const{startDate:s,endDate:r}=t||{},{data:l,error:d}=await ie(async()=>await j.from("storage_locations").select("id, name"));if(d)throw d;const x=new Map;l?.forEach(n=>{x.set(n.id,n.name)});const{data:m,error:g}=await ie(async()=>{let n=j.from("sorting_results").select(`
            id,
            size_class,
            total_pieces,
            total_weight_grams,
            storage_location_id,
            sorting_batch_id,
            sorting_batch:sorting_batches(
              id,
              batch_number,
              status,
              created_at,
              processing_record:processing_records(
                id,
                processing_date,
                grading_results
              )
            )
          `).eq("sorting_batch.status","completed").not("storage_location_id","is",null);return s&&(n=n.gte("sorting_batch.created_at",s)),r&&(n=n.lte("sorting_batch.created_at",r)),await n});if(g)throw g;const f=new Map;return(m||[]).forEach(n=>{const S=n.size_class,T=n.total_pieces||0,u=(n.total_weight_grams||0)/1e3,v=n.storage_location_id,b=x.get(v)||"Unknown Location",M=n.sorting_batch?.created_at||new Date().toISOString(),R=n.sorting_batch?.processing_record?.grading_results,X=R&&typeof R=="object"&&Object.keys(R)[0]||"B",Z=`${v}-${S}-${X}`;f.has(Z)||f.set(Z,{size:S,quantity:0,weight:0,grade:X,location:b,lastUpdated:M,status:"Available"});const K=f.get(Z);K.quantity+=T,K.weight+=u,M>K.lastUpdated&&(K.lastUpdated=M)}),Array.from(f.values()).sort((n,S)=>n.location.localeCompare(S.location)||n.size-S.size||n.grade.localeCompare(S.grade)).map(n=>({...n,weight:Number(n.weight.toFixed(2))}))}catch(s){throw new Error(Ne(s,"fetching inventory data by storage location"))}}async getStorageLocationPerformanceData(t){try{const{startDate:s,endDate:r}=t||{},{data:l,error:d}=await ie(async()=>await j.from("storage_locations").select("*").order("name"));if(d)throw d;const{data:x,error:m}=await ie(async()=>{let n=j.from("sorting_results").select(`
            id,
            size_class,
            total_pieces,
            total_weight_grams,
            storage_location_id,
            sorting_batch_id,
            sorting_batch:sorting_batches(
              id,
              batch_number,
              status,
              created_at,
              processing_record:processing_records(
                id,
                processing_date,
                grading_results
              )
            )
          `).eq("sorting_batch.status","completed").not("storage_location_id","is",null);return s&&(n=n.gte("sorting_batch.created_at",s)),r&&(n=n.lte("sorting_batch.created_at",r)),await n});if(m)throw m;const g=new Map;return(l||[]).forEach(n=>{g.set(n.id,{id:n.id,name:n.name,description:n.description,locationType:n.location_type,capacityKg:Number(n.capacity_kg||0),temperatureCelsius:n.temperature_celsius,humidityPercent:n.humidity_percent,status:n.status,totalItems:0,totalWeight:0,utilizationPercent:0})}),(x||[]).forEach(n=>{const S=n.total_pieces||0,V=(n.total_weight_grams||0)/1e3,u=n.storage_location_id,v=g.get(u);v&&(v.totalItems+=S,v.totalWeight+=V)}),Array.from(g.values()).map(n=>(n.utilizationPercent=n.capacityKg>0?Number((n.totalWeight/n.capacityKg*100).toFixed(1)):0,n.totalWeight=Number(n.totalWeight.toFixed(2)),n)).sort((n,S)=>n.name.localeCompare(S.name))}catch(s){throw new Error(Ne(s,"fetching storage location performance data"))}}async getStorageLocationData(t){try{const{startDate:s,endDate:r}=t||{},{data:l,error:d}=await ie(async()=>await j.from("storage_locations").select("*").order("name"));if(d)throw d;const{data:x,error:m}=await ie(async()=>{let n=j.from("sorting_results").select(`
            id,
            size_class,
            total_pieces,
            total_weight_grams,
            storage_location_id,
            sorting_batch:sorting_batches(
              id,
              batch_number,
              status,
              created_at,
              processing_record:processing_records(
                id,
                processing_date,
                grading_results
              )
            )
          `).eq("sorting_batch.status","completed").not("storage_location_id","is",null);return s&&(n=n.gte("sorting_batch.created_at",s)),r&&(n=n.lte("sorting_batch.created_at",r)),await n});if(m)throw m;const g=new Map;return(l||[]).forEach(n=>{g.set(n.id,{id:n.id,name:n.name,description:n.description,locationType:n.location_type,capacityKg:Number(n.capacity_kg||0),currentUsageKg:0,temperatureCelsius:n.temperature_celsius,humidityPercent:n.humidity_percent,status:n.status,utilizationPercent:0,inventoryItems:[],totalItems:0,totalWeight:0,sizeDistribution:{},gradeDistribution:{},lastUpdated:n.updated_at||n.created_at})}),(x||[]).forEach(n=>{const S=n.size_class,T=n.total_pieces||0,u=(n.total_weight_grams||0)/1e3,v=n.storage_location_id,b=n.sorting_batch?.created_at||new Date().toISOString(),M=n.sorting_batch?.processing_record?.grading_results,R=M&&typeof M=="object"&&Object.keys(M)[0]||"B",X=g.get(v);X&&(X.inventoryItems.push({size:S,quantity:T,weight:Number(u.toFixed(2)),grade:R,location:X.name,lastUpdated:b,status:"Available"}),X.totalItems+=T,X.totalWeight+=u,X.currentUsageKg+=u,X.sizeDistribution[S]=(X.sizeDistribution[S]||0)+T,X.gradeDistribution[R]=(X.gradeDistribution[R]||0)+T,b>X.lastUpdated&&(X.lastUpdated=b))}),Array.from(g.values()).map(n=>(n.utilizationPercent=n.capacityKg>0?Number((n.currentUsageKg/n.capacityKg*100).toFixed(1)):0,n.totalWeight=Number(n.totalWeight.toFixed(2)),n.currentUsageKg=Number(n.currentUsageKg.toFixed(2)),n.inventoryItems.sort((S,T)=>S.size-T.size||S.grade.localeCompare(T.grade)),n)).sort((n,S)=>n.name.localeCompare(S.name))}catch(s){throw new Error(Ne(s,"fetching storage location data"))}}getEstimatedWeightPerFish(t){return{0:.2,1:.3,2:.4,3:.5,4:.6,5:.7,6:.8,7:.9,8:1,9:1.1,10:1.2}[t]||.5}async exportToCSV(t,s,r){try{if(!s||s.length===0)throw new Error("No data to export");const l=Object.keys(s[0]),d=[l.join(","),...s.map(f=>l.map(n=>{const S=f[n];return typeof S=="string"&&S.includes(",")?`"${S}"`:S}).join(","))].join(`
`),x=new Blob([d],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),g=URL.createObjectURL(x);m.setAttribute("href",g),m.setAttribute("download",r||`${t}_report_${new Date().toISOString().split("T")[0]}.csv`),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m)}catch(l){throw new Error(`Failed to export CSV: ${l instanceof Error?l.message:"Unknown error"}`)}}}const Qs=new En;function In(a){const[t,s]=c.useState(null),[r,l]=c.useState([]),[d,x]=c.useState([]),[m,g]=c.useState([]),[f,n]=c.useState([]),[S,T]=c.useState([]),[V,u]=c.useState([]),[v,b]=c.useState([]),[M,R]=c.useState(!1),[X,Z]=c.useState(!1),[K,z]=c.useState(!1),[ae,re]=c.useState(!1),[O,le]=c.useState(!1),[W,G]=c.useState(!1),[J,h]=c.useState(!1),[Y,q]=c.useState(!1),[we,Ce]=c.useState(!1),[De,fe]=c.useState(null),Me=c.useCallback(async A=>{Z(!0),fe(null);try{const I=await Qs.getOverallStats(A);s(I)}catch(I){fe(I instanceof Error?I.message:"Failed to fetch overall stats")}finally{Z(!1)}},[]),y=c.useCallback(async A=>{z(!0),fe(null);try{const I=await Qs.getDailyProcessingData(A);l(I)}catch(I){fe(I instanceof Error?I.message:"Failed to fetch daily processing data")}finally{z(!1)}},[]),L=c.useCallback(async A=>{re(!0),fe(null);try{const I=await Qs.getSizeDistributionData(A);x(I)}catch(I){fe(I instanceof Error?I.message:"Failed to fetch size distribution data")}finally{re(!1)}},[]),je=c.useCallback(async A=>{le(!0),fe(null);try{const I=await Qs.getGradeDistributionData(A);g(I)}catch(I){fe(I instanceof Error?I.message:"Failed to fetch grade distribution data")}finally{le(!1)}},[]),ce=c.useCallback(async A=>{G(!0),fe(null);try{const I=await Qs.getFarmerPerformanceData(A);n(I)}catch(I){fe(I instanceof Error?I.message:"Failed to fetch farmer performance data")}finally{G(!1)}},[]),N=c.useCallback(async A=>{h(!0),fe(null);try{const I=await Qs.getOutletPerformanceData(A);T(I)}catch(I){fe(I instanceof Error?I.message:"Failed to fetch outlet performance data")}finally{h(!1)}},[]),F=c.useCallback(async A=>{q(!0),fe(null);try{const I=await Qs.getInventoryData(A);u(I)}catch(I){fe(I instanceof Error?I.message:"Failed to fetch inventory data")}finally{q(!1)}},[]),p=c.useCallback(async A=>{Ce(!0),fe(null);try{const I=await Qs.getStorageLocationPerformanceData(A);b(I)}catch(I){fe(I instanceof Error?I.message:"Failed to fetch storage location data")}finally{Ce(!1)}},[]),D=c.useCallback(async A=>{R(!0),fe(null);try{await Promise.all([Me(A),y(A),L(A),je(A),ce(A),N(A),F(A),p(A)])}catch(I){fe(I instanceof Error?I.message:"Failed to refresh data")}finally{R(!1)}},[Me,y,L,je,ce,N,F,p]),E=c.useCallback(async(A,I,P)=>{try{await Qs.exportToCSV(A,I,P)}catch(be){throw fe(be instanceof Error?be.message:"Failed to export report"),be}},[]);return c.useEffect(()=>{let A=!0;return(async()=>{if(A){R(!0),fe(null);try{await Promise.all([Me(a),y(a),L(a),je(a),ce(a),N(a),F(a),p(a)])}catch(P){A&&fe(P instanceof Error?P.message:"Failed to load initial data")}finally{A&&R(!1)}}})(),()=>{A=!1}},[]),{overallStats:t,dailyProcessingData:r,sizeDistributionData:d,gradeDistributionData:m,farmerPerformanceData:f,outletPerformanceData:S,inventoryData:V,storageLocationData:v,loading:M,loadingStats:X,loadingDaily:K,loadingSize:ae,loadingGrade:O,loadingFarmers:W,loadingOutlets:J,loadingInventory:Y,loadingStorageLocations:we,error:De,refreshData:D,refreshStats:Me,refreshDaily:y,refreshSize:L,refreshGrade:je,refreshFarmers:ce,refreshOutlets:N,refreshInventory:F,refreshStorageLocations:p,exportReport:E}}function qn({onNavigate:a}){const[t,s]=c.useState("overview"),[r,l]=c.useState(),[d,x]=c.useState(!1),m={startDate:r?.from?kt(r.from,"yyyy-MM-dd"):void 0,endDate:r?.to?kt(r.to,"yyyy-MM-dd"):void 0},{overallStats:g,dailyProcessingData:f,sizeDistributionData:n,gradeDistributionData:S,farmerPerformanceData:T,outletPerformanceData:V,storageLocationData:u,loading:v,loadingStats:b,loadingDaily:M,loadingSize:R,loadingGrade:X,loadingFarmers:Z,loadingOutlets:K,loadingStorageLocations:z,error:ae,refreshData:re,exportReport:O}=In(m),le=J=>`KES ${J.toLocaleString()}`,W=J=>J>=0?e.jsx(Ps,{className:"h-4 w-4 text-green-500"}):e.jsx(Ea,{className:"h-4 w-4 text-red-500"});c.useEffect(()=>{(r?.from||r?.to)&&(x(!1),re(m))},[r?.from,r?.to]),c.useEffect(()=>{if(v){const J=setTimeout(()=>{x(!0)},1e4);return()=>clearTimeout(J)}else x(!1)},[v]);const G=async J=>{try{let h=[],Y="";switch(J){case"overall":g&&(h=[g],Y="overall_stats");break;case"daily":h=f,Y="daily_processing";break;case"size":h=n,Y="size_distribution";break;case"grade":h=S,Y="grade_distribution";break;case"farmers":h=T,Y="farmer_performance";break;case"outlets":h=V,Y="outlet_performance";break;case"inventory":h=u,Y="storage_location_report";break;default:throw new Error("Invalid report type")}if(h.length>0)await O(J,h,Y);else throw new Error("No data to export")}catch(h){console.error("Export failed:",h)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-cyan-50 p-4 md:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(ht,{size:"lg",showText:!1})}),e.jsxs("h1",{className:"text-4xl font-bold text-gray-900 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-indigo-500 to-cyan-600 rounded-2xl shadow-lg",children:e.jsx(Ws,{className:"h-10 w-10 text-white"})}),"Reports & Analytics"]}),e.jsx("p",{className:"text-xl text-gray-600 ml-16",children:"Comprehensive fish warehouse management insights • Performance metrics • Trends analysis"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(On,{children:[e.jsx(Fn,{asChild:!0,children:e.jsxs(k,{variant:"outline",className:"px-6 py-3 rounded-2xl font-semibold",children:[e.jsx(Bs,{className:"h-5 w-5 mr-2"}),r?.from&&r?.to?`${kt(r.from,"MMM dd")} - ${kt(r.to,"MMM dd")}`:"Date Range"]})}),e.jsx(Pn,{className:"w-auto p-0",align:"end",children:e.jsx(zn,{initialFocus:!0,mode:"range",selected:r,onSelect:l,numberOfMonths:2})})]}),e.jsxs(k,{onClick:()=>re(m),disabled:v,variant:"outline",className:"px-6 py-3 rounded-2xl font-semibold",children:[e.jsx(Ze,{className:`h-5 w-5 mr-2 ${v?"animate-spin":""}`}),"Refresh"]}),e.jsxs(k,{onClick:()=>G(t),className:"bg-gradient-to-r from-indigo-600 to-cyan-600 hover:from-indigo-700 hover:to-cyan-700 text-white px-6 py-3 rounded-2xl font-semibold shadow-lg",children:[e.jsx(xt,{className:"h-5 w-5 mr-2"}),"Export Reports"]})]})]}),(ae||d)&&e.jsx(U,{className:"border-red-200 bg-red-50",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ns,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[ae&&e.jsxs("p",{className:"text-red-800 font-medium",children:["Error loading reports: ",ae]}),d&&e.jsx("p",{className:"text-red-800 font-medium",children:"Reports are taking longer than expected to load. This might be due to network issues or database connectivity problems."})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-blue-50 to-blue-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-blue-600 uppercase tracking-wide",children:"Total Entries"}),e.jsx("p",{className:"text-4xl font-bold text-blue-900 mt-2",children:b?"...":g?.totalEntries||0}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[W(12.5),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"+12.5%"})]})]}),e.jsx("div",{className:"p-4 bg-blue-600 rounded-2xl shadow-lg",children:e.jsx(ts,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-emerald-50 to-emerald-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-emerald-600 uppercase tracking-wide",children:"Total Weight"}),e.jsx("p",{className:"text-4xl font-bold text-emerald-900 mt-2",children:b?"...":g?.totalWeight?.toFixed(1)||"0.0"}),e.jsx("p",{className:"text-sm text-emerald-600",children:"kg"})]}),e.jsx("div",{className:"p-4 bg-emerald-600 rounded-2xl shadow-lg",children:e.jsx(Ns,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-purple-50 to-purple-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-purple-600 uppercase tracking-wide",children:"Total Value"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900 mt-2",children:b?"...":le(g?.totalValue||0)}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[W(8.3),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"+8.3%"})]})]}),e.jsx("div",{className:"p-4 bg-purple-600 rounded-2xl shadow-lg",children:e.jsx(Hs,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-orange-50 to-orange-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-orange-600 uppercase tracking-wide",children:"Processing Efficiency"}),e.jsx("p",{className:"text-4xl font-bold text-orange-900 mt-2",children:b?"...":g?.processingEfficiency||0}),e.jsx("p",{className:"text-sm text-orange-600",children:"%"})]}),e.jsx("div",{className:"p-4 bg-orange-600 rounded-2xl shadow-lg",children:e.jsx(qe,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(U,{className:"border-0 shadow-xl bg-gradient-to-br from-cyan-50 to-cyan-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-cyan-600 uppercase tracking-wide",children:"Avg Fish Size"}),e.jsx("p",{className:"text-4xl font-bold text-cyan-900 mt-2",children:b?"...":g?.averageSize||0}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[W(.3),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"+0.3"})]})]}),e.jsx("div",{className:"p-4 bg-cyan-600 rounded-2xl shadow-lg",children:e.jsx(Te,{className:"h-8 w-8 text-white"})})]})})})]}),e.jsxs(U,{className:"border-0 shadow-2xl bg-white/80 backdrop-blur-sm",children:[e.jsx(Fe,{className:"pb-6 bg-gradient-to-r from-gray-50 to-gray-100 rounded-t-3xl",children:e.jsx(Pe,{className:"text-2xl font-bold text-gray-900",children:"Detailed Analytics"})}),e.jsx(H,{className:"p-8",children:e.jsxs(Va,{value:t,onValueChange:s,className:"space-y-8",children:[e.jsxs(Ba,{className:"flex w-full bg-white border border-gray-200 rounded-lg p-1 shadow-sm",children:[e.jsx(ws,{value:"overview",className:"flex-1 rounded-md font-medium text-sm px-4 py-2 data-[state=active]:bg-blue-600 data-[state=active]:text-white data-[state=inactive]:text-gray-600 hover:text-gray-900 transition-colors",children:"Overview"}),e.jsx(ws,{value:"size-analysis",className:"flex-1 rounded-md font-medium text-sm px-4 py-2 data-[state=active]:bg-blue-600 data-[state=active]:text-white data-[state=inactive]:text-gray-600 hover:text-gray-900 transition-colors",children:"Size Analysis"}),e.jsx(ws,{value:"processing",className:"flex-1 rounded-md font-medium text-sm px-4 py-2 data-[state=active]:bg-blue-600 data-[state=active]:text-white data-[state=inactive]:text-gray-600 hover:text-gray-900 transition-colors",children:"Processing"}),e.jsx(ws,{value:"orders",className:"flex-1 rounded-md font-medium text-sm px-4 py-2 data-[state=active]:bg-blue-600 data-[state=active]:text-white data-[state=inactive]:text-gray-600 hover:text-gray-900 transition-colors",children:"Orders"}),e.jsx(ws,{value:"inventory",className:"flex-1 rounded-md font-medium text-sm px-4 py-2 data-[state=active]:bg-blue-600 data-[state=active]:text-white data-[state=inactive]:text-gray-600 hover:text-gray-900 transition-colors",children:"Storage Location"}),e.jsx(ws,{value:"farmers",className:"flex-1 rounded-md font-medium text-sm px-4 py-2 data-[state=active]:bg-blue-600 data-[state=active]:text-white data-[state=inactive]:text-gray-600 hover:text-gray-900 transition-colors",children:"Farmers"}),e.jsx(ws,{value:"outlets",className:"flex-1 rounded-md font-medium text-sm px-4 py-2 data-[state=active]:bg-blue-600 data-[state=active]:text-white data-[state=inactive]:text-gray-600 hover:text-gray-900 transition-colors",children:"Outlets"})]}),e.jsx(Ss,{value:"overview",className:"space-y-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs(U,{className:"p-6 bg-gradient-to-br from-blue-50 to-indigo-50 border-0 shadow-lg",children:[e.jsx(Fe,{className:"pb-4",children:e.jsx(Pe,{className:"text-lg font-semibold text-gray-900",children:"Daily Processing Trend"})}),e.jsx(H,{children:M?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{className:"h-8 w-8 mx-auto mb-4 animate-spin text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading processing data..."})]})}):f.length>0?e.jsx(pt,{width:"100%",height:300,children:e.jsxs(Kr,{data:f,children:[e.jsx(Ct,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Dt,{dataKey:"date",stroke:"#6b7280"}),e.jsx(zt,{stroke:"#6b7280"}),e.jsx(ft,{contentStyle:{backgroundColor:"white",border:"none",borderRadius:"12px",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1)"}}),e.jsx(Gr,{type:"monotone",dataKey:"weight",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.3})]})}):e.jsx("div",{className:"flex items-center justify-center h-96 text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ws,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:"No processing data available"}),e.jsx("p",{className:"text-sm",children:"Data will appear here once processing records are available"})]})})})]}),e.jsxs(U,{className:"p-6 bg-gradient-to-br from-emerald-50 to-green-50 border-0 shadow-lg",children:[e.jsx(Fe,{className:"pb-4",children:e.jsx(Pe,{className:"text-lg font-semibold text-gray-900",children:"Grade Distribution"})}),e.jsx(H,{children:X?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{className:"h-8 w-8 mx-auto mb-4 animate-spin text-green-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading grade data..."})]})}):S.length>0?e.jsx(pt,{width:"100%",height:300,children:e.jsxs(Qr,{children:[e.jsx(Hr,{data:S,cx:"50%",cy:"50%",outerRadius:100,dataKey:"quantity",label:({grade:J,percentage:h})=>`${J}: ${h}%`,children:S.map((J,h)=>e.jsx(Yr,{fill:J.color},`cell-${h}`))}),e.jsx(ft,{contentStyle:{backgroundColor:"white",border:"none",borderRadius:"12px",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1)"}})]})}):e.jsx("div",{className:"flex items-center justify-center h-96 text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ia,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:"No grade data available"}),e.jsx("p",{className:"text-sm",children:"Data will appear here once inventory records are available"})]})})})]})]})}),e.jsxs(Ss,{value:"size-analysis",className:"space-y-8",children:[e.jsxs(U,{className:"p-6 bg-gradient-to-br from-purple-50 to-pink-50 border-0 shadow-lg",children:[e.jsx(Fe,{className:"pb-4",children:e.jsx(Pe,{className:"text-lg font-semibold text-gray-900",children:"Fish Size Distribution (0-10 Scale)"})}),e.jsx(H,{children:R?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{className:"h-8 w-8 mx-auto mb-4 animate-spin text-purple-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading size distribution data..."})]})}):n.length>0?e.jsx(pt,{width:"100%",height:400,children:e.jsxs(ua,{data:n,children:[e.jsx(Ct,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Dt,{dataKey:"size",stroke:"#6b7280"}),e.jsx(zt,{stroke:"#6b7280"}),e.jsx(ft,{contentStyle:{backgroundColor:"white",border:"none",borderRadius:"12px",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1)"}}),e.jsx(Jr,{}),e.jsx(pa,{dataKey:"quantity",fill:"#8b5cf6",radius:[4,4,0,0]})]})}):e.jsx("div",{className:"flex items-center justify-center h-96 text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ws,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:"No size distribution data available"}),e.jsx("p",{className:"text-sm",children:"Data will appear here once inventory records are available"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(U,{className:"p-6 bg-gradient-to-br from-orange-50 to-orange-100 border-0 shadow-lg",children:e.jsxs(H,{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-800 mb-2",children:"Small Fish (0-3)"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:R?"...":n.length>0?n.slice(0,4).reduce((J,h)=>J+(h.quantity||0),0):0}),e.jsx("p",{className:"text-sm text-orange-600",children:"pieces"})]})}),e.jsx(U,{className:"p-6 bg-gradient-to-br from-green-50 to-green-100 border-0 shadow-lg",children:e.jsxs(H,{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"Medium Fish (4-6)"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:R?"...":n.length>0?n.slice(4,7).reduce((J,h)=>J+(h.quantity||0),0):0}),e.jsx("p",{className:"text-sm text-green-600",children:"pieces"})]})}),e.jsx(U,{className:"p-6 bg-gradient-to-br from-blue-50 to-blue-100 border-0 shadow-lg",children:e.jsxs(H,{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Large Fish (7-10)"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:R?"...":n.length>0?n.slice(7).reduce((J,h)=>J+(h.quantity||0),0):0}),e.jsx("p",{className:"text-sm text-blue-600",children:"pieces"})]})})]})]}),e.jsxs(Ss,{value:"processing",className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs(U,{className:"p-6 bg-gradient-to-br from-purple-50 to-pink-50 border-0 shadow-lg",children:[e.jsx(Fe,{className:"pb-4",children:e.jsx(Pe,{className:"text-lg font-semibold text-gray-900",children:"Processing Efficiency Trend"})}),e.jsx(H,{children:M?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{className:"h-8 w-8 mx-auto mb-4 animate-spin text-purple-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading processing efficiency data..."})]})}):f.length>0?e.jsx(pt,{width:"100%",height:300,children:e.jsxs(Zr,{data:f,children:[e.jsx(Ct,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Dt,{dataKey:"date",stroke:"#6b7280"}),e.jsx(zt,{stroke:"#6b7280"}),e.jsx(ft,{contentStyle:{backgroundColor:"white",border:"none",borderRadius:"12px",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1)"}}),e.jsx(Xr,{type:"monotone",dataKey:"efficiency",stroke:"#8b5cf6",strokeWidth:3})]})}):e.jsx("div",{className:"flex items-center justify-center h-96 text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ps,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:"No processing efficiency data available"}),e.jsx("p",{className:"text-sm",children:"Data will appear here once processing records are available"})]})})})]}),e.jsxs(U,{className:"p-6 bg-gradient-to-br from-orange-50 to-red-50 border-0 shadow-lg",children:[e.jsx(Fe,{className:"pb-4",children:e.jsx(Pe,{className:"text-lg font-semibold text-gray-900",children:"Processing Volume"})}),e.jsx(H,{children:M?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{className:"h-8 w-8 mx-auto mb-4 animate-spin text-orange-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading processing volume data..."})]})}):f.length>0?e.jsx(pt,{width:"100%",height:300,children:e.jsxs(ua,{data:f,children:[e.jsx(Ct,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Dt,{dataKey:"date",stroke:"#6b7280"}),e.jsx(zt,{stroke:"#6b7280"}),e.jsx(ft,{contentStyle:{backgroundColor:"white",border:"none",borderRadius:"12px",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1)"}}),e.jsx(pa,{dataKey:"weight",fill:"#f97316",radius:[4,4,0,0]})]})}):e.jsx("div",{className:"flex items-center justify-center h-96 text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Te,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:"No processing volume data available"}),e.jsx("p",{className:"text-sm",children:"Data will appear here once processing records are available"})]})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(U,{className:"p-6 bg-gradient-to-br from-blue-50 to-blue-100 border-0 shadow-lg",children:e.jsxs(H,{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Total Processed"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:b?"...":g?.totalProcessed||0}),e.jsx("p",{className:"text-sm text-blue-600",children:"batches"})]})}),e.jsx(U,{className:"p-6 bg-gradient-to-br from-green-50 to-green-100 border-0 shadow-lg",children:e.jsxs(H,{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"Avg Efficiency"}),e.jsxs("p",{className:"text-3xl font-bold text-green-900",children:[b?"...":g?.processingEfficiency||0,"%"]}),e.jsx("p",{className:"text-sm text-green-600",children:"yield rate"})]})}),e.jsx(U,{className:"p-6 bg-gradient-to-br from-red-50 to-red-100 border-0 shadow-lg",children:e.jsxs(H,{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Waste Rate"}),e.jsxs("p",{className:"text-3xl font-bold text-red-900",children:[b?"...":g?.wastePercentage||0,"%"]}),e.jsx("p",{className:"text-sm text-red-600",children:"waste percentage"})]})})]})]}),e.jsx(Ss,{value:"orders",className:"space-y-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs(U,{className:"p-6 bg-gradient-to-br from-indigo-50 to-purple-50 border-0 shadow-lg",children:[e.jsx(Fe,{className:"pb-4",children:e.jsx(Pe,{className:"text-lg font-semibold text-gray-900",children:"Order Status Distribution"})}),e.jsx(H,{children:K?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{className:"h-8 w-8 mx-auto mb-4 animate-spin text-indigo-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading order data..."})]})}):V.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-green-800",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:V.reduce((J,h)=>J+h.orders,0)})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-800",children:"Total Value"}),e.jsx("p",{className:"text-xl font-bold text-blue-900",children:le(V.reduce((J,h)=>J+h.totalValue,0))})]})]}),e.jsx("div",{className:"space-y-2",children:V.map((J,h)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:J.name}),e.jsx("p",{className:"text-sm text-gray-500",children:J.location})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:[J.orders," orders"]}),e.jsx("p",{className:"text-sm text-gray-600",children:le(J.totalValue)})]})]},h))})]}):e.jsx("div",{className:"flex items-center justify-center h-96 text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Te,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:"No order data available"}),e.jsx("p",{className:"text-sm",children:"Data will appear here once orders are created"})]})})})]}),e.jsxs(U,{className:"p-6 bg-gradient-to-br from-emerald-50 to-teal-50 border-0 shadow-lg",children:[e.jsx(Fe,{className:"pb-4",children:e.jsx(Pe,{className:"text-lg font-semibold text-gray-900",children:"Order Performance Metrics"})}),e.jsx(H,{children:K?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{className:"h-8 w-8 mx-auto mb-4 animate-spin text-emerald-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading performance data..."})]})}):V.length>0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-800",children:"Avg Order Size"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[V.length>0?(V.reduce((J,h)=>J+h.avgOrderSize,0)/V.length).toFixed(1):0," kg"]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-green-800",children:"On-Time Delivery"}),e.jsxs("p",{className:"text-2xl font-bold text-green-900",children:[V.length>0?(V.reduce((J,h)=>J+h.onTimeDelivery,0)/V.length).toFixed(1):0,"%"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"Top Performing Outlets"}),V.slice(0,3).map((J,h)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-bold text-indigo-600",children:["#",h+1]})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:J.name}),e.jsx("p",{className:"text-sm text-gray-500",children:J.location})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:[J.orders," orders"]}),e.jsxs("p",{className:"text-sm text-green-600",children:[J.onTimeDelivery,"% on-time"]})]})]},h))]})]}):e.jsx("div",{className:"flex items-center justify-center h-96 text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ps,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:"No performance data available"}),e.jsx("p",{className:"text-sm",children:"Data will appear here once orders are processed"})]})})})]})]})}),e.jsx(Ss,{value:"inventory",className:"space-y-8",children:z?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{className:"h-8 w-8 mx-auto mb-4 animate-spin text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading storage location data..."})]})}):u.length>0?e.jsx("div",{className:"space-y-6",children:(()=>{const J=u.filter(Y=>Y.totalItems>0),h=u.filter(Y=>Y.totalItems===0);return e.jsxs(e.Fragment,{children:[J.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Used Storage Locations"}),e.jsx("p",{className:"text-gray-600",children:"Storage areas currently holding inventory"})]}),J.map((Y,q)=>{const we=Y.capacityKg-Y.totalWeight;return e.jsx(U,{className:"border-2 border-gray-100 rounded-3xl p-8 hover:shadow-xl transition-all duration-300 bg-gradient-to-r from-white to-gray-50",children:e.jsx("div",{className:"flex flex-col xl:flex-row justify-between items-start xl:items-center gap-6",children:e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-2xl",children:e.jsx(As,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:Y.name}),e.jsx("p",{className:"text-gray-500",children:Y.description||`${Y.locationType?.replace("_"," ")} storage`})]}),e.jsx(se,{className:`px-3 py-1 rounded-xl ${Y.status==="active"?"bg-green-500 text-white":Y.status==="maintenance"?"bg-orange-500 text-white":"bg-red-500 text-white"}`,children:Y.status?.toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-2xl",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-600",children:"Total Items"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:Y.totalItems})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-2xl",children:[e.jsx("p",{className:"text-sm font-semibold text-green-600",children:"Used Weight"}),e.jsxs("p",{className:"text-xl font-bold text-green-900",children:[Y.totalWeight,"kg"]})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-2xl",children:[e.jsx("p",{className:"text-sm font-semibold text-purple-600",children:"Remaining"}),e.jsxs("p",{className:"text-lg font-bold text-purple-900",children:[we.toFixed(1),"kg"]})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-2xl",children:[e.jsx("p",{className:"text-sm font-semibold text-orange-600",children:"Utilization"}),e.jsxs("p",{className:"text-xl font-bold text-orange-900",children:[Y.utilizationPercent,"%"]})]})]})]})})},`used-${q}`)})]}),h.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 mt-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Available Storage Locations"}),e.jsx("p",{className:"text-gray-600",children:"Storage areas ready for new inventory"})]}),h.map((Y,q)=>e.jsx(U,{className:"border-2 border-gray-100 rounded-3xl p-8 hover:shadow-xl transition-all duration-300 bg-gradient-to-r from-white to-gray-50",children:e.jsx("div",{className:"flex flex-col xl:flex-row justify-between items-start xl:items-center gap-6",children:e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gray-100 rounded-2xl",children:e.jsx(As,{className:"h-6 w-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:Y.name}),e.jsx("p",{className:"text-gray-500",children:Y.description||`${Y.locationType?.replace("_"," ")} storage`})]}),e.jsx(se,{className:`px-3 py-1 rounded-xl ${Y.status==="active"?"bg-green-500 text-white":Y.status==="maintenance"?"bg-orange-500 text-white":"bg-red-500 text-white"}`,children:Y.status?.toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-2xl",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-600",children:"Available Capacity"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[Y.capacityKg,"kg"]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-2xl",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-600",children:"Status"}),e.jsx("p",{className:"text-xl font-bold text-blue-900",children:"Ready for Use"})]})]})]})})},`empty-${q}`))]})]})})()}):e.jsx("div",{className:"flex items-center justify-center h-96 text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(As,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:"No storage location data available"}),e.jsx("p",{className:"text-sm",children:"Data will appear here once storage locations are configured and inventory is processed"})]})})}),e.jsx(Ss,{value:"farmers",className:"space-y-8",children:Z?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{className:"h-8 w-8 mx-auto mb-4 animate-spin text-green-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading farmer performance data..."})]})}):T.length>0?e.jsx("div",{className:"space-y-6",children:T.map((J,h)=>e.jsx(U,{className:"border-2 border-gray-100 rounded-3xl p-8 hover:shadow-xl transition-all duration-300 bg-gradient-to-r from-white to-gray-50",children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-2xl",children:e.jsx(Ts,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:J.name}),e.jsxs("p",{className:"text-gray-500 flex items-center gap-2",children:[e.jsx(Ds,{className:"h-4 w-4"}),J.location]})]}),e.jsx(se,{className:`px-3 py-1 rounded-xl ${J.reliability==="excellent"?"bg-green-500 text-white":J.reliability==="good"?"bg-blue-500 text-white":"bg-orange-500 text-white"}`,children:J.reliability.toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-2xl",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-600",children:"Deliveries"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:J.deliveries})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-2xl",children:[e.jsx("p",{className:"text-sm font-semibold text-green-600",children:"Total Weight"}),e.jsxs("p",{className:"text-2xl font-bold text-green-900",children:[J.totalWeight,"kg"]})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-2xl",children:[e.jsx("p",{className:"text-sm font-semibold text-purple-600",children:"Total Value"}),e.jsx("p",{className:"text-xl font-bold text-purple-900",children:le(J.totalValue)})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-2xl",children:[e.jsx("p",{className:"text-sm font-semibold text-orange-600",children:"Avg Size"}),e.jsx("p",{className:"text-2xl font-bold text-orange-900",children:J.avgSize})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:["★ ",J.rating]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Rating"})]})]})},h))}):e.jsx("div",{className:"flex items-center justify-center h-96 text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ts,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:"No farmer data available"}),e.jsx("p",{className:"text-sm",children:"Data will appear here once farmers and warehouse entries are available"})]})})}),e.jsx(Ss,{value:"outlets",className:"space-y-8",children:K?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{className:"h-8 w-8 mx-auto mb-4 animate-spin text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading outlet performance data..."})]})}):V.length>0?e.jsx("div",{className:"space-y-6",children:V.map((J,h)=>e.jsx(U,{className:"border-2 border-gray-100 rounded-3xl p-8 hover:shadow-xl transition-all duration-300 bg-gradient-to-r from-white to-gray-50",children:e.jsx("div",{className:"flex flex-col xl:flex-row justify-between items-start xl:items-center gap-6",children:e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-2xl",children:e.jsx(Ds,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:J.name}),e.jsx("p",{className:"text-gray-500",children:J.location})]}),e.jsxs(se,{className:`px-3 py-1 rounded-xl ${J.onTimeDelivery>=95?"bg-green-500 text-white":J.onTimeDelivery>=90?"bg-blue-500 text-white":"bg-orange-500 text-white"}`,children:[J.onTimeDelivery,"% ON TIME"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-2xl",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-600",children:"Orders"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:J.orders})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-2xl",children:[e.jsx("p",{className:"text-sm font-semibold text-green-600",children:"Total Weight"}),e.jsxs("p",{className:"text-xl font-bold text-green-900",children:[J.totalWeight,"kg"]})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-2xl",children:[e.jsx("p",{className:"text-sm font-semibold text-purple-600",children:"Total Value"}),e.jsx("p",{className:"text-lg font-bold text-purple-900",children:le(J.totalValue)})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-2xl",children:[e.jsx("p",{className:"text-sm font-semibold text-orange-600",children:"Avg Order Size"}),e.jsxs("p",{className:"text-xl font-bold text-orange-900",children:[J.avgOrderSize,"kg"]})]})]})]})})},h))}):e.jsx("div",{className:"flex items-center justify-center h-96 text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ds,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:"No outlet data available"}),e.jsx("p",{className:"text-sm",children:"Data will appear here once outlets and orders are available"})]})})})]})})]})]})})}const Tn=Object.freeze(Object.defineProperty({__proto__:null,default:qn},Symbol.toStringTag,{value:"Module"}));function Jt({className:a,children:t,...s}){return e.jsxs(ei,{"data-slot":"scroll-area",className:Ee("relative",a),...s,children:[e.jsx(si,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:t}),e.jsx(An,{}),e.jsx(ti,{})]})}function An({className:a,orientation:t="vertical",...s}){return e.jsx(ai,{"data-slot":"scroll-area-scrollbar",orientation:t,className:Ee("flex touch-none p-px transition-colors select-none",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",a),...s,children:e.jsx(ri,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}const it=[{id:"*",name:"All Permissions",description:"Full system access - can do everything (Admin only)",category:"System Administration",icon:"Crown"},{id:"manage_users",name:"Manage Users",description:"Create, edit, and delete user accounts and roles",category:"System Administration",icon:"Users"},{id:"view_audit_logs",name:"View Audit Logs",description:"Access system audit logs and activity history",category:"System Administration",icon:"FileText"},{id:"export_data",name:"Export Data",description:"Export system data in various formats",category:"System Administration",icon:"Download"},{id:"view_dashboard",name:"View Dashboard",description:"Access the main dashboard and overview",category:"Dashboard & Overview",icon:"Home"},{id:"view_fish_entry",name:"View Fish Entry",description:"View fish entry records and warehouse operations",category:"Fish Entry & Warehouse",icon:"Warehouse"},{id:"manage_fish_entry",name:"Manage Fish Entry",description:"Create and update fish entry records",category:"Fish Entry & Warehouse",icon:"Warehouse"},{id:"view_warehouse",name:"View Warehouse",description:"View warehouse storage and operations",category:"Fish Entry & Warehouse",icon:"Package"},{id:"manage_warehouse",name:"Manage Warehouse",description:"Update warehouse storage and operations",category:"Fish Entry & Warehouse",icon:"Package"},{id:"view_processing",name:"View Processing",description:"View fish processing operations and records",category:"Processing Operations",icon:"Scissors"},{id:"manage_processing",name:"Manage Processing",description:"Create and update fish processing operations",category:"Processing Operations",icon:"Scissors"},{id:"view_sorting",name:"View Sorting",description:"View fish sorting operations and records",category:"Processing Operations",icon:"Filter"},{id:"manage_sorting",name:"Manage Sorting",description:"Create and update fish sorting operations",category:"Processing Operations",icon:"Filter"},{id:"view_inventory",name:"View Inventory",description:"View fish inventory and stock levels",category:"Inventory Management",icon:"Package"},{id:"manage_inventory",name:"Manage Inventory",description:"Update inventory records and stock levels",category:"Inventory Management",icon:"Package"},{id:"view_outlet_orders",name:"View Outlet Orders",description:"View outlet order records and status",category:"Outlet Operations",icon:"ShoppingCart"},{id:"manage_outlet_orders",name:"Manage Outlet Orders",description:"Create and update outlet orders",category:"Outlet Operations",icon:"ShoppingCart"},{id:"view_outlet_receiving",name:"View Outlet Receiving",description:"View outlet receiving records and confirmations",category:"Outlet Operations",icon:"CheckSquare"},{id:"manage_outlet_receiving",name:"Manage Outlet Receiving",description:"Update outlet receiving records and confirmations",category:"Outlet Operations",icon:"CheckSquare"},{id:"view_dispatch",name:"View Dispatch",description:"View dispatch operations and delivery records",category:"Dispatch & Delivery",icon:"Truck"},{id:"manage_dispatch",name:"Manage Dispatch",description:"Create and update dispatch operations",category:"Dispatch & Delivery",icon:"Truck"},{id:"view_delivery",name:"View Delivery",description:"View delivery records and status",category:"Dispatch & Delivery",icon:"Truck"},{id:"manage_delivery",name:"Manage Delivery",description:"Update delivery records and status",category:"Dispatch & Delivery",icon:"Truck"},{id:"view_disposal",name:"View Disposal",description:"View disposal records and waste management",category:"Disposal Management",icon:"Trash2"},{id:"manage_disposal",name:"Manage Disposal",description:"Create and update disposal records",category:"Disposal Management",icon:"Trash2"},{id:"view_clients",name:"View Clients",description:"View client information and records",category:"Client Management",icon:"Users"},{id:"manage_clients",name:"Manage Clients",description:"Create and update client records",category:"Client Management",icon:"Users"},{id:"view_reports",name:"View Reports",description:"View system reports and analytics",category:"Reports & Analytics",icon:"BarChart3"},{id:"export_reports",name:"Export Reports",description:"Export reports to CSV and other formats",category:"Reports & Analytics",icon:"Download"}],Bt=["System Administration","Dashboard & Overview","Fish Entry & Warehouse","Processing Operations","Inventory Management","Outlet Operations","Dispatch & Delivery","Disposal Management","Client Management","Reports & Analytics"];function $n({selectedPermissions:a,onPermissionsChange:t,className:s=""}){const[r,l]=c.useState(!1),[d,x]=c.useState(""),[m,g]=c.useState(Bt),f=c.useRef(null);c.useEffect(()=>{const R=Z=>{f.current&&!f.current.contains(Z.target)&&(l(!1),x(""))},X=Z=>{Z.key==="Escape"&&(l(!1),x(""))};return r&&(document.addEventListener("mousedown",R),document.addEventListener("keydown",X)),()=>{document.removeEventListener("mousedown",R),document.removeEventListener("keydown",X)}},[r]);const n=it.filter(R=>R.name.toLowerCase().includes(d.toLowerCase())||R.description.toLowerCase().includes(d.toLowerCase())||R.category.toLowerCase().includes(d.toLowerCase())),S=Bt.reduce((R,X)=>(R[X]=n.filter(Z=>Z.category===X),R),{}),T=R=>{if(R==="*")t(["*"]);else{const X=a.filter(z=>z!=="*"),Z=X.includes(R)?X.filter(z=>z!==R):[...X,R],K=[...new Set(Z)];t(K)}},V=R=>{g(X=>X.includes(R)?X.filter(Z=>Z!==R):[...X,R])},u=()=>{t([])},v=()=>{t(["*"])},b=R=>{const Z=it.filter(re=>re.category===R).map(re=>re.id),z=[...a.filter(re=>re!=="*"),...Z],ae=[...new Set(z)];t(ae)},M=R=>{const Z=it.filter(z=>z.category===R).map(z=>z.id),K=a.filter(z=>!Z.includes(z));t(K)};return e.jsxs("div",{ref:f,className:`relative ${s}`,children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>l(!r),className:"w-full justify-between h-auto min-h-[40px] p-3",children:e.jsxs("div",{className:"flex flex-col items-start w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{className:"text-sm font-medium",children:a.length===0?"Select permissions...":a.includes("*")?"All Permissions":`${a.length} permissions selected`}),r?e.jsx(Nt,{className:"h-4 w-4"}):e.jsx(Gs,{className:"h-4 w-4"})]}),a.length>0&&a.length<=3&&!a.includes("*")&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2 w-full",children:a.map(R=>{const X=it.find(Z=>Z.id===R);return e.jsx(se,{variant:"secondary",className:"text-xs",children:X?.name||R},R)})})]})}),r&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-xl max-h-96",children:[e.jsxs("div",{className:"p-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(mt,{className:"h-4 w-4 text-gray-400"}),e.jsx(Se,{placeholder:"Search permissions...",value:d,onChange:R=>x(R.target.value),className:"flex-1"})]}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(k,{size:"sm",variant:"outline",onClick:v,children:"Select All"}),e.jsx(k,{size:"sm",variant:"outline",onClick:u,children:"Clear All"})]}),a.length>0&&e.jsxs("div",{className:"text-xs text-gray-600 bg-blue-50 p-2 rounded",children:[e.jsx("strong",{children:"Currently selected:"})," ",a.includes("*")?"All Permissions":a.map(R=>it.find(X=>X.id===R)?.name||R).join(", ")]})]}),e.jsx(Jt,{className:"max-h-80",children:e.jsx("div",{className:"p-2",children:Bt.map(R=>{const X=S[R];if(X.length===0)return null;const Z=m.includes(R),K=X.filter(z=>a.includes(z.id)).length;return e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>V(R),className:"flex-1 justify-between p-2 h-auto",children:[e.jsxs("span",{className:"font-medium text-sm",children:[R," (",K,"/",X.length,")"]}),Z?e.jsx(Nt,{className:"h-4 w-4"}):e.jsx(Gs,{className:"h-4 w-4"})]}),Z&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx(k,{variant:"outline",size:"sm",onClick:()=>b(R),className:"h-6 px-2 text-xs",title:"Select all in category",children:"All"}),e.jsx(k,{variant:"outline",size:"sm",onClick:()=>M(R),className:"h-6 px-2 text-xs",title:"Clear all in category",children:"Clear"})]})]}),Z&&e.jsx("div",{className:"ml-4 space-y-1",children:X.map(z=>{const ae=a.includes(z.id);return e.jsx("div",{className:`flex items-start gap-2 p-2 rounded cursor-pointer transition-colors ${ae?"bg-blue-50 border border-blue-200":"hover:bg-gray-50"}`,onClick:()=>T(z.id),children:e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("div",{className:`w-4 h-4 rounded border-2 flex items-center justify-center ${ae?"bg-blue-600 border-blue-600":"border-gray-300"}`,children:ae&&e.jsx(dt,{className:"h-3 w-3 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-sm",children:z.name}),z.id==="*"&&e.jsx(se,{variant:"destructive",className:"text-xs",children:"Admin"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:z.description})]})]})},z.id)})})]},R)})})}),e.jsx("div",{className:"p-3 border-t bg-gray-50",children:e.jsx("div",{className:"flex justify-end",children:e.jsx(k,{size:"sm",onClick:()=>l(!1),className:"h-7 px-3 text-xs",children:"Done"})})}),a.length>0&&e.jsx("div",{className:"p-3 border-t bg-gray-50",children:e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:a.map(R=>{const X=it.find(Z=>Z.id===R);return e.jsxs(se,{variant:"secondary",className:"text-xs",children:[X?.name||R,e.jsx(Xs,{className:"h-3 w-3 ml-1 cursor-pointer",onClick:Z=>{Z.stopPropagation(),T(R)}})]},R)})})})]})]})}const Kt={"System Administration":{icon:At,color:"bg-red-100 text-red-800 border-red-200"},"Basic Access":{icon:Ks,color:"bg-blue-100 text-blue-800 border-blue-200"},"Inventory Management":{icon:Te,color:"bg-green-100 text-green-800 border-green-200"},"Processing Operations":{icon:Ls,color:"bg-purple-100 text-purple-800 border-purple-200"},"Quality Control":{icon:qe,color:"bg-yellow-100 text-yellow-800 border-yellow-200"},"Farming Operations":{icon:tt,color:"bg-orange-100 text-orange-800 border-orange-200"},"Sales & Customer Management":{icon:Vs,color:"bg-pink-100 text-pink-800 border-pink-200"},"Logistics & Dispatch":{icon:ks,color:"bg-indigo-100 text-indigo-800 border-indigo-200"},"Orders Management":{icon:Ht,color:"bg-teal-100 text-teal-800 border-teal-200"},"Warehouse Operations":{icon:Fs,color:"bg-gray-100 text-gray-800 border-gray-200"},"Reports & Analytics":{icon:Ws,color:"bg-cyan-100 text-cyan-800 border-cyan-200"}},Rn={"*":At,admin_access:xs,manage_users:Ts,manage_roles:oi,view_audit_logs:Ys,system_settings:ia,export_data:xt,basic_access:Ks,read_all_data:rs,view_inventory:Te,manage_inventory:Te,delete_inventory:us,view_processing:Ls,manage_processing:Ls,delete_processing:us,view_quality:qe,manage_quality:qe,delete_quality:us,view_farming:tt,manage_farming:tt,delete_farming:us,view_harvests:ba,manage_harvests:ba,delete_harvests:us,view_sales:Vs,manage_sales:Vs,delete_sales:us,view_customers:Ts,manage_customers:li,delete_customers:ni,view_logistics:ks,manage_logistics:ks,delete_logistics:us,view_dispatch:fa,manage_dispatch:fa,delete_dispatch:us,view_orders:Ht,manage_orders:Ht,delete_orders:us,view_warehouse:Fs,manage_warehouse:Fs,delete_warehouse:us,view_reports:Ws,create_reports:ii,export_reports:xt},Gt=[{id:"*",name:"All Permissions",description:"Full system access - can do everything (Admin only)",category:"System Administration"},{id:"admin_access",name:"Admin Access",description:"Full administrative access to all system functions",category:"System Administration"},{id:"manage_users",name:"Manage Users",description:"Create, edit, and delete user accounts",category:"System Administration"},{id:"manage_roles",name:"Manage Roles",description:"Create, edit, and delete user roles and permissions",category:"System Administration"},{id:"view_audit_logs",name:"View Audit Logs",description:"Access system audit logs and activity history",category:"System Administration"},{id:"system_settings",name:"System Settings",description:"Configure system-wide settings and preferences",category:"System Administration"},{id:"export_data",name:"Export Data",description:"Export system data in various formats",category:"System Administration"},{id:"basic_access",name:"Basic Access",description:"Basic system access and navigation",category:"Basic Access"},{id:"read_all_data",name:"Read All Data",description:"View all system data without modification rights",category:"Basic Access"},{id:"view_inventory",name:"View Inventory",description:"View fish inventory and stock levels",category:"Inventory Management"},{id:"manage_inventory",name:"Manage Inventory",description:"Add, update, and modify inventory records",category:"Inventory Management"},{id:"delete_inventory",name:"Delete Inventory",description:"Remove inventory records and items",category:"Inventory Management"},{id:"view_processing",name:"View Processing",description:"View fish processing operations and records",category:"Processing Operations"},{id:"manage_processing",name:"Manage Processing",description:"Create and update processing operations",category:"Processing Operations"},{id:"delete_processing",name:"Delete Processing",description:"Remove processing records and operations",category:"Processing Operations"},{id:"view_quality",name:"View Quality",description:"View quality control records and assessments",category:"Quality Control"},{id:"manage_quality",name:"Manage Quality",description:"Create and update quality control assessments",category:"Quality Control"},{id:"delete_quality",name:"Delete Quality",description:"Remove quality control records",category:"Quality Control"},{id:"view_farming",name:"View Farming",description:"View farming operations and records",category:"Farming Operations"},{id:"manage_farming",name:"Manage Farming",description:"Create and update farming operations",category:"Farming Operations"},{id:"delete_farming",name:"Delete Farming",description:"Remove farming operation records",category:"Farming Operations"},{id:"view_harvests",name:"View Harvests",description:"View harvest records and data",category:"Farming Operations"},{id:"manage_harvests",name:"Manage Harvests",description:"Create and update harvest records",category:"Farming Operations"},{id:"delete_harvests",name:"Delete Harvests",description:"Remove harvest records",category:"Farming Operations"},{id:"view_sales",name:"View Sales",description:"View sales records and transactions",category:"Sales & Customer Management"},{id:"manage_sales",name:"Manage Sales",description:"Create and update sales transactions",category:"Sales & Customer Management"},{id:"delete_sales",name:"Delete Sales",description:"Remove sales records and transactions",category:"Sales & Customer Management"},{id:"view_customers",name:"View Customers",description:"View customer information and records",category:"Sales & Customer Management"},{id:"manage_customers",name:"Manage Customers",description:"Create and update customer information",category:"Sales & Customer Management"},{id:"delete_customers",name:"Delete Customers",description:"Remove customer records",category:"Sales & Customer Management"},{id:"view_logistics",name:"View Logistics",description:"View logistics and transportation records",category:"Logistics & Dispatch"},{id:"manage_logistics",name:"Manage Logistics",description:"Create and update logistics operations",category:"Logistics & Dispatch"},{id:"delete_logistics",name:"Delete Logistics",description:"Remove logistics records",category:"Logistics & Dispatch"},{id:"view_dispatch",name:"View Dispatch",description:"View dispatch records and deliveries",category:"Logistics & Dispatch"},{id:"manage_dispatch",name:"Manage Dispatch",description:"Create and update dispatch operations",category:"Logistics & Dispatch"},{id:"delete_dispatch",name:"Delete Dispatch",description:"Remove dispatch records",category:"Logistics & Dispatch"},{id:"view_orders",name:"View Orders",description:"View outlet orders and requests",category:"Orders Management"},{id:"manage_orders",name:"Manage Orders",description:"Create, update, and process orders",category:"Orders Management"},{id:"delete_orders",name:"Delete Orders",description:"Remove order records",category:"Orders Management"},{id:"view_warehouse",name:"View Warehouse",description:"View warehouse operations and storage",category:"Warehouse Operations"},{id:"manage_warehouse",name:"Manage Warehouse",description:"Create and update warehouse operations",category:"Warehouse Operations"},{id:"delete_warehouse",name:"Delete Warehouse",description:"Remove warehouse operation records",category:"Warehouse Operations"},{id:"view_reports",name:"View Reports",description:"View system reports and analytics",category:"Reports & Analytics"},{id:"create_reports",name:"Create Reports",description:"Generate custom reports and analytics",category:"Reports & Analytics"},{id:"export_reports",name:"Export Reports",description:"Export reports to CSV and other formats",category:"Reports & Analytics"}];function Ln({className:a="",showAsModal:t=!1,onClose:s}){const{userProfile:r,userRole:l,permissions:d,loading:x}=$t(),[m,g]=c.useState(!1),n=x?[]:!d||d.length===0?[]:d.includes("*")?Gt:d.map(u=>Gt.find(v=>v.id===u)).filter(Boolean),S=n.reduce((u,v)=>(u[v.category]||(u[v.category]=[]),u[v.category].push(v),u),{}),T=d.includes("*"),V=()=>e.jsxs("div",{className:a,children:[x&&e.jsx(U,{children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(xs,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-gray-900",children:"Loading permissions..."}),e.jsx("p",{className:"text-xs text-gray-600",children:"Please wait while we fetch your permissions"})]})]})})}),!x&&(!r||!d)&&e.jsx(U,{children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-full",children:e.jsx(xs,{className:"h-4 w-4 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-gray-900",children:"Unable to load permissions"}),e.jsx("p",{className:"text-xs text-gray-600",children:"There was an issue loading your permissions. Please try refreshing the page."})]})]})})}),!x&&r&&d&&e.jsxs(U,{children:[e.jsx(Fe,{className:"pb-3",children:e.jsxs(Pe,{className:"flex items-center gap-2 text-lg",children:[e.jsx(xs,{className:"h-5 w-5 text-blue-600"}),"Your Permissions"]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(Pt,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-sm text-blue-900",children:[r?.first_name," ",r?.last_name]}),e.jsx("p",{className:"text-xs text-blue-600",children:r?.email})]}),e.jsx(se,{className:"bg-blue-100 text-blue-800 border-blue-200",children:l?.name?.replace("_"," ").toUpperCase()||l?.display_name?.toUpperCase()||"USER"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Total Permissions:"}),e.jsx(se,{variant:"outline",className:"bg-white",children:T?"All Permissions":`${n.length} permissions`})]}),T&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-amber-600",children:[e.jsx(At,{className:"h-4 w-4"}),e.jsx("span",{children:"You have full administrative access to the system"})]})]}),!T&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-700",children:"Permission Categories"}),e.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>g(!m),className:"h-6 px-2 text-xs",children:[m?"Collapse":"Expand"," All",e.jsx(na,{className:`h-3 w-3 ml-1 transition-transform ${m?"rotate-90":""}`})]})]}),e.jsx(Jt,{className:"max-h-96",children:e.jsx("div",{className:"space-y-2",children:Object.entries(S).map(([u,v])=>{const b=Kt[u]?.icon||xs;return Kt[u]?.color,e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 border-b",children:[e.jsx(b,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"font-medium text-sm text-gray-700",children:u}),e.jsxs(se,{variant:"outline",className:"ml-auto text-xs",children:[v.length," permissions"]})]}),e.jsx("div",{className:"p-3 space-y-2",children:v.map(M=>{const R=Rn[M.id]||ci;return e.jsxs("div",{className:"flex items-start gap-2 p-2 bg-white rounded border",children:[e.jsx(R,{className:"h-4 w-4 text-gray-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900",children:M.name}),e.jsx("p",{className:"text-xs text-gray-500",children:M.description})]})]},M.id)})})]},u)})})})]}),T&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-700",children:"Available System Permissions"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.entries(Kt).map(([u,v])=>{const b=v.icon,M=Gt.filter(R=>R.category===u);return e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(b,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"font-medium text-sm text-gray-700",children:u}),e.jsx(se,{variant:"outline",className:"ml-auto text-xs",children:M.length})]}),e.jsxs("div",{className:"space-y-1",children:[M.slice(0,3).map(R=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-xs text-gray-600",children:R.name})]},R.id)),M.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 ml-3.5",children:["+",M.length-3," more permissions"]})]})]},u)})})]})]})]})]});return t?e.jsx(Xe,{open:!0,onOpenChange:s,children:e.jsxs(Ye,{className:"max-w-4xl max-h-[80vh]",children:[e.jsxs(es,{children:[e.jsxs(Je,{className:"flex items-center gap-2",children:[e.jsx(xs,{className:"h-5 w-5 text-blue-600"}),"Your Role & Permissions"]}),e.jsx(vs,{children:"View your assigned role and the permissions you have in the Fish Management System"})]}),e.jsx(Jt,{className:"max-h-[60vh]",children:e.jsx(V,{})})]})}):e.jsx(V,{})}function Wn({onNavigate:a}){const[t,s]=c.useState([]),[r,l]=c.useState([]),[d,x]=c.useState([]),[m,g]=c.useState([]),[f,n]=c.useState([]),[S,T]=c.useState([]),[V,u]=c.useState([]),[v,b]=c.useState({provider:"sendgrid",from_email:"noreply@riofish.com",from_name:"RioFish System",api_key:""}),[M,R]=c.useState(!0),[X,Z]=c.useState("users"),[K,z]=c.useState(!1),[ae,re]=c.useState(!1),[O,le]=c.useState(!1),[W,G]=c.useState(!1),[J,h]=c.useState(!1),[Y,q]=c.useState(!1),[we,Ce]=c.useState(!1),[De,fe]=c.useState(!1),[Me,y]=c.useState(!1),[L,je]=c.useState(null),[ce,N]=c.useState(null),[F,p]=c.useState(null),[D,E]=c.useState(null),[A,I]=c.useState(""),[P,be]=c.useState("all"),[ze,Ie]=c.useState("all"),[ke,ye]=c.useState(null),[Le,ls]=c.useState({}),[w,xe]=c.useState({isValid:!0,message:""}),[$e,Re]=c.useState({isValid:!0,message:""}),[de,oe]=c.useState({isValid:!0,message:""}),[he,ge]=c.useState({email:"",first_name:"",last_name:"",role:"",phone:"",is_active:!0,password:"",confirm_password:""}),[_,ne]=c.useState({name:"",display_name:"",description:"",permissions:[],icon:"Shield",color:"bg-gray-100 text-gray-800 border-gray-200",is_active:!0}),We=async i=>{if(!i||i.length<3){xe({isValid:!0,message:""});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)){xe({isValid:!1,message:"Please enter a valid email address"});return}try{let Oe=j.from("profiles").select("id").eq("email",i.toLowerCase().trim());L?.id&&(Oe=Oe.neq("id",L.id));const{data:te,error:Ae}=await Oe;if(Ae&&Ae.code!=="PGRST116"){xe({isValid:!0,message:""});return}te&&te.length>0?xe({isValid:!1,message:"This email is already in use"}):xe({isValid:!0,message:"Email is available"})}catch{xe({isValid:!0,message:""})}},is=async i=>{if(!i||i.length<6){Re({isValid:!1,message:"Password must be at least 6 characters long"});return}try{const{data:$,error:Oe}=await j.from("profiles").select("password_hash").not("password_hash","is",null);if(Oe){Re({isValid:!0,message:""});return}if($&&$.length>0){const te=await ps(()=>import("./vendor-DLLmvrOi.js").then(Ae=>Ae.bt),[]);for(const Ae of $)if(Ae.password_hash&&await te.compare(i,Ae.password_hash)){Re({isValid:!1,message:"This password is already in use"});return}}Re({isValid:!0,message:"Password is available"})}catch{Re({isValid:!0,message:""})}},as=async i=>{if(!i||i.trim()===""){oe({isValid:!0,message:""});return}if(!/^[\+]?[1-9][\d]{0,15}$/.test(i.replace(/[\s\-\(\)]/g,""))){oe({isValid:!1,message:"Please enter a valid phone number"});return}try{let Oe=j.from("profiles").select("id").eq("phone",i.trim());L?.id&&(Oe=Oe.neq("id",L.id));const{data:te,error:Ae}=await Oe;if(Ae&&Ae.code!=="PGRST116"){oe({isValid:!0,message:""});return}te&&te.length>0?oe({isValid:!1,message:"This phone number is already in use"}):oe({isValid:!0,message:"Phone number is available"})}catch{oe({isValid:!0,message:""})}},[o,C]=c.useState({name:"",phone:"",location:"",rating:0,reliability:"fair",status:"active"}),[Q,ue]=c.useState({name:"",description:"",capacity_kg:1e3,temperature_celsius:4,humidity_percent:85,location_type:"cold_storage",status:"active"}),[ve,me]=c.useState({name:"",location:"",phone:"",manager_name:"",status:"active"}),pe=async()=>{try{const{data:i,error:$}=await j.from("user_roles").select("*").order("name");if($)throw $;l(i||[])}catch(i){console.warn("Could not fetch roles:",i),l([])}},Be=async()=>{try{const{data:i,error:$}=await j.from("audit_logs").select("*").order("created_at",{ascending:!1}).limit(100);if($)console.warn("Could not fetch audit logs:",$),x([]);else{const Oe=await Promise.all((i||[]).map(async te=>{if(te.user_id)try{const{data:Ae}=await j.from("profiles").select("first_name, last_name, email").eq("id",te.user_id).single();return{...te,user:Ae}}catch(Ae){return console.warn("Could not fetch user for audit log:",Ae),te}return te}));x(Oe)}}catch(i){console.warn("Could not fetch audit logs:",i),x([])}},ss=i=>{const $=i.user?`${i.user.first_name} ${i.user.last_name}`:"Unknown User",Oe=i.action.toLowerCase(),te=i.table_name.toLowerCase().replace("_"," ");let Ae=null,Ge=null;try{Ae=i.old_values?JSON.parse(i.old_values):null,Ge=i.new_values?JSON.parse(i.new_values):null}catch{}switch(Oe){case"insert":switch(te){case"profiles":return`${$} created a new user account${Ge?.email?` (${Ge.email})`:""}`;case"farmers":return`${$} added a new farmer${Ge?.name?` (${Ge.name})`:""}`;case"warehouse entries":const rt=Ge?.fish_type||"fish",st=Ge?.total_weight?`${Ge.total_weight}kg`:"",Lt=Ge?.entry_code?` (${Ge.entry_code})`:"";return`${$} recorded a new ${rt} entry${st?` (${st})`:""}${Lt}`;case"outlet receiving inventory":const sr=Ge?.fish_type||"fish",da=Ge?.weight_received?`${Ge.weight_received}kg`:"",tr=Ge?.entry_code?` (${Ge.entry_code})`:"";return`${$} received ${sr} at outlet${da?` (${da})`:""}${tr}`;case"outlet orders":return`${$} created a new order`;default:return`${$} created a new ${te} record`}case"update":switch(te){case"profiles":const rt=Ae?.email!==Ge?.email?` (${Ae?.email} → ${Ge?.email})`:"",st=Ae?.role!==Ge?.role?` (${Ae?.role} → ${Ge?.role})`:"";return`${$} updated user information${rt||st||""}`;case"farmers":const Lt=Ae?.name!==Ge?.name?` (${Ae?.name} → ${Ge?.name})`:"";return`${$} updated farmer details${Lt||""}`;case"outlet orders":return Ge?.status==="confirmed"?`${$} confirmed order ${i.record_id?.substring(0,8)||""}`:Ge?.status==="cancelled"?`${$} cancelled order ${i.record_id?.substring(0,8)||""}`:`${$} updated order details`;default:return`${$} updated ${te} information`}case"delete":switch(te){case"profiles":return`${$} deleted user account${Ae?.email?` (${Ae.email})`:""}`;case"farmers":return`${$} removed farmer${Ae?.name?` (${Ae.name})`:""}`;default:return`${$} deleted ${te} record`}case"login":return`${$} logged into the system`;case"logout":return`${$} logged out of the system`;default:return`${$} performed ${Oe} on ${te}`}},Ke=i=>{const $=[];i.ip_address&&$.push(`IP: ${i.ip_address}`),i.record_id&&$.push(`ID: ${i.record_id.substring(0,8)}...`);try{const Oe=i.old_values?JSON.parse(i.old_values):null,te=i.new_values?JSON.parse(i.new_values):null;i.table_name==="warehouse_entries"&&te&&(te.entry_code&&$.push(`Entry Code: ${te.entry_code}`),te.fish_type&&$.push(`Type: ${te.fish_type}`),te.condition&&$.push(`Grade: ${te.condition}`),te.total_weight&&$.push(`Weight: ${te.total_weight}kg`),te.total_pieces&&$.push(`Pieces: ${te.total_pieces}`),te.price_per_kg&&$.push(`Price: $${te.price_per_kg}/kg`),te.farmer_id&&$.push(`Farmer ID: ${te.farmer_id}`)),i.table_name==="outlet_receiving"&&te&&(te.actual_weight_received&&$.push(`Weight Received: ${te.actual_weight_received}kg`),te.condition&&$.push(`Condition: ${te.condition}`),te.outlet_name&&$.push(`Outlet: ${te.outlet_name}`),te.received_date&&$.push(`Date: ${te.received_date}`)),i.table_name==="outlet_orders"&&te&&(te.order_number&&$.push(`Order #: ${te.order_number}`),te.status&&$.push(`Status: ${te.status}`),te.delivery_date&&$.push(`Delivery: ${te.delivery_date}`)),i.table_name==="profiles"&&te&&(te.role&&$.push(`Role: ${te.role}`),te.is_active!==void 0&&$.push(`Active: ${te.is_active?"Yes":"No"}`),te.phone&&$.push(`Phone: ${te.phone}`)),i.table_name==="farmers"&&te&&(te.location&&$.push(`Location: ${te.location}`),te.phone&&$.push(`Phone: ${te.phone}`),te.rating&&$.push(`Rating: ${te.rating}/5`),te.reliability&&$.push(`Reliability: ${te.reliability}`))}catch{}return $},He=async(i,$,Oe,te,Ae)=>{try{const Ge=JSON.parse(sessionStorage.getItem("currentUser")||"null");if(!Ge)return;const rt={user_id:Ge.id,action:i,table_name:$,record_id:Oe,old_values:te?JSON.stringify(te):null,new_values:Ae?JSON.stringify(Ae):null,ip_address:null,user_agent:navigator.userAgent,created_at:new Date().toISOString()},{error:st}=await j.from("audit_logs").insert([rt]);st&&console.warn("Failed to log audit event:",st)}catch(Ge){console.warn("Failed to log audit event:",Ge)}},fs=async()=>{b({provider:"sendgrid",from_email:"noreply@riofish.com",from_name:"Rio Fish Management",api_key:""})},hs=async()=>{try{console.log("Fetching storage locations...");const{data:i,error:$}=await j.from("storage_locations").select("*").order("name");if($)throw console.error("Error fetching storage locations:",$),$;console.log("Storage locations fetched successfully:",i),T(i||[])}catch(i){console.error("Could not fetch storage locations:",i),T([])}},Es=async()=>{try{R(!0);const{data:i,error:$}=await j.from("profiles").select("*").order("created_at",{ascending:!1});if($)throw $;s(i||[])}catch(i){console.warn("Could not fetch users:",i),s([])}finally{R(!1)}},Zs=async()=>{try{const{data:i,error:$}=await j.from("farmers").select("*").order("name");if($)throw $;n(i||[])}catch(i){console.warn("Could not fetch farmers:",i),n([])}},Us=async()=>{try{console.log("Fetching outlets...");const{data:i,error:$}=await j.from("outlets").select("*").order("name");if($)throw console.error("Error fetching outlets:",$),$.message.includes('relation "outlets" does not exist')&&(console.warn("Outlets table does not exist. Please run the database setup script."),ee.error("Outlets table not found. Please contact administrator.")),$;console.log("Outlets fetched successfully:",i?.length||0,"records"),u(i||[])}catch(i){console.warn("Could not fetch outlets:",i),u([])}};c.useEffect(()=>{pe(),Es(),Zs(),Us(),Be(),fs(),hs()},[]);const Rt=()=>{const i={};return _.name.trim()?_.name.trim().length<2?i.name="Role name must be at least 2 characters":_.name.trim().length>50?i.name="Role name must be less than 50 characters":/^[a-zA-Z0-9_\s-]+$/.test(_.name.trim())||(i.name="Role name can only contain letters, numbers, spaces, hyphens, and underscores"):i.name="Role name is required",_.display_name.trim()?_.display_name.trim().length<2?i.display_name="Display name must be at least 2 characters":_.display_name.trim().length>100&&(i.display_name="Display name must be less than 100 characters"):i.display_name="Display name is required",_.description.trim().length>500&&(i.description="Description must be less than 500 characters"),!Array.isArray(_.permissions)||_.permissions.length===0?i.permissions="At least one permission must be selected":_.permissions.length>50&&(i.permissions="Too many permissions selected (maximum 50)"),ls(i),Object.keys(i).length===0},Ka=async()=>{try{if(ye("saving-role"),!Rt())return;const i=_.name.toLowerCase().trim().replace(/\s+/g,"_");if(ce){if(i!==ce.name){const{data:te,error:Ae}=await j.from("user_roles").select("id").eq("name",i).neq("id",ce.id).single();if(Ae&&Ae.code!=="PGRST116")throw Ae;if(te){ee.error("Role name already exists",{description:"Please choose a different name for the role"});return}}const $=[...new Set(_.permissions)],{error:Oe}=await j.from("user_roles").update({..._,name:i,permissions:$}).eq("id",ce.id);if(Oe)throw Oe;ee.success("Role updated successfully")}else{const{data:$,error:Oe}=await j.from("user_roles").select("id").eq("name",i).single();if(Oe&&Oe.code!=="PGRST116")throw Oe;if($){ee.error("Role name already exists",{description:"Please choose a different name for the role"});return}const te=[...new Set(_.permissions)],{error:Ae}=await j.from("user_roles").insert([{..._,name:i,permissions:te}]);if(Ae){if(Ae.code==="23505"){ee.error("Role name already exists",{description:"Please choose a different name for the role"});return}throw Ae}ee.success("Role created successfully")}G(!1),N(null),ne({name:"",display_name:"",description:"",permissions:[],icon:"Shield",color:"bg-gray-100 text-gray-800 border-gray-200",is_active:!0}),ls({}),pe()}catch(i){ee.error(`Role operation failed: ${i.message}`)}finally{ye(null)}},Ga=async()=>{try{if(ye("saving-user"),!he.email||!he.first_name||!he.last_name){ee.error("Please fill in all required fields");return}if(!w.isValid){ee.error("Please fix email validation errors");return}if(!de.isValid){ee.error("Please fix phone number validation errors");return}if(!L){if(!he.password||he.password.length<6){ee.error("Password must be at least 6 characters long");return}if(!$e.isValid){ee.error("Please fix password validation errors");return}if(he.password!==he.confirm_password){ee.error("Passwords do not match");return}}if(!L?.id){const{data:i,error:$}=await j.from("profiles").select("id, email").eq("email",he.email.toLowerCase().trim());if($&&$.code!=="PGRST116")throw $;if(i&&i.length>0){ee.error("Email already exists",{description:"Please choose a different email address"});return}}if(!L?.id&&he.phone&&he.phone.trim()!==""){const{data:i,error:$}=await j.from("profiles").select("id, phone").eq("phone",he.phone.trim());if($&&$.code!=="PGRST116")throw $;if(i&&i.length>0){ee.error("Phone number already exists",{description:"Please choose a different phone number"});return}}if(!L){const{data:i,error:$}=await j.from("profiles").select("id, password_hash").not("password_hash","is",null);if($)throw $;if(i&&i.length>0){const Oe=await ps(()=>import("./vendor-DLLmvrOi.js").then(te=>te.bt),[]);for(const te of i)if(te.password_hash&&await Oe.compare(he.password,te.password_hash)){ee.error("Password already in use",{description:"Please choose a different password for security reasons"});return}}}if(L){const i={email:L.email,first_name:L.first_name,last_name:L.last_name,role:L.role,phone:L.phone,is_active:L.is_active},$={email:he.email,first_name:he.first_name,last_name:he.last_name,role:he.role,phone:he.phone,is_active:he.is_active},{error:Oe}=await j.from("profiles").update($).eq("id",L.id);if(Oe)throw Oe;await He("UPDATE","profiles",L.id,i,$),ee.success("User updated successfully")}else{const $=await(await ps(()=>import("./vendor-DLLmvrOi.js").then(Ge=>Ge.bt),[])).hash(he.password,10),Oe={email:he.email.toLowerCase().trim(),password_hash:$,first_name:he.first_name.trim(),last_name:he.last_name.trim(),role:he.role,phone:he.phone?.trim()||null,is_active:he.is_active},{data:te,error:Ae}=await j.from("profiles").insert([Oe]).select().single();if(Ae){if(Ae.code==="23505"){ee.error("Email already exists",{description:"Please choose a different email address"});return}throw Ae}await He("INSERT","profiles",te.id,null,Oe),ee.success("User created successfully")}z(!1),je(null),ge({email:"",first_name:"",last_name:"",role:"",phone:"",is_active:!0,password:"",confirm_password:""}),xe({isValid:!0,message:""}),Re({isValid:!0,message:""}),oe({isValid:!0,message:""}),Es(),Be()}catch(i){ee.error(`User operation failed: ${i.message}`)}finally{ye(null)}},Qa=async()=>{try{if(ye("saving-farmer"),!o.name||!o.phone||!o.location){ee.error("Please fill in all required fields");return}if(F){const i={name:F.name,phone:F.phone,location:F.location,rating:F.rating,reliability:F.reliability,status:F.status},{error:$}=await j.from("farmers").update(o).eq("id",F.id);if($)throw $;await He("UPDATE","farmers",F.id,i,o),ee.success("Farmer updated successfully")}else{const{data:i,error:$}=await j.from("farmers").insert([o]).select().single();if($)throw $;await He("INSERT","farmers",i.id,null,o),ee.success("Farmer created successfully")}q(!1),p(null),C({name:"",phone:"",location:"",rating:0,reliability:"fair",status:"active"}),Zs(),Be()}catch(i){ee.error(`Farmer operation failed: ${i.message}`)}finally{ye(null)}},Ha=async i=>{if(confirm("Are you sure you want to delete this farmer?"))try{ye("deleting-farmer");const $=f.find(te=>te.id===i),{error:Oe}=await j.from("farmers").delete().eq("id",i);if(Oe)throw Oe;$&&await He("DELETE","farmers",i,$,null),ee.success("Farmer deleted successfully"),Zs(),Be()}catch($){ee.error(`Failed to delete farmer: ${$.message}`)}finally{ye(null)}},Ya=async()=>{try{ye("saving-storage");const{error:i}=await j.from("storage_locations").insert([Q]);if(i)throw i;ee.success("Storage location created successfully"),fe(!1),ue({name:"",description:"",capacity_kg:1e3,temperature_celsius:4,humidity_percent:85,location_type:"cold_storage",status:"active"}),hs()}catch(i){ee.error(`Storage location creation failed: ${i.message}`)}finally{ye(null)}},Ja=async(i,$)=>{try{ye(`toggle-storage-${i}`);const Oe=$==="active"?"inactive":"active",{error:te}=await j.from("storage_locations").update({status:Oe,updated_at:new Date().toISOString()}).eq("id",i);if(te)throw te;ee.success(`Storage location marked as ${Oe}`),hs()}catch(Oe){ee.error(`Failed to update storage status: ${Oe.message}`)}finally{ye(null)}},Za=async()=>{try{ye("saving-outlet");const i={name:ve.name,location:ve.location,phone:ve.phone,manager_name:ve.manager_name||null,status:ve.status};if(console.log("Submitting outlet data:",i),D){const{error:$}=await j.from("outlets").update(i).eq("id",D.id);if($)throw console.error("Update outlet error:",$),$;ee.success("Outlet updated successfully")}else{const{error:$}=await j.from("outlets").insert([i]);if($)throw console.error("Create outlet error:",$),$;ee.success("Outlet created successfully")}y(!1),E(null),me({name:"",location:"",phone:"",manager_name:"",status:"active"}),Us()}catch(i){ee.error(`Outlet operation failed: ${i.message}`)}finally{ye(null)}},Xa=async i=>{if(confirm("Are you sure you want to delete this outlet?"))try{ye("deleting-outlet");const{error:$}=await j.from("outlets").delete().eq("id",i);if($)throw $;ee.success("Outlet deleted successfully"),Us()}catch($){ee.error(`Failed to delete outlet: ${$.message}`)}finally{ye(null)}},ca=t.filter(i=>{const $=i.first_name.toLowerCase().includes(A.toLowerCase())||i.last_name.toLowerCase().includes(A.toLowerCase())||i.email.toLowerCase().includes(A.toLowerCase()),Oe=P==="all"||i.role===P;return $&&Oe}),er=i=>({Shield:xs,Crown:At,Package:Te,Building:Ft,Eye:rs,Tractor:tt,Warehouse:Fs})[i]||xs;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50",children:e.jsxs("div",{className:"space-y-8 p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 via-blue-700 to-indigo-800 p-8 text-white shadow-2xl",children:[e.jsx("div",{className:"absolute inset-0 bg-black/10"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(Ts,{className:"h-8 w-8"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold tracking-tight",children:"User Management"}),e.jsx("p",{className:"text-blue-100 text-lg",children:"Comprehensive user, role, and system administration"})]})]}),e.jsxs("div",{className:"flex items-center gap-6 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-100",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium",children:"System Active"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-blue-100",children:[e.jsx(Ts,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm",children:[t.length," Users"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-blue-100",children:[e.jsx(tt,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm",children:[f.length," Farmers"]})]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(k,{onClick:()=>h(!0),variant:"secondary",className:"bg-white/20 hover:bg-white/30 text-white border-white/30 backdrop-blur-sm transition-all duration-200",children:[e.jsx(ia,{className:"h-4 w-4 mr-2"}),"Email Config"]})})]})}),e.jsx("div",{className:"absolute -top-4 -right-4 w-24 h-24 bg-white/10 rounded-full blur-xl"}),e.jsx("div",{className:"absolute -bottom-8 -left-8 w-32 h-32 bg-white/5 rounded-full blur-2xl"})]}),e.jsxs(Va,{value:X,onValueChange:Z,className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:e.jsxs(Ba,{className:"flex w-full bg-gradient-to-r from-gray-50 to-gray-100 p-1 h-auto overflow-x-auto",children:[e.jsxs(ws,{value:"users",className:"flex items-center gap-3 px-6 py-4 font-medium data-[state=active]:bg-white data-[state=active]:shadow-md data-[state=active]:text-blue-600 transition-all duration-200 hover:bg-white/50 rounded-xl whitespace-nowrap",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 data-[state=active]:bg-blue-600 transition-colors duration-200",children:e.jsx(Ts,{className:"h-5 w-5 data-[state=active]:text-white text-blue-600"})}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Users"}),e.jsx("span",{className:"text-xs text-gray-500",children:t.length})]})]}),e.jsxs(ws,{value:"farmers",className:"flex items-center gap-3 px-6 py-4 font-medium data-[state=active]:bg-white data-[state=active]:shadow-md data-[state=active]:text-green-600 transition-all duration-200 hover:bg-white/50 rounded-xl whitespace-nowrap",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 data-[state=active]:bg-green-600 transition-colors duration-200",children:e.jsx(tt,{className:"h-5 w-5 data-[state=active]:text-white text-green-600"})}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Farmers"}),e.jsx("span",{className:"text-xs text-gray-500",children:f.length})]})]}),e.jsxs(ws,{value:"storage",className:"flex items-center gap-3 px-6 py-4 font-medium data-[state=active]:bg-white data-[state=active]:shadow-md data-[state=active]:text-purple-600 transition-all duration-200 hover:bg-white/50 rounded-xl whitespace-nowrap",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100 data-[state=active]:bg-purple-600 transition-colors duration-200",children:e.jsx(Fs,{className:"h-5 w-5 data-[state=active]:text-white text-purple-600"})}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Storage"}),e.jsx("span",{className:"text-xs text-gray-500",children:S.length})]})]}),e.jsxs(ws,{value:"roles",className:"flex items-center gap-3 px-6 py-4 font-medium data-[state=active]:bg-white data-[state=active]:shadow-md data-[state=active]:text-orange-600 transition-all duration-200 hover:bg-white/50 rounded-xl whitespace-nowrap",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-100 data-[state=active]:bg-orange-600 transition-colors duration-200",children:e.jsx(xs,{className:"h-5 w-5 data-[state=active]:text-white text-orange-600"})}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Roles"}),e.jsx("span",{className:"text-xs text-gray-500",children:r.length})]})]}),e.jsxs(ws,{value:"frontend",className:"flex items-center gap-3 px-6 py-4 font-medium data-[state=active]:bg-white data-[state=active]:shadow-md data-[state=active]:text-indigo-600 transition-all duration-200 hover:bg-white/50 rounded-xl whitespace-nowrap",children:[e.jsx("div",{className:"p-2 rounded-lg bg-indigo-100 data-[state=active]:bg-indigo-600 transition-colors duration-200",children:e.jsx(rs,{className:"h-5 w-5 data-[state=active]:text-white text-indigo-600"})}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Public View"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Config"})]})]}),e.jsxs(ws,{value:"audit",className:"flex items-center gap-3 px-6 py-4 font-medium data-[state=active]:bg-white data-[state=active]:shadow-md data-[state=active]:text-red-600 transition-all duration-200 hover:bg-white/50 rounded-xl whitespace-nowrap",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 data-[state=active]:bg-red-600 transition-colors duration-200",children:e.jsx(yt,{className:"h-5 w-5 data-[state=active]:text-white text-red-600"})}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Audit Logs"}),e.jsx("span",{className:"text-xs text-gray-500",children:d.length})]})]}),e.jsxs(ws,{value:"outlets",className:"flex items-center gap-3 px-6 py-4 font-medium data-[state=active]:bg-white data-[state=active]:shadow-md data-[state=active]:text-purple-600 transition-all duration-200 hover:bg-white/50 rounded-xl whitespace-nowrap",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100 data-[state=active]:bg-purple-600 transition-colors duration-200",children:e.jsx(As,{className:"h-5 w-5 data-[state=active]:text-white text-purple-600"})}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Outlets"}),e.jsx("span",{className:"text-xs text-gray-500",children:V.length})]})]})]})}),e.jsx(Ss,{value:"users",className:"space-y-6",children:e.jsxs(U,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[e.jsx(Fe,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-blue-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:e.jsx(Ts,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs(Pe,{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:["User Management",e.jsxs(se,{variant:"secondary",className:"bg-blue-100 text-blue-700 border-blue-200",children:[ca.length," Active"]})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage system users and their permissions"})]})]}),e.jsxs(k,{onClick:()=>{je(null),ge({email:"",first_name:"",last_name:"",role:"",phone:"",is_active:!0,password:"",confirm_password:""}),xe({isValid:!0,message:""}),Re({isValid:!0,message:""}),oe({isValid:!0,message:""}),z(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white shadow-lg hover:shadow-xl transition-all duration-200",children:[e.jsx(Cs,{className:"h-4 w-4 mr-2"}),"Add User"]})]})}),e.jsxs(H,{className:"p-6",children:[e.jsx("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(mt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Se,{placeholder:"Search users by name or email...",value:A,onChange:i=>I(i.target.value),className:"pl-10 bg-white border-gray-200 focus:border-blue-500 focus:ring-blue-500/20"})]})}),e.jsxs(os,{value:P,onValueChange:be,children:[e.jsxs(ds,{className:"w-full sm:w-[200px] bg-white border-gray-200 focus:border-blue-500 focus:ring-blue-500/20",children:[e.jsx(wt,{className:"mr-2 h-4 w-4"}),e.jsx(cs,{placeholder:"Filter by role"})]}),e.jsxs(ms,{children:[e.jsx(_e,{value:"all",children:"All Roles"}),r.filter(i=>i.name&&i.name.trim()!=="").map(i=>e.jsx(_e,{value:i.name,children:i.display_name||i.name},i.id))]})]})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"mobile-table-container",children:e.jsxs(lt,{className:"mobile-table",children:[e.jsx(ot,{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:e.jsxs(Is,{className:"border-b border-gray-200",children:[e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"User"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Contact"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Role"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Status"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Last Login"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4 text-center",children:"Actions"})]})}),e.jsx(ct,{children:ca.map((i,$)=>e.jsxs(Is,{className:`hover:bg-blue-50/50 transition-colors duration-200 border-b border-gray-100 ${$%2===0?"bg-white":"bg-gray-50/30"}`,children:[e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center text-white font-semibold text-sm",children:[i.first_name.charAt(0),i.last_name.charAt(0)]}),e.jsx("div",{children:e.jsxs("div",{className:"font-semibold text-gray-900",children:[i.first_name," ",i.last_name]})})]})}),e.jsxs(Ve,{className:"py-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ja,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:i.email})]}),i.phone&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Et,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-500",children:i.phone})]})]}),e.jsx(Ve,{className:"py-4",children:e.jsx(se,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200 font-medium",children:i.role.replace("_"," ")})}),e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${i.is_active?"bg-green-500":"bg-gray-400"}`}),e.jsx(se,{variant:i.is_active?"default":"secondary",className:i.is_active?"bg-green-100 text-green-700 border-green-200":"",children:i.is_active?"Active":"Inactive"})]})}),e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:i.last_login?new Date(i.last_login).toLocaleDateString():"Never"})]})}),e.jsx(Ve,{className:"py-4",children:e.jsx("div",{className:"flex justify-center gap-2",children:e.jsx(k,{size:"sm",variant:"outline",className:"hover:bg-blue-50 hover:border-blue-300 hover:text-blue-700 transition-all duration-200",onClick:()=>{je(i),ge({email:i.email,first_name:i.first_name,last_name:i.last_name,role:i.role,phone:i.phone||"",is_active:i.is_active,password:"",confirm_password:""}),xe({isValid:!0,message:""}),Re({isValid:!0,message:""}),oe({isValid:!0,message:""}),z(!0)},children:e.jsx(nt,{className:"h-4 w-4"})})})})]},i.id))})]})})})]})]})}),e.jsx(Ss,{value:"farmers",className:"space-y-6",children:e.jsxs(U,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[e.jsx(Fe,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-b border-green-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-xl",children:e.jsx(tt,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsxs(Pe,{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:["Farmer Management",e.jsxs(se,{variant:"secondary",className:"bg-green-100 text-green-700 border-green-200",children:[f.length," Registered"]})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage farmer profiles and relationships"})]})]}),e.jsxs(k,{onClick:()=>q(!0),className:"bg-green-600 hover:bg-green-700 text-white shadow-lg hover:shadow-xl transition-all duration-200",children:[e.jsx(Cs,{className:"h-4 w-4 mr-2"}),"Add Farmer"]})]})}),e.jsx(H,{className:"p-6",children:e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"mobile-table-container",children:e.jsxs(lt,{className:"mobile-table",children:[e.jsx(ot,{className:"bg-gradient-to-r from-green-50 to-emerald-50",children:e.jsxs(Is,{className:"border-b border-green-100",children:[e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Farmer"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Contact"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Location"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Rating"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Reliability"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Status"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4 text-center",children:"Actions"})]})}),e.jsx(ct,{children:f.map((i,$)=>e.jsxs(Is,{className:`hover:bg-green-50/50 transition-colors duration-200 border-b border-gray-100 ${$%2===0?"bg-white":"bg-gray-50/30"}`,children:[e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center text-white font-semibold text-sm",children:i.name.charAt(0)}),e.jsx("div",{children:e.jsx("div",{className:"font-semibold text-gray-900",children:i.name})})]})}),e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Et,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:i.phone})]})}),e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ds,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:i.location})]})}),e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex",children:[...Array(5)].map((Oe,te)=>e.jsx("div",{className:`w-4 h-4 ${te<i.rating?"text-yellow-400":"text-gray-300"}`,children:"★"},te))}),e.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",i.rating,"/5)"]})]})}),e.jsx(Ve,{className:"py-4",children:e.jsx(se,{variant:"outline",className:`font-medium ${i.reliability==="excellent"?"bg-green-100 text-green-700 border-green-200":i.reliability==="good"?"bg-blue-100 text-blue-700 border-blue-200":i.reliability==="fair"?"bg-yellow-100 text-yellow-700 border-yellow-200":"bg-red-100 text-red-700 border-red-200"}`,children:i.reliability})}),e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${i.status==="active"?"bg-green-500":"bg-gray-400"}`}),e.jsx(se,{variant:i.status==="active"?"default":"secondary",className:i.status==="active"?"bg-green-100 text-green-700 border-green-200":"",children:i.status})]})}),e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(k,{size:"sm",variant:"outline",className:"hover:bg-green-50 hover:border-green-300 hover:text-green-700 transition-all duration-200",onClick:()=>{p(i),C({name:i.name,phone:i.phone,location:i.location,rating:i.rating,reliability:i.reliability,status:i.status}),q(!0)},children:e.jsx(nt,{className:"h-4 w-4"})}),e.jsx(k,{size:"sm",variant:"outline",className:"hover:bg-red-50 hover:border-red-300 hover:text-red-700 transition-all duration-200",onClick:()=>Ha(i.id),disabled:ke==="deleting-farmer",children:e.jsx(us,{className:"h-4 w-4"})})]})})]},i.id))})]})})})})]})}),e.jsx(Ss,{value:"storage",className:"space-y-6",children:e.jsxs(U,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[e.jsx(Fe,{className:"bg-gradient-to-r from-purple-50 to-violet-50 border-b border-purple-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-xl",children:e.jsx(Fs,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsxs(Pe,{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:["Storage Management",e.jsxs(se,{variant:"secondary",className:"bg-purple-100 text-purple-700 border-purple-200",children:[S.length," Locations"]})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Monitor storage capacity and conditions"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:hs,variant:"outline",className:"border-purple-200 text-purple-700 hover:bg-purple-50",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(k,{onClick:()=>fe(!0),className:"bg-purple-600 hover:bg-purple-700 text-white shadow-lg hover:shadow-xl transition-all duration-200",children:[e.jsx(Cs,{className:"h-4 w-4 mr-2"}),"Add Location"]})]})]})}),e.jsx(H,{className:"p-6",children:e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:S.map(i=>e.jsxs(U,{className:"hover:shadow-lg transition-all duration-200 border border-gray-200 bg-white",children:[e.jsx(Fe,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Pe,{className:"text-lg font-semibold text-gray-900",children:i.name}),e.jsx(se,{variant:i.status==="active"?"default":"secondary",className:i.status==="active"?"bg-green-100 text-green-700 border-green-200":"",children:i.status})]})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Type:"}),e.jsx("span",{className:"font-medium capitalize",children:i.location_type.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Capacity:"}),e.jsxs("span",{className:"font-medium",children:[i.current_usage_kg,"/",i.capacity_kg," kg"]})]}),i.temperature_celsius&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Temperature:"}),e.jsxs("span",{className:"font-medium",children:[i.temperature_celsius,"°C"]})]}),i.humidity_percent&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Humidity:"}),e.jsxs("span",{className:"font-medium",children:[i.humidity_percent,"%"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:[Math.round(i.current_usage_kg/i.capacity_kg*100),"% occupied"]}),e.jsx("div",{className:"pt-2 border-t border-gray-100",children:e.jsx(k,{size:"sm",variant:i.status==="active"?"destructive":"default",className:`w-full text-xs ${i.status==="active"?"bg-red-100 text-red-700 hover:bg-red-200 border-red-200":"bg-green-100 text-green-700 hover:bg-green-200 border-green-200"}`,onClick:()=>Ja(i.id,i.status),disabled:ke===`toggle-storage-${i.id}`,children:ke===`toggle-storage-${i.id}`?"Updating...":i.status==="active"?"Mark Inactive":"Mark Active"})})]})})]},i.id))})})]})}),e.jsxs(Ss,{value:"roles",className:"space-y-6",children:[e.jsxs(U,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[e.jsx(Fe,{className:"bg-gradient-to-r from-orange-50 to-amber-50 border-b border-orange-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-orange-100 rounded-xl",children:e.jsx(xs,{className:"h-6 w-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsxs(Pe,{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:["Role Management",e.jsxs(se,{variant:"secondary",className:"bg-orange-100 text-orange-700 border-orange-200",children:[r.length," Roles"]})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Define user roles and permissions"})]})]}),e.jsxs(k,{onClick:()=>G(!0),className:"bg-orange-600 hover:bg-orange-700 text-white shadow-lg hover:shadow-xl transition-all duration-200",children:[e.jsx(Cs,{className:"h-4 w-4 mr-2"}),"Add Role"]})]})}),e.jsx(H,{className:"p-6",children:e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:r.map(i=>{const $=er(i.icon);return e.jsxs(U,{className:"hover:shadow-lg transition-all duration-200 border border-gray-200 bg-white",children:[e.jsx(Fe,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(se,{className:`${i.color} px-3 py-1 font-medium`,children:[e.jsx($,{className:"w-4 h-4 mr-2"}),i.display_name]}),e.jsx("div",{className:"flex gap-1",children:e.jsx(k,{size:"sm",variant:"outline",className:"hover:bg-orange-50 hover:border-orange-300 hover:text-orange-700 transition-all duration-200",onClick:()=>{N(i),ne({name:i.name,display_name:i.display_name,description:i.description,permissions:Array.isArray(i.permissions)?i.permissions:typeof i.permissions=="string"?JSON.parse(i.permissions):[],icon:i.icon,color:i.color,is_active:i.is_active}),G(!0)},children:e.jsx(nt,{className:"h-4 w-4"})})})]})}),e.jsxs(H,{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:i.description}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500",children:"Permissions:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[Array.isArray(i.permissions)&&i.permissions.slice(0,3).map((Oe,te)=>e.jsx(se,{variant:"secondary",className:"text-xs bg-gray-100 text-gray-700",children:Oe},te)),Array.isArray(i.permissions)&&i.permissions.length>3&&e.jsxs(se,{variant:"secondary",className:"text-xs bg-gray-100 text-gray-700",children:["+",i.permissions.length-3," more"]})]})]})]})]},i.id)})})})]}),ce&&e.jsxs(U,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[e.jsx(Fe,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-b border-green-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-xl",children:e.jsx(xs,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsxs(Pe,{className:"text-2xl font-bold text-gray-900",children:["Permissions for: ",ce.display_name]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"View permissions assigned to this role"})]})]})}),e.jsx(H,{className:"p-6",children:e.jsx(Ln,{className:"border-0 shadow-none bg-transparent"})})]})]}),e.jsx(Ss,{value:"frontend",className:"space-y-6",children:e.jsxs(U,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[e.jsx(Fe,{className:"bg-gradient-to-r from-indigo-50 to-blue-50 border-b border-indigo-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-indigo-100 rounded-xl",children:e.jsx(rs,{className:"h-6 w-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx(Pe,{className:"text-2xl font-bold text-gray-900",children:"Public View Configuration"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure public-facing settings and appearance"})]})]})}),e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(js,{className:"border-indigo-200 bg-indigo-50",children:[e.jsx(di,{className:"h-4 w-4 text-indigo-600"}),e.jsx(ys,{className:"text-indigo-800",children:"Configure public-facing settings and frontend appearance."})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"site_name",className:"text-sm font-medium text-gray-700",children:"Site Name"}),e.jsx(Se,{id:"site_name",placeholder:"Rio Fish Management",className:"mt-1 border-gray-200 focus:border-indigo-500 focus:ring-indigo-500/20"})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"site_description",className:"text-sm font-medium text-gray-700",children:"Site Description"}),e.jsx(Ms,{id:"site_description",placeholder:"Professional fish management system",className:"mt-1 border-gray-200 focus:border-indigo-500 focus:ring-indigo-500/20"})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"contact_email",className:"text-sm font-medium text-gray-700",children:"Contact Email"}),e.jsx(Se,{id:"contact_email",type:"email",placeholder:"contact@riofish.com",className:"mt-1 border-gray-200 focus:border-indigo-500 focus:ring-indigo-500/20"})]})]}),e.jsx(k,{className:"bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg hover:shadow-xl transition-all duration-200",children:"Save Configuration"})]})})]})}),e.jsx(Ss,{value:"audit",className:"space-y-6",children:e.jsxs(U,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[e.jsx(Fe,{className:"bg-gradient-to-r from-red-50 to-pink-50 border-b border-red-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-red-100 rounded-xl",children:e.jsx(yt,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{children:[e.jsxs(Pe,{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:["Audit Logs",e.jsxs(se,{variant:"secondary",className:"bg-red-100 text-red-700 border-red-200",children:[d.length," Entries"]})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Monitor system activity and user actions"})]})]})}),e.jsx(H,{className:"p-6",children:e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"mobile-table-container",children:e.jsxs(lt,{className:"mobile-table",children:[e.jsx(ot,{className:"bg-gradient-to-r from-red-50 to-pink-50",children:e.jsxs(Is,{className:"border-b border-red-100",children:[e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Activity"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"User"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Details"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Date & Time"})]})}),e.jsx(ct,{children:d.map((i,$)=>e.jsxs(Is,{className:`hover:bg-red-50/50 transition-colors duration-200 border-b border-gray-100 ${$%2===0?"bg-white":"bg-gray-50/30"}`,children:[e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold text-sm",children:e.jsx(yt,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-900 font-medium",children:ss(i)}),e.jsxs("p",{className:"text-sm text-gray-500",children:[i.table_name," • ",i.action]})]})]})}),e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-green-500 to-teal-600 rounded-full flex items-center justify-center text-white font-semibold text-xs",children:i.user?i.user.first_name.charAt(0):"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-900 font-medium",children:i.user?`${i.user.first_name} ${i.user.last_name}`:"Unknown User"}),e.jsx("p",{className:"text-sm text-gray-500",children:i.user?.email||"No email"})]})]})}),e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"space-y-1",children:[Ke(i).map((Oe,te)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-600",children:Oe})]},te)),Ke(i).length===0&&e.jsx("span",{className:"text-sm text-gray-400 italic",children:"No additional details"})]})}),e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-gray-900 font-medium",children:new Date(i.created_at).toLocaleDateString()}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(i.created_at).toLocaleTimeString()})]})})]},i.id))})]})})})})]})}),e.jsx(Ss,{value:"outlets",className:"space-y-6",children:e.jsxs(U,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[e.jsx(Fe,{className:"bg-gradient-to-r from-purple-50 to-indigo-50 border-b border-purple-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-xl",children:e.jsx(As,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsxs(Pe,{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:["Outlet Management",e.jsxs(se,{variant:"secondary",className:"bg-purple-100 text-purple-700 border-purple-200",children:[V.length," Outlets"]})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage retail outlets and distribution partners"})]})]}),e.jsxs(k,{onClick:()=>y(!0),className:"bg-purple-600 hover:bg-purple-700 text-white shadow-lg hover:shadow-xl transition-all duration-200",children:[e.jsx(Cs,{className:"h-4 w-4 mr-2"}),"Add Outlet"]})]})}),e.jsx(H,{className:"p-6",children:e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:e.jsxs(lt,{children:[e.jsx(ot,{className:"bg-gradient-to-r from-purple-50 to-indigo-50",children:e.jsxs(Is,{className:"border-b border-purple-100",children:[e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Outlet Name"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Location"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Contact"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Status"}),e.jsx(Ue,{className:"font-semibold text-gray-700 py-4",children:"Actions"})]})}),e.jsx(ct,{children:V.map((i,$)=>e.jsxs(Is,{className:`hover:bg-purple-50/50 transition-colors duration-200 border-b border-gray-100 ${$%2===0?"bg-white":"bg-gray-50/30"}`,children:[e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex items-center justify-center text-white font-semibold",children:i.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:i.name}),i.manager_name&&e.jsx("div",{className:"text-sm text-gray-500",children:i.manager_name})]})]})}),e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ds,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:i.location})]})}),e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Et,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:i.phone})]})}),e.jsx(Ve,{className:"py-4",children:e.jsx(se,{className:`${i.status==="active"?"bg-green-100 text-green-800 border-green-200":i.status==="inactive"?"bg-gray-100 text-gray-800 border-gray-200":"bg-red-100 text-red-800 border-red-200"}`,children:i.status.charAt(0).toUpperCase()+i.status.slice(1)})}),e.jsx(Ve,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{size:"sm",variant:"outline",onClick:()=>{E(i),me({name:i.name,location:i.location,phone:i.phone,manager_name:i.manager_name||"",status:i.status}),y(!0)},className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:e.jsx(nt,{className:"h-4 w-4"})}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>Xa(i.id),className:"border-red-200 text-red-700 hover:bg-red-50",children:e.jsx(us,{className:"h-4 w-4"})})]})})]},i.id))})]})})})]})})]}),e.jsx(Xe,{open:K,onOpenChange:z,children:e.jsxs(Ye,{className:"max-w-2xl",children:[e.jsxs(es,{children:[e.jsx(Je,{className:"text-xl font-semibold text-gray-900",children:L?"Edit User":"Add New User"}),e.jsx(vs,{className:"text-gray-600",children:L?"Update user information":"Create a new user account with a secure password"})]}),e.jsxs("form",{onSubmit:i=>{i.preventDefault(),Ga()},className:"space-y-6",children:[!L&&e.jsxs(js,{className:"border-blue-200 bg-blue-50",children:[e.jsx(Pa,{className:"h-4 w-4 text-blue-600"}),e.jsx(ys,{className:"text-blue-800",children:"Password must be at least 6 characters long. The user will use this password to log in."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"first_name",className:"text-sm font-medium text-gray-700",children:"First Name *"}),e.jsx(Se,{id:"first_name",value:he.first_name,onChange:i=>ge({...he,first_name:i.target.value}),required:!0,className:"w-full",placeholder:"Enter first name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"last_name",className:"text-sm font-medium text-gray-700",children:"Last Name *"}),e.jsx(Se,{id:"last_name",value:he.last_name,onChange:i=>ge({...he,last_name:i.target.value}),required:!0,className:"w-full",placeholder:"Enter last name"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"email",className:"text-sm font-medium text-gray-700",children:"Email Address *"}),e.jsx(Se,{id:"email",type:"email",value:he.email,onChange:i=>{ge({...he,email:i.target.value}),We(i.target.value)},required:!0,className:`w-full ${w.isValid?w.message==="Email is available"?"border-green-300 focus:border-green-500":"":"border-red-300 focus:border-red-500"}`,placeholder:"user@example.com"}),w.message&&e.jsx("p",{className:`text-xs ${w.isValid?"text-green-600":"text-red-600"}`,children:w.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"role",className:"text-sm font-medium text-gray-700",children:"Role *"}),e.jsxs(os,{value:he.role,onValueChange:i=>ge({...he,role:i}),children:[e.jsx(ds,{className:"w-full",children:e.jsx(cs,{placeholder:"Select a role"})}),e.jsx(ms,{children:r.filter(i=>i.name&&i.name.trim()!=="").map(i=>e.jsx(_e,{value:i.name,children:i.display_name||i.name},i.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"phone",className:"text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsx(Se,{id:"phone",value:he.phone,onChange:i=>{ge({...he,phone:i.target.value}),as(i.target.value)},className:`w-full ${de.isValid?de.message==="Phone number is available"?"border-green-300 focus:border-green-500":"":"border-red-300 focus:border-red-500"}`,placeholder:"+254 700 000 000"}),de.message&&e.jsx("p",{className:`text-xs ${de.isValid?"text-green-600":"text-red-600"}`,children:de.message})]}),!L&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"password",className:"text-sm font-medium text-gray-700",children:"Password *"}),e.jsx(Se,{id:"password",type:"password",value:he.password,onChange:i=>{ge({...he,password:i.target.value}),is(i.target.value)},required:!0,className:`w-full ${$e.isValid?$e.message==="Password is available"?"border-green-300 focus:border-green-500":"":"border-red-300 focus:border-red-500"}`,placeholder:"Enter a secure password"}),$e.message&&e.jsx("p",{className:`text-xs ${$e.isValid?"text-green-600":"text-red-600"}`,children:$e.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"confirm_password",className:"text-sm font-medium text-gray-700",children:"Confirm Password *"}),e.jsx(Se,{id:"confirm_password",type:"password",value:he.confirm_password,onChange:i=>ge({...he,confirm_password:i.target.value}),required:!0,className:`w-full ${he.confirm_password&&he.password!==he.confirm_password?"border-red-300 focus:border-red-500":he.confirm_password&&he.password===he.confirm_password?"border-green-300 focus:border-green-500":""}`,placeholder:"Confirm the password"}),he.confirm_password&&e.jsx("p",{className:`text-xs ${he.password===he.confirm_password?"text-green-600":"text-red-600"}`,children:he.password===he.confirm_password?"Passwords match":"Passwords do not match"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 pt-2",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:he.is_active,onChange:i=>ge({...he,is_active:i.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx(B,{htmlFor:"is_active",className:"text-sm font-medium text-gray-700",children:"User is active"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>z(!1),className:"px-6",children:"Cancel"}),e.jsx(k,{type:"submit",disabled:ke==="saving-user",className:"px-6 bg-blue-600 hover:bg-blue-700",children:ke==="saving-user"?"Saving...":L?"Update User":"Create User"})]})]})]})}),e.jsx(Xe,{open:W,onOpenChange:i=>{G(i),i||ls({})},children:e.jsxs(Ye,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(es,{className:"pb-6 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-sm",children:e.jsx(xs,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(Je,{className:"text-xl font-semibold text-gray-900",children:ce?"Edit Role":"Create New Role"}),e.jsx(vs,{className:"text-gray-600 mt-1",children:ce?"Update role information and permissions":"Define a new role with specific permissions and access levels"})]})]})}),e.jsxs("form",{onSubmit:i=>{i.preventDefault(),Ka()},className:"flex flex-col flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto pr-2 space-y-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(B,{htmlFor:"name",className:"text-sm font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Role Name *"]}),e.jsx(Se,{id:"name",value:_.name,onChange:i=>{ne({..._,name:i.target.value}),Le.name&&ls({...Le,name:""})},className:`transition-all duration-200 ${Le.name?"border-red-400 focus:border-red-500 focus:ring-red-500/20 bg-red-50":"border-gray-200 focus:border-blue-500 focus:ring-blue-500/20 hover:border-gray-300"} ${ce?"bg-gray-50 cursor-not-allowed":""}`,placeholder:"e.g., warehouse_manager",maxLength:50,required:!0,disabled:!!ce}),Le.name&&e.jsxs("p",{className:"text-red-600 text-xs flex items-center gap-1.5 font-medium",children:[e.jsx(Qe,{className:"h-3 w-3"}),Le.name]}),e.jsx("p",{className:"text-xs text-gray-500 bg-gray-50 px-2 py-1 rounded",children:ce?"Role name cannot be changed after creation":"Internal identifier (lowercase, no spaces)"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(B,{htmlFor:"display_name",className:"text-sm font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Display Name *"]}),e.jsx(Se,{id:"display_name",value:_.display_name,onChange:i=>{ne({..._,display_name:i.target.value}),Le.display_name&&ls({...Le,display_name:""})},className:`transition-all duration-200 ${Le.display_name?"border-red-400 focus:border-red-500 focus:ring-red-500/20 bg-red-50":"border-gray-200 focus:border-blue-500 focus:ring-blue-500/20 hover:border-gray-300"} ${ce?"bg-gray-50 cursor-not-allowed":""}`,placeholder:"e.g., Warehouse Manager",maxLength:100,required:!0,disabled:!!ce}),Le.display_name&&e.jsxs("p",{className:"text-red-600 text-xs flex items-center gap-1.5 font-medium",children:[e.jsx(Qe,{className:"h-3 w-3"}),Le.display_name]}),e.jsx("p",{className:"text-xs text-gray-500 bg-gray-50 px-2 py-1 rounded",children:ce?"Display name cannot be changed after creation":"User-friendly name shown in the interface"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(B,{htmlFor:"description",className:"text-sm font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),"Description"]}),e.jsx(Ms,{id:"description",value:_.description,onChange:i=>{ne({..._,description:i.target.value}),Le.description&&ls({...Le,description:""})},className:`transition-all duration-200 resize-none ${Le.description?"border-red-400 focus:border-red-500 focus:ring-red-500/20 bg-red-50":"border-gray-200 focus:border-blue-500 focus:ring-blue-500/20 hover:border-gray-300"}`,placeholder:"Describe the role's responsibilities and scope...",maxLength:500,rows:3}),Le.description&&e.jsxs("p",{className:"text-red-600 text-xs flex items-center gap-1.5 font-medium",children:[e.jsx(Qe,{className:"h-3 w-3"}),Le.description]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-xs text-gray-500 bg-gray-50 px-2 py-1 rounded",children:"Optional description of the role's purpose"}),e.jsxs("span",{className:`text-xs px-2 py-1 rounded ${_.description.length>450?"text-orange-600 bg-orange-50":"text-gray-500 bg-gray-50"}`,children:[_.description.length,"/500"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 p-5 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl border border-gray-200 hover:shadow-sm transition-all duration-200",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:_.is_active,onChange:i=>ne({..._,is_active:i.target.checked}),className:"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded transition-all duration-200"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(B,{htmlFor:"is_active",className:"text-sm font-semibold text-gray-800 cursor-pointer",children:"Active Role"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Inactive roles cannot be assigned to users"})]}),e.jsx("div",{className:`p-2 rounded-full transition-all duration-200 ${_.is_active?"bg-green-100 shadow-sm":"bg-gray-200"}`,children:_.is_active?e.jsx(qe,{className:"h-5 w-5 text-green-600"}):e.jsx(_t,{className:"h-5 w-5 text-gray-400"})})]})]}),_.is_active&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(B,{htmlFor:"permissions",className:"text-sm font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Select Permissions *"]}),e.jsx("div",{className:`border-2 rounded-xl p-5 transition-all duration-200 ${Le.permissions?"border-red-300 bg-red-50":"border-gray-200 bg-white hover:border-gray-300 hover:shadow-sm"}`,children:e.jsx("div",{className:"min-h-[60px] flex items-center",children:e.jsx($n,{selectedPermissions:_.permissions,onPermissionsChange:i=>{ne({..._,permissions:i}),Le.permissions&&ls({...Le,permissions:""})},className:"w-full"})})}),Le.permissions?e.jsxs("p",{className:"text-red-600 text-xs flex items-center gap-1.5 font-medium",children:[e.jsx(Qe,{className:"h-3 w-3"}),Le.permissions]}):e.jsx("p",{className:"text-xs text-gray-500 bg-gray-50 px-2 py-1 rounded",children:'Choose the specific permissions this role should have. Use "All Permissions" for full admin access.'})]}),Array.isArray(_.permissions)&&_.permissions.length>0&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 rounded-lg",children:e.jsx(xs,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("span",{className:"text-sm font-semibold text-blue-900",children:["Selected Permissions (",(Array.isArray(_.permissions)?_.permissions:[]).length,")"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(Array.isArray(_.permissions)?_.permissions:[]).slice(0,8).map(i=>e.jsx(se,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-800 border border-blue-200 hover:bg-blue-200 transition-colors duration-200",children:i},i)),(Array.isArray(_.permissions)?_.permissions:[]).length>8&&e.jsxs(se,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-800 border border-blue-200",children:["+",(Array.isArray(_.permissions)?_.permissions:[]).length-8," more"]})]})]})]}),!_.is_active&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-6 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[e.jsx(_t,{className:"h-6 w-6 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Role is Inactive"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Permissions are not available for inactive roles. Enable the role to configure permissions."})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 pt-6 border-t border-gray-200 flex-shrink-0",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>{G(!1),ls({})},className:"px-6 hover:bg-gray-50 transition-colors duration-200",children:"Cancel"}),e.jsx(k,{type:"submit",disabled:ke==="saving-role",className:"px-6 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white shadow-sm hover:shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:ke==="saving-role"?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xs,{className:"h-4 w-4 mr-2"}),ce?"Update Role":"Create Role"]})})]})]})]})}),e.jsx(Xe,{open:Y,onOpenChange:q,children:e.jsxs(Ye,{className:"max-w-2xl",children:[e.jsxs(es,{children:[e.jsx(Je,{children:F?"Edit Farmer":"Add New Farmer"}),e.jsx(vs,{children:F?"Update farmer information":"Add a new farmer to the system"})]}),e.jsxs("form",{onSubmit:i=>{i.preventDefault(),Qa()},children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"name",children:"Name"}),e.jsx(Se,{id:"name",value:o.name,onChange:i=>C({...o,name:i.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"phone",children:"Phone"}),e.jsx(Se,{id:"phone",value:o.phone,onChange:i=>C({...o,phone:i.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"location",children:"Location"}),e.jsx(Se,{id:"location",value:o.location,onChange:i=>C({...o,location:i.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"rating",children:"Rating (0-5)"}),e.jsx(Se,{id:"rating",type:"number",min:"0",max:"5",value:o.rating,onChange:i=>C({...o,rating:parseInt(i.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"reliability",children:"Reliability"}),e.jsxs(os,{value:o.reliability,onValueChange:i=>C({...o,reliability:i}),children:[e.jsx(ds,{children:e.jsx(cs,{})}),e.jsxs(ms,{children:[e.jsx(_e,{value:"excellent",children:"Excellent"}),e.jsx(_e,{value:"good",children:"Good"}),e.jsx(_e,{value:"fair",children:"Fair"}),e.jsx(_e,{value:"poor",children:"Poor"})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>q(!1),children:"Cancel"}),e.jsx(k,{type:"submit",disabled:ke==="saving-farmer",children:ke==="saving-farmer"?"Saving...":F?"Update":"Create"})]})]})]})}),e.jsx(Xe,{open:J,onOpenChange:h,children:e.jsxs(Ye,{className:"max-w-2xl",children:[e.jsxs(es,{children:[e.jsxs(Je,{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(ja,{className:"h-5 w-5 text-blue-600"}),"Email Configuration"]}),e.jsx(vs,{children:"Configure email settings for notifications and communications"})]}),e.jsxs("form",{onSubmit:i=>{i.preventDefault()},children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"provider",className:"text-sm font-medium text-gray-700",children:"Email Provider"}),e.jsxs(os,{value:v.provider,onValueChange:i=>b({...v,provider:i}),children:[e.jsx(ds,{className:"mt-1",children:e.jsx(cs,{})}),e.jsxs(ms,{children:[e.jsx(_e,{value:"sendgrid",children:"SendGrid"}),e.jsx(_e,{value:"ses",children:"AWS SES"}),e.jsx(_e,{value:"smtp",children:"SMTP"}),e.jsx(_e,{value:"resend",children:"Resend"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"from_email",className:"text-sm font-medium text-gray-700",children:"From Email"}),e.jsx(Se,{id:"from_email",type:"email",value:v.from_email,onChange:i=>b({...v,from_email:i.target.value}),className:"mt-1",placeholder:"noreply@riofish.com",required:!0})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"from_name",className:"text-sm font-medium text-gray-700",children:"From Name"}),e.jsx(Se,{id:"from_name",value:v.from_name,onChange:i=>b({...v,from_name:i.target.value}),className:"mt-1",placeholder:"Rio Fish Management",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"api_key",className:"text-sm font-medium text-gray-700",children:"API Key *"}),e.jsx(Se,{id:"api_key",name:"api_key",type:"password",autoComplete:"off",value:v.api_key,onChange:i=>b({...v,api_key:i.target.value}),className:"mt-1",disabled:ke==="saving-email-config",placeholder:"Your email service API key",required:!0})]}),v.provider==="smtp"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"smtp_host",className:"text-sm font-medium text-gray-700",children:"SMTP Host"}),e.jsx(Se,{id:"smtp_host",value:v.smtp_host||"",onChange:i=>b({...v,smtp_host:i.target.value}),className:"mt-1",placeholder:"smtp.gmail.com"})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"smtp_port",className:"text-sm font-medium text-gray-700",children:"SMTP Port"}),e.jsx(Se,{id:"smtp_port",type:"number",value:v.smtp_port||"",onChange:i=>b({...v,smtp_port:parseInt(i.target.value)||587}),className:"mt-1",placeholder:"587"})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"smtp_username",className:"text-sm font-medium text-gray-700",children:"SMTP Username"}),e.jsx(Se,{id:"smtp_username",value:v.smtp_username||"",onChange:i=>b({...v,smtp_username:i.target.value}),className:"mt-1",placeholder:"your-email@gmail.com"})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"smtp_pass",className:"text-sm font-medium text-gray-700",children:"SMTP Password"}),e.jsx(Se,{id:"smtp_pass",name:"smtp_pass",type:"password",autoComplete:"off",value:v.smtp_pass||"",onChange:i=>b({...v,smtp_pass:i.target.value}),className:"mt-1",disabled:ke==="saving-email-config",placeholder:"your-app-password"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsx(k,{type:"submit",disabled:ke==="saving-email-config",children:ke==="saving-email-config"?"Saving...":"Save Configuration"})]})]})]})}),e.jsx(Xe,{open:De,onOpenChange:fe,children:e.jsxs(Ye,{className:"max-w-2xl",children:[e.jsxs(es,{children:[e.jsxs(Je,{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Fs,{className:"h-5 w-5 text-purple-600"}),"Add New Storage Location"]}),e.jsx(vs,{children:"Create a new storage location for fish processing and storage"})]}),e.jsxs("form",{onSubmit:i=>{i.preventDefault(),Ya()},children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"storage_name",className:"text-sm font-medium text-gray-700",children:"Location Name *"}),e.jsx(Se,{id:"storage_name",value:Q.name,onChange:i=>ue({...Q,name:i.target.value}),className:"mt-1 border-gray-200 focus:border-purple-500 focus:ring-purple-500/20",placeholder:"e.g., Cold Storage A",required:!0})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"storage_type",className:"text-sm font-medium text-gray-700",children:"Location Type *"}),e.jsxs(os,{value:Q.location_type,onValueChange:i=>ue({...Q,location_type:i}),children:[e.jsx(ds,{className:"mt-1 border-gray-200 focus:border-purple-500 focus:ring-purple-500/20",children:e.jsx(cs,{})}),e.jsxs(ms,{children:[e.jsx(_e,{value:"cold_storage",children:"Cold Storage"}),e.jsx(_e,{value:"freezer",children:"Freezer"}),e.jsx(_e,{value:"ambient",children:"Ambient"}),e.jsx(_e,{value:"processing_area",children:"Processing Area"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"storage_description",className:"text-sm font-medium text-gray-700",children:"Description"}),e.jsx(Ms,{id:"storage_description",value:Q.description,onChange:i=>ue({...Q,description:i.target.value}),className:"mt-1 border-gray-200 focus:border-purple-500 focus:ring-purple-500/20",placeholder:"Brief description of this storage location"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"storage_capacity",className:"text-sm font-medium text-gray-700",children:"Capacity (kg) *"}),e.jsx(Se,{id:"storage_capacity",type:"number",min:"1",step:"0.01",value:Q.capacity_kg,onChange:i=>ue({...Q,capacity_kg:parseFloat(i.target.value)||0}),className:"mt-1 border-gray-200 focus:border-purple-500 focus:ring-purple-500/20",required:!0})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"storage_temperature",className:"text-sm font-medium text-gray-700",children:"Temperature (°C)"}),e.jsx(Se,{id:"storage_temperature",type:"number",step:"0.1",value:Q.temperature_celsius,onChange:i=>ue({...Q,temperature_celsius:parseFloat(i.target.value)||0}),className:"mt-1 border-gray-200 focus:border-purple-500 focus:ring-purple-500/20",placeholder:"4.0"})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"storage_humidity",className:"text-sm font-medium text-gray-700",children:"Humidity (%)"}),e.jsx(Se,{id:"storage_humidity",type:"number",min:"0",max:"100",step:"0.1",value:Q.humidity_percent,onChange:i=>ue({...Q,humidity_percent:parseFloat(i.target.value)||0}),className:"mt-1 border-gray-200 focus:border-purple-500 focus:ring-purple-500/20",placeholder:"85.0"})]})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"storage_status",className:"text-sm font-medium text-gray-700",children:"Status"}),e.jsxs(os,{value:Q.status,onValueChange:i=>ue({...Q,status:i}),children:[e.jsx(ds,{className:"mt-1 border-gray-200 focus:border-purple-500 focus:ring-purple-500/20",children:e.jsx(cs,{})}),e.jsxs(ms,{children:[e.jsx(_e,{value:"active",children:"Active"}),e.jsx(_e,{value:"maintenance",children:"Maintenance"}),e.jsx(_e,{value:"inactive",children:"Inactive"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>fe(!1),children:"Cancel"}),e.jsx(k,{type:"submit",disabled:ke==="saving-storage",className:"bg-purple-600 hover:bg-purple-700",children:ke==="saving-storage"?"Creating...":"Create Location"})]})]})]})}),e.jsx(Xe,{open:Me,onOpenChange:y,children:e.jsxs(Ye,{className:"max-w-2xl",children:[e.jsxs(es,{children:[e.jsxs(Je,{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(As,{className:"h-5 w-5 text-purple-600"}),D?"Edit Outlet":"Add New Outlet"]}),e.jsx(vs,{children:D?"Update outlet information":"Create a new retail outlet or distribution partner"})]}),e.jsxs("form",{onSubmit:i=>{i.preventDefault(),Za()},children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"outlet_name",children:"Outlet Name"}),e.jsx(Se,{id:"outlet_name",value:ve.name,onChange:i=>me({...ve,name:i.target.value}),placeholder:"e.g., Nakuru Fresh Fish Market",required:!0})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"outlet_location",children:"Location"}),e.jsx(Se,{id:"outlet_location",value:ve.location,onChange:i=>me({...ve,location:i.target.value}),placeholder:"e.g., Nakuru, Kenya",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"outlet_phone",children:"Phone Number"}),e.jsx(Se,{id:"outlet_phone",value:ve.phone,onChange:i=>me({...ve,phone:i.target.value}),placeholder:"e.g., +254722456789",required:!0})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"outlet_manager_name",children:"Manager Name (Optional)"}),e.jsx(Se,{id:"outlet_manager_name",value:ve.manager_name,onChange:i=>me({...ve,manager_name:i.target.value}),placeholder:"e.g., John Doe"})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"outlet_status",children:"Status"}),e.jsxs(os,{value:ve.status,onValueChange:i=>me({...ve,status:i}),children:[e.jsx(ds,{children:e.jsx(cs,{})}),e.jsxs(ms,{children:[e.jsx(_e,{value:"active",children:"Active"}),e.jsx(_e,{value:"inactive",children:"Inactive"}),e.jsx(_e,{value:"suspended",children:"Suspended"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsx(k,{type:"submit",disabled:ke==="saving-outlet",className:"bg-purple-600 hover:bg-purple-700",children:ke==="saving-outlet"?"Saving...":D?"Update Outlet":"Create Outlet"})]})]})]})})]})})}const Mn=Object.freeze(Object.defineProperty({__proto__:null,default:Wn},Symbol.toStringTag,{value:"Module"}));export{ps as _};
