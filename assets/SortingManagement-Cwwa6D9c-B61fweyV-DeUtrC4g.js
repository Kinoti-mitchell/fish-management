import{H as Ye,w as m,c as e,n as h,g as Ge,B as z,a as C,b as H,P as se,O as te,D as ze,W as Y,q as Je,d as Ke,l as re,S as w,_ as Qe,J as b,T as u}from"./index-D0a7Ul_G.js";import{T as Ce,_ as Xe,j as Ze,C as es,N as ss,P as ts}from"./select-DqWpyIkf-D_8tzK0d-BBn-WGEA.js";import{V as ie,_ as ae,H as ne,C as le,I as ce}from"./dialog-NtgNh5u1-2hJTriox-IAMkB2HC.js";import{v as rs}from"./textarea-TOFJikG_-C72QqR98-D5hWOVfE.js";import{O as G}from"./sortingService-Dsc9Jscx-3rLBSyzC-CgPYPR6-.js";import{W as is}from"./inventoryService-gXyYRUkQ-CaNYK-Tu-DXS6GM-l.js";import{generateUniqueBatchNumber as as}from"./entryCodeGenerator-B82PSXKH-CycamVnB-BX21HUcr.js";import{h as oe}from"./refresh-cw-BlPh9kri-DxVFEABi-aZB1kqTg.js";import{r as J}from"./circle-alert-DCgzIeFQ-JtILe7g3-BxoVeYrg.js";import{p as D}from"./circle-check-big-BZ9nasO6-BWVBSi9U-D_bzRs9E.js";import{t as De}from"./scale-Coap2kcd-Bsk2bCpZ-BAcJJTw5.js";import{a as de}from"./weight-CtEhXJRi-DcPJONPf-CLEOuACO.js";import{h as Pe}from"./calendar-CU6tj0PZ-Ucpt8Hnz-1IrCz7t9.js";import{a as Oe}from"./index-io8wS31O-C_L8DqSR-BTUohV_t.js";import{r as ns}from"./settings-sF8YfQqu-C8NtKH81-DK-zFTFh.js";import{p as ls}from"./square-pen-BXk3qRWQ-BrUlDIvM-BHIo8QnW.js";import"./index-B7iGXlpc-YR4igk-O-CmE8Ucvu.js";import"./index-CEgc-Zw--jggqibQ8-DNEgScq_.js";var cs=Object.defineProperty,os=Object.defineProperties,ds=Object.getOwnPropertyDescriptors,Fe=Object.getOwnPropertySymbols,ms=Object.prototype.hasOwnProperty,gs=Object.prototype.propertyIsEnumerable,$e=(l,o,d)=>o in l?cs(l,o,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[o]=d,K=(l,o)=>{for(var d in o||(o={}))ms.call(o,d)&&$e(l,d,o[d]);if(Fe)for(var d of Fe(o))gs.call(o,d)&&$e(l,d,o[d]);return l},me=(l,o)=>os(l,ds(o)),P=(l,o,d)=>new Promise((O,j)=>{var L=p=>{try{S(d.next(p))}catch(k){j(k)}},R=p=>{try{S(d.throw(p))}catch(k){j(k)}},S=p=>p.done?O(p.value):Promise.resolve(p.value).then(L,R);S((d=d.apply(l,o)).next())});function Te(l){return P(this,null,function*(){try{const{data:o,error:d}=yield l;if(d){if(d.message&&d.message.includes("406")){console.warn("406 error detected, trying alternative query approach");const{data:O,error:j}=yield b.from("sorting_batches").select("*").limit(1);return j?(console.error("Fallback query also failed:",j),{data:null,error:j}):(console.warn("Fallback query succeeded, original query structure may be problematic"),{data:null,error:new Error("Query structure incompatible with current RLS policies")})}return{data:o,error:d}}return{data:o,error:d}}catch(o){return console.error("Unexpected error in safeQuerySortingBatches:",o),{data:null,error:o}}})}function hs(l,o){if(console.error(`Supabase ${o} error:`,l),l&&typeof l=="object"){if(l.message&&l.message.includes("406"))return"Access denied. Please check your permissions or contact your administrator.";if(l.message&&l.message.includes("401"))return"Authentication required. Please log in again.";if(l.message&&l.message.includes("403"))return"Access forbidden. You do not have permission to perform this action.";if(l.message&&l.message.includes("JWT"))return"Authentication error. Please log in again.";if(l.message&&l.message.includes("relation")&&l.message.includes("does not exist"))return"Database table not found. Please contact your administrator.";if(l.message&&l.message.includes("permission denied"))return"Permission denied. Please check your user permissions.";if(l.message&&typeof l.message=="string")return l.message}return"An unexpected error occurred. Please try again."}const Fs=({onNavigate:l})=>{var o,d,O,j,L,R,S,p,k,ge,he;const{user:xe}=Ye(),[f,ue]=m.useState([]),[N,pe]=m.useState([]),[q,je]=m.useState([]),[Q,E]=m.useState([]),[Ie,be]=m.useState(!1),[fe,Ne]=m.useState(null),[_e,ve]=m.useState(!1),[X,Be]=m.useState(!1),[Z,Ae]=m.useState(!1),[ee,v]=m.useState(!1),[Le,U]=m.useState(!1),[Re,W]=m.useState(!1),[qe,M]=m.useState(!1),[n,ye]=m.useState(null),[r,we]=m.useState(null),[i,F]=m.useState({batch_number:"",size_distribution:{},total_weight_kg:0,remaining_weight_kg:0,notes:"",storage_location_id:""}),$=m.useCallback(()=>P(void 0,null,function*(){be(!0),Ne(null);try{console.log("ðŸ”„ Loading sorting data...");const[s,t,a]=yield Promise.all([G.getSizeClassThresholds(),G.getSortingBatches({status:"completed",limit:20}),G.getProcessingRecordsReadyForSorting()]);console.log("ðŸ“Š Data loaded:",{thresholds:s.length,batches:t.length,records:a.length}),je(s),pe(t),ue(a);try{const{data:c,error:x}=yield b.from("storage_locations").select("*").eq("status","active").order("name");x?(console.warn("Could not fetch storage locations:",x.message),E([{id:"default-1",name:"Cold Storage A",capacity_kg:1e3,current_usage_kg:0,location_type:"cold_storage"},{id:"default-2",name:"Cold Storage B",capacity_kg:1e3,current_usage_kg:0,location_type:"cold_storage"}])):(console.log("ðŸª Storage locations loaded:",(c==null?void 0:c.length)||0),E(c||[]))}catch(c){console.warn("Error fetching storage locations:",c),E([{id:"default-1",name:"Cold Storage A",capacity_kg:1e3,current_usage_kg:0,location_type:"cold_storage"},{id:"default-2",name:"Cold Storage B",capacity_kg:1e3,current_usage_kg:0,location_type:"cold_storage"}])}}catch(s){console.error("âŒ Error loading sorting data:",s),Ne("Failed to load sorting data. Please try again."),je([]),pe([]),ue([]),E([])}finally{be(!1)}}),[]);m.useEffect(()=>{$()},[$]);const Se=m.useCallback(()=>P(void 0,null,function*(){ve(!0),yield $(),ve(!1)}),[]),Ee=m.useMemo(()=>N.reduce((s,t)=>s+(t.total_weight_grams?t.total_weight_grams/1e3:0),0),[N]);m.useMemo(()=>f.reduce((s,t)=>s+(t.post_processing_weight||0),0),[f]);const Ue=s=>P(void 0,null,function*(){try{if(console.log("Starting sorting for record:",s.id),!xe){console.error("No user found in AuthContext"),u.error("Please log in to continue.");return}console.log("User authenticated via AuthContext:",xe.email);const t=b.from("sorting_batches").select("id, batch_number, status").eq("processing_record_id",s.id).eq("status","completed").maybeSingle(),{data:a,error:c}=yield Te(t);if(c){if(console.warn("Could not check for existing sorting batches:",c),c.message&&c.message.includes("406")){u.error("Access denied. Please check your permissions or contact your administrator.");return}if(c.message&&c.message.includes("relation")&&c.message.includes("does not exist")){u.error("Sorting functionality is not properly set up. Please contact your administrator.");return}console.warn("Continuing despite check error:",c.message)}if(a&&a.length>0){u.error(`This processing record has already been sorted! Batch: ${a[0].batch_number}`);return}ye(s);let x;try{x=yield as()}catch(_){console.warn("Error generating batch number, using fallback:",_),x=`Batch${Date.now().toString().slice(-6)}`}const y=s.post_processing_weight||0;F({batch_number:x,size_distribution:{},total_weight_kg:y,remaining_weight_kg:y,notes:"",storage_location_id:""}),U(!0)}catch(t){console.error("Error starting sorting:",t);const a=hs(t,"starting sorting");u.error(a)}}),We=(s,t)=>{const a=K({},i.size_distribution);t===0?delete a[s]:a[s]=t;const c=Object.values(a).reduce((y,_)=>y+_,0),x=i.total_weight_kg-c;F(me(K({},i),{size_distribution:a,remaining_weight_kg:x}))},Me=()=>P(void 0,null,function*(){try{if(!n||ee)return;if(v(!0),i.remaining_weight_kg!==0){u.error(`Please distribute all ${i.total_weight_kg}kg. ${i.remaining_weight_kg}kg remaining.`),v(!1);return}if(!i.storage_location_id){u.error("Please select a storage location"),v(!1);return}const s=b.from("sorting_batches").select("id, batch_number, status").eq("processing_record_id",n.id).eq("status","completed").maybeSingle(),{data:t,error:a}=yield Te(s);if(a&&(console.warn("Could not check for existing sorting batches:",a),a.message&&a.message.includes("406"))){u.error("Access denied. Please check your permissions or contact your administrator."),v(!1);return}if(t&&t.length>0){u.error(`This processing record has already been sorted! Batch: ${t[0].batch_number}`),v(!1);return}const{error:c}=yield b.from("processing_records").update({size_distribution:i.size_distribution,updated_at:new Date().toISOString()}).eq("id",n.id);if(c)throw console.error("Error updating processing record:",c),c;const x=Object.values(i.size_distribution).reduce((I,g)=>I+(Number(g)||0),0),y={processing_record_id:n.id,batch_number:i.batch_number,notes:i.notes,status:"completed",total_pieces:x,total_weight_grams:i.total_weight_kg*1e3,sorting_date:new Date().toISOString().split("T")[0],storage_location_id:i.storage_location_id,size_distribution:i.size_distribution};console.log("Creating batch with size distribution:",y.size_distribution);const{data:_,error:T}=yield b.from("sorting_batches").insert([y]).select("id").single();if(T){if(T.code==="23505"&&T.message.includes("sorting_batches_one_completed_per_processing_record")){u.error("This processing record has already been sorted! Please refresh the page to see the updated list."),yield $(),v(!1);return}throw console.error("Error creating sorting batch:",T),T}if(_){const I=Object.entries(i.size_distribution).map(([g,V])=>{const B=Number(V)||0,A=B>0?i.total_weight_kg*1e3/x:0,He=B*A;return{sorting_batch_id:_.id,storage_location_id:i.storage_location_id,size_class:parseInt(g),total_pieces:B,total_weight_grams:He,average_weight_grams:A,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}).filter(g=>g.total_pieces>0);if(I.length>0){const{error:g}=yield b.from("sorting_results").insert(I);if(g)throw console.error("Error creating sorting results:",g),g;console.log("Created sorting results:",I.length,"size classes")}try{const{data:g,error:V}=yield b.from("storage_locations").select("current_usage_kg").eq("id",i.storage_location_id).single();if(V)console.warn("Could not fetch current storage usage:",V);else{const B=(g.current_usage_kg||0)+i.total_weight_kg,{error:A}=yield b.from("storage_locations").update({current_usage_kg:B,updated_at:new Date().toISOString()}).eq("id",i.storage_location_id);A?console.warn("Could not update storage location capacity:",A):console.log("Updated storage location capacity:",i.storage_location_id)}}catch(g){console.warn("Error updating storage capacity:",g)}try{yield is.addStockFromSorting(_.id),console.log("Automatically added to inventory:",_.id)}catch(g){console.warn("Could not automatically add to inventory:",g),u.error("Sorting completed but failed to add to inventory. Please add manually from inventory management.")}}u.success("Fish sorted and batch created successfully!"),U(!1),ye(null),F({batch_number:"",size_distribution:{},total_weight_kg:0,remaining_weight_kg:0,notes:"",storage_location_id:""}),yield $()}catch(s){u.error("Failed to complete sorting"),console.error("Sorting error:",s)}finally{v(!1)}}),ke=()=>{W(!0)},Ve=s=>P(void 0,null,function*(){try{console.log("Viewing batch details:",s),console.log("Batch size distribution:",s.size_distribution);const t=yield G.getSortingBatch(s.id);console.log("Fresh batch data:",t),we(t),M(!0)}catch(t){console.error("Error fetching fresh batch data:",t),we(s),M(!0)}});return e.jsx("div",{className:"min-h-screen bg-gray-50 content-container",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 responsive-padding",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Sorting Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Sort fish into size classes and manage sorting operations"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(h,{variant:"outline",onClick:Se,disabled:_e,className:"flex items-center gap-2",children:[e.jsx(oe,{className:`w-4 h-4 ${_e?"animate-spin":""}`}),"Refresh"]}),e.jsxs(h,{onClick:()=>l("inventory"),className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Go to Inventory"]})]})]})}),fe&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-800",children:"Error Loading Data"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:fe}),e.jsx(h,{onClick:Se,variant:"outline",size:"sm",className:"mt-2",children:"Try Again"})]})]})}),!1,e.jsx("div",{className:"px-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(z,{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white",children:e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm font-medium",children:"Processing Records"}),e.jsx("p",{className:"text-3xl font-bold",children:f.length})]}),e.jsx(H,{className:"w-8 h-8 text-blue-200"})]})})}),e.jsx(z,{className:"bg-gradient-to-r from-green-500 to-green-600 text-white",children:e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-sm font-medium",children:"Total Sorted"}),e.jsxs("p",{className:"text-3xl font-bold",children:[Ee.toFixed(1),"kg"]}),e.jsxs("p",{className:"text-green-200 text-xs mt-1",children:[N.length," batches"]})]}),e.jsx(D,{className:"w-8 h-8 text-green-200"})]})})}),e.jsx(z,{className:"bg-gradient-to-r from-purple-500 to-purple-600 text-white",children:e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm font-medium",children:"Size Classes"}),e.jsx("p",{className:"text-3xl font-bold",children:q.length})]}),e.jsx(De,{className:"w-8 h-8 text-purple-200"})]})})})]})}),e.jsxs(z,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(se,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-b",children:e.jsxs(te,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(H,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xl font-semibold",children:"Processing Records Ready for Sorting"}),e.jsx("p",{className:"text-sm text-gray-600 font-normal mt-1",children:"Fish that have been processed and are ready to be sorted into size classes"})]})]})}),e.jsx(C,{className:"p-6",children:Ie?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(oe,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading processing records..."})]})}):f.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"p-4 bg-blue-50 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:e.jsx(H,{className:"w-10 h-10 text-blue-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Processing Records"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No fish have been processed yet"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-500",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx("span",{children:"Process fish first, then they'll appear here for sorting"})]}),!1]}):e.jsxs("div",{className:"space-y-4",children:[(Z?f:f.slice(0,3)).map(s=>e.jsx("div",{className:"group p-6 border border-gray-200 rounded-xl hover:border-blue-300 hover:shadow-md transition-all duration-200 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg group-hover:bg-blue-200 transition-colors",children:e.jsx(Y,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("h4",{className:"font-semibold text-gray-900",children:["Processing Record ",s.processing_code||s.id]})}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.post_processing_weight||s.total_weight||0,"kg"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.ready_for_dispatch_count||s.fish_count||0," fish"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:new Date(s.processing_date||s.processed_at).toLocaleDateString()})]})]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(h,{onClick:()=>Ue(s),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Sort Fish"]})})]})},s.id)),f.length>3&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(h,{variant:"outline",onClick:()=>Ae(!Z),className:"text-blue-600 border-blue-300 hover:bg-blue-50",children:Z?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"View All (",f.length," records)"]})})})]})})]}),e.jsxs(z,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(se,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-b",children:e.jsxs(te,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(D,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xl font-semibold",children:"Sorted Batches"}),e.jsx("p",{className:"text-sm text-gray-600 font-normal mt-1",children:"Completed sorting operations with size distribution"})]})]})}),e.jsx(C,{className:"p-6",children:N.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"p-4 bg-green-50 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:e.jsx(D,{className:"w-10 h-10 text-green-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Sorted Batches"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No fish have been sorted yet"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-500",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx("span",{children:"Sort fish from processing records above to create batches"})]}),!1]}):e.jsxs("div",{className:"space-y-4",children:[(X?N:N.slice(0,3)).map(s=>{var t,a,c;return e.jsx("div",{className:"group p-6 border border-gray-200 rounded-xl hover:border-green-300 hover:shadow-md transition-all duration-200 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg group-hover:bg-green-200 transition-colors",children:e.jsx(D,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("h4",{className:"font-semibold text-gray-900",children:["Sorted Batch #",s.batch_number||s.id.slice(-8).toUpperCase()]})}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsxs("span",{children:["Created: ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.total_weight_grams?(s.total_weight_grams/1e3).toFixed(1):0,"kg"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.total_pieces||0," pieces"]})]}),((t=s.processing_record)==null?void 0:t.fish_type)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{children:s.processing_record.fish_type})]})]}),((c=(a=s.processing_record)==null?void 0:a.warehouse_entry)==null?void 0:c.farmer)&&e.jsx("div",{className:"flex items-center gap-1 mt-2 text-xs text-gray-500",children:e.jsxs("span",{children:["Farmer: ",s.processing_record.warehouse_entry.farmer.name]})})]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(h,{size:"sm",onClick:()=>Ve(s),className:"bg-orange-600 hover:bg-orange-700 text-white shadow-lg font-medium",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"View Details"]})})]})},s.id)}),N.length>3&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(h,{variant:"outline",onClick:()=>Be(!X),className:"text-green-600 border-green-300 hover:bg-green-50",children:X?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"View All (",N.length," batches)"]})})})]})})]}),e.jsxs(z,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(se,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(te,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(De,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xl font-semibold",children:"Size Class Thresholds"}),e.jsx("p",{className:"text-sm text-gray-600 font-normal mt-1",children:"Configure weight ranges for each size class (0-10)"})]})]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:ke,children:[e.jsx(ns,{className:"w-4 h-4 mr-2"}),"Manage"]})]})}),e.jsxs(C,{className:"p-6",children:[q.length===0&&!1,e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:q.map(s=>e.jsxs("div",{className:"group p-4 border border-gray-200 rounded-xl hover:border-green-300 hover:shadow-md transition-all duration-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs(re,{variant:"outline",className:`w-16 justify-center font-semibold ${s.class_number<=2?"border-blue-200 text-blue-700 bg-blue-50":s.class_number<=5?"border-green-200 text-green-700 bg-green-50":s.class_number<=8?"border-orange-200 text-orange-700 bg-orange-50":"border-red-200 text-red-700 bg-red-50"}`,children:["Class ",s.class_number]}),e.jsx(h,{variant:"ghost",size:"sm",onClick:ke,children:e.jsx(ls,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.min_weight_grams,"g - ",s.max_weight_grams===999999.99?"âˆž":`${s.max_weight_grams}g`]})]})]})]},s.class_number))})]})]}),e.jsx(ie,{open:qe,onOpenChange:M,children:e.jsxs(ae,{className:"w-[95vw] max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ne,{children:e.jsx(le,{children:r?"Sorted Batch Details":"Sorting Details"})}),r?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 text-xs text-gray-600",children:[e.jsxs("span",{children:["Data refreshed: ",new Date().toLocaleTimeString()]}),e.jsxs("span",{children:["Batch ID: ",r.id.slice(-8).toUpperCase()]})]})}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-3",children:"Batch Information"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-blue-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Batch Number:"}),e.jsx("span",{className:"ml-2 font-mono text-xs",children:r.batch_number||r.id.slice(-8).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Code:"}),e.jsx("span",{className:"ml-2 font-mono text-xs",children:((o=r.processing_record)==null?void 0:o.processing_code)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx(re,{variant:"outline",className:"ml-2",children:r.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Weight:"}),e.jsxs("span",{className:"ml-2 text-green-600 font-semibold",children:[r.total_weight_grams?(r.total_weight_grams/1e3).toFixed(1):0,"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Pieces:"}),e.jsx("span",{className:"ml-2 text-green-600 font-semibold",children:r.total_pieces||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Created Date:"}),e.jsx("span",{className:"ml-2",children:new Date(r.created_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Sorting Date:"}),e.jsx("span",{className:"ml-2",children:new Date(r.sorting_date).toLocaleDateString()})]})]})]}),r.processing_record&&e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-purple-900 mb-3",children:"Processing Record Details"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-purple-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Record ID:"}),e.jsx("span",{className:"ml-2 font-mono text-xs",children:(d=r.processing_record.id)==null?void 0:d.slice(-8).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Date:"}),e.jsx("span",{className:"ml-2",children:new Date(r.processing_record.processing_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Post-Processing Weight:"}),e.jsxs("span",{className:"ml-2 text-green-600 font-semibold",children:[r.processing_record.post_processing_weight||0,"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Ready for Dispatch:"}),e.jsxs("span",{className:"ml-2 text-green-600 font-semibold",children:[r.processing_record.ready_for_dispatch_count||0," pieces"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fish Type:"}),e.jsx("span",{className:"ml-2",children:r.processing_record.fish_type||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Final Value:"}),e.jsx("span",{className:"ml-2",children:r.processing_record.final_value||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Yield:"}),e.jsxs("span",{className:"ml-2",children:[r.processing_record.processing_yield||0,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Waste:"}),e.jsxs("span",{className:"ml-2",children:[r.processing_record.processing_waste||0,"kg"]})]})]})]}),((j=(O=r.processing_record)==null?void 0:O.warehouse_entry)==null?void 0:j.farmer)&&e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-900 mb-3",children:"Farmer Information"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-orange-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Farmer Name:"}),e.jsx("span",{className:"ml-2",children:r.processing_record.warehouse_entry.farmer.name})]}),r.processing_record.warehouse_entry.farmer.phone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"}),e.jsx("span",{className:"ml-2",children:r.processing_record.warehouse_entry.farmer.phone})]}),r.processing_record.warehouse_entry.farmer.location&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Location:"}),e.jsx("span",{className:"ml-2",children:r.processing_record.warehouse_entry.farmer.location})]}),r.processing_record.warehouse_entry.farmer.rating&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Rating:"}),e.jsxs("span",{className:"ml-2",children:[r.processing_record.warehouse_entry.farmer.rating,"/5"]})]})]})]}),r.storage_location_id&&(()=>{const s=Q.find(t=>t.id===r.storage_location_id);return e.jsxs("div",{className:"p-4 bg-indigo-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-indigo-900 mb-3",children:"Storage Information"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-indigo-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Storage Location:"}),e.jsx("span",{className:"ml-2",children:(s==null?void 0:s.name)||"Unknown Storage"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Stored Date:"}),e.jsx("span",{className:"ml-2",children:new Date(r.created_at).toLocaleDateString()})]})]})]})})(),r.size_distribution&&Object.keys(r.size_distribution).length>0||r.processing_record&&r.processing_record.size_distribution&&Object.keys(r.processing_record.size_distribution).length>0?e.jsxs("div",{children:[e.jsx(w,{className:"text-lg font-semibold",children:"Size Distribution"}),e.jsxs("div",{className:"mt-4 bg-gray-50 rounded-lg p-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-4",children:"Distribution Chart"}),e.jsx("div",{className:"space-y-3",children:Object.entries(r.size_distribution||((L=r.processing_record)==null?void 0:L.size_distribution)||{}).filter(([s,t])=>t>0).sort(([s],[t])=>parseInt(s)-parseInt(t)).map(([s,t])=>{const a=r.total_weight_grams?r.total_weight_grams/1e3:0,c=a>0?t/a*100:0;return e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsxs("div",{className:"w-12 sm:w-16 text-sm font-medium text-gray-700",children:["Size ",s]}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-6 sm:h-8 relative overflow-hidden",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-full rounded-full transition-all duration-300 flex items-center justify-end pr-2",style:{width:`${Math.min(c,100)}%`},children:c>15&&e.jsxs("span",{className:"text-xs font-medium text-white",children:[t,"kg"]})})}),e.jsxs("div",{className:"text-xs text-gray-600 w-12 text-right",children:[c.toFixed(1),"%"]})]},s)})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-3",children:"Detailed Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:Object.entries(r.size_distribution||((R=r.processing_record)==null?void 0:R.size_distribution)||{}).filter(([s,t])=>t>0).sort(([s],[t])=>parseInt(s)-parseInt(t)).map(([s,t])=>{const a=r.total_weight_grams?r.total_weight_grams/1e3:0,c=a>0?t/a*100:0;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-blue-700 text-sm",children:s})}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold text-gray-900",children:["Size ",s]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[c.toFixed(1),"% of total"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:[t,"kg"]})})]},s)})})]})]}):e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-yellow-800",children:"No size distribution data available for this batch"})]})}),(r.size_distribution&&Object.keys(r.size_distribution).length>0||r.processing_record&&r.processing_record.size_distribution&&Object.keys(r.processing_record.size_distribution).length>0)&&e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 mb-3",children:"Sorting Summary"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-green-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Sizes:"}),e.jsx("span",{className:"ml-2",children:Object.keys(r.size_distribution||((S=r.processing_record)==null?void 0:S.size_distribution)||{}).length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Distributed:"}),e.jsxs("span",{className:"ml-2 font-semibold",children:[Object.values(r.size_distribution||((p=r.processing_record)==null?void 0:p.size_distribution)||{}).reduce((s,t)=>s+t,0).toFixed(2),"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Largest Size:"}),e.jsxs("span",{className:"ml-2",children:["Size ",Object.entries(r.size_distribution||((k=r.processing_record)==null?void 0:k.size_distribution)||{}).reduce((s,[t,a])=>a>s.weight?{size:t,weight:a}:s,{size:"0",weight:0}).size]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Smallest Size:"}),e.jsxs("span",{className:"ml-2",children:["Size ",Object.entries(r.size_distribution||((ge=r.processing_record)==null?void 0:ge.size_distribution)||{}).reduce((s,[t,a])=>a<s.weight?{size:t,weight:a}:s,{size:"0",weight:1/0}).size]})]})]})]}),r.notes&&e.jsxs("div",{children:[e.jsx(w,{className:"text-lg font-semibold",children:"Batch Notes"}),e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:r.notes})})]}),r.sorted_by_user&&e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-900 mb-3",children:"Sorted By"}),e.jsxs("div",{className:"text-sm text-orange-700",children:[e.jsx("span",{className:"font-medium",children:"User:"}),e.jsx("span",{className:"ml-2",children:r.sorted_by_user.email})]})]})]}):n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-3",children:"Processing Record Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-blue-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Record ID:"}),e.jsx("span",{className:"ml-2 font-mono text-xs",children:(he=n.id)==null?void 0:he.slice(-8).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Date:"}),e.jsx("span",{className:"ml-2",children:new Date(n.processing_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Weight:"}),e.jsxs("span",{className:"ml-2 text-green-600 font-semibold",children:[n.post_processing_weight||0,"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Pieces:"}),e.jsx("span",{className:"ml-2 text-green-600 font-semibold",children:n.ready_for_dispatch_count||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fish Type:"}),e.jsx("span",{className:"ml-2",children:n.fish_type||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Final Grade:"}),e.jsx("span",{className:"ml-2",children:n.final_grade||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Yield:"}),e.jsxs("span",{className:"ml-2",children:[n.processing_yield||0,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Waste:"}),e.jsxs("span",{className:"ml-2",children:[n.processing_waste||0,"kg"]})]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Debug Information"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Size Distribution Type:"})," ",typeof n.size_distribution]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Size Distribution Value:"})," ",JSON.stringify(n.size_distribution)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Has Size Distribution:"})," ",n.size_distribution?"Yes":"No"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Size Distribution Keys:"})," ",n.size_distribution?Object.keys(n.size_distribution).join(", "):"None"]})]})]}),n.size_distribution&&Object.keys(n.size_distribution).length>0?e.jsxs("div",{children:[e.jsx(w,{className:"text-lg font-semibold",children:"Size Distribution"}),e.jsxs("div",{className:"mt-4 bg-gray-50 rounded-lg p-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-4",children:"Distribution Chart"}),e.jsx("div",{className:"space-y-3",children:Object.entries(n.size_distribution).filter(([s,t])=>t>0).sort(([s],[t])=>parseInt(s)-parseInt(t)).map(([s,t])=>{const a=n.post_processing_weight>0?t/n.post_processing_weight*100:0;return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"w-16 text-sm font-medium text-gray-700",children:["Size ",s]}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-8 relative overflow-hidden",children:e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-green-600 h-full rounded-full transition-all duration-300 flex items-center justify-between px-3",style:{width:`${Math.min(a,100)}%`},children:[e.jsxs("span",{className:"text-sm font-medium text-white",children:[t,"kg"]}),e.jsxs("span",{className:"text-xs text-green-100",children:[a.toFixed(1),"%"]})]})})]},s)})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-3",children:"Detailed Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.entries(n.size_distribution).filter(([s,t])=>t>0).sort(([s],[t])=>parseInt(s)-parseInt(t)).map(([s,t])=>{const a=n.post_processing_weight>0?t/n.post_processing_weight*100:0;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-green-100 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-green-700 text-sm",children:s})}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold text-gray-900",children:["Size ",s]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[a.toFixed(1),"% of total"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[t,"kg"]})})]},s)})})]})]}):e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-yellow-800",children:"No size distribution data available for this record"})]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-2",children:"This record may not have been sorted yet, or the size distribution data is missing."})]}),n.size_distribution&&Object.keys(n.size_distribution).length>0?e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 mb-3",children:"Sorting Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-green-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Sizes:"}),e.jsx("span",{className:"ml-2",children:Object.keys(n.size_distribution).length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Distributed:"}),e.jsxs("span",{className:"ml-2 font-semibold",children:[Object.values(n.size_distribution).reduce((s,t)=>s+t,0).toFixed(2),"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Largest Size:"}),e.jsxs("span",{className:"ml-2",children:["Size ",Object.entries(n.size_distribution).reduce((s,[t,a])=>a>s.weight?{size:t,weight:a}:s,{size:"0",weight:0}).size]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Smallest Size:"}),e.jsxs("span",{className:"ml-2",children:["Size ",Object.entries(n.size_distribution).reduce((s,[t,a])=>a<s.weight?{size:t,weight:a}:s,{size:"0",weight:1/0}).size]})]})]})]}):e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Sorting Status"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:"This processing record has not been sorted yet."}),e.jsx("p",{className:"mt-2",children:'Use the "Sort Fish" button to distribute the fish into size classes.'})]})]}),(n.notes||n.processing_notes)&&e.jsxs("div",{children:[e.jsx(w,{className:"text-lg font-semibold",children:"Notes & Comments"}),e.jsxs("div",{className:"mt-3 space-y-3",children:[n.notes&&e.jsxs("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-yellow-900 mb-1",children:"Processing Notes"}),e.jsx("p",{className:"text-sm text-yellow-800",children:n.notes})]}),n.processing_notes&&e.jsxs("div",{className:"p-3 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-purple-900 mb-1",children:"Additional Notes"}),e.jsx("p",{className:"text-sm text-purple-800",children:n.processing_notes})]})]})]}),n.farmer_name&&e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-900 mb-3",children:"Farmer Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-orange-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Farmer Name:"}),e.jsx("span",{className:"ml-2",children:n.farmer_name})]}),n.farmer_phone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"}),e.jsx("span",{className:"ml-2",children:n.farmer_phone})]}),n.farmer_location&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Location:"}),e.jsx("span",{className:"ml-2",children:n.farmer_location})]}),n.farmer_rating&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Rating:"}),e.jsxs("span",{className:"ml-2",children:[n.farmer_rating,"/5"]})]})]})]})]}):null,e.jsx(ce,{children:e.jsx(h,{variant:"outline",onClick:()=>M(!1),children:"Close"})})]})}),e.jsx(ie,{open:Re,onOpenChange:W,children:e.jsxs(ae,{className:"sm:max-w-4xl",children:[e.jsx(ne,{children:e.jsx(le,{children:"Manage Size Class Thresholds"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Configure the weight ranges for each size class. Fish will be automatically sorted into these classes based on their weight."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto",children:q.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-medium",children:["Class ",s.class_number]}),e.jsx(re,{variant:"outline",children:s.is_active?"Active":"Inactive"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.description}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Range:"})," ",s.min_weight_grams,"g - ",s.max_weight_grams===999999.99?"âˆž":`${s.max_weight_grams}g`]})]},s.class_number))})]}),e.jsxs(ce,{children:[e.jsx(h,{variant:"outline",onClick:()=>W(!1),children:"Close"}),e.jsx(h,{onClick:()=>W(!1),children:"Save Changes"})]})]})}),e.jsx(ie,{open:Le,onOpenChange:U,children:e.jsxs(ae,{className:"w-[95vw] max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ne,{children:[e.jsx(le,{className:"text-xl font-semibold",children:"Sort Fish into Size Classes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Distribute the processed fish across different size classes"})]}),e.jsxs("div",{className:"space-y-6",children:[n&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Y,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h4",{className:"font-semibold text-blue-900",children:"Processing Record Summary"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Total Weight:"}),e.jsxs("p",{className:"text-blue-900 font-semibold",children:[n.post_processing_weight||0,"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Total Pieces:"}),e.jsx("p",{className:"text-blue-900 font-semibold",children:n.ready_for_dispatch_count||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Fish Type:"}),e.jsx("p",{className:"text-blue-900 font-semibold",children:n.fish_type||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Processing Date:"}),e.jsx("p",{className:"text-blue-900 font-semibold",children:new Date(n.processing_date).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Size Distribution"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Remaining:"}),e.jsxs("span",{className:`font-medium px-2 py-1 rounded ${i.remaining_weight_kg===0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[i.remaining_weight_kg.toFixed(1),"kg"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:Array.from({length:11},(s,t)=>t).map(s=>{const t=i.size_distribution[s.toString()]||0,a=t>0,c=i.total_weight_kg>0?t/i.total_weight_kg*100:0;return e.jsxs("div",{className:`p-3 rounded-lg border transition-all hover:shadow-sm ${a?"bg-blue-50 border-blue-200 shadow-sm":"bg-gray-50 border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(w,{htmlFor:`size-${s}`,className:`text-sm font-medium ${a?"text-blue-700":"text-gray-600"}`,children:["Size ",s]}),a&&e.jsxs("span",{className:"text-xs text-blue-600 font-medium",children:[c.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{id:`size-${s}`,type:"number",min:"0",max:i.total_weight_kg,step:"0.1",value:t||"",onChange:x=>We(s.toString(),parseFloat(x.target.value)||0),placeholder:"0.0",className:`flex-1 text-sm ${a?"border-blue-300 focus:border-blue-500 bg-white":"border-gray-200"}`}),e.jsx("span",{className:"text-xs text-gray-500 whitespace-nowrap",children:"kg"})]}),a&&e.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-1",children:e.jsx("div",{className:"bg-blue-500 h-1 rounded-full transition-all duration-300",style:{width:`${Math.min(c,100)}%`}})})]},s)})}),i.remaining_weight_kg!==0&&e.jsx("div",{className:`p-3 rounded-lg border ${i.remaining_weight_kg>0?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:`w-4 h-4 ${i.remaining_weight_kg>0?"text-yellow-600":"text-red-600"}`}),e.jsx("span",{className:`text-sm ${i.remaining_weight_kg>0?"text-yellow-800":"text-red-800"}`,children:i.remaining_weight_kg>0?`${i.remaining_weight_kg.toFixed(1)}kg remaining to distribute`:`Over-distributed by ${Math.abs(i.remaining_weight_kg).toFixed(1)}kg`})]})}),i.remaining_weight_kg===0&&Object.keys(i.size_distribution).filter(s=>i.size_distribution[s]>0).length>0&&e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm text-green-800",children:["âœ“ All ",i.total_weight_kg,"kg distributed across ",Object.keys(i.size_distribution).filter(s=>i.size_distribution[s]>0).length," size classes"]})]})})]}),Object.keys(i.size_distribution).filter(s=>i.size_distribution[s]>0).length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Distribution Preview"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[Object.keys(i.size_distribution).filter(s=>i.size_distribution[s]>0).length," sizes"]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-100",children:e.jsx("div",{className:"space-y-2",children:Object.entries(i.size_distribution).filter(([s,t])=>t>0).sort(([s],[t])=>parseInt(s)-parseInt(t)).map(([s,t])=>{const a=i.total_weight_kg>0?t/i.total_weight_kg*100:0;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 text-sm font-medium text-gray-700",children:["Size ",s]}),e.jsx("div",{className:"flex-1 bg-white rounded-full h-4 relative overflow-hidden border border-gray-200",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-full rounded-full transition-all duration-300 flex items-center justify-end pr-2",style:{width:`${Math.min(a,100)}%`},children:a>20&&e.jsxs("span",{className:"text-xs font-medium text-white",children:[t,"kg"]})})}),e.jsxs("div",{className:"text-xs text-gray-600 w-12 text-right font-medium",children:[a.toFixed(1),"%"]})]},s)})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"storage-location",className:"text-sm font-medium",children:"Storage Location *"}),e.jsxs(Xe,{value:i.storage_location_id,onValueChange:s=>F(me(K({},i),{storage_location_id:s})),children:[e.jsx(Ze,{className:"mt-1",children:e.jsx(es,{placeholder:"Select storage location"})}),e.jsx(ss,{children:(()=>{const s=Q.filter(t=>t.capacity_kg-(t.current_usage_kg||0)>=i.total_weight_kg);return s.length===0?e.jsxs("div",{className:"p-3 text-center text-gray-500 text-sm",children:["No storage locations with adequate space (",i.total_weight_kg,"kg needed)"]}):s.map(t=>{const a=t.capacity_kg-(t.current_usage_kg||0),c=a-i.total_weight_kg;return e.jsx(ts,{value:t.id,children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("span",{className:"text-gray-900",children:t.name}),e.jsxs("span",{className:"text-xs ml-2 text-gray-500",children:[a,"kg available (",c,"kg remaining)"]})]})},t.id)})})()})]}),i.storage_location_id&&(()=>{const s=Q.find(a=>a.id===i.storage_location_id);if(!s)return null;const t=s.capacity_kg-(s.current_usage_kg||0)-i.total_weight_kg;return e.jsxs("div",{className:"mt-2 p-2 bg-green-50 border border-green-200 rounded text-xs text-green-700",children:["âœ“ Adequate space confirmed - ",t,"kg remaining after storage"]})})()]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"sorting-notes",className:"text-sm font-medium",children:"Notes (Optional)"}),e.jsx(rs,{id:"sorting-notes",value:i.notes,onChange:s=>F(me(K({},i),{notes:s.target.value})),placeholder:"Add any notes about this sorting operation...",rows:3,className:"mt-1"})]})]})]})]}),e.jsxs(ce,{className:"mt-6",children:[e.jsx(h,{variant:"outline",onClick:()=>U(!1),children:"Cancel"}),e.jsx(h,{onClick:Me,disabled:!!(ee||i.remaining_weight_kg!==0||!i.storage_location_id),className:"bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:ee?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Complete Sorting"]})})]})]})})]})})};export{Fs as default};
