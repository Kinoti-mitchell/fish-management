var Ye=Object.defineProperty,Ge=Object.defineProperties;var Ke=Object.getOwnPropertyDescriptors;var Ce=Object.getOwnPropertySymbols;var Qe=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable;var De=(l,d,o)=>d in l?Ye(l,d,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[d]=o,I=(l,d)=>{for(var o in d||(d={}))Qe.call(d,o)&&De(l,o,d[o]);if(Ce)for(var o of Ce(d))Je.call(d,o)&&De(l,o,d[o]);return l},V=(l,d)=>Ge(l,Ke(d));var y=(l,d,o)=>new Promise((O,g)=>{var L=b=>{try{z(o.next(b))}catch(_){g(_)}},k=b=>{try{z(o.throw(b))}catch(_){g(_)}},z=b=>b.done?O(b.value):Promise.resolve(b.value).then(L,k);z((o=o.apply(l,d)).next())});import{s as N,m as Xe,r as m,j as e,B as u,H as Ze,a as D,b as F,P as H,f as Z,g as ee,n as Fe,F as Y,k as es,E as ss,l as se,L as S,I as ts,t as j}from"./index-DQMMO_c0.js";import{C as Pe,S as rs,a as is,b as as,c as ns,d as ls}from"./select-CgBsLs0l.js";import{D as te,b as re,c as ie,d as ae,e as ne}from"./dialog-DsOrmHTK.js";import{T as cs}from"./textarea-CAWYDPSl.js";import{s as G}from"./sortingService-jTdL8ozA.js";import{i as os}from"./inventoryService-BQvVG_EV.js";import{generateUniqueBatchNumber as ds}from"./entryCodeGenerator-CnmlbcQ-.js";import{C as E}from"./circle-alert-DDB34EIT.js";import{R as K}from"./refresh-cw-Lq6Yor4G.js";import{C as P}from"./circle-check-big-BRXFGpnR.js";import{S as Oe}from"./scale-lxSGmVqU.js";import{W as le}from"./weight-0FXLPeWt.js";import{C as Te}from"./calendar-aKpXVim2.js";import{C as Re}from"./index-vfJYS-vN.js";import{S as ms}from"./settings-Dgp5ces2.js";import{S as gs}from"./square-pen-CiVBriDF.js";import"./index-ByaXzgZu.js";import"./index-2myZ9lWz.js";function Be(l){return y(this,null,function*(){try{const{data:d,error:o}=yield l;if(o){if(o.message&&o.message.includes("406")){console.warn("406 error detected, trying alternative query approach");const{data:O,error:g}=yield N.from("sorting_batches").select("*").limit(1);return g?(console.error("Fallback query also failed:",g),{data:null,error:g}):(console.warn("Fallback query succeeded, original query structure may be problematic"),{data:null,error:new Error("Query structure incompatible with current RLS policies")})}return{data:d,error:o}}return{data:d,error:o}}catch(d){return console.error("Unexpected error in safeQuerySortingBatches:",d),{data:null,error:d}}})}function hs(l,d){if(console.error(`Supabase ${d} error:`,l),l&&typeof l=="object"){if(l.message&&l.message.includes("406"))return"Access denied. Please check your permissions or contact your administrator.";if(l.message&&l.message.includes("401"))return"Authentication required. Please log in again.";if(l.message&&l.message.includes("403"))return"Access forbidden. You do not have permission to perform this action.";if(l.message&&l.message.includes("JWT"))return"Authentication error. Please log in again.";if(l.message&&l.message.includes("relation")&&l.message.includes("does not exist"))return"Database table not found. Please contact your administrator.";if(l.message&&l.message.includes("permission denied"))return"Permission denied. Please check your user permissions.";if(l.message&&typeof l.message=="string")return l.message}return"An unexpected error occurred. Please try again."}const Ts=({onNavigate:l})=>{var je,be,fe,Ne,_e,ve,we,ye,Se,ke,ze;const{user:d}=Xe(),[o,O]=m.useState([]),[g,L]=m.useState([]),[k,z]=m.useState([]),[b,_]=m.useState([]),[ce,oe]=m.useState(!1),[$,de]=m.useState(null),[me,ge]=m.useState(!1),[Q,Ae]=m.useState(!1),[J,Ie]=m.useState(!1),[X,w]=m.useState(!1),[Ee,q]=m.useState(!1),[Le,U]=m.useState(!1),[$e,W]=m.useState(!1),[n,he]=m.useState(null),[r,xe]=m.useState(null),[a,T]=m.useState({batch_number:"",size_distribution:{},total_weight_kg:0,remaining_weight_kg:0,notes:"",storage_location_id:""}),C=m.useCallback(()=>y(void 0,null,function*(){oe(!0),de(null);try{console.log("🔄 Loading sorting data...");const[s,t,i]=yield Promise.allSettled([G.getSizeClassThresholds(),G.getSortingBatches({status:"completed",limit:20}),G.getProcessingRecordsReadyForSorting()]),c=s.status==="fulfilled"?s.value:[],p=t.status==="fulfilled"?t.value:[],f=i.status==="fulfilled"?i.value:[];s.status==="rejected"&&console.warn("Failed to load size class thresholds:",s.reason),t.status==="rejected"&&console.warn("Failed to load sorting batches:",t.reason),i.status==="rejected"&&console.warn("Failed to load processing records:",i.reason),console.log("📊 Data loaded:",{thresholds:c.length,batches:p.length,records:f.length}),z(c),L(p),O(f);try{const{data:h,error:v}=yield N.from("storage_locations").select("*").eq("status","active").order("name");v?(console.warn("Could not fetch storage locations:",v.message),_([{id:"default-1",name:"Cold Storage A",capacity_kg:1e3,current_usage_kg:0,location_type:"cold_storage"},{id:"default-2",name:"Cold Storage B",capacity_kg:1e3,current_usage_kg:0,location_type:"cold_storage"}])):(console.log("🏪 Storage locations loaded:",(h==null?void 0:h.length)||0),_(h||[]))}catch(h){console.warn("Error fetching storage locations:",h),_([{id:"default-1",name:"Cold Storage A",capacity_kg:1e3,current_usage_kg:0,location_type:"cold_storage"},{id:"default-2",name:"Cold Storage B",capacity_kg:1e3,current_usage_kg:0,location_type:"cold_storage"}])}}catch(s){console.error("❌ Error loading sorting data:",s),de("Failed to load sorting data. Please try again."),z([]),L([]),O([]),_([])}finally{oe(!1)}}),[]);m.useEffect(()=>{C()},[C]);const ue=m.useCallback(()=>y(void 0,null,function*(){ge(!0),yield C(),ge(!1)}),[]),qe=m.useMemo(()=>g.reduce((s,t)=>s+(t.total_weight_grams?t.total_weight_grams/1e3:0),0),[g]);m.useMemo(()=>o.reduce((s,t)=>s+(t.post_processing_weight||0),0),[o]);const Ue=s=>y(void 0,null,function*(){try{if(console.log("Starting sorting for record:",s.id),!d){console.error("No user found in AuthContext"),j.error("Please log in to continue.");return}console.log("User authenticated via AuthContext:",d.email);const t=N.from("sorting_batches").select("id, batch_number, status").eq("processing_record_id",s.id).eq("status","completed").maybeSingle(),{data:i,error:c}=yield Be(t);if(c){if(console.warn("Could not check for existing sorting batches:",c),c.message&&c.message.includes("406")){j.error("Access denied. Please check your permissions or contact your administrator.");return}if(c.message&&c.message.includes("relation")&&c.message.includes("does not exist")){j.error("Sorting functionality is not properly set up. Please contact your administrator.");return}console.warn("Continuing despite check error:",c.message)}if(i&&i.length>0){j.error(`This processing record has already been sorted! Batch: ${i[0].batch_number}`);return}he(s);let p;try{p=yield ds()}catch(h){console.warn("Error generating batch number, using fallback:",h),p=`Batch${Date.now().toString().slice(-6)}`}const f=s.post_processing_weight||0;T({batch_number:p,size_distribution:{},total_weight_kg:f,remaining_weight_kg:f,notes:"",storage_location_id:""}),q(!0)}catch(t){console.error("Error starting sorting:",t);const i=hs(t,"starting sorting");j.error(i)}}),We=(s,t)=>{const i=I({},a.size_distribution);t===0?delete i[s]:i[s]=t;const c=Object.values(i).reduce((f,h)=>f+h,0),p=a.total_weight_kg-c;T(V(I({},a),{size_distribution:i,remaining_weight_kg:p}))},Me=()=>y(void 0,null,function*(){try{if(!n||X)return;if(w(!0),a.remaining_weight_kg!==0){j.error(`Please distribute all ${a.total_weight_kg}kg. ${a.remaining_weight_kg}kg remaining.`),w(!1);return}if(!a.storage_location_id){j.error("Please select a storage location"),w(!1);return}const s=N.from("sorting_batches").select("id, batch_number, status").eq("processing_record_id",n.id).eq("status","completed").maybeSingle(),{data:t,error:i}=yield Be(s);if(i&&(console.warn("Could not check for existing sorting batches:",i),i.message&&i.message.includes("406"))){j.error("Access denied. Please check your permissions or contact your administrator."),w(!1);return}if(t&&t.length>0){j.error(`This processing record has already been sorted! Batch: ${t[0].batch_number}`),w(!1);return}const{error:c}=yield N.from("processing_records").update({size_distribution:a.size_distribution,updated_at:new Date().toISOString()}).eq("id",n.id);if(c)throw console.error("Error updating processing record:",c),c;const p=Object.values(a.size_distribution).reduce((R,x)=>R+(Number(x)||0),0),f={processing_record_id:n.id,batch_number:a.batch_number,notes:a.notes,status:"completed",total_pieces:p,total_weight_grams:a.total_weight_kg*1e3,sorting_date:new Date().toISOString().split("T")[0],storage_location_id:a.storage_location_id,size_distribution:a.size_distribution};console.log("Creating batch with size distribution:",f.size_distribution);const{data:h,error:v}=yield N.from("sorting_batches").insert([f]).select("id").single();if(v){if(v.code==="23505"&&v.message.includes("sorting_batches_one_completed_per_processing_record")){j.error("This processing record has already been sorted! Please refresh the page to see the updated list."),yield C(),w(!1);return}throw console.error("Error creating sorting batch:",v),v}if(h){const R=Object.entries(a.size_distribution).map(([x,M])=>{const B=Number(M)||0,A=B>0?a.total_weight_kg*1e3/p:0,He=B*A;return{sorting_batch_id:h.id,storage_location_id:a.storage_location_id,size_class:parseInt(x),total_pieces:B,total_weight_grams:He,average_weight_grams:A,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}).filter(x=>x.total_pieces>0);if(R.length>0){const{error:x}=yield N.from("sorting_results").insert(R);if(x)throw console.error("Error creating sorting results:",x),x;console.log("Created sorting results:",R.length,"size classes")}try{const{data:x,error:M}=yield N.from("storage_locations").select("current_usage_kg").eq("id",a.storage_location_id).single();if(M)console.warn("Could not fetch current storage usage:",M);else{const B=(x.current_usage_kg||0)+a.total_weight_kg,{error:A}=yield N.from("storage_locations").update({current_usage_kg:B,updated_at:new Date().toISOString()}).eq("id",a.storage_location_id);A?console.warn("Could not update storage location capacity:",A):console.log("Updated storage location capacity:",a.storage_location_id)}}catch(x){console.warn("Error updating storage capacity:",x)}try{yield os.addStockFromSorting(h.id),console.log("Automatically added to inventory:",h.id)}catch(x){console.warn("Could not automatically add to inventory:",x),j.error("Sorting completed but failed to add to inventory. Please add manually from inventory management.")}}j.success("Fish sorted and batch created successfully!"),q(!1),he(null),T({batch_number:"",size_distribution:{},total_weight_kg:0,remaining_weight_kg:0,notes:"",storage_location_id:""}),yield C()}catch(s){j.error("Failed to complete sorting"),console.error("Sorting error:",s)}finally{w(!1)}}),pe=()=>{U(!0)},Ve=s=>y(void 0,null,function*(){try{console.log("Viewing batch details:",s),console.log("Batch size distribution:",s.size_distribution);const t=yield G.getSortingBatch(s.id);console.log("Fresh batch data:",t),xe(t),W(!0)}catch(t){console.error("Error fetching fresh batch data:",t),xe(s),W(!0)}});return ce&&o.length===0&&g.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading sorting data..."})]})}):$&&o.length===0&&g.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsx("div",{className:"bg-red-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:e.jsx(E,{className:"w-8 h-8 text-red-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error Loading Data"}),e.jsx("p",{className:"text-gray-600 mb-4",children:$}),e.jsxs(u,{onClick:C,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Try Again"]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 content-container",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 responsive-padding",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Sorting Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Sort fish into size classes and manage sorting operations"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(u,{variant:"outline",onClick:ue,disabled:me,className:"flex items-center gap-2",children:[e.jsx(K,{className:`w-4 h-4 ${me?"animate-spin":""}`}),"Refresh"]}),e.jsxs(u,{onClick:()=>l("inventory"),className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4"}),"Go to Inventory"]})]})]})}),$&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-800",children:"Error Loading Data"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:$}),e.jsx(u,{onClick:ue,variant:"outline",size:"sm",className:"mt-2",children:"Try Again"})]})]})}),!1,e.jsx("div",{className:"px-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(D,{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white",children:e.jsx(F,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm font-medium",children:"Processing Records"}),e.jsx("p",{className:"text-3xl font-bold",children:o.length})]}),e.jsx(H,{className:"w-8 h-8 text-blue-200"})]})})}),e.jsx(D,{className:"bg-gradient-to-r from-green-500 to-green-600 text-white",children:e.jsx(F,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-sm font-medium",children:"Total Sorted"}),e.jsxs("p",{className:"text-3xl font-bold",children:[qe.toFixed(1),"kg"]}),e.jsxs("p",{className:"text-green-200 text-xs mt-1",children:[g.length," batches"]})]}),e.jsx(P,{className:"w-8 h-8 text-green-200"})]})})}),e.jsx(D,{className:"bg-gradient-to-r from-purple-500 to-purple-600 text-white",children:e.jsx(F,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm font-medium",children:"Size Classes"}),e.jsx("p",{className:"text-3xl font-bold",children:k.length})]}),e.jsx(Oe,{className:"w-8 h-8 text-purple-200"})]})})})]})}),e.jsxs(D,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(Z,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-b",children:e.jsxs(ee,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(H,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xl font-semibold",children:"Processing Records Ready for Sorting"}),e.jsx("p",{className:"text-sm text-gray-600 font-normal mt-1",children:"Fish that have been processed and are ready to be sorted into size classes"})]})]})}),e.jsx(F,{className:"p-6",children:ce?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading processing records..."})]})}):o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"p-4 bg-blue-50 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:e.jsx(H,{className:"w-10 h-10 text-blue-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Processing Records"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No fish have been processed yet"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-500",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Process fish first, then they'll appear here for sorting"})]}),!1]}):e.jsxs("div",{className:"space-y-4",children:[(J?o:o.slice(0,3)).map(s=>e.jsx("div",{className:"group p-6 border border-gray-200 rounded-xl hover:border-blue-300 hover:shadow-md transition-all duration-200 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg group-hover:bg-blue-200 transition-colors",children:e.jsx(Y,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("h4",{className:"font-semibold text-gray-900",children:["Processing Record ",s.processing_code||s.id]})}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.post_processing_weight||s.total_weight||0,"kg"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.ready_for_dispatch_count||s.fish_count||0," fish"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{children:new Date(s.processing_date||s.processed_at).toLocaleDateString()})]})]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(u,{onClick:()=>Ue(s),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(es,{className:"w-4 h-4 mr-2"}),"Sort Fish"]})})]})},s.id)),o.length>3&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(u,{variant:"outline",onClick:()=>Ie(!J),className:"text-blue-600 border-blue-300 hover:bg-blue-50",children:J?e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"View All (",o.length," records)"]})})})]})})]}),e.jsxs(D,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(Z,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-b",children:e.jsxs(ee,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(P,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xl font-semibold",children:"Sorted Batches"}),e.jsx("p",{className:"text-sm text-gray-600 font-normal mt-1",children:"Completed sorting operations with size distribution"})]})]})}),e.jsx(F,{className:"p-6",children:g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"p-4 bg-green-50 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:e.jsx(P,{className:"w-10 h-10 text-green-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Sorted Batches"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No fish have been sorted yet"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-500",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Sort fish from processing records above to create batches"})]}),!1]}):e.jsxs("div",{className:"space-y-4",children:[(Q?g:g.slice(0,3)).map(s=>{var t,i,c;return e.jsx("div",{className:"group p-6 border border-gray-200 rounded-xl hover:border-green-300 hover:shadow-md transition-all duration-200 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg group-hover:bg-green-200 transition-colors",children:e.jsx(P,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("h4",{className:"font-semibold text-gray-900",children:["Sorted Batch #",s.batch_number||s.id.slice(-8).toUpperCase()]})}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsxs("span",{children:["Created: ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.total_weight_grams?(s.total_weight_grams/1e3).toFixed(1):0,"kg"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.total_pieces||0," pieces"]})]}),((t=s.processing_record)==null?void 0:t.fish_type)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{children:s.processing_record.fish_type})]})]}),((c=(i=s.processing_record)==null?void 0:i.warehouse_entry)==null?void 0:c.farmer)&&e.jsx("div",{className:"flex items-center gap-1 mt-2 text-xs text-gray-500",children:e.jsxs("span",{children:["Farmer: ",s.processing_record.warehouse_entry.farmer.name]})})]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(u,{size:"sm",onClick:()=>Ve(s),className:"bg-orange-600 hover:bg-orange-700 text-white shadow-lg font-medium",children:[e.jsx(ss,{className:"w-4 h-4 mr-2"}),"View Details"]})})]})},s.id)}),g.length>3&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(u,{variant:"outline",onClick:()=>Ae(!Q),className:"text-green-600 border-green-300 hover:bg-green-50",children:Q?e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"View All (",g.length," batches)"]})})})]})})]}),e.jsxs(D,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(Z,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ee,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(Oe,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xl font-semibold",children:"Size Class Thresholds"}),e.jsx("p",{className:"text-sm text-gray-600 font-normal mt-1",children:"Configure weight ranges for each size class (0-10)"})]})]}),e.jsxs(u,{variant:"outline",size:"sm",onClick:pe,children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Manage"]})]})}),e.jsxs(F,{className:"p-6",children:[k.length===0&&!1,e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:k.map(s=>e.jsxs("div",{className:"group p-4 border border-gray-200 rounded-xl hover:border-green-300 hover:shadow-md transition-all duration-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs(se,{variant:"outline",className:`w-16 justify-center font-semibold ${s.class_number<=2?"border-blue-200 text-blue-700 bg-blue-50":s.class_number<=5?"border-green-200 text-green-700 bg-green-50":s.class_number<=8?"border-orange-200 text-orange-700 bg-orange-50":"border-red-200 text-red-700 bg-red-50"}`,children:["Class ",s.class_number]}),e.jsx(u,{variant:"ghost",size:"sm",onClick:pe,children:e.jsx(gs,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(le,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.min_weight_grams,"g - ",s.max_weight_grams===999999.99?"∞":`${s.max_weight_grams}g`]})]})]})]},s.class_number))})]})]}),e.jsx(te,{open:$e,onOpenChange:W,children:e.jsxs(re,{className:"w-[95vw] max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ie,{children:e.jsx(ae,{children:r?"Sorted Batch Details":"Sorting Details"})}),r?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 text-xs text-gray-600",children:[e.jsxs("span",{children:["Data refreshed: ",new Date().toLocaleTimeString()]}),e.jsxs("span",{children:["Batch ID: ",r.id.slice(-8).toUpperCase()]})]})}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-3",children:"Batch Information"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-blue-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Batch Number:"}),e.jsx("span",{className:"ml-2 font-mono text-xs",children:r.batch_number||r.id.slice(-8).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Code:"}),e.jsx("span",{className:"ml-2 font-mono text-xs",children:((je=r.processing_record)==null?void 0:je.processing_code)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx(se,{variant:"outline",className:"ml-2",children:r.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Weight:"}),e.jsxs("span",{className:"ml-2 text-green-600 font-semibold",children:[r.total_weight_grams?(r.total_weight_grams/1e3).toFixed(1):0,"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Pieces:"}),e.jsx("span",{className:"ml-2 text-green-600 font-semibold",children:r.total_pieces||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Created Date:"}),e.jsx("span",{className:"ml-2",children:new Date(r.created_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Sorting Date:"}),e.jsx("span",{className:"ml-2",children:new Date(r.sorting_date).toLocaleDateString()})]})]})]}),r.processing_record&&e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-purple-900 mb-3",children:"Processing Record Details"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-purple-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Record ID:"}),e.jsx("span",{className:"ml-2 font-mono text-xs",children:(be=r.processing_record.id)==null?void 0:be.slice(-8).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Date:"}),e.jsx("span",{className:"ml-2",children:new Date(r.processing_record.processing_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Post-Processing Weight:"}),e.jsxs("span",{className:"ml-2 text-green-600 font-semibold",children:[r.processing_record.post_processing_weight||0,"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Ready for Dispatch:"}),e.jsxs("span",{className:"ml-2 text-green-600 font-semibold",children:[r.processing_record.ready_for_dispatch_count||0," pieces"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fish Type:"}),e.jsx("span",{className:"ml-2",children:r.processing_record.fish_type||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Final Value:"}),e.jsx("span",{className:"ml-2",children:r.processing_record.final_value||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Yield:"}),e.jsxs("span",{className:"ml-2",children:[r.processing_record.processing_yield||0,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Waste:"}),e.jsxs("span",{className:"ml-2",children:[r.processing_record.processing_waste||0,"kg"]})]})]})]}),((Ne=(fe=r.processing_record)==null?void 0:fe.warehouse_entry)==null?void 0:Ne.farmer)&&e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-900 mb-3",children:"Farmer Information"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-orange-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Farmer Name:"}),e.jsx("span",{className:"ml-2",children:r.processing_record.warehouse_entry.farmer.name})]}),r.processing_record.warehouse_entry.farmer.phone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"}),e.jsx("span",{className:"ml-2",children:r.processing_record.warehouse_entry.farmer.phone})]}),r.processing_record.warehouse_entry.farmer.location&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Location:"}),e.jsx("span",{className:"ml-2",children:r.processing_record.warehouse_entry.farmer.location})]}),r.processing_record.warehouse_entry.farmer.rating&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Rating:"}),e.jsxs("span",{className:"ml-2",children:[r.processing_record.warehouse_entry.farmer.rating,"/5"]})]})]})]}),r.storage_location_id&&(()=>{const s=b.find(t=>t.id===r.storage_location_id);return e.jsxs("div",{className:"p-4 bg-indigo-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-indigo-900 mb-3",children:"Storage Information"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-indigo-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Storage Location:"}),e.jsx("span",{className:"ml-2",children:(s==null?void 0:s.name)||"Unknown Storage"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Stored Date:"}),e.jsx("span",{className:"ml-2",children:new Date(r.created_at).toLocaleDateString()})]})]})]})})(),r.size_distribution&&Object.keys(r.size_distribution).length>0||r.processing_record&&r.processing_record.size_distribution&&Object.keys(r.processing_record.size_distribution).length>0?e.jsxs("div",{children:[e.jsx(S,{className:"text-lg font-semibold",children:"Size Distribution"}),e.jsxs("div",{className:"mt-4 bg-gray-50 rounded-lg p-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-4",children:"Distribution Chart"}),e.jsx("div",{className:"space-y-3",children:Object.entries(r.size_distribution||((_e=r.processing_record)==null?void 0:_e.size_distribution)||{}).filter(([s,t])=>t>0).sort(([s],[t])=>parseInt(s)-parseInt(t)).map(([s,t])=>{const i=r.total_weight_grams?r.total_weight_grams/1e3:0,c=i>0?t/i*100:0;return e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsxs("div",{className:"w-12 sm:w-16 text-sm font-medium text-gray-700",children:["Size ",s]}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-6 sm:h-8 relative overflow-hidden",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-full rounded-full transition-all duration-300 flex items-center justify-end pr-2",style:{width:`${Math.min(c,100)}%`},children:c>15&&e.jsxs("span",{className:"text-xs font-medium text-white",children:[t,"kg"]})})}),e.jsxs("div",{className:"text-xs text-gray-600 w-12 text-right",children:[c.toFixed(1),"%"]})]},s)})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-3",children:"Detailed Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:Object.entries(r.size_distribution||((ve=r.processing_record)==null?void 0:ve.size_distribution)||{}).filter(([s,t])=>t>0).sort(([s],[t])=>parseInt(s)-parseInt(t)).map(([s,t])=>{const i=r.total_weight_grams?r.total_weight_grams/1e3:0,c=i>0?t/i*100:0;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-blue-700 text-sm",children:s})}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold text-gray-900",children:["Size ",s]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[c.toFixed(1),"% of total"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:[t,"kg"]})})]},s)})})]})]}):e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-yellow-800",children:"No size distribution data available for this batch"})]})}),(r.size_distribution&&Object.keys(r.size_distribution).length>0||r.processing_record&&r.processing_record.size_distribution&&Object.keys(r.processing_record.size_distribution).length>0)&&e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 mb-3",children:"Sorting Summary"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-green-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Sizes:"}),e.jsx("span",{className:"ml-2",children:Object.keys(r.size_distribution||((we=r.processing_record)==null?void 0:we.size_distribution)||{}).length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Distributed:"}),e.jsxs("span",{className:"ml-2 font-semibold",children:[Object.values(r.size_distribution||((ye=r.processing_record)==null?void 0:ye.size_distribution)||{}).reduce((s,t)=>s+t,0).toFixed(2),"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Largest Size:"}),e.jsxs("span",{className:"ml-2",children:["Size ",Object.entries(r.size_distribution||((Se=r.processing_record)==null?void 0:Se.size_distribution)||{}).reduce((s,[t,i])=>i>s.weight?{size:t,weight:i}:s,{size:"0",weight:0}).size]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Smallest Size:"}),e.jsxs("span",{className:"ml-2",children:["Size ",Object.entries(r.size_distribution||((ke=r.processing_record)==null?void 0:ke.size_distribution)||{}).reduce((s,[t,i])=>i<s.weight?{size:t,weight:i}:s,{size:"0",weight:1/0}).size]})]})]})]}),r.notes&&e.jsxs("div",{children:[e.jsx(S,{className:"text-lg font-semibold",children:"Batch Notes"}),e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:r.notes})})]}),r.sorted_by_user&&e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-900 mb-3",children:"Sorted By"}),e.jsxs("div",{className:"text-sm text-orange-700",children:[e.jsx("span",{className:"font-medium",children:"User:"}),e.jsx("span",{className:"ml-2",children:r.sorted_by_user.email})]})]})]}):n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-3",children:"Processing Record Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-blue-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Record ID:"}),e.jsx("span",{className:"ml-2 font-mono text-xs",children:(ze=n.id)==null?void 0:ze.slice(-8).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Date:"}),e.jsx("span",{className:"ml-2",children:new Date(n.processing_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Weight:"}),e.jsxs("span",{className:"ml-2 text-green-600 font-semibold",children:[n.post_processing_weight||0,"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Pieces:"}),e.jsx("span",{className:"ml-2 text-green-600 font-semibold",children:n.ready_for_dispatch_count||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fish Type:"}),e.jsx("span",{className:"ml-2",children:n.fish_type||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Final Grade:"}),e.jsx("span",{className:"ml-2",children:n.final_grade||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Yield:"}),e.jsxs("span",{className:"ml-2",children:[n.processing_yield||0,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processing Waste:"}),e.jsxs("span",{className:"ml-2",children:[n.processing_waste||0,"kg"]})]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Debug Information"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Size Distribution Type:"})," ",typeof n.size_distribution]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Size Distribution Value:"})," ",JSON.stringify(n.size_distribution)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Has Size Distribution:"})," ",n.size_distribution?"Yes":"No"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Size Distribution Keys:"})," ",n.size_distribution?Object.keys(n.size_distribution).join(", "):"None"]})]})]}),n.size_distribution&&Object.keys(n.size_distribution).length>0?e.jsxs("div",{children:[e.jsx(S,{className:"text-lg font-semibold",children:"Size Distribution"}),e.jsxs("div",{className:"mt-4 bg-gray-50 rounded-lg p-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-4",children:"Distribution Chart"}),e.jsx("div",{className:"space-y-3",children:Object.entries(n.size_distribution).filter(([s,t])=>t>0).sort(([s],[t])=>parseInt(s)-parseInt(t)).map(([s,t])=>{const i=n.post_processing_weight>0?t/n.post_processing_weight*100:0;return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"w-16 text-sm font-medium text-gray-700",children:["Size ",s]}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-8 relative overflow-hidden",children:e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-green-600 h-full rounded-full transition-all duration-300 flex items-center justify-between px-3",style:{width:`${Math.min(i,100)}%`},children:[e.jsxs("span",{className:"text-sm font-medium text-white",children:[t,"kg"]}),e.jsxs("span",{className:"text-xs text-green-100",children:[i.toFixed(1),"%"]})]})})]},s)})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-3",children:"Detailed Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.entries(n.size_distribution).filter(([s,t])=>t>0).sort(([s],[t])=>parseInt(s)-parseInt(t)).map(([s,t])=>{const i=n.post_processing_weight>0?t/n.post_processing_weight*100:0;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-green-100 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-green-700 text-sm",children:s})}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold text-gray-900",children:["Size ",s]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[i.toFixed(1),"% of total"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[t,"kg"]})})]},s)})})]})]}):e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-yellow-800",children:"No size distribution data available for this record"})]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-2",children:"This record may not have been sorted yet, or the size distribution data is missing."})]}),n.size_distribution&&Object.keys(n.size_distribution).length>0?e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 mb-3",children:"Sorting Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-green-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Sizes:"}),e.jsx("span",{className:"ml-2",children:Object.keys(n.size_distribution).length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Distributed:"}),e.jsxs("span",{className:"ml-2 font-semibold",children:[Object.values(n.size_distribution).reduce((s,t)=>s+t,0).toFixed(2),"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Largest Size:"}),e.jsxs("span",{className:"ml-2",children:["Size ",Object.entries(n.size_distribution).reduce((s,[t,i])=>i>s.weight?{size:t,weight:i}:s,{size:"0",weight:0}).size]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Smallest Size:"}),e.jsxs("span",{className:"ml-2",children:["Size ",Object.entries(n.size_distribution).reduce((s,[t,i])=>i<s.weight?{size:t,weight:i}:s,{size:"0",weight:1/0}).size]})]})]})]}):e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Sorting Status"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:"This processing record has not been sorted yet."}),e.jsx("p",{className:"mt-2",children:'Use the "Sort Fish" button to distribute the fish into size classes.'})]})]}),(n.notes||n.processing_notes)&&e.jsxs("div",{children:[e.jsx(S,{className:"text-lg font-semibold",children:"Notes & Comments"}),e.jsxs("div",{className:"mt-3 space-y-3",children:[n.notes&&e.jsxs("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-yellow-900 mb-1",children:"Processing Notes"}),e.jsx("p",{className:"text-sm text-yellow-800",children:n.notes})]}),n.processing_notes&&e.jsxs("div",{className:"p-3 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-purple-900 mb-1",children:"Additional Notes"}),e.jsx("p",{className:"text-sm text-purple-800",children:n.processing_notes})]})]})]}),n.farmer_name&&e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-900 mb-3",children:"Farmer Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-orange-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Farmer Name:"}),e.jsx("span",{className:"ml-2",children:n.farmer_name})]}),n.farmer_phone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"}),e.jsx("span",{className:"ml-2",children:n.farmer_phone})]}),n.farmer_location&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Location:"}),e.jsx("span",{className:"ml-2",children:n.farmer_location})]}),n.farmer_rating&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Rating:"}),e.jsxs("span",{className:"ml-2",children:[n.farmer_rating,"/5"]})]})]})]})]}):null,e.jsx(ne,{children:e.jsx(u,{variant:"outline",onClick:()=>W(!1),children:"Close"})})]})}),e.jsx(te,{open:Le,onOpenChange:U,children:e.jsxs(re,{className:"sm:max-w-4xl",children:[e.jsx(ie,{children:e.jsx(ae,{children:"Manage Size Class Thresholds"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Configure the weight ranges for each size class. Fish will be automatically sorted into these classes based on their weight."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto",children:k.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-medium",children:["Class ",s.class_number]}),e.jsx(se,{variant:"outline",children:s.is_active?"Active":"Inactive"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.description}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Range:"})," ",s.min_weight_grams,"g - ",s.max_weight_grams===999999.99?"∞":`${s.max_weight_grams}g`]})]},s.class_number))})]}),e.jsxs(ne,{children:[e.jsx(u,{variant:"outline",onClick:()=>U(!1),children:"Close"}),e.jsx(u,{onClick:()=>U(!1),children:"Save Changes"})]})]})}),e.jsx(te,{open:Ee,onOpenChange:q,children:e.jsxs(re,{className:"w-[95vw] max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsx(ae,{className:"text-xl font-semibold",children:"Sort Fish into Size Classes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Distribute the processed fish across different size classes"})]}),e.jsxs("div",{className:"space-y-6",children:[n&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Y,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h4",{className:"font-semibold text-blue-900",children:"Processing Record Summary"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Total Weight:"}),e.jsxs("p",{className:"text-blue-900 font-semibold",children:[n.post_processing_weight||0,"kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Total Pieces:"}),e.jsx("p",{className:"text-blue-900 font-semibold",children:n.ready_for_dispatch_count||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Fish Type:"}),e.jsx("p",{className:"text-blue-900 font-semibold",children:n.fish_type||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Processing Date:"}),e.jsx("p",{className:"text-blue-900 font-semibold",children:new Date(n.processing_date).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Size Distribution"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Remaining:"}),e.jsxs("span",{className:`font-medium px-2 py-1 rounded ${a.remaining_weight_kg===0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[a.remaining_weight_kg.toFixed(1),"kg"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:Array.from({length:11},(s,t)=>t).map(s=>{const t=a.size_distribution[s.toString()]||0,i=t>0,c=a.total_weight_kg>0?t/a.total_weight_kg*100:0;return e.jsxs("div",{className:`p-3 rounded-lg border transition-all hover:shadow-sm ${i?"bg-blue-50 border-blue-200 shadow-sm":"bg-gray-50 border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(S,{htmlFor:`size-${s}`,className:`text-sm font-medium ${i?"text-blue-700":"text-gray-600"}`,children:["Size ",s]}),i&&e.jsxs("span",{className:"text-xs text-blue-600 font-medium",children:[c.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{id:`size-${s}`,type:"number",min:"0",max:a.total_weight_kg,step:"0.1",value:t||"",onChange:p=>We(s.toString(),parseFloat(p.target.value)||0),placeholder:"0.0",className:`flex-1 text-sm ${i?"border-blue-300 focus:border-blue-500 bg-white":"border-gray-200"}`}),e.jsx("span",{className:"text-xs text-gray-500 whitespace-nowrap",children:"kg"})]}),i&&e.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-1",children:e.jsx("div",{className:"bg-blue-500 h-1 rounded-full transition-all duration-300",style:{width:`${Math.min(c,100)}%`}})})]},s)})}),a.remaining_weight_kg!==0&&e.jsx("div",{className:`p-3 rounded-lg border ${a.remaining_weight_kg>0?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:`w-4 h-4 ${a.remaining_weight_kg>0?"text-yellow-600":"text-red-600"}`}),e.jsx("span",{className:`text-sm ${a.remaining_weight_kg>0?"text-yellow-800":"text-red-800"}`,children:a.remaining_weight_kg>0?`${a.remaining_weight_kg.toFixed(1)}kg remaining to distribute`:`Over-distributed by ${Math.abs(a.remaining_weight_kg).toFixed(1)}kg`})]})}),a.remaining_weight_kg===0&&Object.keys(a.size_distribution).filter(s=>a.size_distribution[s]>0).length>0&&e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm text-green-800",children:["✓ All ",a.total_weight_kg,"kg distributed across ",Object.keys(a.size_distribution).filter(s=>a.size_distribution[s]>0).length," size classes"]})]})})]}),Object.keys(a.size_distribution).filter(s=>a.size_distribution[s]>0).length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Distribution Preview"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[Object.keys(a.size_distribution).filter(s=>a.size_distribution[s]>0).length," sizes"]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-100",children:e.jsx("div",{className:"space-y-2",children:Object.entries(a.size_distribution).filter(([s,t])=>t>0).sort(([s],[t])=>parseInt(s)-parseInt(t)).map(([s,t])=>{const i=a.total_weight_kg>0?t/a.total_weight_kg*100:0;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 text-sm font-medium text-gray-700",children:["Size ",s]}),e.jsx("div",{className:"flex-1 bg-white rounded-full h-4 relative overflow-hidden border border-gray-200",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-full rounded-full transition-all duration-300 flex items-center justify-end pr-2",style:{width:`${Math.min(i,100)}%`},children:i>20&&e.jsxs("span",{className:"text-xs font-medium text-white",children:[t,"kg"]})})}),e.jsxs("div",{className:"text-xs text-gray-600 w-12 text-right font-medium",children:[i.toFixed(1),"%"]})]},s)})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"storage-location",className:"text-sm font-medium",children:"Storage Location *"}),e.jsxs(rs,{value:a.storage_location_id,onValueChange:s=>T(V(I({},a),{storage_location_id:s})),children:[e.jsx(is,{className:"mt-1",children:e.jsx(as,{placeholder:"Select storage location"})}),e.jsx(ns,{children:(()=>{const s=b.filter(t=>t.capacity_kg-(t.current_usage_kg||0)>=a.total_weight_kg);return s.length===0?e.jsxs("div",{className:"p-3 text-center text-gray-500 text-sm",children:["No storage locations with adequate space (",a.total_weight_kg,"kg needed)"]}):s.map(t=>{const i=t.capacity_kg-(t.current_usage_kg||0),c=i-a.total_weight_kg;return e.jsx(ls,{value:t.id,children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("span",{className:"text-gray-900",children:t.name}),e.jsxs("span",{className:"text-xs ml-2 text-gray-500",children:[i,"kg available (",c,"kg remaining)"]})]})},t.id)})})()})]}),a.storage_location_id&&(()=>{const s=b.find(c=>c.id===a.storage_location_id);if(!s)return null;const i=s.capacity_kg-(s.current_usage_kg||0)-a.total_weight_kg;return e.jsxs("div",{className:"mt-2 p-2 bg-green-50 border border-green-200 rounded text-xs text-green-700",children:["✓ Adequate space confirmed - ",i,"kg remaining after storage"]})})()]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"sorting-notes",className:"text-sm font-medium",children:"Notes (Optional)"}),e.jsx(cs,{id:"sorting-notes",value:a.notes,onChange:s=>T(V(I({},a),{notes:s.target.value})),placeholder:"Add any notes about this sorting operation...",rows:3,className:"mt-1"})]})]})]})]}),e.jsxs(ne,{className:"mt-6",children:[e.jsx(u,{variant:"outline",onClick:()=>q(!1),children:"Cancel"}),e.jsx(u,{onClick:Me,disabled:!!(X||a.remaining_weight_kg!==0||!a.storage_location_id),className:"bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:X?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Complete Sorting"]})})]})]})})]})})};export{Ts as default};
