var l=(g,e,t)=>new Promise((o,n)=>{var i=s=>{try{r(t.next(s))}catch(c){n(c)}},u=s=>{try{r(t.throw(s))}catch(c){n(c)}},r=s=>s.done?o(s.value):Promise.resolve(s.value).then(i,u);r((t=t.apply(g,e)).next())});import{s as _}from"./index-DRkvTocB.js";class a{static logEvent(e){return l(this,null,function*(){try{const t=JSON.parse(sessionStorage.getItem("currentUser")||"null");if(!t){console.warn("No authenticated user found for audit logging");return}const o={user_id:t.id,action:e.action,table_name:e.table_name,record_id:e.record_id,old_values:e.old_values?JSON.stringify(e.old_values):null,new_values:e.new_values?JSON.stringify(e.new_values):null,ip_address:e.ip_address||null,user_agent:e.user_agent||navigator.userAgent,created_at:new Date().toISOString()},n=void 0;let i=null;n||(i=(yield _.from("audit_logs").insert([o])).error),i&&console.warn("Failed to log audit event:",i)}catch(t){console.warn("Failed to log audit event:",t)}})}static logCreate(e,t,o){return l(this,null,function*(){yield a.logEvent({action:"CREATE",table_name:e,record_id:t,new_values:o})})}static logUpdate(e,t,o,n){return l(this,null,function*(){yield a.logEvent({action:"UPDATE",table_name:e,record_id:t,old_values:o,new_values:n})})}static logDelete(e,t,o){return l(this,null,function*(){yield a.logEvent({action:"DELETE",table_name:e,record_id:t,old_values:o})})}static logLogin(e,t){return l(this,null,function*(){yield a.logEvent({action:"LOGIN",table_name:"profiles",record_id:e,new_values:{login_time:new Date().toISOString()},user_agent:t})})}static logLogout(e){return l(this,null,function*(){yield a.logEvent({action:"LOGOUT",table_name:"profiles",record_id:e,new_values:{logout_time:new Date().toISOString()}})})}static logCustomAction(e,t,o,n){return l(this,null,function*(){yield a.logEvent({action:e,table_name:t,record_id:o,new_values:n})})}}const m={create:a.logCreate,update:a.logUpdate,delete:a.logDelete,login:a.logLogin,logout:a.logLogout,custom:a.logCustomAction};export{m as a};
