import{J as g}from"./index-D0a7Ul_G.js";var r=(c,e,t)=>new Promise((n,l)=>{var i=a=>{try{s(t.next(a))}catch(u){l(u)}},d=a=>{try{s(t.throw(a))}catch(u){l(u)}},s=a=>a.done?n(a.value):Promise.resolve(a.value).then(i,d);s((t=t.apply(c,e)).next())});class o{static logEvent(e){return r(this,null,function*(){try{const t=JSON.parse(sessionStorage.getItem("currentUser")||"null");if(!t){console.warn("No authenticated user found for audit logging");return}const n={user_id:t.id,action:e.action,table_name:e.table_name,record_id:e.record_id,old_values:e.old_values?JSON.stringify(e.old_values):null,new_values:e.new_values?JSON.stringify(e.new_values):null,ip_address:e.ip_address||null,user_agent:e.user_agent||navigator.userAgent,created_at:new Date().toISOString()},l=void 0;let i=null;l||(i=(yield g.from("audit_logs").insert([n])).error),i&&console.warn("Failed to log audit event:",i)}catch(t){console.warn("Failed to log audit event:",t)}})}static logCreate(e,t,n){return r(this,null,function*(){yield o.logEvent({action:"CREATE",table_name:e,record_id:t,new_values:n})})}static logUpdate(e,t,n,l){return r(this,null,function*(){yield o.logEvent({action:"UPDATE",table_name:e,record_id:t,old_values:n,new_values:l})})}static logDelete(e,t,n){return r(this,null,function*(){yield o.logEvent({action:"DELETE",table_name:e,record_id:t,old_values:n})})}static logLogin(e,t){return r(this,null,function*(){yield o.logEvent({action:"LOGIN",table_name:"profiles",record_id:e,new_values:{login_time:new Date().toISOString()},user_agent:t})})}static logLogout(e){return r(this,null,function*(){yield o.logEvent({action:"LOGOUT",table_name:"profiles",record_id:e,new_values:{logout_time:new Date().toISOString()}})})}static logCustomAction(e,t,n,l){return r(this,null,function*(){yield o.logEvent({action:e,table_name:t,record_id:n,new_values:l})})}}const v={create:o.logCreate,update:o.logUpdate,delete:o.logDelete,login:o.logLogin,logout:o.logLogout,custom:o.logCustomAction};export{v};
