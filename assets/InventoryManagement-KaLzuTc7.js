import{c as $e,m as qe,r as c,j as e,n as be,a as k,b as D,H as fe,l as ce,L as Re,B as S,P as L,I as Ve,k as He,C as Qe,Z as Ge,E as Ke,f as Ze,g as Je}from"./main-DaUA0_HE.js";import{D as je,b as ye,c as Ne,d as ve}from"./dialog--emBz1E_.js";import{i as B}from"./inventoryService-L47iJXIj.js";import{s as Xe}from"./sortingService-DPnhaoRr.js";import{T as Ye}from"./textarea-PFfsCJHc.js";import{C as Te}from"./checkbox-BNGHNOlz.js";import{S as U}from"./scale-DxfIWcTn.js";import{L as oe}from"./loader-circle-B0OjFwMC.js";import{C as P}from"./circle-alert-Bgvlpwtg.js";import{C as ie}from"./circle-check-big-CcKkuKH7.js";import{F as Ie}from"./file-text-B1IdRfzD.js";import{T as ne}from"./trending-up-Co6Ut-kE.js";import{S as es}from"./search-CmxNxxBJ.js";import{R as ss}from"./refresh-cw-BtyiKIQ6.js";import{C as ts}from"./chart-pie-CW47mx5j.js";import{C as pe}from"./clock-D5zwnXNA.js";import{A as as}from"./award-B1iu855p.js";import{C as ls}from"./index-C_qyoy25.js";import{C as rs}from"./chevron-right-Bs-byGw7.js";import"./index-DqKwVrkr.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],is=$e("bell",ns);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Z=$e("layers",cs);function os({isOpen:F,onClose:J,sourceStorage:C,itemsToTransfer:m,onTransferComplete:X}){const{user:_e}=qe(),[A,p]=c.useState([]),[z,R]=c.useState(""),[Y,de]=c.useState(""),[ee,_]=c.useState(!1),[$,j]=c.useState(null),[V,xe]=c.useState(null),[H,ge]=c.useState(!1),[b,E]=c.useState(new Set);c.useEffect(()=>{if(F){const a=new Set(m.map(g=>g.size));E(a),j(null),xe(null)}},[F,C.id,m]),c.useEffect(()=>{F&&b.size>0&&te()},[b,F,C.id]);const T=m.filter(a=>b.has(a.size)).reduce((a,g)=>a+g.total_weight,0),se=m.filter(a=>b.has(a.size)).reduce((a,g)=>a+g.quantity,0),W=a=>{E(a?new Set(m.map(g=>g.size)):new Set)},me=(a,g)=>{const f=new Set(b);g?f.add(a):f.delete(a),E(f)},M=b.size===m.length;b.size>0;const te=async()=>{_(!0),j(null);try{const a=await B.getAvailableStorageLocationsForTransfer(C.id),g=m.filter(w=>b.has(w.size)).reduce((w,q)=>w+q.total_weight,0),f=a.filter(w=>{const q=w.available_capacity_kg>=g;return console.log(`${w.name}: ${w.available_capacity_kg}kg available, need ${g.toFixed(1)}kg - ${q?"SUITABLE":"NOT ENOUGH SPACE"}`),q});console.log(`Found ${f.length} suitable storage locations for ${g.toFixed(1)}kg transfer`),console.log("Suitable storages:",f),p(f),f.length===0?j(`No storage locations have enough capacity for this transfer. Total weight to transfer: ${g.toFixed(1)}kg`):console.log(`Found ${f.length} suitable storage locations for transfer`)}catch(a){console.error("Error loading available storages:",a),j(a.message||"Failed to load available storage locations")}finally{_(!1)}},he=async()=>{if(!H){if(!z){j("Please select a destination storage location");return}if(b.size===0){j("Please select at least one size to transfer");return}ge(!0),j(null);try{console.log("Creating transfer request..."),console.log("Source storage:",C),console.log("Destination storage ID:",z),console.log("Selected sizes:",Array.from(b)),console.log("Items to transfer:",m.filter(N=>b.has(N.size)));const a=m.filter(N=>b.has(N.size)),g=a.reduce((N,G)=>N+G.quantity,0),f=a.reduce((N,G)=>N+G.total_weight,0);console.log(`Creating batch transfer for ${a.length} selected size classes, total quantity: ${g}, total weight: ${f}kg`);const w=a.map(N=>({size:N.size,quantity:N.quantity,weightKg:N.total_weight})),q=await B.createBatchTransfer(C.id,z,w,`Transfer from ${C.name} - Sizes: ${Array.from(b).sort().join(", ")} - ${Y||"No notes"}`,_e?.id);console.log("Batch transfer created:",q),xe(`Transfer request created successfully for ${a.length} size${a.length!==1?"s":""}! Awaiting approval.`),X(),setTimeout(()=>{J()},600)}catch(a){console.error("Error creating transfer request:",a),a.message&&(a.message.includes("already exists")||a.message.includes("409"))?j("A transfer request for these items already exists. Please check the 'Transfer Approvals' section to review pending requests."):a.message&&a.message.includes("ERR_CONNECTION_CLOSED")?j("Connection error. Please check your internet connection and try again."):a.message&&a.message.includes("500")?j("Server error. Please try again in a moment."):a.message&&a.message.includes("insufficient")?j("Insufficient inventory for this transfer. Please check available quantities."):j(a.message||"Failed to create transfer request. Please try again.")}finally{ge(!1)}}},Q=A.find(a=>a.id===z);return e.jsx(je,{open:F,onOpenChange:J,children:e.jsxs(ye,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(Ne,{children:e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5"}),"Transfer Stock from ",C.name]})}),e.jsxs("div",{className:"space-y-6 overflow-y-auto flex-1 pr-2",children:[e.jsx(k,{children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(fe,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:C.name}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:C.location_type.replace("_"," ")})]}),e.jsx(ce,{variant:"default",className:"bg-green-100 text-green-800",children:"Active"})]})})}),e.jsx(k,{children:e.jsxs(D,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Fish to Transfer (by Weight)"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{id:"select-all",checked:M,onCheckedChange:W}),e.jsx("label",{htmlFor:"select-all",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Select All"})]})]}),e.jsxs("div",{className:"space-y-2",children:[m.map((a,g)=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${b.has(a.size)?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Te,{id:`size-${a.size}`,checked:b.has(a.size),onCheckedChange:f=>me(a.size,f)}),e.jsxs(ce,{variant:"outline",className:"w-16 justify-center",children:["Size ",a.size]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[a.total_weight.toFixed(1),"kg"]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a.quantity," pieces"]})]},g)),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Total Weight"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[se," pieces selected"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"font-bold text-green-600 text-lg",children:[T.toFixed(1),"kg"]})]})]})]})]})}),e.jsx(k,{children:e.jsxs(D,{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"Available Storage Locations"]}),ee?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(oe,{className:"w-6 h-6 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading available storage locations..."})]}):$?e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-1 bg-red-100 rounded-full",children:e.jsx(P,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-1",children:"Transfer Request Failed"}),e.jsx("p",{className:"text-sm text-red-700",children:$}),$.includes("already exists")&&e.jsx("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded",children:e.jsxs("p",{className:"text-xs text-blue-700",children:["💡 ",e.jsx("strong",{children:"Tip:"}),' Navigate to "Transfer Approvals" to review and approve existing requests.']})})]})]})}):A.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No suitable storage locations found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"All active storage locations are at capacity or don't have enough space"})]}):e.jsx("div",{className:"space-y-3",children:A.map(a=>e.jsx("div",{className:`p-4 border rounded-lg transition-all ${z===a.id?"border-blue-300 bg-blue-50 cursor-pointer":"border-gray-200 hover:border-blue-300 hover:bg-gray-50 cursor-pointer"}`,onClick:()=>{R(a.id)},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 ${z===a.id?"border-blue-600 bg-blue-600":"border-gray-300"}`,children:z===a.id&&e.jsx(ie,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:a.location_type.replace("_"," ")})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(U,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[a.available_capacity_kg.toFixed(1),"kg available"]})]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-1",children:[a.current_usage_kg.toFixed(1),"kg / ",a.capacity_kg.toFixed(1),"kg used"]}),e.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["Need: ",T.toFixed(1),"kg"]}),e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2 mt-1",children:e.jsx("div",{className:`h-2 rounded-full ${a.utilization_percent>=90?"bg-red-500":a.utilization_percent>=70?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(a.utilization_percent,100)}%`}})})]})]})},a.id))})]})}),V&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-1 bg-green-100 rounded-full",children:e.jsx(ie,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-1",children:"Transfer Request Created"}),e.jsx("p",{className:"text-sm text-green-700",children:V})]})]})}),e.jsx(k,{children:e.jsxs(D,{className:"p-4",children:[e.jsx(Re,{htmlFor:"transfer-notes",className:"text-sm font-medium text-gray-700",children:"Transfer Notes (Optional)"}),e.jsx(Ye,{id:"transfer-notes",placeholder:"Add notes about this transfer...",value:Y,onChange:a=>de(a.target.value),className:"mt-2",rows:3})]})}),Q&&e.jsx(k,{className:"border-blue-200 bg-blue-50",children:e.jsxs(D,{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-blue-600"}),"Selected Destination"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:Q.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Will have ",(Q.available_capacity_kg-T).toFixed(1),"kg remaining after transfer"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-1",children:["Transfer: ",T.toFixed(1),"kg"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Current: ",Q.utilization_percent.toFixed(1),"% used"]})]})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t",children:[e.jsx(S,{variant:"outline",onClick:J,disabled:H,children:"Cancel"}),e.jsx(S,{onClick:he,disabled:!z||H||A.length===0||b.size===0,className:"bg-blue-600 hover:bg-blue-700",children:H?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2 animate-spin"}),"Transferring..."]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Transfer Stock"]})})]})]})})}function Ts({onNavigate:F}){const[J,C]=c.useState([]),[m,X]=c.useState([]),[_e,A]=c.useState([]),[p,z]=c.useState(null),[R,Y]=c.useState(""),[de,ee]=c.useState(!1),[_,$]=c.useState(null),[j,V]=c.useState(!1),[xe,H]=c.useState(null),[ge,b]=c.useState(null),[E,T]=c.useState(!1),[se,W]=c.useState(null),[me,M]=c.useState([]),[te,he]=c.useState(new Set),[Q,a]=c.useState(!1),[g,f]=c.useState("grid"),[w,q]=c.useState("name"),[N,G]=c.useState([]),[Be,Ae]=c.useState(null),[I,we]=c.useState(null),[Se,ze]=c.useState(!1),[ke,Ee]=c.useState([]),[ue,Oe]=c.useState([]),[ae,Ce]=c.useState(!1),K=c.useCallback(async()=>{ee(!0),$(null);try{console.log("🔍 Fetching inventory data..."),console.log("🔗 Testing database connection...");try{const l=await B.getInventorySummary();console.log("✅ Database connection successful, test data:",l)}catch(l){console.error("❌ Database connection failed:",l)}const s=await B.getInventoryByStorage();if(console.log("📦 Raw inventory data received:",s),console.log("📊 Data structure analysis:",{totalItems:s?.length||0,hasStorageLocationId:s?.some(l=>l.storage_location_id)||!1,hasSize:s?.some(l=>l.size!==null)||!1,hasQuantity:s?.some(l=>l.total_quantity>0)||!1,hasContributingBatches:s?.some(l=>l.contributing_batches&&l.contributing_batches.length>0)||!1,itemsWithBatches:s?.filter(l=>l.contributing_batches&&l.contributing_batches.length>0).length||0,itemsWithoutBatches:s?.filter(l=>l.size!==null&&l.total_quantity>0&&(!l.contributing_batches||l.contributing_batches.length===0)).length||0,sampleItem:s?.[0]||null,sampleItemWithBatches:s?.find(l=>l.contributing_batches&&l.contributing_batches.length>0)||null,sampleItemWithoutBatches:s?.find(l=>l.size!==null&&l.total_quantity>0&&(!l.contributing_batches||l.contributing_batches.length===0))||null}),s&&s.length>0){console.log("🔍 Detailed data analysis:"),console.log("🔍 Raw data structure check:",{isArray:Array.isArray(s),length:s.length,firstItem:s[0],firstItemKeys:s[0]?Object.keys(s[0]):null}),s.forEach((n,x)=>{x<3&&console.log(`Item ${x+1}:`,{storage_location_id:n.storage_location_id,storage_location_name:n.storage_location_name,size:n.size,total_quantity:n.total_quantity,total_weight_kg:n.total_weight_kg,batch_count:n.batch_count,contributing_batches_count:n.contributing_batches?.length||0,contributing_batches:n.contributing_batches,capacity_kg:n.capacity_kg,current_usage_kg:n.current_usage_kg,utilization_percent:n.utilization_percent,status:n.status,allKeys:Object.keys(n)})});const l=s.filter(n=>n&&typeof n=="object").reduce((n,x)=>{try{const v=x.storage_location_name||x.storage_location_id||"Unknown";if(!v||typeof v!="string")return console.warn("⚠️ Invalid storage key:",v,"for item:",x),n;n[v]||(n[v]={totalItems:0,totalWeight:0,totalBatches:0,sizes:new Set,status:x.status||"unknown",capacity:x.capacity_kg||0,utilization:x.utilization_percent||0}),n[v]&&(n[v].totalItems+=1,n[v].totalWeight+=x.total_weight_kg||0,n[v].totalBatches+=x.batch_count||0,x.size!==null&&x.size!==void 0&&n[v].sizes.add(x.size))}catch(v){console.error("❌ Error processing storage summary item:",v,"item:",x)}return n},{});console.log("📊 Storage location summary:",l),console.log("✅ Data validation results:");const y={hasValidData:s.length>0,hasStorageLocations:s.some(n=>n.storage_location_id),hasSizeData:s.some(n=>n.size!==null),hasWeightData:s.some(n=>n.total_weight_kg>0),hasBatchData:s.some(n=>n.contributing_batches&&n.contributing_batches.length>0),totalWeight:s.reduce((n,x)=>n+(x.total_weight_kg||0),0),totalBatches:s.reduce((n,x)=>n+(x.batch_count||0),0),uniqueSizes:[...new Set(s.map(n=>n.size).filter(n=>n!==null))].length,uniqueStorageLocations:[...new Set(s.map(n=>n.storage_location_name))].length};console.log("📋 Validation results:",y)}X(s||[]);const r=await Xe.getSortingBatches();console.log("📦 Sorting batches received:",r),A(r||[]);const o=await B.getOldestBatchForRemoval();console.log("📦 Oldest batches received:",o),console.log("📦 Oldest batches count:",o?.length||0),o&&o.length>0&&console.log("📦 First oldest batch:",o[0]),G(o||[]);const d=await B.getSizeDemandStatistics();console.log("📊 Size demand statistics received:",d),Ee(d||[]);const t=await B.getPendingTransfers();console.log("📦 Pending transfers received:",t),Oe(t||[])}catch(s){console.error("❌ Error fetching inventory:",s),console.error("❌ Error details:",{message:s.message,stack:s.stack,error:s}),$(s.message||"Failed to fetch inventory data"),X([]),A([])}finally{ee(!1)}},[]),Le=async()=>{V(!0),await K(),V(!1)},Pe=s=>{if(s.status==="inactive"&&s.items.length>0){if(O(s.location_id)){const o=De(s.location_id);$(o);return}const r=s.items.map(o=>({size:o.size,quantity:o.quantity,total_weight:o.total_weight}));W({id:s.location_id,name:s.location,location_type:s.location_type}),M(r),T(!0)}},We=async()=>{await K(),T(!1),W(null),M([]),console.log("Transfer request created successfully!")},O=s=>ue.some(r=>r.from_storage_location_id===s&&r.status==="pending"),De=s=>{const r=ue.filter(o=>o.from_storage_location_id===s&&o.status==="pending").length;return r>0?`Contact your admin for approval. ${r} transfer request${r>1?"s":""} already pending.`:""},Me=async s=>{try{Ae(s),ze(!0);const r=await B.getBatchDetails(s.batch_id);we(r)}catch(r){console.error("Error fetching batch details:",r),we(null)}};c.useEffect(()=>{K()},[K]);const u=c.useMemo(()=>{const s=new Map;m.forEach(i=>{i.storage_location_id&&!s.has(i.storage_location_id)&&s.set(i.storage_location_id,{id:i.storage_location_id,name:i.storage_location_name,type:i.storage_location_type,status:i.storage_status||"active",capacity_kg:i.capacity_kg||0,current_usage_kg:i.current_usage_kg||0,utilization_percent:i.utilization_percent||0})});const r=Array.from(s.values()),o=r.length,d=r.filter(i=>i.status==="active").length,t=r.reduce((i,h)=>i+(h.capacity_kg||0),0),l=r.reduce((i,h)=>i+(h.current_usage_kg||0),0),y=m.filter(i=>i.size!==null&&i.total_quantity>0&&i.contributing_batches&&i.contributing_batches.length>0).length,n=o>0?r.reduce((i,h)=>i+(h.utilization_percent||0),0)/o:0,x=m.reduce((i,h)=>(h.size!==null&&h.total_weight_kg>0&&(i[h.size]=(i[h.size]||0)+h.total_weight_kg),i),{});console.log("📊 Size distribution (total across all storage):",x),console.log("🔍 Size 9 total weight:",x[9]||"NOT FOUND"),console.log("🔍 All sizes found:",Object.keys(x).map(Number).sort((i,h)=>i-h));const v=m.filter(i=>i.size===9);console.log("🔍 Size 9 items by storage:",v.map(i=>({storage:i.storage_location_name,weight:i.total_weight_kg})));const le=new Map;m.forEach(i=>{if(i.storage_location_id&&i.total_weight_kg>0){const h=i.storage_location_id;le.has(h)||le.set(h,{storage_location_id:i.storage_location_id,storage_location_name:i.storage_location_name,total_weight_kg:0,utilization_percent:i.utilization_percent||0,capacity_kg:i.capacity_kg||0}),le.get(h).total_weight_kg+=i.total_weight_kg}});const Fe=Array.from(le.values()).sort((i,h)=>h.total_weight_kg-i.total_weight_kg).slice(0,3);console.log("🏆 Top storage units by total weight:",Fe);const re=[];return n>85&&re.push({type:"warning",message:"High overall utilization"}),d<o*.8&&re.push({type:"info",message:"Some storage units inactive"}),l>t*.9&&re.push({type:"error",message:"Near capacity limit"}),{totalStorage:o,activeStorage:d,totalCapacity:t,totalUsed:l,totalItems:y,avgUtilization:n,sizeDistribution:x,topStorage:Fe,alerts:re}},[m]),Ue=c.useMemo(()=>{const s={};m.forEach(t=>{const l=t.storage_location_id||"unknown";if(s[l]||(s[l]={location:t.storage_location_name||"Unknown Storage",location_id:t.storage_location_id||"unknown",location_type:t.storage_location_type||"unknown",status:t.storage_status||"active",capacity_kg:t.capacity_kg||0,current_usage_kg:t.current_usage_kg||0,available_capacity_kg:t.available_capacity_kg||0,utilization_percent:t.utilization_percent||0,items:[]}),t.size===null||t.size!==null&&t.size!==void 0&&t.total_quantity>0){if(t.size===null)return;if(t.contributing_batches&&t.contributing_batches.length>0){const n=s[l].items.findIndex(x=>x.size===t.size);n>=0?(s[l].items[n].quantity+=t.total_quantity,s[l].items[n].total_weight+=t.total_weight_kg||0,s[l].items[n].contributing_batches=[...s[l].items[n].contributing_batches||[],...t.contributing_batches],s[l].items[n].batch_count=(s[l].items[n].batch_count||0)+(t.batch_count||0)):s[l].items.push({id:`${l}-${t.size}`,size:t.size,quantity:t.total_quantity,total_weight:t.total_weight_kg||0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),batch_count:t.batch_count||0,contributing_batches:t.contributing_batches||[]})}else console.warn("⚠️ Skipping inventory item without proper batch data:",{storage_location_id:t.storage_location_id,size:t.size,quantity:t.total_quantity,hasContributingBatches:t.contributing_batches&&t.contributing_batches.length>0,contributingBatchesCount:t.contributing_batches?.length||0})}}),Object.values(s).forEach(t=>{t.items.sort((l,y)=>l.size-y.size)});const r=Object.values(s),o=r.map(t=>t.location_id),d=o.filter((t,l)=>o.indexOf(t)!==l);return d.length>0&&console.warn("⚠️ Duplicate location IDs found:",d),console.log("🏭 Processed storage units:",{totalUnits:r.length,unitsWithItems:r.filter(t=>t.items.length>0).length,totalItems:r.reduce((t,l)=>t+l.items.length,0),itemsWithBatches:r.reduce((t,l)=>t+l.items.filter(y=>y.contributing_batches&&y.contributing_batches.length>0).length,0),sampleUnit:r[0]||null,sampleItemWithBatches:r.find(t=>t.items.some(l=>l.contributing_batches&&l.contributing_batches.length>0))?.items.find(t=>t.contributing_batches&&t.contributing_batches.length>0)||null,locationIds:o,duplicateIds:d}),console.log("🔍 Detailed processing analysis:"),r.forEach((t,l)=>{l<2&&console.log(`Storage Unit ${l+1} (${t.location}):`,{location_id:t.location_id,status:t.status,capacity_kg:t.capacity_kg,current_usage_kg:t.current_usage_kg,utilization_percent:t.utilization_percent,totalItems:t.items.length,items:t.items.map(y=>({size:y.size,quantity:y.quantity,total_weight:y.total_weight,batch_count:y.batch_count,contributing_batches_count:y.contributing_batches?.length||0}))})}),r},[m]),{user:ds}=qe();return de&&m.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-blue-600 font-medium",children:"Loading inventory..."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 content-container responsive-padding",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(L,{className:"h-6 w-6 md:h-8 md:w-8 text-blue-600"}),"Inventory Management"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage fish inventory across storage locations"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(S,{onClick:()=>F("transfers"),variant:"outline",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Transfer Approvals"]}),e.jsxs(S,{onClick:()=>F("dashboard"),variant:"outline",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(fe,{className:"w-4 h-4"}),"Dashboard"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Storage"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:u.totalStorage})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(L,{className:"w-6 h-6 text-blue-600"})})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm",children:[e.jsxs("span",{className:"text-green-600 font-medium",children:[u.activeStorage," active"]}),e.jsx("span",{className:"text-gray-400 mx-2",children:"•"}),e.jsxs("span",{className:"text-gray-500",children:[u.totalStorage-u.activeStorage," inactive"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Capacity"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[u.totalCapacity.toFixed(1),"kg"]})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(U,{className:"w-6 h-6 text-green-600"})})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[u.totalUsed.toFixed(1),"kg used"]}),e.jsx("span",{className:"text-gray-400 mx-2",children:"•"}),e.jsxs("span",{className:"text-gray-500",children:[(u.totalCapacity-u.totalUsed).toFixed(1),"kg available"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Utilization"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:[u.avgUtilization.toFixed(1),"%"]})]}),e.jsx("div",{className:"p-3 bg-orange-100 rounded-lg",children:e.jsx(ne,{className:"w-6 h-6 text-orange-600"})})]}),e.jsx("div",{className:"mt-2 flex items-center text-sm",children:u.avgUtilization>85?e.jsxs("span",{className:"text-red-600 font-medium flex items-center",children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),"High usage"]}):u.avgUtilization>70?e.jsxs("span",{className:"text-yellow-600 font-medium flex items-center",children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),"Moderate usage"]}):e.jsxs("span",{className:"text-green-600 font-medium flex items-center",children:[e.jsx(ie,{className:"w-4 h-4 mr-1"}),"Optimal usage"]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Items"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:u.totalItems})]}),e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(Z,{className:"w-6 h-6 text-purple-600"})})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Size classes"}),e.jsx("span",{className:"text-gray-400 mx-2",children:"•"}),e.jsxs("span",{className:"text-gray-500",children:["Across ",u.totalStorage," locations"]})]})]})]}),u.alerts.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(is,{className:"w-5 h-5 text-amber-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"System Alerts"})]}),e.jsx("div",{className:"space-y-2",children:u.alerts.map((s,r)=>e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg ${s.type==="error"?"bg-red-50 border border-red-200":s.type==="warning"?"bg-yellow-50 border border-yellow-200":"bg-blue-50 border border-blue-200"}`,children:[e.jsx(P,{className:`w-4 h-4 ${s.type==="error"?"text-red-600":s.type==="warning"?"text-yellow-600":"text-blue-600"}`}),e.jsx("span",{className:`text-sm font-medium ${s.type==="error"?"text-red-800":s.type==="warning"?"text-yellow-800":"text-blue-800"}`,children:s.message})]},r))})]}),_&&e.jsx("div",{className:`border rounded-lg p-4 ${_.includes("Contact your admin")?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:`w-5 h-5 ${_.includes("Contact your admin")?"text-yellow-600":"text-red-600"}`}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-medium ${_.includes("Contact your admin")?"text-yellow-800":"text-red-800"}`,children:_.includes("Contact your admin")?"Transfer Request Pending":"Error Loading Data"}),e.jsx("p",{className:`text-sm mt-1 ${_.includes("Contact your admin")?"text-yellow-700":"text-red-700"}`,children:_}),!_.includes("Contact your admin")&&e.jsx(S,{onClick:K,variant:"outline",size:"sm",className:"mt-2",children:"Try Again"}),_.includes("Contact your admin")&&e.jsx(S,{onClick:()=>F("transfers"),variant:"outline",size:"sm",className:"mt-2",children:"View Transfer Approvals"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsx("div",{className:"flex-1 w-full sm:max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(es,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Ve,{placeholder:"Search storage locations...",value:R,onChange:s=>Y(s.target.value),className:"pl-10 w-full"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:w,onChange:s=>q(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"capacity",children:"Sort by Capacity"}),e.jsx("option",{value:"utilization",children:"Sort by Utilization"}),e.jsx("option",{value:"items",children:"Sort by Items"})]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden",children:[e.jsx(S,{onClick:()=>f("grid"),variant:g==="grid"?"default":"ghost",size:"sm",className:"rounded-none border-0 hover:bg-blue-50",title:"Grid View",children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx(S,{onClick:()=>f("list"),variant:g==="list"?"default":"ghost",size:"sm",className:"rounded-none border-0 hover:bg-green-50",title:"List View",children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx(S,{onClick:()=>f("analytics"),variant:g==="analytics"?"default":"ghost",size:"sm",className:"rounded-none border-0 hover:bg-purple-50",title:"Analytics View",children:e.jsx(Qe,{className:"w-4 h-4"})})]}),e.jsxs(S,{onClick:Le,variant:"outline",size:"sm",disabled:j,className:"flex-1 sm:flex-none",children:[e.jsx(ss,{className:`w-4 h-4 mr-2 ${j?"animate-spin":""}`}),"Refresh"]})]})]})}),g==="analytics"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ts,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Size Distribution"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Total across all storage locations"})]})]}),e.jsx("div",{className:"space-y-3",children:Object.entries(u.sizeDistribution).sort(([,s],[,r])=>r-s).slice(0,12).map(([s,r])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:s})}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Size ",s]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${r/Math.max(...Object.values(u.sizeDistribution).map(o=>o))*100}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-600 w-16 text-right",children:[r.toFixed(1),"kg"]})]})]},s))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(pe,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Oldest Batches (FIFO)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Next batches to be removed"})]})]}),e.jsxs("div",{className:"space-y-3",children:[N.slice(0,5).map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 rounded-lg border border-orange-200 cursor-pointer hover:bg-orange-100 transition-colors",onClick:()=>Me(s),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-semibold text-orange-600",children:["#",r+1]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Batch ",s.batch_number]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Size ",s.size_class," • ",s.days_in_storage," days old"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-orange-600",children:[s.total_weight_kg?.toFixed(1),"kg"]}),e.jsx("p",{className:"text-xs text-orange-500 mt-1",children:"Click to view details"})]})]},s.batch_id)),N.length===0&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(pe,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No batches available for removal"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Check console for debugging info"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ne,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Size Demand Statistics"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Based on outlet orders (most requested first)"})]})]}),e.jsxs("div",{className:"space-y-3",children:[ke.slice(0,8).map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-semibold text-purple-600",children:["#",r+1]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Size ",s.size_class]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.total_orders," orders • ",s.unique_outlets," outlets •",s.days_span>0?`${s.days_span} days span`:"Recent"]}),e.jsxs("p",{className:"text-xs text-purple-600",children:["Grade ",s.most_requested_grade," preferred"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-purple-600",children:[s.total_weight_kg_requested.toFixed(1),"kg"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"total requested"})]})]},s.size_class)),ke.length===0&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(ne,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No size demand data available"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(as,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Top Storage Units"}),e.jsx("p",{className:"text-xs text-gray-500",children:"By total weight across all sizes"})]})]}),e.jsx("div",{className:"space-y-3",children:u.topStorage.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${r===0?"bg-yellow-100 text-yellow-600":r===1?"bg-gray-100 text-gray-600":"bg-orange-100 text-orange-600"}`,children:e.jsxs("span",{className:"text-sm font-bold",children:["#",r+1]})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.storage_location_name||`Storage Unit ${r+1}`}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.utilization_percent?.toFixed(1),"% utilized"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-600",children:[s.total_weight_kg?.toFixed(1),"kg"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"total weight"})]})]},`top-storage-${s.storage_location_id}-${r}`))})]})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:Ue.filter(s=>!R||s.location.toLowerCase().includes(R.toLowerCase())).sort((s,r)=>{switch(w){case"capacity":return r.capacity_kg-s.capacity_kg;case"utilization":return r.utilization_percent-s.utilization_percent;case"items":return r.items.length-s.items.length;default:return s.location.localeCompare(r.location)}}).map((s,r)=>{const o=te.has(s.location_id);return e.jsxs(k,{className:"card-shadow",children:[e.jsxs("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>{const d=new Set(te);o?d.delete(s.location_id):d.add(s.location_id),he(d)},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[o?e.jsx(ls,{className:"w-5 h-5 text-gray-400"}):e.jsx(rs,{className:"w-5 h-5 text-gray-400"}),e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(L,{className:"w-5 h-5 text-blue-600"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.location}),O(s.location_id)&&e.jsxs(ce,{variant:"destructive",className:"text-xs",children:[ue.filter(d=>d.from_storage_location_id===s.location_id&&d.status==="pending").length," Pending"]})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.location_type," • ",s.items.length," size classes"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[s.current_usage_kg.toFixed(1),"kg / ",s.capacity_kg,"kg"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.utilization_percent.toFixed(1),"% utilized"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.utilization_percent>90&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs",children:[e.jsx(P,{className:"w-3 h-3"}),e.jsx("span",{children:"Full"})]}),e.jsx(ce,{variant:s.status==="active"?"default":"secondary",className:s.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:s.status}),s.status==="inactive"&&s.items.length>0&&e.jsxs(S,{onClick:d=>{d.stopPropagation(),Pe(s)},variant:"outline",size:"sm",className:`${O(s.location_id)?"text-red-600 border-red-200 hover:bg-red-50":"text-orange-600 border-orange-200 hover:bg-orange-50"}`,children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),O(s.location_id)?"Pending Transfer":"Transfer"]}),s.status==="active"&&s.items.length>0&&e.jsx(S,{onClick:async d=>{if(d.stopPropagation(),!ae){if(O(s.location_id)){const t=De(s.location_id);$(t);return}Ce(!0);try{const t=s.items.map(l=>({size:l.size,quantity:l.quantity,total_weight:l.total_weight}));W({id:s.location_id,name:s.location,location_type:s.location_type}),M(t),T(!0)}finally{Ce(!1)}}},disabled:ae,variant:"outline",size:"sm",className:`${O(s.location_id)?"text-red-600 border-red-200 hover:bg-red-50":"text-blue-600 border-blue-200 hover:bg-blue-50"} ${ae?"opacity-50 cursor-not-allowed":""}`,children:ae?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-1 animate-spin"}),"Opening..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"w-4 h-4 mr-1"}),O(s.location_id)?"Pending Transfer":"Quick Transfer"]})})]})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Capacity"}),e.jsxs("span",{className:`text-xs font-medium ${s.utilization_percent>90?"text-red-600":s.utilization_percent>70?"text-yellow-600":"text-green-600"}`,children:[s.utilization_percent.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-500 ease-out ${s.utilization_percent>90?"bg-gradient-to-r from-red-400 to-red-600":s.utilization_percent>70?"bg-gradient-to-r from-yellow-400 to-yellow-600":"bg-gradient-to-r from-green-400 to-green-600"}`,style:{width:`${Math.min(s.utilization_percent,100)}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsx("span",{children:"0kg"}),e.jsxs("span",{children:[s.capacity_kg,"kg"]})]})]})]}),o&&e.jsx("div",{className:"border-t border-gray-100 p-4",children:s.items.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No inventory items"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Inventory Items"}),s.items.map(d=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>z(d),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:d.size})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Size ",d.size]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[d.batch_count," batch",d.batch_count!==1?"es":""]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-600",children:[d.total_weight.toFixed(1),"kg"]}),e.jsx(Ke,{className:"w-4 h-4 text-gray-400"})]})]},d.id))]})})]},`${s.location_id}-${r}`)})}),p&&e.jsx(je,{open:!!p,onOpenChange:()=>z(null),children:e.jsxs(ye,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Ne,{children:e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"Size ",p.size," - Inventory Details"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(k,{children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Quantity"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p.quantity})]})]})})}),e.jsx(k,{children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Weight"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[p.total_weight.toFixed(1),"kg"]})]})]})})}),e.jsx(k,{children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Weight/Fish"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[p.quantity>0?(p.total_weight/p.quantity).toFixed(2):"0.00","kg"]})]})]})})}),e.jsx(k,{children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Contributing Batches"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p.batch_count||p.contributing_batches?.length||0})]})]})})})]}),e.jsxs(k,{children:[e.jsx(Ze,{children:e.jsxs(Je,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),"Contributing Batches",p.contributing_batches&&p.contributing_batches.length>6&&e.jsx("span",{className:"text-sm text-gray-500 font-normal ml-2",children:"(scroll to see all)"})]})}),e.jsx(D,{children:e.jsx("div",{className:"border border-gray-200 rounded-lg bg-gray-50 max-h-[500px] overflow-y-auto",children:e.jsx("div",{className:"p-4 space-y-4",children:p.contributing_batches&&p.contributing_batches.length>0?p.contributing_batches.map((s,r)=>e.jsx("div",{className:"p-4 border border-gray-300 rounded-lg bg-white shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Batch Number"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.batch_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Weight Added"}),e.jsxs("p",{className:"font-semibold text-green-600 text-lg",children:[s.weight_kg?.toFixed(1),"kg"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Quantity Added"}),e.jsxs("p",{className:"font-semibold text-gray-500",children:["Batch #",s.batch_number]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Storage Location"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.storage_location_name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Farmer"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.farmer_name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Processing Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.processing_date||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Added Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:new Date(s.added_date).toLocaleDateString()})]})]})},s.batch_id||r)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No contributing batches found"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"This may indicate that the data is still being processed or there's an issue with the batch tracking."})]})})})})]})]})]})}),E&&se&&e.jsx(os,{isOpen:E,onClose:()=>{T(!1),W(null),M([])},sourceStorage:se,itemsToTransfer:me,onTransferComplete:We}),Se&&e.jsx(je,{open:Se,onOpenChange:ze,children:e.jsxs(ye,{className:"max-w-2xl",children:[e.jsx(Ne,{children:e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-orange-600"}),"Batch Details - ",Be?.batch_number]})}),I?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Batch Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Batch Number"}),e.jsx("p",{className:"font-semibold text-gray-900",children:I.batch?.batch_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Created Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:I.batch?.created_at?new Date(I.batch.created_at).toLocaleDateString():"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Processing Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:I.batch?.processing_record?.processing_date||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Farmer"}),e.jsx("p",{className:"font-semibold text-gray-900",children:I.batch?.processing_record?.warehouse_entry?.farmers?.name||"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Remaining Sizes"}),e.jsxs("div",{className:"space-y-3",children:[I.sizes?.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:s.size_class})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Size ",s.size_class]}),e.jsx("p",{className:"text-sm text-gray-500",children:s.storage_location_name})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-blue-600",children:[s.total_weight_kg?.toFixed(1),"kg"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:[s.total_pieces," pieces"]})]})]},r)),(!I.sizes||I.sizes.length===0)&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(L,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No sizes remaining in this batch"})]})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(oe,{className:"w-8 h-8 mx-auto mb-2 text-gray-400 animate-spin"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading batch details..."})]})]})})]})})}export{Ts as default};
