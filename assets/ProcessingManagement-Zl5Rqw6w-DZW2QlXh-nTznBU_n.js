const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/entryCodeGenerator-B82PSXKH-CycamVnB-BX21HUcr.js","assets/index-D0a7Ul_G.js","assets/index-c8IhzymI.css"])))=>i.map(i=>d[i]);
import{w as p,c as e,K as J,n as y,g as Oe,B as w,P as L,O as M,F as be,a as E,l as f,d as he,b as se,J as z,S as U,_ as Q,E as ze,y as Ie,h as Ge}from"./index-D0a7Ul_G.js";import{_ as Te,j as We,C as Be,N as Re,P as re}from"./select-DqWpyIkf-D_8tzK0d-BBn-WGEA.js";import{V as pe,q as Le,_ as je,H as ue,C as fe}from"./dialog-NtgNh5u1-2hJTriox-IAMkB2HC.js";import{getOrGenerateProcessingCode as Me,getOrGenerateEntryCode as Ue}from"./entryCodeGenerator-B82PSXKH-CycamVnB-BX21HUcr.js";import{h as ie}from"./refresh-cw-BlPh9kri-DxVFEABi-aZB1kqTg.js";import{p as Ye}from"./plus-FJ0CIBRX-DLM2sgk0-DVYylXdR.js";import{n as _e}from"./trending-up-DUO3gdV8-ywoZrOkl-C4LPeYLB.js";import{r as Ke}from"./star-arJKEdXF-DFv3ZT5S-XOliRUi8.js";import{i as Ve}from"./clock-sArWPAJm-BmsKQooK-qn3wSWAF.js";import{o as le}from"./map-pin-C-M6umvy-CUBiYWs8-BzOTRlrX.js";import{h as ve}from"./calendar-CU6tj0PZ-Ucpt8Hnz-1IrCz7t9.js";import{r as we}from"./circle-alert-DCgzIeFQ-JtILe7g3-BxoVeYrg.js";import{t as qe}from"./scale-Coap2kcd-Bsk2bCpZ-BAcJJTw5.js";import{a as $e}from"./weight-CtEhXJRi-DcPJONPf-CLEOuACO.js";import{p as He}from"./circle-check-big-BZ9nasO6-BWVBSi9U-D_bzRs9E.js";import"./index-B7iGXlpc-YR4igk-O-CmE8Ucvu.js";import"./index-io8wS31O-C_L8DqSR-BTUohV_t.js";import"./index-CEgc-Zw--jggqibQ8-DNEgScq_.js";const Pe=(a,l=Pe,t=l.f||(l.f=["assets/entryCodeGenerator-B82PSXKH-CycamVnB.js","assets/index-Cx51dYQZ.js","assets/index-c8IhzymI.css"]))=>a.map(h=>t[h]),Se=(a,l=Se,t=l.f||(l.f=["assets/entryCodeGenerator-B82PSXKH.js","assets/index-CpNFiXA1.js","assets/index-c8IhzymI.css"]))=>a.map(h=>t[h]);var Xe=Object.defineProperty,Je=Object.defineProperties,Qe=Object.getOwnPropertyDescriptors,Ne=Object.getOwnPropertySymbols,Ze=Object.prototype.hasOwnProperty,es=Object.prototype.propertyIsEnumerable,ye=(a,l,t)=>l in a?Xe(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,Y=(a,l)=>{for(var t in l||(l={}))Ze.call(l,t)&&ye(a,t,l[t]);if(Ne)for(var t of Ne(l))es.call(l,t)&&ye(a,t,l[t]);return a},K=(a,l)=>Je(a,Qe(l)),A=(a,l,t)=>new Promise((h,r)=>{var k=N=>{try{P(t.next(N))}catch(j){r(j)}},_=N=>{try{P(t.throw(N))}catch(j){r(j)}},P=N=>N.done?h(N.value):Promise.resolve(N.value).then(k,_);P((t=t.apply(a,l)).next())});const Z=a=>({A:"bg-green-500",B:"bg-yellow-500",C:"bg-orange-500"})[a]||"bg-gray-500",ee=a=>a>=80?"text-green-600":a>=70?"text-yellow-600":"text-red-600",ss=({data:a,dataKey:l})=>{if(!a||a.length===0)return e.jsx("div",{className:"flex items-center justify-center h-32 text-gray-500",children:"No data available"});const t=Math.max(...a.map(h=>h[l]||0));return e.jsx("div",{className:"flex items-end justify-between h-32 gap-1",children:a.map((h,r)=>e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("div",{className:"bg-blue-500 rounded-t w-full min-h-[4px]",style:{height:`${t>0?(h[l]||0)/t*100:0}%`}}),e.jsx("span",{className:"text-xs text-gray-600 mt-1 text-center",children:h.date?new Date(h.date).getDate():r+1})]},r))})},as=({data:a,dataKey:l})=>{if(!a||a.length===0)return e.jsx("div",{className:"flex items-center justify-center h-32 text-gray-500",children:"No data available"});const t=a.map(_=>_[l]||0),h=Math.max(...t),r=Math.min(...t),k=h-r||1;return e.jsx("div",{className:"relative h-32",children:e.jsxs("svg",{width:"100%",height:"100%",className:"overflow-visible",children:[e.jsx("polyline",{fill:"none",stroke:"#8b5cf6",strokeWidth:"2",points:a.map((_,P)=>{const N=a.length>1?P/(a.length-1)*100:50,j=100-((_[l]||0)-r)/k*80,v=isNaN(j)?50:Math.max(0,Math.min(100,j));return`${N},${v}`}).join(" ")}),a.map((_,P)=>{const N=a.length>1?P/(a.length-1)*100:50,j=100-((_[l]||0)-r)/k*80,v=isNaN(j)?50:Math.max(0,Math.min(100,j));return e.jsx("circle",{cx:`${N}%`,cy:`${v}%`,r:"3",fill:"#8b5cf6"},P)})]})})},ts=({stats:a,processingRecords:l})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsx(w,{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white",children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm",children:"Ready for Processing"}),e.jsx("p",{className:"text-3xl font-bold",children:a.readyForProcessing})]}),e.jsx(we,{className:"h-8 w-8 text-blue-200"})]})})}),e.jsx(w,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white",children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-sm",children:"Total Processed"}),e.jsx("p",{className:"text-3xl font-bold",children:a.totalProcessed})]}),e.jsx(He,{className:"h-8 w-8 text-green-200"})]})})}),e.jsx(w,{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white",children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm",children:"Average Yield"}),e.jsxs("p",{className:"text-3xl font-bold",children:[a.averageYield,"%"]})]}),e.jsx(_e,{className:"h-8 w-8 text-purple-200"})]})})}),e.jsx(w,{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white",children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-100 text-sm",children:"Total Waste"}),e.jsxs("p",{className:"text-3xl font-bold",children:[a.totalWaste,"kg"]})]}),e.jsx(be,{className:"h-8 w-8 text-orange-200"})]})})})]}),rs=({selectedEntryId:a,setSelectedEntryId:l,warehouseEntries:t,processingRecords:h,formData:r,setFormData:k,selectedStorage:_,setSelectedStorage:P,storageLocations:N,isProcessing:j,onSubmit:v,onClose:I})=>{var G,T,V,W,x,q,$,O;const B=t.filter(i=>!a||i.id===a).filter(i=>!h.some(D=>D.warehouse_entry_id===i.id)),R=(i,D)=>{k(K(Y({},r),{[i]:D}))};return a?e.jsxs("div",{className:"py-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-1",children:"Selected Entry"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx(f,{variant:"outline",className:"bg-white",children:(G=t.find(i=>i.id===a))==null?void 0:G.entry_code}),e.jsxs("span",{className:"text-blue-700",children:[(T=t.find(i=>i.id===a))==null?void 0:T.total_weight,"kg - ",(V=t.find(i=>i.id===a))==null?void 0:V.total_pieces," pieces"]}),e.jsxs("span",{className:"text-blue-600",children:["â€¢ ",(W=t.find(i=>i.id===a))==null?void 0:W.farmer_name]})]})]}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>{l(""),k({})},children:"Change Entry"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{className:"text-sm font-medium",children:"Pre-Processing Weight (kg)"}),e.jsx(Q,{type:"number",value:((x=t.find(i=>i.id===a))==null?void 0:x.total_weight)||"",readOnly:!0,className:"bg-gray-50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{className:"text-sm font-medium",children:"Post-Processing Weight (kg) *"}),e.jsx(Q,{type:"number",step:"0.1",value:r.post_processing_weight||"",onChange:i=>R("post_processing_weight",Number(i.target.value)),placeholder:"Enter weight after processing"})]})]}),r.post_processing_weight&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Processing Calculations"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Processing Waste"}),e.jsxs("p",{className:"text-xl font-bold text-red-600",children:[r.processing_waste||0,"kg"]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Processing Yield"}),e.jsxs("p",{className:`text-xl font-bold ${ee(r.processing_yield||0)}`,children:[r.processing_yield||0,"%"]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Weight Loss"}),e.jsxs("p",{className:"text-xl font-bold text-orange-600",children:[((r.processing_waste||0)/(((q=t.find(i=>i.id===a))==null?void 0:q.total_weight)||1)*100).toFixed(1),"%"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{className:"text-sm font-medium",children:"Number of Fish"}),e.jsx(Q,{type:"number",value:(($=t.find(i=>i.id===a))==null?void 0:$.total_pieces)||"",readOnly:!0,className:"bg-gray-50"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Inherited from warehouse entry"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{className:"text-sm font-medium",children:"Final Grade *"}),e.jsxs(Te,{value:r.final_grade||"",onValueChange:i=>R("final_grade",i),children:[e.jsx(We,{children:e.jsx(Be,{placeholder:"Select grade"})}),e.jsxs(Re,{children:[e.jsx(re,{value:"A",children:"Grade A"}),e.jsx(re,{value:"B",children:"Grade B"}),e.jsx(re,{value:"C",children:"Grade C"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Size classification will be determined during sorting process"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{className:"text-sm font-medium",children:"Fish Type"}),e.jsx(Q,{value:((O=t.find(i=>i.id===a))==null?void 0:O.fish_type)||"Not specified",readOnly:!0,className:"bg-gray-50"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Inherited from warehouse entry"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(se,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Next Step: Sorting"}),e.jsx("p",{className:"text-sm text-blue-700",children:"After processing, fish will be sorted into size classes and assigned to storage locations."})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(y,{variant:"outline",onClick:I,children:"Cancel"}),e.jsx(y,{onClick:v,className:"bg-blue-600 hover:bg-blue-700",disabled:!r.post_processing_weight||!r.final_grade||j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):"Complete Processing"})]})]})]}):e.jsxs("div",{className:"py-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(se,{className:"h-8 w-8 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Select Warehouse Entry"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Choose a warehouse entry to begin processing"})]}),B.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(we,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No Entries Available"}),e.jsx("p",{className:"text-sm text-gray-400",children:t.length===0?"No warehouse entries found":"All warehouse entries have been processed"}),t.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:t.length})," total warehouse entries exist,",e.jsxs("strong",{children:[" ",h.length]})," have been processed"]})})]}):e.jsx("div",{className:"space-y-3",children:B.map(i=>e.jsx(w,{className:"p-4 hover:shadow-md transition-all duration-200 cursor-pointer border hover:border-blue-300",onClick:()=>l(i.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(qe,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(f,{variant:"outline",className:"font-medium",children:i.entry_code}),e.jsxs(f,{className:"bg-green-500 text-white font-medium",children:[i.total_pieces," pieces"]})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"h-4 w-4"}),i.total_weight,"kg"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"h-4 w-4"}),new Date(i.entry_date).toLocaleDateString()]}),e.jsxs("span",{className:"flex items-center gap-1 font-medium text-gray-900",children:[e.jsx(le,{className:"h-4 w-4"}),i.farmer_name]})]})]})]}),e.jsx(y,{size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:D=>{D.stopPropagation(),l(i.id)},children:"Select"})]})},i.id))}),e.jsxs("div",{className:"flex justify-between pt-6 border-t mt-6",children:[e.jsxs(y,{variant:"outline",onClick:()=>{window.location.reload()},className:"text-blue-600 border-blue-300 hover:bg-blue-50",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Refresh Entries"]}),e.jsx(y,{variant:"outline",onClick:I,children:"Cancel"})]})]})};function vs({onNavigate:a}){var l;const[t,h]=p.useState([]),[r,k]=p.useState([]),[_,P]=p.useState([]),[N,j]=p.useState([]),[v,I]=p.useState(""),[G,T]=p.useState(""),[V,W]=p.useState(!1),[x,q]=p.useState(null),[$,O]=p.useState(!1),[B,R]=p.useState(!1),[i,D]=p.useState(!1),[ne,ce]=p.useState(!1),[g,H]=p.useState({}),[F,Ce]=p.useState({totalProcessed:0,readyForProcessing:0,averageYield:0,totalWaste:0,gradeDistribution:{A:0,B:0,C:0},weeklyProcessing:[],yieldTrends:[]}),de=()=>A(this,null,function*(){const{data:s,error:n}=yield z.from("warehouse_entries").select(`
        *,
        farmers!inner(name)
      `).order("entry_date",{ascending:!1});if(n)console.error("Error fetching warehouse entries:",n.message);else{const c=yield Promise.all((s||[]).map(d=>A(this,null,function*(){var b;const S=d.entry_code||(yield Ue(d.id));return K(Y({},d),{farmer_name:((b=d.farmers)==null?void 0:b.name)||`Farmer ID: ${d.farmer_id}`,entry_code:S})})));h(c)}}),X=()=>A(this,null,function*(){const{data:s,error:n}=yield z.from("processing_records").select(`
        *,
        warehouse_entries!inner(
          id,
          farmer_id,
          farmers!inner(name)
        )
      `).order("processing_date",{ascending:!1});if(n)console.error("Error fetching processing records:",n.message);else{const c=yield Promise.all((s||[]).map(d=>A(this,null,function*(){var b,S;const u=d.grading_results||{},o=d.size_distribution||{},m=Object.keys(u)[0]||"A";Object.keys(o)[0];const C=d.processing_code||(yield Me(d.id));return K(Y({},d),{farmer_name:((S=(b=d.warehouse_entries)==null?void 0:b.farmers)==null?void 0:S.name)||"Unknown Farmer",final_grade:m,final_size:null,storage_location:"Not specified",ready_for_dispatch:!1,processing_code:C})})));k(c),P(c.slice(0,5))}}),oe=()=>A(this,null,function*(){try{const{data:s,error:n}=yield z.from("storage_locations").select("*").eq("status","active").order("name");if(n)console.warn("Storage locations table not found, using default locations:",n.message),j([{id:"1",name:"Cold Storage A",capacity:2e3},{id:"2",name:"Cold Storage B",capacity:1500},{id:"3",name:"Freezer Unit 1",capacity:1e3},{id:"4",name:"Processing Area 1",capacity:500},{id:"5",name:"Processing Area 2",capacity:500}]);else{const{data:c,error:d}=yield z.from("processing_records").select("post_processing_weight"),b=new Map;if(c&&!d){const u=c.reduce((o,m)=>o+(m.post_processing_weight||0),0)/((s==null?void 0:s.length)||1);s==null||s.forEach(o=>{b.set(o.name,u)})}const S=((s==null?void 0:s.map(u=>({id:u.id,name:u.name,capacity:u.capacity_kg,currentUsage:b.get(u.name)||0,availableCapacity:u.capacity_kg-(b.get(u.name)||0)})))||[]).filter(u=>u.availableCapacity>0);S.length===0?(console.warn("No available storage locations found, using defaults"),j([{id:"1",name:"Cold Storage A",capacity:2e3},{id:"2",name:"Cold Storage B",capacity:1500},{id:"3",name:"Freezer Unit 1",capacity:1e3},{id:"4",name:"Processing Area 1",capacity:500},{id:"5",name:"Processing Area 2",capacity:500}])):j(S)}}catch(s){console.warn("Error fetching storage locations, using defaults:",s),j([{id:"1",name:"Cold Storage A",capacity:2e3},{id:"2",name:"Cold Storage B",capacity:1500},{id:"3",name:"Freezer Unit 1",capacity:1e3},{id:"4",name:"Processing Area 1",capacity:500},{id:"5",name:"Processing Area 2",capacity:500}])}}),ke=()=>A(this,null,function*(){R(!0);try{yield Promise.all([de(),X(),oe()])}finally{R(!1)}}),De=()=>{const s=t.filter(o=>!r.some(m=>m.warehouse_entry_id===o.id)).length,n=r.reduce((o,m)=>o+(m.processing_yield||0),0),c=r.length>0?n/r.length:0,d=r.reduce((o,m)=>o+(m.processing_waste||0),0),b=r.reduce((o,m)=>(m.final_grade&&["A","B","C"].includes(m.final_grade)&&o[m.final_grade]++,o),{A:0,B:0,C:0}),S=Array.from({length:7},(o,m)=>{const C=new Date;C.setDate(C.getDate()-m);const xe=C.toISOString().split("T")[0],Ae=r.filter(Fe=>{var ge;return(ge=Fe.processing_date)==null?void 0:ge.startsWith(xe)}).length;return{date:xe,count:Ae}}).reverse(),u=r.slice(0,10).map(o=>({date:new Date(o.processing_date).toLocaleDateString(),yield:o.processing_yield||0})).reverse();Ce({totalProcessed:r.length,readyForProcessing:s,averageYield:Number(c.toFixed(1)),totalWaste:Number(d.toFixed(1)),gradeDistribution:b,weeklyProcessing:S,yieldTrends:u})};p.useEffect(()=>{if(v&&t.length>0){const s=t.find(n=>n.id===v);s&&H(n=>K(Y({},n),{warehouse_entry_id:s.id,pre_processing_weight:s.total_weight?Number(s.total_weight):0,post_processing_weight:0,final_grade:n.final_grade||"",processing_date:new Date().toISOString()}))}},[v,t]),p.useEffect(()=>{if(g.pre_processing_weight&&g.post_processing_weight!==void 0){const s=g.pre_processing_weight-g.post_processing_weight,n=g.pre_processing_weight>0?g.post_processing_weight/g.pre_processing_weight*100:0;H(c=>K(Y({},c),{processing_waste:s,processing_yield:Number(n.toFixed(2))}))}},[g.pre_processing_weight,g.post_processing_weight]),p.useEffect(()=>{de(),X(),oe()},[]),p.useEffect(()=>{De()},[t,r]);const Ee=()=>A(this,null,function*(){if(!i){D(!0);try{const s=N.find(C=>C.name===G),n=t.find(C=>C.id===v),{data:c,error:d}=yield z.from("processing_records").select("id, processing_code").eq("warehouse_entry_id",v).single();if(d&&d.code!=="PGRST116")throw d;if(c){alert(`This warehouse entry has already been processed! Processing Code: ${c.processing_code}`);return}const{generateUniqueProcessingCode:b}=yield ze(()=>A(this,null,function*(){const{generateUniqueProcessingCode:C}=yield Ie(()=>Ge(()=>import("./entryCodeGenerator-B82PSXKH-CycamVnB-BX21HUcr.js"),__vite__mapDeps([0,1,2])),Pe([0,1,2]));return{generateUniqueProcessingCode:C}}),Se([0,1,2])),S=yield b(),u=Math.round((g.post_processing_weight||0)*5),o={warehouse_entry_id:g.warehouse_entry_id,processing_date:new Date().toISOString().split("T")[0],processed_by:null,pre_processing_weight:g.pre_processing_weight,post_processing_weight:g.post_processing_weight,processing_waste:g.processing_waste,processing_yield:g.processing_yield,size_distribution:{},grading_results:{[g.final_grade||"A"]:g.post_processing_weight||0},final_value:(g.post_processing_weight||0)*450,total_pieces:(n==null?void 0:n.total_pieces)||0,ready_for_dispatch_count:u,processing_code:S},{error:m}=yield z.from("processing_records").insert([o]);if(m){if(m.code==="23505"&&m.message.includes("warehouse_entry_id")){alert("This warehouse entry has already been processed! Please refresh the page to see the updated list."),yield X();return}throw m}yield X(),ae(),a("sorting")}catch(s){console.error("Error creating processing record:",s.message),alert(`Error creating processing record: ${s.message}`)}finally{D(!1)}}}),ae=()=>{W(!1),I(""),H({}),T(""),D(!1)},me=s=>{q(s),O(!0)},te=t.filter(s=>!r.some(n=>n.warehouse_entry_id===s.id));return e.jsx("div",{className:"min-h-screen bg-gray-50 content-container responsive-padding",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(J,{className:"h-6 w-6 md:h-8 md:w-8 text-blue-600"}),"Processing Management"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Monitor and manage fish processing operations"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(y,{variant:"outline",onClick:ke,disabled:B,children:[e.jsx(ie,{className:`h-4 w-4 mr-2 ${B?"animate-spin":""}`}),"Refresh"]}),e.jsxs(y,{variant:"outline",onClick:()=>a("dashboard"),children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Dashboard"]}),e.jsxs(pe,{open:V,onOpenChange:s=>s?W(!0):ae(),children:[e.jsx(Le,{asChild:!0,children:e.jsxs(y,{className:"bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",disabled:te.length===0,children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),te.length===0?"No Entries to Process":"Start Processing"]})}),e.jsxs(je,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ue,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-blue-600"}),"Start Fish Processing"]})}),e.jsx(rs,{selectedEntryId:v,setSelectedEntryId:I,warehouseEntries:te,processingRecords:r,formData:g,setFormData:H,selectedStorage:G,setSelectedStorage:T,storageLocations:N,isProcessing:i,onSubmit:Ee,onClose:ae})]})]})]})]}),e.jsx(ts,{stats:F,processingRecords:r}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsx(L,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5 text-blue-600"}),"Weekly Processing Activity"]})}),e.jsxs(E,{children:[e.jsx(ss,{data:F.weeklyProcessing,dataKey:"count"}),e.jsx("div",{className:"mt-2 text-center",children:e.jsx("p",{className:"text-sm text-gray-600",children:"Last 7 days"})})]})]}),e.jsxs(w,{children:[e.jsx(L,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5 text-purple-600"}),"Yield Trends"]})}),e.jsxs(E,{children:[F.yieldTrends.length>0?e.jsx(as,{data:F.yieldTrends,dataKey:"yield"}):e.jsx("div",{className:"h-32 flex items-center justify-center text-gray-500",children:"No yield data available"}),e.jsx("div",{className:"mt-2 text-center",children:e.jsx("p",{className:"text-sm text-gray-600",children:"Recent processing yield %"})})]})]})]}),e.jsxs(w,{children:[e.jsx(L,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5"}),"Quality Grade Distribution"]})}),e.jsx(E,{children:e.jsx("div",{className:"grid grid-cols-3 gap-4",children:Object.entries(F.gradeDistribution).map(([s,n])=>e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs(f,{className:`${Z(s)} text-white mb-2`,children:["Grade ",s]}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:n}),e.jsxs("p",{className:"text-sm text-gray-600",children:[F.totalProcessed>0?(n/F.totalProcessed*100).toFixed(1):0,"%"]})]},s))})})]}),e.jsxs(w,{children:[e.jsx(L,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5"}),"Recent Processing Activity",e.jsxs(f,{variant:"secondary",className:"ml-auto",children:[_.length," recent"]})]})}),e.jsx(E,{children:_.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No recent processing activity"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Start by processing some warehouse entries"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3",children:_.map(s=>{var n;return t.find(c=>c.id===s.warehouse_entry_id),e.jsx(w,{className:"p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(f,{variant:"outline",children:(n=t.find(c=>c.id===s.warehouse_entry_id))==null?void 0:n.entry_code}),e.jsx(f,{className:"bg-purple-500 text-white",children:s.processing_code}),e.jsxs(f,{className:`${Z(s.final_grade)} text-white`,children:["Grade ",s.final_grade]}),e.jsx("span",{className:"text-sm text-gray-600",children:"Size: To be sorted"}),e.jsx(f,{variant:"outline",className:"text-blue-600 border-blue-300",children:"Processing Complete"}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(s.processing_date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-4 text-sm",children:[e.jsxs("span",{children:["Pre: ",s.pre_processing_weight,"kg"]}),e.jsxs("span",{children:["Post: ",s.post_processing_weight,"kg"]}),e.jsxs("span",{children:["Waste: ",s.processing_waste,"kg"]}),e.jsxs("span",{className:ee(s.processing_yield),children:["Yield: ",s.processing_yield,"%"]})]}),e.jsxs("p",{className:"flex items-center gap-1 text-sm",children:[e.jsx(le,{className:"h-3 w-3"}),e.jsx("strong",{children:s.storage_location||"Not assigned"})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>me(s),children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),"Details"]})})]})},s.id)})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs(y,{variant:"outline",onClick:()=>ce(!ne),className:"w-full",children:["View All ",r.length," Records"]})})]})})]}),ne&&e.jsxs(w,{className:"mt-6",children:[e.jsx(L,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"All Processing Records (",r.length,")"]})}),e.jsxs(E,{children:[e.jsx("div",{className:"space-y-4",children:r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No processing records found"})]}):r.map(s=>{var n;return t.find(c=>c.id===s.warehouse_entry_id),e.jsx(w,{className:"p-4 border border-gray-200 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-start gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(f,{variant:"outline",className:"font-medium",children:(n=t.find(c=>c.id===s.warehouse_entry_id))==null?void 0:n.entry_code}),e.jsx(f,{className:"bg-purple-500 text-white font-medium",children:s.processing_code}),e.jsxs(f,{className:`${Z(s.final_grade)} text-white font-medium`,children:["Grade ",s.final_grade]}),e.jsx(f,{className:"bg-purple-500 text-white font-medium",children:"Size: To be sorted"}),e.jsx(f,{variant:"outline",className:"text-blue-600 border-blue-300 font-medium",children:"Processing Complete"}),e.jsxs("span",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(ve,{className:"h-4 w-4"}),new Date(s.processing_date).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-6 text-sm",children:[e.jsxs("span",{children:["Pre: ",s.pre_processing_weight,"kg"]}),e.jsxs("span",{children:["Post: ",s.post_processing_weight,"kg"]}),e.jsxs("span",{children:["Waste: ",s.processing_waste,"kg"]}),e.jsxs("span",{className:ee(s.processing_yield),children:["Yield: ",s.processing_yield,"%"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1 font-medium text-gray-900",children:[e.jsx(le,{className:"h-4 w-4"}),s.farmer_name]}),e.jsxs("span",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(se,{className:"h-4 w-4"}),"Storage: ",s.storage_location||"Not assigned"]})]})]}),e.jsx("div",{className:"flex gap-2 flex-shrink-0",children:e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>me(s),children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"View Details"]})})]})},s.id)})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(y,{variant:"outline",onClick:()=>ce(!1),className:"w-full",children:"Show Less"})})]})]}),e.jsx(pe,{open:$,onOpenChange:O,children:e.jsxs(je,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ue,{children:e.jsx(fe,{className:"text-2xl font-bold",children:"Processing Details"})}),x&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Entry Code"}),e.jsx("span",{className:"font-medium",children:(l=t.find(s=>s.id===x.warehouse_entry_id))==null?void 0:l.entry_code})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Processing Code"}),e.jsx("span",{className:"font-medium",children:x.processing_code})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Processing Date"}),e.jsx("span",{className:"font-medium",children:new Date(x.processing_date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Farmer"}),e.jsx("span",{className:"font-medium",children:x.farmer_name||"Unknown"})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Processed By"}),e.jsx("span",{className:"font-medium",children:x.processed_by||"Not specified"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Final Grade"}),e.jsxs(f,{className:`${Z(x.final_grade)} text-white`,children:["Grade ",x.final_grade]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Size"}),e.jsx("span",{className:"font-medium",children:"To be sorted"})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Storage Location"}),e.jsx("span",{className:"font-medium",children:x.storage_location||"Not assigned"})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Status"}),e.jsx(f,{className:"bg-green-600 text-white",children:"Complete"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Weight Analysis"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[x.pre_processing_weight,"kg"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pre-Processing"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[x.post_processing_weight,"kg"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Post-Processing"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:[x.processing_waste,"kg"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Waste"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${ee(x.processing_yield)}`,children:[x.processing_yield,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Yield"})]})]})]}),x.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Notes"}),e.jsx("p",{className:"text-gray-700 bg-gray-50 p-4 rounded-lg",children:x.notes})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(y,{onClick:()=>O(!1),children:"Close"})})]})]})})]})})}export{vs as default};
