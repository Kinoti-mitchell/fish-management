import{r as l,j as e,R,T as k,a as V,f as W,g as K,b as Q,l as z,B as h,E as H,P as he,L as S,t as o,s as p}from"./main-DyVZDjuq.js";import{S as pe,a as ge,b as ue,c as fe,d as be}from"./select-Bnb_HlNt.js";import{C as G}from"./clock-BABH2_nd.js";import{B as q}from"./building-2-Vs6Txcwr.js";import{M as J}from"./map-pin-DxdeMbhs.js";import{C as X}from"./circle-check-big-C1kRXgwe.js";import"./index-DRKH-lyK.js";import"./index-BfNkWUJc.js";import"./index-DaD87DNJ.js";function Ce({onNavigate:je}){const[f,Y]=l.useState([]),[v,I]=l.useState([]),[Z,ee]=l.useState([]),[D,T]=l.useState(!0),[A,E]=l.useState([]),[te,L]=l.useState(!1),[m,N]=l.useState([]),[g,w]=l.useState(null),[se,C]=l.useState(!1),[F,re]=l.useState([]),[i,y]=l.useState({driverId:"",notes:"",pickingDate:"",pickingTime:""}),[ae,U]=l.useState(!1),[a,M]=l.useState(null),P=async()=>{try{const{data:t,error:s}=await p.from("outlet_orders").select(`
          *,
          outlet:outlets(
            id,
            name,
            location,
            phone,
            manager_name,
            status
          )
        `).eq("status","confirmed").order("order_date",{ascending:!1});if(s)throw s;Y(t||[])}catch(t){console.error("Error fetching confirmed orders:",t),o.error("Failed to fetch confirmed orders",{description:"Please refresh the page or try again later",duration:5e3})}},O=async()=>{try{const{data:t,error:s}=await p.from("outlet_orders").select(`
          *,
          outlet:outlets(
            id,
            name,
            location,
            phone,
            manager_name,
            status
          )
        `).eq("status","dispatched").order("dispatch_date",{ascending:!1});if(s)throw s;if(t&&t.length>0){const d=t.map(u=>u.id),{data:r,error:x}=await p.from("dispatch_records").select("*").in("outlet_order_id",d);if(!x&&r){const u=t.map(b=>{const _=r.find(j=>j.outlet_order_id===b.id);return{...b,dispatch_record:_||null}});I(u)}else console.warn("Could not fetch dispatch records:",x),I(t)}else I([])}catch(t){console.error("Error fetching dispatched orders:",t),o.error("Failed to fetch dispatched orders",{description:"Please refresh the page or try again later",duration:5e3})}},ie=async()=>{try{const{data:t,error:s}=await p.from("outlets").select("*").order("name");if(s)throw s;ee(t||[])}catch(t){console.error("Error fetching outlets:",t),o.error("Failed to fetch outlets",{description:"Please refresh the page or try again later",duration:5e3})}},ne=async()=>{try{const{data:t,error:s}=await p.from("profiles").select("id, first_name, last_name").eq("role","driver").order("first_name");if(s)throw s;const d=(t||[]).map(r=>({id:r.id,name:`${r.first_name} ${r.last_name}`}));re(d)}catch(t){console.error("Error fetching drivers:",t),o.error("Failed to fetch drivers",{description:"Please refresh the page or try again later",duration:5e3})}},$=async()=>{try{const{data:t,error:s}=await p.from("processing_records").select(`
          id,
          post_processing_weight,
          ready_for_dispatch_count,
          processing_date,
          final_value
        `).gt("ready_for_dispatch_count",0).order("processing_date",{ascending:!1});if(s)throw s;E(t||[])}catch(t){console.error("Error fetching inventory:",t),o.error("Failed to fetch inventory",{description:"Please refresh the page or try again later",duration:5e3}),E([])}},le=t=>{w(t),y({driverId:"",notes:"",pickingDate:"",pickingTime:""}),C(!0)},de=async()=>{if(!g||!i.driverId){o.error("Please select a driver");return}if(!i.pickingDate||!i.pickingTime){o.error("Please select picking date and time");return}try{const s=F.find(c=>c.id===i.driverId)?.name||"Unknown Driver",d=f.find(c=>c.id===g),r=Z.find(c=>c.id===d?.outlet_id),x=d?.requested_quantity||0,u=d?.requested_quantity||0,b=d?.size_quantities||{},{data:_,error:j}=await p.from("dispatch_records").insert({outlet_order_id:g,fish_ids:[],destination:r?.name||"Unknown",dispatch_date:new Date().toISOString().split("T")[0],total_weight:x,total_pieces:u,size_breakdown:b,total_value:d?.total_value||0,status:"scheduled",notes:i.notes,picking_date:i.pickingDate,picking_time:i.pickingTime,assigned_driver:s,assigned_date:new Date().toISOString().split("T")[0]}).select().single();if(j)throw j;const{error:n}=await p.from("outlet_orders").update({status:"dispatched",dispatch_date:new Date().toISOString().split("T")[0],notes:i.notes}).eq("id",g);if(n)throw n;C(!1),w(null),await Promise.all([P(),O()]),o.success("Dispatch approved successfully!",{description:`Driver ${s} assigned to order for picking on ${i.pickingDate} at ${i.pickingTime}`,duration:5e3})}catch(t){console.error("Error approving dispatch:",t),o.error("Failed to approve dispatch",{description:"Please try again or contact support if the issue persists",duration:5e3})}},ce=t=>{M(t),U(!0)},oe=()=>{U(!1),M(null)},me=()=>{window.print()},xe=async()=>{if(!g||m.length===0){o.error("Please select items from inventory");return}try{const t=m.map(n=>n.inventoryItem.id),{error:s}=await p.from("processing_records").update({ready_for_dispatch_count:0}).in("id",t);if(s)throw s;const d=m.reduce((n,c)=>n+c.weight,0),r=m.reduce((n,c)=>n+c.quantity,0),x=m.reduce((n,c)=>{const B=c.inventoryItem.final_size||0;return n[B]=(n[B]||0)+c.quantity,n},{}),u=f.find(n=>n.id===g),{data:b,error:_}=await p.from("dispatch_records").update({fish_ids:t,total_weight:d,total_pieces:r,size_breakdown:x,status:"dispatched",notes:`Inventory picked for order ${u?.order_number||g}`}).eq("outlet_order_id",g).select().single();if(_)throw _;const{error:j}=await p.from("outlet_orders").update({status:"dispatched",dispatch_date:new Date().toISOString().split("T")[0]}).eq("id",g);if(j)throw j;await Promise.all([P(),O(),$()]),L(!1),w(null),N([]),o.success("Order dispatched successfully!",{description:`Order ${u?.order_number||g} has been dispatched with ${r} pieces`,duration:5e3})}catch(t){console.error("Error dispatching order:",t),o.error("Failed to dispatch order",{description:"Please try again or contact support if the issue persists",duration:5e3})}};return l.useEffect(()=>{(async()=>{T(!0),await Promise.all([P(),O(),ie(),$(),ne()]),T(!1)})()},[]),e.jsxs(e.Fragment,{children:[e.jsx("style",{jsx:"true",global:"true",children:`
        @media print {
          body * {
            visibility: hidden;
          }
          .printable-invoice, .printable-invoice * {
            visibility: visible;
          }
          .printable-invoice {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            background: white !important;
            color: black !important;
            box-shadow: none !important;
            border: none !important;
            margin: 0 !important;
            padding: 20px !important;
            max-height: none !important;
            overflow: visible !important;
          }
          .printable-invoice .bg-gradient-to-r {
            background: #2563eb !important;
            color: white !important;
          }
          .printable-invoice .bg-green-600 {
            background: #16a34a !important;
            color: white !important;
          }
          .printable-invoice .bg-gray-50 {
            background: #f9fafb !important;
          }
          .printable-invoice .bg-yellow-50 {
            background: #fefce8 !important;
          }
          .printable-invoice .text-white {
            color: white !important;
          }
          .printable-invoice .text-blue-100 {
            color: #dbeafe !important;
          }
          .printable-invoice .text-green-100 {
            color: #dcfce7 !important;
          }
          .printable-invoice .border {
            border: 1px solid #d1d5db !important;
          }
          .printable-invoice .rounded-lg,
          .printable-invoice .rounded-xl,
          .printable-invoice .rounded-2xl {
            border-radius: 4px !important;
          }
          .printable-invoice .shadow-2xl,
          .printable-invoice .shadow-lg {
            box-shadow: none !important;
          }
          .printable-invoice .p-8 {
            padding: 16px !important;
          }
          .printable-invoice .p-6 {
            padding: 12px !important;
          }
          .printable-invoice .p-4 {
            padding: 8px !important;
          }
          .printable-invoice .p-3 {
            padding: 6px !important;
          }
          .printable-invoice .text-3xl {
            font-size: 24px !important;
          }
          .printable-invoice .text-2xl {
            font-size: 20px !important;
          }
          .printable-invoice .text-lg {
            font-size: 16px !important;
          }
          .printable-invoice .mb-6 {
            margin-bottom: 12px !important;
          }
          .printable-invoice .mb-4 {
            margin-bottom: 8px !important;
          }
          .printable-invoice .mb-2 {
            margin-bottom: 4px !important;
          }
          .printable-invoice .mb-1 {
            margin-bottom: 2px !important;
          }
          .printable-invoice .mt-4 {
            margin-top: 8px !important;
          }
          .printable-invoice .gap-6 {
            gap: 12px !important;
          }
          .printable-invoice .max-h-[60vh] {
            max-height: none !important;
          }
          .printable-invoice .overflow-hidden {
            overflow: visible !important;
          }
          .printable-invoice .overflow-y-auto {
            overflow: visible !important;
          }
          .printable-invoice .flex {
            display: block !important;
          }
          .printable-invoice .grid {
            display: block !important;
          }
          .printable-invoice .grid > * {
            margin-bottom: 8px !important;
          }
          .printable-invoice .hidden {
            display: none !important;
          }
          .printable-invoice table {
            width: 100% !important;
            border-collapse: collapse !important;
          }
          .printable-invoice th,
          .printable-invoice td {
            padding: 8px !important;
            text-align: left !important;
            border-bottom: 1px solid #d1d5db !important;
          }
        }
      `}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 content-container responsive-padding",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl p-6 text-white shadow-lg",children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(R,{size:"lg",showText:!1})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(k,{className:"h-8 w-8"}),"Dispatch Management"]}),e.jsx("p",{className:"text-white/80 mt-2",children:"Assign drivers to confirmed orders and manage dispatch operations"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-white/70",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold",children:f.length+v.length})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-white/70",children:"Awaiting Dispatch"}),e.jsx("p",{className:"text-2xl font-bold text-orange-200",children:f.length})]})]})]})}),!D&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Awaiting Dispatch"}),e.jsx("p",{className:"text-3xl font-bold text-orange-800",children:f.length})]}),e.jsx("div",{className:"p-3 bg-orange-100 rounded-full",children:e.jsx(G,{className:"h-6 w-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Dispatched"}),e.jsx("p",{className:"text-3xl font-bold text-green-800",children:v.length})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx(k,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Orders"}),e.jsx("p",{className:"text-3xl font-bold text-blue-800",children:f.length+v.length})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx(q,{className:"h-6 w-6 text-blue-600"})})]})})]}),D&&e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-3 text-muted-foreground",children:"Loading dispatch data..."})]}),!D&&e.jsxs(V,{className:"shadow-lg border-0",children:[e.jsx(W,{className:"bg-gradient-to-r from-orange-50 to-amber-50 border-b",children:e.jsxs(K,{className:"flex items-center gap-2 text-orange-800",children:[e.jsx(G,{className:"h-5 w-5"}),"Orders Awaiting Driver Assignment (",f.length,")"]})}),e.jsx(Q,{className:"p-6",children:f.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("div",{className:"bg-orange-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4",children:e.jsx(k,{className:"h-10 w-10 text-orange-600"})}),e.jsx("p",{className:"text-lg font-medium",children:"No orders awaiting dispatch"}),e.jsx("p",{className:"text-sm",children:"Confirmed orders will appear here for driver assignment"})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:f.map(t=>e.jsxs("div",{className:"bg-white border border-orange-200 rounded-xl p-5 hover:shadow-xl transition-all duration-300 hover:border-orange-400 hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(z,{className:"bg-orange-100 text-orange-800 text-xs font-medium px-2 py-1",children:"AWAITING DRIVER"})}),e.jsx(h,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-blue-50",children:e.jsx(H,{className:"h-4 w-4 text-gray-600"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(q,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-900 text-sm",children:t.outlet?.name||"Unknown Outlet"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(J,{className:"h-3 w-3"}),e.jsx("span",{children:t.outlet?.location||"Unknown Location"})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Order ID:"}),e.jsx("span",{className:"font-medium text-gray-900",children:t.order_number||t.id})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Quantity:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[t.requested_quantity,"kg"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Sizes:"}),e.jsx("span",{className:"font-medium text-gray-900",children:t.requested_sizes?.join(", ")||"Any"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(t.order_date).toLocaleDateString()})]})]}),e.jsx("div",{className:"border-t border-gray-100 pt-3 mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Value"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["KES ",t.total_value?.toLocaleString()||"0"]})]})}),e.jsx("div",{className:"space-y-2",children:e.jsxs(h,{size:"sm",onClick:()=>le(t.id),className:"w-full bg-green-600 hover:bg-green-700 text-white text-xs",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"Approve Dispatch"]})})]},t.id))})})]}),!D&&e.jsxs(V,{className:"shadow-lg border-0",children:[e.jsx(W,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-b",children:e.jsxs(K,{className:"flex items-center gap-2 text-green-800",children:[e.jsx(k,{className:"h-5 w-5"}),"Dispatched Orders (",v.length,")"]})}),e.jsx(Q,{className:"p-6",children:v.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("div",{className:"bg-green-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4",children:e.jsx(k,{className:"h-10 w-10 text-green-600"})}),e.jsx("p",{className:"text-lg font-medium",children:"No dispatched orders"}),e.jsx("p",{className:"text-sm",children:"Orders that have been dispatched will appear here"})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:v.map(t=>e.jsxs("div",{className:"bg-white border border-green-200 rounded-xl p-5 hover:shadow-xl transition-all duration-300 hover:border-green-400 hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(z,{className:"bg-green-100 text-green-800 text-xs font-medium px-2 py-1",children:"DISPATCHED"})}),e.jsx(h,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-blue-50",onClick:()=>ce(t),title:"View Invoice Details",children:e.jsx(H,{className:"h-4 w-4 text-gray-600"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(q,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-900 text-sm",children:t.outlet?.name||"Unknown Outlet"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(J,{className:"h-3 w-3"}),e.jsx("span",{children:t.outlet?.location||"Unknown Location"})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Order ID:"}),e.jsx("span",{className:"font-medium text-gray-900",children:t.order_number||t.id})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Quantity:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[t.requested_quantity,"kg"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Sizes:"}),e.jsx("span",{className:"font-medium text-gray-900",children:t.requested_sizes?.join(", ")||"Any"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Dispatched:"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(t.dispatch_date||t.order_date).toLocaleDateString()})]}),(t.dispatch_record?.picking_date||t.dispatch_record?.notes?.includes("Picking:"))&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Picking Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:t.dispatch_record?.picking_date?new Date(t.dispatch_record.picking_date).toLocaleDateString():t.dispatch_record?.notes?.match(/Picking: ([^ ]+)/)?.[1]||"Not specified"})]}),(t.dispatch_record?.picking_time||t.dispatch_record?.notes?.includes("at "))&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Picking Time:"}),e.jsx("span",{className:"font-medium text-gray-900",children:t.dispatch_record?.picking_time||t.dispatch_record?.notes?.match(/at ([^.]+)/)?.[1]||"Not specified"})]}),(t.dispatch_record?.assigned_driver||t.dispatch_record?.notes?.includes("Driver:"))&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Driver:"}),e.jsx("span",{className:"font-medium text-gray-900",children:t.dispatch_record?.assigned_driver||t.dispatch_record?.notes?.match(/Driver: ([^,]+)/)?.[1]||"Not assigned"})]}),t.dispatch_record?.total_weight&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Weight:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[t.dispatch_record.total_weight," kg"]})]})]}),e.jsx("div",{className:"border-t border-gray-100 pt-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Value"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["KES ",t.total_value?.toLocaleString()||"0"]})]})})]},t.id))})})]}),te&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Pick Inventory for Order"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Select items from inventory to fulfill this order"})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:A.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(he,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No inventory available"}),e.jsx("p",{className:"text-sm",children:"No items are ready for dispatch"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:A.map(t=>{const s=m.some(r=>r.inventoryItem.id===t.id),d=m.find(r=>r.inventoryItem.id===t.id);return e.jsxs("div",{className:`border rounded-lg p-4 ${s?"border-orange-500 bg-orange-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium text-gray-900",children:["Size ",t.final_size]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Available: ",t.ready_for_dispatch_count," pieces"]})]}),e.jsx(z,{className:s?"bg-orange-500":"bg-gray-500",children:s?"Picked":"Available"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("p",{children:["Weight: ",t.total_weight,"kg"]}),e.jsxs("p",{children:["Storage: ",t.storage_location||"Unknown"]}),e.jsxs("p",{children:["Farmer: ",t.farmer_name||"Unknown"]})]}),s?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"1",max:t.ready_for_dispatch_count,value:d?.quantity||1,onChange:r=>{const x=parseInt(r.target.value)||1;N(u=>u.map(b=>b.inventoryItem.id===t.id?{...b,quantity:x,weight:x*(t.total_weight/t.ready_for_dispatch_count)}:b))},className:"w-20 px-2 py-1 border rounded text-sm"}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>{N(r=>r.filter(x=>x.inventoryItem.id!==t.id))},className:"text-red-600 hover:text-red-700",children:"Remove"})]}):e.jsx(h,{size:"sm",onClick:()=>{N(r=>[...r,{inventoryItem:t,quantity:1,weight:t.total_weight/t.ready_for_dispatch_count}])},className:"w-full bg-orange-600 hover:bg-orange-700 text-white",children:"Add to Pick List"})]})]},t.id)})})}),e.jsxs("div",{className:"p-6 border-t bg-gray-50 flex justify-between items-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:m.length>0&&e.jsxs("p",{children:["Selected: ",m.reduce((t,s)=>t+s.quantity,0)," pieces,",m.reduce((t,s)=>t+s.weight,0).toFixed(2),"kg"]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{variant:"outline",onClick:()=>{L(!1),w(null),N([])},children:"Cancel"}),e.jsx(h,{onClick:xe,disabled:m.length===0,className:"bg-orange-600 hover:bg-orange-700 text-white",children:"Dispatch Order"})]})]})]})}),se&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Approve Dispatch"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Assign a driver and approve this dispatch"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(S,{className:"text-sm font-medium text-gray-700",children:"Select Driver"}),e.jsxs(pe,{onValueChange:t=>y(s=>({...s,driverId:t})),children:[e.jsx(ge,{className:"mt-1",children:e.jsx(ue,{placeholder:"Choose a driver"})}),e.jsx(fe,{children:F.map(t=>e.jsx(be,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-sm font-medium text-gray-700",children:"Picking Date *"}),e.jsx("input",{type:"date",value:i.pickingDate,onChange:t=>y(s=>({...s,pickingDate:t.target.value})),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-sm font-medium text-gray-700",children:"Picking Time *"}),e.jsx("input",{type:"time",value:i.pickingTime,onChange:t=>y(s=>({...s,pickingTime:t.target.value})),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-sm font-medium text-gray-700",children:"Notes (Optional)"}),e.jsx("textarea",{value:i.notes,onChange:t=>y(s=>({...s,notes:t.target.value})),placeholder:"Add any notes for this dispatch...",className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]})]}),e.jsxs("div",{className:"p-6 border-t bg-gray-50 flex justify-end gap-3",children:[e.jsx(h,{variant:"outline",onClick:()=>{C(!1),w(null),y({driverId:"",notes:"",pickingDate:"",pickingTime:""})},children:"Cancel"}),e.jsxs(h,{onClick:de,disabled:!i.driverId,className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Approve Dispatch"]})]})]})}),ae&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"printable-invoice bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl",children:e.jsx(R,{size:"lg",showText:!1})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Dispatch Invoice"}),e.jsxs("p",{className:"text-blue-100 text-lg mt-1",children:["Order #",a.order_number||a.id.slice(0,8)]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:me,className:"bg-white/10 border-white/30 text-white hover:bg-white/20 px-4 py-2 rounded-xl font-semibold",children:"Print"}),e.jsx(h,{variant:"outline",size:"sm",onClick:oe,className:"bg-white/10 border-white/30 text-white hover:bg-white/20 px-4 py-2 rounded-xl font-semibold",children:"Close"})]})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-2",children:"From:"}),e.jsx("p",{className:"text-gray-700",children:"Rio Fish Management"}),e.jsx("p",{className:"text-gray-700",children:"Nairobi, Kenya"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-2",children:"To:"}),e.jsx("p",{className:"text-gray-700 font-medium",children:a.outlet?.name||"Unknown Outlet"}),e.jsx("p",{className:"text-gray-700",children:a.outlet?.location||"Unknown Location"})]})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("th",{className:"text-left py-2 font-semibold text-gray-700",children:"Item"}),e.jsx("th",{className:"text-left py-2 font-semibold text-gray-700",children:"Details"})]})}),e.jsxs("tbody",{className:"text-sm",children:[e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Order #"}),e.jsx("td",{className:"py-2 font-medium",children:a.order_number||a.id.slice(0,8)})]}),e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Date"}),e.jsx("td",{className:"py-2 font-medium",children:new Date(a.order_date).toLocaleDateString()})]}),e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Quantity"}),e.jsxs("td",{className:"py-2 font-medium",children:[a.requested_quantity," kg"]})]}),e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Sizes"}),e.jsx("td",{className:"py-2 font-medium",children:a.requested_sizes?.join(", ")||"Any Size"})]}),e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Driver"}),e.jsx("td",{className:"py-2 font-medium",children:a.dispatch_record?.assigned_driver||a.dispatch_record?.notes?.match(/Driver: ([^,]+)/)?.[1]||"Not assigned"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Price/kg"}),e.jsxs("td",{className:"py-2 font-medium",children:["KES ",a.price_per_kg?.toLocaleString()||"0"]})]})]})]})}),e.jsxs("div",{className:"bg-green-600 rounded-lg p-4 text-white text-center",children:[e.jsx("p",{className:"text-green-100 text-sm mb-1",children:"Total Amount"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KES ",a.total_value?.toLocaleString()||"0"]})]}),a.notes&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Notes:"})," ",a.notes]})})]})]})})]})})]})}export{Ce as default};
