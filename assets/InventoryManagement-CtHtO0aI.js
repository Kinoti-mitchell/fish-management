var E=(C,R,N)=>new Promise((h,L)=>{var V=p=>{try{u(N.next(p))}catch(I){L(I)}},T=p=>{try{u(N.throw(p))}catch(I){L(I)}},u=p=>p.done?h(p.value):Promise.resolve(p.value).then(V,T);u((N=N.apply(C,R)).next())});import{c as Ve,m as He,r as c,j as e,n as Ne,a as D,b as F,H as ve,l as de,L as ss,B as w,P as M,I as ts,k as as,C as ls,Z as rs,E as is,f as ns,g as cs}from"./index-DQMMO_c0.js";import{D as _e,b as we,c as Se,d as ze}from"./dialog-DsOrmHTK.js";import{i as O}from"./inventoryService-BQvVG_EV.js";import{s as os}from"./sortingService-jTdL8ozA.js";import{T as ds}from"./textarea-CAWYDPSl.js";import{C as Ue}from"./checkbox-Bt6jOmmS.js";import{S as K}from"./scale-lxSGmVqU.js";import{L as xe}from"./loader-circle-CREzAx8v.js";import{C as U}from"./circle-alert-DDB34EIT.js";import{C as oe}from"./circle-check-big-BRXFGpnR.js";import{F as Re}from"./file-text-D55IyvWp.js";import{T as ce}from"./trending-up-CTZzpyxu.js";import{S as xs}from"./search-Bg6y5UmE.js";import{R as gs}from"./refresh-cw-Lq6Yor4G.js";import{C as ms}from"./chart-pie-D4WLIc9M.js";import{C as ye}from"./clock-Brzc9MzS.js";import{A as hs}from"./award-DXPv9JFq.js";import{C as us}from"./index-vfJYS-vN.js";import{C as ps}from"./chevron-right-DdTcp05I.js";import"./index-2myZ9lWz.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],fs=Ve("bell",bs);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],se=Ve("layers",js);function ys({isOpen:C,onClose:R,sourceStorage:N,itemsToTransfer:h,onTransferComplete:L}){const{user:V}=He(),[T,u]=c.useState([]),[p,I]=c.useState(""),[te,ge]=c.useState(""),[ae,S]=c.useState(!1),[q,v]=c.useState(null),[Z,me]=c.useState(null),[J,he]=c.useState(!1),[j,P]=c.useState(new Set);c.useEffect(()=>{if(C){const a=new Set(h.map(m=>m.size));P(a),v(null),me(null)}},[C,N.id,h]),c.useEffect(()=>{C&&j.size>0&&re()},[j,C,N.id]);const A=h.filter(a=>j.has(a.size)).reduce((a,m)=>a+m.total_weight,0),le=h.filter(a=>j.has(a.size)).reduce((a,m)=>a+m.quantity,0),H=a=>{P(a?new Set(h.map(m=>m.size)):new Set)},ue=(a,m)=>{const y=new Set(j);m?y.add(a):y.delete(a),P(y)},Q=j.size===h.length;j.size>0;const re=()=>E(this,null,function*(){S(!0),v(null);try{const a=yield O.getAvailableStorageLocationsForTransfer(N.id),m=h.filter(z=>j.has(z.size)).reduce((z,B)=>z+B.total_weight,0),y=a.filter(z=>{const B=z.available_capacity_kg>=m;return console.log(`${z.name}: ${z.available_capacity_kg}kg available, need ${m.toFixed(1)}kg - ${B?"SUITABLE":"NOT ENOUGH SPACE"}`),B});console.log(`Found ${y.length} suitable storage locations for ${m.toFixed(1)}kg transfer`),console.log("Suitable storages:",y),u(y),y.length===0?v(`No storage locations have enough capacity for this transfer. Total weight to transfer: ${m.toFixed(1)}kg`):console.log(`Found ${y.length} suitable storage locations for transfer`)}catch(a){console.error("Error loading available storages:",a),v(a.message||"Failed to load available storage locations")}finally{S(!1)}}),pe=()=>E(this,null,function*(){if(!J){if(!p){v("Please select a destination storage location");return}if(j.size===0){v("Please select at least one size to transfer");return}he(!0),v(null);try{console.log("Creating transfer request..."),console.log("Source storage:",N),console.log("Destination storage ID:",p),console.log("Selected sizes:",Array.from(j)),console.log("Items to transfer:",h.filter(_=>j.has(_.size)));const a=h.filter(_=>j.has(_.size)),m=a.reduce((_,Y)=>_+Y.quantity,0),y=a.reduce((_,Y)=>_+Y.total_weight,0);console.log(`Creating batch transfer for ${a.length} selected size classes, total quantity: ${m}, total weight: ${y}kg`);const z=a.map(_=>({size:_.size,quantity:1,weightKg:_.total_weight})),B=yield O.createBatchTransfer(N.id,p,z,`Transfer from ${N.name} - Sizes: ${Array.from(j).sort().join(", ")} - ${te||"No notes"}`,V==null?void 0:V.id);console.log("Batch transfer created:",B),me(`Transfer request created successfully for ${a.length} size${a.length!==1?"s":""}! Awaiting approval.`),L(),setTimeout(()=>{R()},600)}catch(a){console.error("Error creating transfer request:",a),a.message&&(a.message.includes("already exists")||a.message.includes("409"))?v("A transfer request for these items already exists. Please check the 'Transfer Approvals' section to review pending requests."):a.message&&a.message.includes("ERR_CONNECTION_CLOSED")?v("Connection error. Please check your internet connection and try again."):a.message&&a.message.includes("500")?v("Server error. Please try again in a moment."):a.message&&a.message.includes("insufficient")?v("Insufficient inventory for this transfer. Please check available quantities."):v(a.message||"Failed to create transfer request. Please try again.")}finally{he(!1)}}}),X=T.find(a=>a.id===p);return e.jsx(_e,{open:C,onOpenChange:R,children:e.jsxs(we,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(Se,{children:e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Transfer Stock from ",N.name]})}),e.jsxs("div",{className:"space-y-6 overflow-y-auto flex-1 pr-2",children:[e.jsx(D,{children:e.jsx(F,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(ve,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:N.name}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:N.location_type.replace("_"," ")})]}),e.jsx(de,{variant:"default",className:"bg-green-100 text-green-800",children:"Active"})]})})}),e.jsx(D,{children:e.jsxs(F,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Fish to Transfer (by Weight)"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ue,{id:"select-all",checked:Q,onCheckedChange:H}),e.jsx("label",{htmlFor:"select-all",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Select All"})]})]}),e.jsxs("div",{className:"space-y-2",children:[h.map((a,m)=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${j.has(a.size)?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ue,{id:`size-${a.size}`,checked:j.has(a.size),onCheckedChange:y=>ue(a.size,y)}),e.jsxs(de,{variant:"outline",className:"w-16 justify-center",children:["Size ",a.size]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[a.total_weight.toFixed(1),"kg"]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a.quantity," pieces"]})]},m)),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Total Weight"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[le," pieces selected"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"font-bold text-green-600 text-lg",children:[A.toFixed(1),"kg"]})]})]})]})]})}),e.jsx(D,{children:e.jsxs(F,{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Available Storage Locations"]}),ae?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(xe,{className:"w-6 h-6 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading available storage locations..."})]}):q?e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-1 bg-red-100 rounded-full",children:e.jsx(U,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-1",children:"Transfer Request Failed"}),e.jsx("p",{className:"text-sm text-red-700",children:q}),q.includes("already exists")&&e.jsx("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded",children:e.jsxs("p",{className:"text-xs text-blue-700",children:["💡 ",e.jsx("strong",{children:"Tip:"}),' Navigate to "Transfer Approvals" to review and approve existing requests.']})})]})]})}):T.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(U,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No suitable storage locations found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"All active storage locations are at capacity or don't have enough space"})]}):e.jsx("div",{className:"space-y-3",children:T.map(a=>e.jsx("div",{className:`p-4 border rounded-lg transition-all ${p===a.id?"border-blue-300 bg-blue-50 cursor-pointer":"border-gray-200 hover:border-blue-300 hover:bg-gray-50 cursor-pointer"}`,onClick:()=>{I(a.id)},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 ${p===a.id?"border-blue-600 bg-blue-600":"border-gray-300"}`,children:p===a.id&&e.jsx(oe,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:a.location_type.replace("_"," ")})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(K,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[a.available_capacity_kg.toFixed(1),"kg available"]})]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-1",children:[a.current_usage_kg.toFixed(1),"kg / ",a.capacity_kg.toFixed(1),"kg used"]}),e.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["Need: ",A.toFixed(1),"kg"]}),e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2 mt-1",children:e.jsx("div",{className:`h-2 rounded-full ${a.utilization_percent>=90?"bg-red-500":a.utilization_percent>=70?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(a.utilization_percent,100)}%`}})})]})]})},a.id))})]})}),Z&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-1 bg-green-100 rounded-full",children:e.jsx(oe,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-1",children:"Transfer Request Created"}),e.jsx("p",{className:"text-sm text-green-700",children:Z})]})]})}),e.jsx(D,{children:e.jsxs(F,{className:"p-4",children:[e.jsx(ss,{htmlFor:"transfer-notes",className:"text-sm font-medium text-gray-700",children:"Transfer Notes (Optional)"}),e.jsx(ds,{id:"transfer-notes",placeholder:"Add notes about this transfer...",value:te,onChange:a=>ge(a.target.value),className:"mt-2",rows:3})]})}),X&&e.jsx(D,{className:"border-blue-200 bg-blue-50",children:e.jsxs(F,{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 text-blue-600"}),"Selected Destination"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:X.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Will have ",(X.available_capacity_kg-A).toFixed(1),"kg remaining after transfer"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-1",children:["Transfer: ",A.toFixed(1),"kg"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Current: ",X.utilization_percent.toFixed(1),"% used"]})]})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t",children:[e.jsx(w,{variant:"outline",onClick:R,disabled:J,children:"Cancel"}),e.jsx(w,{onClick:pe,disabled:!p||J||T.length===0||j.size===0,className:"bg-blue-600 hover:bg-blue-700",children:J?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-4 h-4 mr-2 animate-spin"}),"Transferring..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Transfer Stock"]})})]})]})})}function Us({onNavigate:C}){var Ie,Ae,$e,qe,Be,Ee,Oe,Le,Pe,We;const[R,N]=c.useState([]),[h,L]=c.useState([]),[V,T]=c.useState([]),[u,p]=c.useState(null),[I,te]=c.useState(""),[ge,ae]=c.useState(!1),[S,q]=c.useState(null),[v,Z]=c.useState(!1),[me,J]=c.useState(null),[he,j]=c.useState(null),[P,A]=c.useState(!1),[le,H]=c.useState(null),[ue,Q]=c.useState([]),[re,pe]=c.useState(new Set),[X,a]=c.useState(!1),[m,y]=c.useState("grid"),[z,B]=c.useState("name"),[_,Y]=c.useState([]),[be,Qe]=c.useState(null),[$,ke]=c.useState(null),[Ce,fe]=c.useState(!1),[De,Ge]=c.useState([]),[je,Ke]=c.useState([]),[ie,Fe]=c.useState(!1),ee=c.useCallback(()=>E(this,null,function*(){ae(!0),q(null);try{console.log("🔍 Fetching inventory data..."),console.log("🔗 Testing database connection...");try{const t=yield O.getInventorySummary();console.log("✅ Database connection successful, test data:",t)}catch(t){console.error("❌ Database connection failed:",t)}const s=yield O.getInventoryByStorage();if(console.log("📦 Raw inventory data received:",s),console.log("📊 Data structure analysis:",{totalItems:(s==null?void 0:s.length)||0,hasStorageLocationId:(s==null?void 0:s.some(t=>t.storage_location_id))||!1,hasSize:(s==null?void 0:s.some(t=>t.size!==null))||!1,hasQuantity:(s==null?void 0:s.some(t=>t.total_quantity>0))||!1,hasContributingBatches:(s==null?void 0:s.some(t=>t.contributing_batches&&t.contributing_batches.length>0))||!1,itemsWithBatches:(s==null?void 0:s.filter(t=>t.contributing_batches&&t.contributing_batches.length>0).length)||0,itemsWithoutBatches:(s==null?void 0:s.filter(t=>t.size!==null&&t.total_quantity>0&&(!t.contributing_batches||t.contributing_batches.length===0)).length)||0,sampleItem:(s==null?void 0:s[0])||null,sampleItemWithBatches:(s==null?void 0:s.find(t=>t.contributing_batches&&t.contributing_batches.length>0))||null,sampleItemWithoutBatches:(s==null?void 0:s.find(t=>t.size!==null&&t.total_quantity>0&&(!t.contributing_batches||t.contributing_batches.length===0)))||null}),s&&s.length>0){console.log("🔍 Detailed data analysis:"),console.log("🔍 Raw data structure check:",{isArray:Array.isArray(s),length:s.length,firstItem:s[0],firstItemKeys:s[0]?Object.keys(s[0]):null}),s.forEach((l,x)=>{var g;x<3&&console.log(`Item ${x+1}:`,{storage_location_id:l.storage_location_id,storage_location_name:l.storage_location_name,size:l.size,total_quantity:l.total_quantity,total_weight_kg:l.total_weight_kg,batch_count:l.batch_count,contributing_batches_count:((g=l.contributing_batches)==null?void 0:g.length)||0,contributing_batches:l.contributing_batches,capacity_kg:l.capacity_kg,current_usage_kg:l.current_usage_kg,utilization_percent:l.utilization_percent,status:l.status,allKeys:Object.keys(l)})});const t=s.filter(l=>l&&typeof l=="object").reduce((l,x)=>{try{const g=x.storage_location_name||x.storage_location_id||"Unknown";if(!g||typeof g!="string")return console.warn("⚠️ Invalid storage key:",g,"for item:",x),l;l[g]||(l[g]={totalItems:0,totalWeight:0,totalBatches:0,sizes:new Set,status:x.status||"unknown",capacity:x.capacity_kg||0,utilization:x.utilization_percent||0}),l[g]&&(l[g].totalItems+=1,l[g].totalWeight+=x.total_weight_kg||0,l[g].totalBatches+=x.batch_count||0,x.size!==null&&x.size!==void 0&&l[g].sizes.add(x.size))}catch(g){console.error("❌ Error processing storage summary item:",g,"item:",x)}return l},{});console.log("📊 Storage location summary:",t),console.log("✅ Data validation results:");const d={hasValidData:s.length>0,hasStorageLocations:s.some(l=>l.storage_location_id),hasSizeData:s.some(l=>l.size!==null),hasWeightData:s.some(l=>l.total_weight_kg>0),hasBatchData:s.some(l=>l.contributing_batches&&l.contributing_batches.length>0),totalWeight:s.reduce((l,x)=>l+(x.total_weight_kg||0),0),totalBatches:s.reduce((l,x)=>l+(x.batch_count||0),0),uniqueSizes:[...new Set(s.map(l=>l.size).filter(l=>l!==null))].length,uniqueStorageLocations:[...new Set(s.map(l=>l.storage_location_name))].length};console.log("📋 Validation results:",d)}L(s||[]);const r=yield os.getSortingBatches();console.log("📦 Sorting batches received:",r),T(r||[]);const n=yield O.getOldestBatchForRemoval();console.log("📦 Oldest batches received:",n),console.log("📦 Oldest batches count:",(n==null?void 0:n.length)||0),n&&n.length>0&&console.log("📦 First oldest batch:",n[0]),Y(n||[]);const o=yield O.getSizeDemandStatistics();console.log("📊 Size demand statistics received:",o),Ge(o||[]);const k=yield O.getPendingTransfers();console.log("📦 Pending transfers received:",k),Ke(k||[])}catch(s){console.error("❌ Error fetching inventory:",s),console.error("❌ Error details:",{message:s.message,stack:s.stack,error:s}),q(s.message||"Failed to fetch inventory data"),L([]),T([])}finally{ae(!1)}}),[]),Ze=()=>E(this,null,function*(){Z(!0),yield ee(),Z(!1)}),Je=s=>{if(s.status==="inactive"&&s.items.length>0){if(W(s.location_id)){const n=Te(s.location_id);q(n);return}const r=s.items.map(n=>({size:n.size,quantity:n.quantity,total_weight:n.total_weight}));H({id:s.location_id,name:s.location,location_type:s.location_type}),Q(r),A(!0)}},Xe=()=>E(this,null,function*(){yield ee(),A(!1),H(null),Q([]),console.log("Transfer request created successfully!")}),W=s=>je.some(r=>r.from_storage_location_id===s&&r.status==="pending"),Te=s=>{const r=je.filter(n=>n.from_storage_location_id===s&&n.status==="pending").length;return r>0?`Contact your admin for approval. ${r} transfer request${r>1?"s":""} already pending.`:""},Ye=s=>E(this,null,function*(){try{Qe(s),fe(!0);const r=yield O.getBatchDetails(s.batch_id);ke(r)}catch(r){console.error("Error fetching batch details:",r),ke(null)}});c.useEffect(()=>{ee()},[ee]);const f=c.useMemo(()=>{const s=new Map;h.forEach(i=>{i.storage_location_id&&!s.has(i.storage_location_id)&&s.set(i.storage_location_id,{id:i.storage_location_id,name:i.storage_location_name,type:i.storage_location_type,status:i.storage_status||"active",capacity_kg:i.capacity_kg||0,current_usage_kg:i.current_usage_kg||0,utilization_percent:i.utilization_percent||0})});const r=Array.from(s.values()),n=r.length,o=r.filter(i=>i.status==="active").length,k=r.reduce((i,b)=>i+(b.capacity_kg||0),0),t=r.reduce((i,b)=>i+(b.current_usage_kg||0),0),d=h.filter(i=>i.size!==null&&i.total_quantity>0&&i.contributing_batches&&i.contributing_batches.length>0).length,l=n>0?r.reduce((i,b)=>i+(b.utilization_percent||0),0)/n:0,x=h.reduce((i,b)=>(b.size!==null&&b.total_weight_kg>0&&(i[b.size]=(i[b.size]||0)+b.total_weight_kg),i),{});console.log("📊 Size distribution (total across all storage):",x),console.log("🔍 Size 9 total weight:",x[9]||"NOT FOUND"),console.log("🔍 All sizes found:",Object.keys(x).map(Number).sort((i,b)=>i-b));const g=h.filter(i=>i.size===9);console.log("🔍 Size 9 items by storage:",g.map(i=>({storage:i.storage_location_name,weight:i.total_weight_kg})));const G=new Map;h.forEach(i=>{if(i.storage_location_id&&i.total_weight_kg>0){const b=i.storage_location_id;G.has(b)||G.set(b,{storage_location_id:i.storage_location_id,storage_location_name:i.storage_location_name,total_weight_kg:0,utilization_percent:i.utilization_percent||0,capacity_kg:i.capacity_kg||0}),G.get(b).total_weight_kg+=i.total_weight_kg}});const Me=Array.from(G.values()).sort((i,b)=>b.total_weight_kg-i.total_weight_kg).slice(0,3);console.log("🏆 Top storage units by total weight:",Me);const ne=[];return l>85&&ne.push({type:"warning",message:"High overall utilization"}),o<n*.8&&ne.push({type:"info",message:"Some storage units inactive"}),t>k*.9&&ne.push({type:"error",message:"Near capacity limit"}),{totalStorage:n,activeStorage:o,totalCapacity:k,totalUsed:t,totalItems:d,avgUtilization:l,sizeDistribution:x,topStorage:Me,alerts:ne}},[h]),es=c.useMemo(()=>{var k;const s={};h.forEach(t=>{var l;const d=t.storage_location_id||"unknown";if(s[d]||(s[d]={location:t.storage_location_name||"Unknown Storage",location_id:t.storage_location_id||"unknown",location_type:t.storage_location_type||"unknown",status:t.storage_status||"active",capacity_kg:t.capacity_kg||0,current_usage_kg:t.current_usage_kg||0,available_capacity_kg:t.available_capacity_kg||0,utilization_percent:t.utilization_percent||0,items:[]}),t.size===null||t.size!==null&&t.size!==void 0&&t.total_quantity>0){if(t.size===null)return;if(t.contributing_batches&&t.contributing_batches.length>0){const g=s[d].items.findIndex(G=>G.size===t.size);g>=0?(s[d].items[g].quantity+=t.total_quantity,s[d].items[g].total_weight+=t.total_weight_kg||0,s[d].items[g].contributing_batches=[...s[d].items[g].contributing_batches||[],...t.contributing_batches],s[d].items[g].batch_count=(s[d].items[g].batch_count||0)+(t.batch_count||0)):s[d].items.push({id:`${d}-${t.size}`,size:t.size,quantity:t.total_quantity,total_weight:t.total_weight_kg||0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),batch_count:t.batch_count||0,contributing_batches:t.contributing_batches||[]})}else console.warn("⚠️ Skipping inventory item without proper batch data:",{storage_location_id:t.storage_location_id,size:t.size,quantity:t.total_quantity,hasContributingBatches:t.contributing_batches&&t.contributing_batches.length>0,contributingBatchesCount:((l=t.contributing_batches)==null?void 0:l.length)||0})}}),Object.values(s).forEach(t=>{t.items.sort((d,l)=>d.size-l.size)});const r=Object.values(s),n=r.map(t=>t.location_id),o=n.filter((t,d)=>n.indexOf(t)!==d);return o.length>0&&console.warn("⚠️ Duplicate location IDs found:",o),console.log("🏭 Processed storage units:",{totalUnits:r.length,unitsWithItems:r.filter(t=>t.items.length>0).length,totalItems:r.reduce((t,d)=>t+d.items.length,0),itemsWithBatches:r.reduce((t,d)=>t+d.items.filter(l=>l.contributing_batches&&l.contributing_batches.length>0).length,0),sampleUnit:r[0]||null,sampleItemWithBatches:((k=r.find(t=>t.items.some(d=>d.contributing_batches&&d.contributing_batches.length>0)))==null?void 0:k.items.find(t=>t.contributing_batches&&t.contributing_batches.length>0))||null,locationIds:n,duplicateIds:o}),console.log("🔍 Detailed processing analysis:"),r.forEach((t,d)=>{d<2&&console.log(`Storage Unit ${d+1} (${t.location}):`,{location_id:t.location_id,status:t.status,capacity_kg:t.capacity_kg,current_usage_kg:t.current_usage_kg,utilization_percent:t.utilization_percent,totalItems:t.items.length,items:t.items.map(l=>{var x;return{size:l.size,quantity:l.quantity,total_weight:l.total_weight,batch_count:l.batch_count,contributing_batches_count:((x=l.contributing_batches)==null?void 0:x.length)||0}})})}),r},[h]),{user:Ns}=He();return ge&&h.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-blue-600 font-medium",children:"Loading inventory..."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 content-container responsive-padding",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(M,{className:"h-6 w-6 md:h-8 md:w-8 text-blue-600"}),"Inventory Management"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage fish inventory across storage locations"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(w,{onClick:()=>C("transfers"),variant:"outline",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(Re,{className:"w-4 h-4"}),"Transfer Approvals"]}),e.jsxs(w,{onClick:()=>C("dashboard"),variant:"outline",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(ve,{className:"w-4 h-4"}),"Dashboard"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Storage"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:f.totalStorage})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(M,{className:"w-6 h-6 text-blue-600"})})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm",children:[e.jsxs("span",{className:"text-green-600 font-medium",children:[f.activeStorage," active"]}),e.jsx("span",{className:"text-gray-400 mx-2",children:"•"}),e.jsxs("span",{className:"text-gray-500",children:[f.totalStorage-f.activeStorage," inactive"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Capacity"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[f.totalCapacity.toFixed(1),"kg"]})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(K,{className:"w-6 h-6 text-green-600"})})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[f.totalUsed.toFixed(1),"kg used"]}),e.jsx("span",{className:"text-gray-400 mx-2",children:"•"}),e.jsxs("span",{className:"text-gray-500",children:[(f.totalCapacity-f.totalUsed).toFixed(1),"kg available"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Utilization"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:[f.avgUtilization.toFixed(1),"%"]})]}),e.jsx("div",{className:"p-3 bg-orange-100 rounded-lg",children:e.jsx(ce,{className:"w-6 h-6 text-orange-600"})})]}),e.jsx("div",{className:"mt-2 flex items-center text-sm",children:f.avgUtilization>85?e.jsxs("span",{className:"text-red-600 font-medium flex items-center",children:[e.jsx(U,{className:"w-4 h-4 mr-1"}),"High usage"]}):f.avgUtilization>70?e.jsxs("span",{className:"text-yellow-600 font-medium flex items-center",children:[e.jsx(U,{className:"w-4 h-4 mr-1"}),"Moderate usage"]}):e.jsxs("span",{className:"text-green-600 font-medium flex items-center",children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"Optimal usage"]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Items"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:f.totalItems})]}),e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(se,{className:"w-6 h-6 text-purple-600"})})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Size classes"}),e.jsx("span",{className:"text-gray-400 mx-2",children:"•"}),e.jsxs("span",{className:"text-gray-500",children:["Across ",f.totalStorage," locations"]})]})]})]}),f.alerts.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(fs,{className:"w-5 h-5 text-amber-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"System Alerts"})]}),e.jsx("div",{className:"space-y-2",children:f.alerts.map((s,r)=>e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg ${s.type==="error"?"bg-red-50 border border-red-200":s.type==="warning"?"bg-yellow-50 border border-yellow-200":"bg-blue-50 border border-blue-200"}`,children:[e.jsx(U,{className:`w-4 h-4 ${s.type==="error"?"text-red-600":s.type==="warning"?"text-yellow-600":"text-blue-600"}`}),e.jsx("span",{className:`text-sm font-medium ${s.type==="error"?"text-red-800":s.type==="warning"?"text-yellow-800":"text-blue-800"}`,children:s.message})]},r))})]}),S&&e.jsx("div",{className:`border rounded-lg p-4 ${S.includes("Contact your admin")?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:`w-5 h-5 ${S.includes("Contact your admin")?"text-yellow-600":"text-red-600"}`}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-medium ${S.includes("Contact your admin")?"text-yellow-800":"text-red-800"}`,children:S.includes("Contact your admin")?"Transfer Request Pending":"Error Loading Data"}),e.jsx("p",{className:`text-sm mt-1 ${S.includes("Contact your admin")?"text-yellow-700":"text-red-700"}`,children:S}),!S.includes("Contact your admin")&&e.jsx(w,{onClick:ee,variant:"outline",size:"sm",className:"mt-2",children:"Try Again"}),S.includes("Contact your admin")&&e.jsx(w,{onClick:()=>C("transfers"),variant:"outline",size:"sm",className:"mt-2",children:"View Transfer Approvals"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsx("div",{className:"flex-1 w-full sm:max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(xs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(ts,{placeholder:"Search storage locations...",value:I,onChange:s=>te(s.target.value),className:"pl-10 w-full"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:z,onChange:s=>B(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"capacity",children:"Sort by Capacity"}),e.jsx("option",{value:"utilization",children:"Sort by Utilization"}),e.jsx("option",{value:"items",children:"Sort by Items"})]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden",children:[e.jsx(w,{onClick:()=>y("grid"),variant:m==="grid"?"default":"ghost",size:"sm",className:"rounded-none border-0 hover:bg-blue-50",title:"Grid View",children:e.jsx(se,{className:"w-4 h-4"})}),e.jsx(w,{onClick:()=>y("list"),variant:m==="list"?"default":"ghost",size:"sm",className:"rounded-none border-0 hover:bg-green-50",title:"List View",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx(w,{onClick:()=>y("analytics"),variant:m==="analytics"?"default":"ghost",size:"sm",className:"rounded-none border-0 hover:bg-purple-50",title:"Analytics View",children:e.jsx(ls,{className:"w-4 h-4"})})]}),e.jsxs(w,{onClick:Ze,variant:"outline",size:"sm",disabled:v,className:"flex-1 sm:flex-none",children:[e.jsx(gs,{className:`w-4 h-4 mr-2 ${v?"animate-spin":""}`}),"Refresh"]})]})]})}),m==="analytics"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ms,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Size Distribution"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Total across all storage locations"})]})]}),e.jsx("div",{className:"space-y-3",children:Object.entries(f.sizeDistribution).sort(([,s],[,r])=>r-s).slice(0,12).map(([s,r])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:s})}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Size ",s]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${r/Math.max(...Object.values(f.sizeDistribution).map(n=>n))*100}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-600 w-16 text-right",children:[r.toFixed(1),"kg"]})]})]},s))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ye,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Oldest Batches (FIFO)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Next batches to be removed"})]})]}),e.jsxs("div",{className:"space-y-3",children:[_.slice(0,5).map((s,r)=>{var n;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 rounded-lg border border-orange-200 cursor-pointer hover:bg-orange-100 transition-colors",onClick:()=>Ye(s),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-semibold text-orange-600",children:["#",r+1]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Batch ",s.batch_number]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Size ",s.size_class," • ",s.days_in_storage," days old"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-orange-600",children:[(n=s.total_weight_kg)==null?void 0:n.toFixed(1),"kg"]}),e.jsx("p",{className:"text-xs text-orange-500 mt-1",children:"Click to view details"})]})]},s.batch_id)}),_.length===0&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(ye,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No batches available for removal"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Check console for debugging info"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ce,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Size Demand Statistics"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Based on outlet orders (most requested first)"})]})]}),e.jsxs("div",{className:"space-y-3",children:[De.slice(0,8).map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-semibold text-purple-600",children:["#",r+1]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Size ",s.size_class]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.total_orders," orders • ",s.unique_outlets," outlets •",s.days_span>0?`${s.days_span} days span`:"Recent"]}),e.jsxs("p",{className:"text-xs text-purple-600",children:["Grade ",s.most_requested_grade," preferred"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-purple-600",children:[s.total_weight_kg_requested.toFixed(1),"kg"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"total requested"})]})]},s.size_class)),De.length===0&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(ce,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No size demand data available"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(hs,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Top Storage Units"}),e.jsx("p",{className:"text-xs text-gray-500",children:"By total weight across all sizes"})]})]}),e.jsx("div",{className:"space-y-3",children:f.topStorage.map((s,r)=>{var n,o;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${r===0?"bg-yellow-100 text-yellow-600":r===1?"bg-gray-100 text-gray-600":"bg-orange-100 text-orange-600"}`,children:e.jsxs("span",{className:"text-sm font-bold",children:["#",r+1]})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.storage_location_name||`Storage Unit ${r+1}`}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(n=s.utilization_percent)==null?void 0:n.toFixed(1),"% utilized"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-600",children:[(o=s.total_weight_kg)==null?void 0:o.toFixed(1),"kg"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"total weight"})]})]},`top-storage-${s.storage_location_id}-${r}`)})})]})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:es.filter(s=>!I||s.location.toLowerCase().includes(I.toLowerCase())).sort((s,r)=>{switch(z){case"capacity":return r.capacity_kg-s.capacity_kg;case"utilization":return r.utilization_percent-s.utilization_percent;case"items":return r.items.length-s.items.length;default:return s.location.localeCompare(r.location)}}).map((s,r)=>{const n=re.has(s.location_id);return e.jsxs(D,{className:"card-shadow",children:[e.jsxs("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>{const o=new Set(re);n?o.delete(s.location_id):o.add(s.location_id),pe(o)},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n?e.jsx(us,{className:"w-5 h-5 text-gray-400"}):e.jsx(ps,{className:"w-5 h-5 text-gray-400"}),e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(M,{className:"w-5 h-5 text-blue-600"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.location}),W(s.location_id)&&e.jsxs(de,{variant:"destructive",className:"text-xs",children:[je.filter(o=>o.from_storage_location_id===s.location_id&&o.status==="pending").length," Pending"]})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.location_type," • ",s.items.length," size classes"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[s.current_usage_kg.toFixed(1),"kg / ",s.capacity_kg,"kg"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.utilization_percent.toFixed(1),"% utilized"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.utilization_percent>=95&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs",children:[e.jsx(U,{className:"w-3 h-3"}),e.jsx("span",{children:"Full"})]}),e.jsx(de,{variant:s.status==="active"?"default":"secondary",className:s.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:s.status}),s.status==="inactive"&&s.items.length>0&&e.jsxs(w,{onClick:o=>{o.stopPropagation(),Je(s)},variant:"outline",size:"sm",className:`${W(s.location_id)?"text-red-600 border-red-200 hover:bg-red-50":"text-orange-600 border-orange-200 hover:bg-orange-50"}`,children:[e.jsx(Ne,{className:"w-4 h-4 mr-1"}),W(s.location_id)?"Pending Transfer":"Transfer"]}),s.status==="active"&&s.items.length>0&&e.jsx(w,{onClick:o=>E(this,null,function*(){if(o.stopPropagation(),!ie){if(W(s.location_id)){const k=Te(s.location_id);q(k);return}Fe(!0);try{const k=s.items.map(t=>({size:t.size,quantity:t.quantity,total_weight:t.total_weight}));H({id:s.location_id,name:s.location,location_type:s.location_type}),Q(k),A(!0)}finally{Fe(!1)}}}),disabled:ie,variant:"outline",size:"sm",className:`${W(s.location_id)?"text-red-600 border-red-200 hover:bg-red-50":"text-blue-600 border-blue-200 hover:bg-blue-50"} ${ie?"opacity-50 cursor-not-allowed":""}`,children:ie?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-4 h-4 mr-1 animate-spin"}),"Opening..."]}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"w-4 h-4 mr-1"}),W(s.location_id)?"Pending Transfer":"Quick Transfer"]})})]})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Capacity"}),e.jsxs("span",{className:`text-xs font-medium ${s.utilization_percent>=95?"text-red-600":s.utilization_percent>80?"text-yellow-600":"text-green-600"}`,children:[s.utilization_percent.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-500 ease-out ${s.utilization_percent>=95?"bg-gradient-to-r from-red-400 to-red-600":s.utilization_percent>80?"bg-gradient-to-r from-yellow-400 to-yellow-600":"bg-gradient-to-r from-green-400 to-green-600"}`,style:{width:`${s.utilization_percent>=95?100:Math.min(s.utilization_percent,100)}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsx("span",{children:"0kg"}),e.jsxs("span",{children:[s.capacity_kg,"kg"]})]})]})]}),n&&e.jsx("div",{className:"border-t border-gray-100 p-4",children:s.items.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(M,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No inventory items"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Inventory Items"}),s.items.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>p(o),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:o.size})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Size ",o.size]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[o.batch_count," batch",o.batch_count!==1?"es":""]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-600",children:[o.total_weight.toFixed(1),"kg"]}),e.jsx(is,{className:"w-4 h-4 text-gray-400"})]})]},o.id))]})})]},`${s.location_id}-${r}`)})}),u&&e.jsx(_e,{open:!!u,onOpenChange:()=>p(null),children:e.jsxs(we,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Se,{children:e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Size ",u.size," - Inventory Details"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(D,{children:e.jsx(F,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Quantity"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.quantity})]})]})})}),e.jsx(D,{children:e.jsx(F,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Weight"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[u.total_weight.toFixed(1),"kg"]})]})]})})}),e.jsx(D,{children:e.jsx(F,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Weight/Fish"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[u.quantity>0?(u.total_weight/u.quantity).toFixed(2):"0.00","kg"]})]})]})})}),e.jsx(D,{children:e.jsx(F,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Contributing Batches"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.batch_count||((Ie=u.contributing_batches)==null?void 0:Ie.length)||0})]})]})})})]}),e.jsxs(D,{children:[e.jsx(ns,{children:e.jsxs(cs,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),"Contributing Batches",u.contributing_batches&&u.contributing_batches.length>6&&e.jsx("span",{className:"text-sm text-gray-500 font-normal ml-2",children:"(scroll to see all)"})]})}),e.jsx(F,{children:e.jsx("div",{className:"border border-gray-200 rounded-lg bg-gray-50 max-h-[500px] overflow-y-auto",children:e.jsx("div",{className:"p-4 space-y-4",children:u.contributing_batches&&u.contributing_batches.length>0?u.contributing_batches.map((s,r)=>{var n;return e.jsx("div",{className:"p-4 border border-gray-300 rounded-lg bg-white shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Batch Number"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.batch_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Weight Added"}),e.jsxs("p",{className:"font-semibold text-green-600 text-lg",children:[(n=s.weight_kg)==null?void 0:n.toFixed(1),"kg"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Quantity Added"}),e.jsxs("p",{className:"font-semibold text-gray-500",children:["Batch #",s.batch_number]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Storage Location"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.storage_location_name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Farmer"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.farmer_name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Processing Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.processing_date||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Added Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:new Date(s.added_date).toLocaleDateString()})]})]})},s.batch_id||r)}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(se,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No contributing batches found"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"This may indicate that the data is still being processed or there's an issue with the batch tracking."})]})})})})]})]})]})}),P&&le&&e.jsx(ys,{isOpen:P,onClose:()=>{A(!1),H(null),Q([])},sourceStorage:le,itemsToTransfer:ue,onTransferComplete:Xe}),Ce&&e.jsx(_e,{open:Ce,onOpenChange:fe,children:e.jsxs(we,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(Se,{className:"flex-shrink-0",children:e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-orange-600"}),"Batch Details - ",be==null?void 0:be.batch_number]})}),$?e.jsxs("div",{className:"space-y-6 overflow-y-auto flex-1 pr-2",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Batch Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Batch Number"}),e.jsx("p",{className:"font-semibold text-gray-900",children:(Ae=$.batch)==null?void 0:Ae.batch_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Created Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:($e=$.batch)!=null&&$e.created_at?new Date($.batch.created_at).toLocaleDateString():"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Processing Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:((Be=(qe=$.batch)==null?void 0:qe.processing_record)==null?void 0:Be.processing_date)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Farmer"}),e.jsx("p",{className:"font-semibold text-gray-900",children:((Pe=(Le=(Oe=(Ee=$.batch)==null?void 0:Ee.processing_record)==null?void 0:Oe.warehouse_entry)==null?void 0:Le.farmers)==null?void 0:Pe.name)||"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Available Sizes (Not Ordered)"}),e.jsxs("div",{className:"space-y-3",children:[(We=$.sizes)==null?void 0:We.map((s,r)=>{var n;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:s.size_class})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Size ",s.size_class]}),e.jsx("p",{className:"text-sm text-gray-500",children:s.storage_location_name})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-blue-600",children:[(n=s.total_weight_kg)==null?void 0:n.toFixed(1),"kg"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Available"})]})]},r)}),(!$.sizes||$.sizes.length===0)&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(M,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"All sizes in this batch have been ordered"})]})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(xe,{className:"w-8 h-8 mx-auto mb-2 text-gray-400 animate-spin"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading batch details..."})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200 flex-shrink-0",children:e.jsx(w,{onClick:()=>fe(!1),variant:"outline",className:"px-6",children:"Close"})})]})})]})})}export{Us as default};
