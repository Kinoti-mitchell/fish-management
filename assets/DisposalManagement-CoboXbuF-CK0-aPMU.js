import{w as p,u as e,f as B,o as b,j as A,N as O,d as ae,i as N,b as Q,c as ee,x as J,m as Y,k as ge,q as Ne,K as z}from"./index-Cx51dYQZ.js";import{T as ye,N as _e,P as we,_ as De,E as Se}from"./select-DqWpyIkf-D_8tzK0d.js";import{H as Ce,O as ke,X as Te,_ as Ee,E as Fe,q as $e}from"./dialog-NtgNh5u1-2hJTriox.js";import{c as Ie}from"./dollar-sign-BhCk0N5D-BR4pe6-Y.js";import{i as Re}from"./trending-down-ByidX05P-B4862-te.js";import{i as xe}from"./clock-sArWPAJm-BmsKQooK.js";import{a as Ae}from"./scale-Coap2kcd-Bsk2bCpZ.js";import{o as Oe}from"./activity-CcEyukxx-Bq8KH6V5.js";import{c as ze}from"./plus-FJ0CIBRX-DLM2sgk0.js";import{a as le}from"./calendar-CU6tj0PZ-Ucpt8Hnz.js";import{o as ie}from"./map-pin-C-M6umvy-CUBiYWs8.js";import{i as We}from"./index-io8wS31O-C_L8DqSR.js";import{e as Le}from"./chevron-right-DTnlI_34-Bu_ud7Vy.js";import{h as Pe}from"./file-text-35uk4vLR-D2sbaJVA.js";import{a as Ue}from"./download-cYb9BEHt-BKKeRdQe.js";import{i as qe}from"./trending-up-DUO3gdV8-ywoZrOkl.js";import"./index-B7iGXlpc-YR4igk-O.js";import"./index-CEgc-Zw--jggqibQ8.js";var Me=Object.defineProperty,Ke=Object.defineProperties,Ge=Object.getOwnPropertyDescriptors,ne=Object.getOwnPropertySymbols,Be=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable,ce=(l,t,o)=>t in l?Me(l,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[t]=o,de=(l,t)=>{for(var o in t||(t={}))Be.call(t,o)&&ce(l,o,t[o]);if(ne)for(var o of ne(t))Ve.call(t,o)&&ce(l,o,t[o]);return l},me=(l,t)=>Ke(l,Ge(t)),q=(l,t,o)=>new Promise((r,g)=>{var x=y=>{try{h(o.next(y))}catch(u){g(u)}},_=y=>{try{h(o.throw(y))}catch(u){g(u)}},h=y=>y.done?r(y.value):Promise.resolve(y.value).then(x,_);h((o=o.apply(l,t)).next())});class He{getDisposalStats(){return q(this,null,function*(){try{console.log("ðŸ” [DisposalService] Fetching disposal statistics...");const{data:t,error:o}=yield z.from("disposal_records").select(`
          *,
          disposal_reason:disposal_reasons(name)
        `).order("created_at",{ascending:!1});if(o)throw console.error("âŒ [DisposalService] Error fetching disposal records:",o),o;console.log("ðŸ“Š [DisposalService] Disposal records:",(t==null?void 0:t.length)||0);const r=(t==null?void 0:t.length)||0,g=(t==null?void 0:t.reduce((n,d)=>n+(d.total_weight_kg||0),0))||0,x=(t==null?void 0:t.reduce((n,d)=>n+(d.disposal_cost||0),0))||0,_=(t==null?void 0:t.filter(n=>n.status==="pending").length)||0,h=new Date;h.setDate(h.getDate()-7);const y=(t==null?void 0:t.filter(n=>new Date(n.created_at)>=h).length)||0,u=(t==null?void 0:t.filter(n=>n.status==="completed"))||[];let V=0;u.length>0&&(V=u.reduce((n,d)=>{const C=new Date(d.created_at),k=new Date(d.disposal_date),T=Math.floor((k.getTime()-C.getTime())/(1e3*60*60*24));return n+T},0)/u.length);const R={};t==null||t.forEach(n=>{var d;const C=((d=n.disposal_reason)==null?void 0:d.name)||"Unknown";R[C]=(R[C]||0)+1});const M=Object.keys(R).reduce((n,d)=>R[n]>R[d]?n:d,"Age"),W=new Date,L=W.getMonth(),H=W.getFullYear(),f=L===0?11:L-1,i=L===0?H-1:H,D=(t==null?void 0:t.filter(n=>{const d=new Date(n.created_at);return d.getMonth()===L&&d.getFullYear()===H}).length)||0,E=(t==null?void 0:t.filter(n=>{const d=new Date(n.created_at);return d.getMonth()===f&&d.getFullYear()===i}).length)||0,S=E>0?(D-E)/E*100:0,F={totalDisposals:r,totalDisposedWeight:g,totalDisposalCost:x,pendingDisposals:_,recentDisposals:y,averageDisposalAge:V,topDisposalReason:M,monthlyDisposalTrend:S};return console.log("ðŸ“Š [DisposalService] Calculated stats:",F),F}catch(t){return console.error("âŒ [DisposalService] Error getting disposal stats:",t),{totalDisposals:0,totalDisposedWeight:0,totalDisposalCost:0,pendingDisposals:0,recentDisposals:0,averageDisposalAge:0,topDisposalReason:"Age",monthlyDisposalTrend:0}}})}getDisposalRecords(t=50,o=0){return q(this,null,function*(){try{const{data:r,error:g}=yield z.from("disposal_records").select(`
          *,
          disposal_reason:disposal_reasons(name)
        `).order("created_at",{ascending:!1}).range(o,o+t-1);if(g)throw g;return r||[]}catch(r){return console.error("Error fetching disposal records:",r),[]}})}getDisposalReasons(){return q(this,null,function*(){try{const{data:t,error:o}=yield z.from("disposal_reasons").select("*").eq("is_active",!0).order("name");if(o)throw o;return t||[]}catch(t){return console.error("Error fetching disposal reasons:",t),[]}})}getInventoryForDisposal(t=30,o=!0,r,g=!1,x,_){return q(this,null,function*(){try{console.log("ðŸ” [DisposalService] Getting inventory for disposal with improved filtering..."),console.log("ðŸ“Š [DisposalService] Filter criteria:",{daysOld:t,includeStorageIssues:o});const h=new Date;h.setDate(h.getDate()-t);const y=h.toISOString().split("T")[0];console.log("ðŸ“… [DisposalService] Cutoff date:",y);const{data:u,error:V}=yield z.from("storage_locations").select("id, name, status, capacity_kg, current_usage_kg").order("name");if(V)throw console.error("âŒ [DisposalService] Storage locations error:",V),V;console.log("ðŸ“ [DisposalService] Storage locations found:",(u==null?void 0:u.length)||0);const R=new Map;u==null||u.forEach(i=>{R.set(i.id,i)});let M=z.from("sorting_results").select(`
          id,
          size_class,
          total_pieces,
          total_weight_grams,
          storage_location_id,
          created_at,
          sorting_batch:sorting_batches(
            id,
            batch_number,
            status,
            created_at
          )
        `).not("storage_location_id","is",null).gt("total_weight_grams",0);M=M.eq("sorting_batch.status","completed");const{data:W,error:L}=yield M.order("created_at",{ascending:!1});if(L)throw console.error("âŒ [DisposalService] Query error:",L),L;console.log("ðŸ“Š [DisposalService] Raw query results:",(W==null?void 0:W.length)||0,"items");const H=(W||[]).filter(i=>{var D,E,S,F;const n=R.get(i.storage_location_id);if(!i.total_weight_grams||i.total_weight_grams<=0)return console.log("âŒ [DisposalService] Item filtered out - no weight:",i.id,i.total_weight_grams),!1;const d=((E=(D=i.sorting_batch)==null?void 0:D.created_at)==null?void 0:E.split("T")[0])||((S=i.created_at)==null?void 0:S.split("T")[0]);if(!d)return console.log("âŒ [DisposalService] Item filtered out - no processing date:",i.id),!1;const C=new Date(d);if(isNaN(C.getTime())||C>new Date)return console.log("âŒ [DisposalService] Item filtered out - invalid or future date:",i.id,d),!1;const k=Math.floor((new Date().getTime()-C.getTime())/(1e3*60*60*24));let T=!1;if(t===0?T=!0:r&&r>t?T=k>=t&&k<=r:T=k>=t,x||_){const P=d;let I=!0;if(x&&P<x&&(I=!1),_&&P>_&&(I=!1),!I)return console.log("âŒ [DisposalService] Item filtered out - not in date range:",i.id,P,"from:",x,"to:",_),!1}let $=!1;if(g)return $=n&&n.status!=="active",$;o&&($=!i.storage_location_id||!n||n.status!=="active"||n.current_usage_kg>n.capacity_kg);const K=T||$;return console.log("ðŸ” [DisposalService] Item check:",{id:i.id,batchNumber:(F=i.sorting_batch)==null?void 0:F.batch_number,processingDate:d,daysInStorage:k,weightGrams:i.total_weight_grams,isOldEnough:T,hasStorageIssues:$,storageStatus:n==null?void 0:n.status,isEligible:K,inactiveStorageOnly:g}),K});console.log("ðŸ“Š [DisposalService] Eligible items after filtering:",H.length);const f=H.map(i=>{var D,E,S,F,n,d,C,k,T,$,K,P,I,se;const w=R.get(i.storage_location_id),X=((E=(D=i.sorting_batch)==null?void 0:D.created_at)==null?void 0:E.split("T")[0])||((S=i.created_at)==null?void 0:S.split("T")[0]),Z=Math.floor((new Date().getTime()-new Date(X).getTime())/(1e3*60*60*24));let U="Age";return i.storage_location_id?w?w.status!=="active"?U="Storage Inactive":w.current_usage_kg>w.capacity_kg?U="Storage Over Capacity":Z>=t&&(U="Age"):U="Storage Not Found":U="No Storage Location",{sorting_result_id:i.id,size_class:i.size_class,total_pieces:i.total_pieces,total_weight_grams:i.total_weight_grams,batch_number:((F=i.sorting_batch)==null?void 0:F.batch_number)||"BATCH-"+((d=(n=i.sorting_batch)==null?void 0:n.id)==null?void 0:d.substring(0,8)),storage_location_name:(w==null?void 0:w.name)||"No Storage Assigned",farmer_name:(($=(T=(k=(C=i.sorting_batch)==null?void 0:C.processing_record)==null?void 0:k.warehouse_entry)==null?void 0:T.farmers)==null?void 0:$.name)||"Unknown Farmer",processing_date:X,days_in_storage:Z,disposal_reason:U,quality_notes:`Fish from ${((se=(I=(P=(K=i.sorting_batch)==null?void 0:K.processing_record)==null?void 0:P.warehouse_entry)==null?void 0:I.farmers)==null?void 0:se.name)||"Unknown Farmer"}`,storage_status:(w==null?void 0:w.status)||"unknown"}});return console.log("ðŸ“Š [DisposalService] Transformed items:",f.length),f}catch(h){return console.error("âŒ [DisposalService] Error getting inventory for disposal:",h),[]}})}createDisposal(t){return q(this,null,function*(){try{console.log("ðŸ” [DisposalService] Creating disposal record..."),console.log("ðŸ“Š [DisposalService] Disposal data:",t);const{data:o,error:r}=yield z.from("disposal_reasons").select("id").eq("name",t.disposalReason).single();if(r)throw console.error("âŒ [DisposalService] Error finding disposal reason:",r),new Error(`Disposal reason "${t.disposalReason}" not found`);const{data:g,error:x}=yield z.from("disposal_records").insert({disposal_reason_id:o.id,total_weight_kg:t.totalWeight,disposal_cost:t.disposalCost,notes:t.disposalNotes,status:"completed",disposal_date:new Date().toISOString().split("T")[0],created_by:"system"}).select().single();if(x)throw console.error("âŒ [DisposalService] Error creating disposal record:",x),x;console.log("âœ… [DisposalService] Disposal record created:",g.id);const _=t.selectedItems.map(u=>({disposal_record_id:g.id,sorting_result_id:u})),{error:h}=yield z.from("disposal_items").insert(_);if(h)throw console.error("âŒ [DisposalService] Error creating disposal items:",h),h;console.log("âœ… [DisposalService] Disposal items created:",_.length);const{error:y}=yield z.from("sorting_results").update({status:"disposed"}).in("id",t.selectedItems);if(y)throw console.error("âŒ [DisposalService] Error updating sorting results:",y),y;return console.log("âœ… [DisposalService] Sorting results updated to disposed status"),{success:!0,disposalRecord:g,message:`Successfully disposed ${t.selectedItems.length} items`}}catch(o){return console.error("âŒ [DisposalService] Error creating disposal:",o),{success:!1,error:o instanceof Error?o.message:"Unknown error occurred"}}})}getInventoryForDisposalFallback(t=30){return q(this,null,function*(){try{const o=new Date;o.setDate(o.getDate()-t);const{data:r,error:g}=yield z.from("sorting_results").select(`
          id,
          size_class,
          total_weight_grams,
          batch_number,
          storage_location_name,
          farmer_name,
          processing_date,
          quality_notes,
          storage_locations!inner(status)
        `).eq("status","available").lte("processing_date",o.toISOString().split("T")[0]).gte("total_weight_grams",0);if(g)throw g;return(r==null?void 0:r.map(x=>{var _,h;return{sorting_result_id:x.id,size_class:x.size_class,total_weight_grams:x.total_weight_grams,batch_number:x.batch_number,storage_location_name:x.storage_location_name,storage_status:((_=x.storage_locations)==null?void 0:_.status)||"active",farmer_name:x.farmer_name,processing_date:x.processing_date,days_in_storage:Math.floor((new Date().getTime()-new Date(x.processing_date).getTime())/(1e3*60*60*24)),disposal_reason:((h=x.storage_locations)==null?void 0:h.status)==="inactive"?"Storage Inactive":"Age",quality_notes:x.quality_notes}}))||[]}catch(o){return console.error("Error in fallback method:",o),[]}})}}const te=new He;function Qe({stats:l}){const[t,o]=p.useState([]);return p.useEffect(()=>{const r={totalDisposals:Number(l==null?void 0:l.totalDisposals)||0,totalDisposedWeight:Number(l==null?void 0:l.totalDisposedWeight)||0,totalDisposalCost:Number(l==null?void 0:l.totalDisposalCost)||0,pendingDisposals:Number(l==null?void 0:l.pendingDisposals)||0,recentDisposals:Number(l==null?void 0:l.recentDisposals)||0,averageDisposalAge:Number(l==null?void 0:l.averageDisposalAge)||0,monthlyDisposalTrend:Number(l==null?void 0:l.monthlyDisposalTrend)||0,topDisposalReason:String((l==null?void 0:l.topDisposalReason)||"Age")},g=[{id:"1",type:"warning",icon:e.jsx(J,{className:"h-5 w-5"}),text:`ðŸ—‘ï¸ Total Disposals: ${r.totalDisposals} records | ${r.totalDisposedWeight.toFixed(1)}kg disposed`,bgColor:"bg-orange-100",textColor:"text-orange-800"},{id:"2",type:"info",icon:e.jsx(Ie,{className:"h-5 w-5"}),text:`ðŸ’° Disposal Costs: KES ${r.totalDisposalCost.toLocaleString()} total cost | ${r.averageDisposalAge.toFixed(1)} days avg age`,bgColor:"bg-red-100",textColor:"text-red-800"},{id:"3",type:"warning",icon:e.jsx(ge,{className:"h-5 w-5"}),text:`âš ï¸ Pending Disposals: ${r.pendingDisposals} awaiting approval | ${r.recentDisposals} this week`,bgColor:"bg-yellow-100",textColor:"text-yellow-800"},{id:"4",type:"info",icon:e.jsx(Re,{className:"h-5 w-5"}),text:`ðŸ“‰ Disposal Trend: ${r.monthlyDisposalTrend}% change this month | Top reason: ${r.topDisposalReason}`,bgColor:"bg-purple-100",textColor:"text-purple-800"},{id:"5",type:"info",icon:e.jsx(xe,{className:"h-5 w-5"}),text:`â° Average Age: ${r.averageDisposalAge.toFixed(1)} days before disposal | Quality control active`,bgColor:"bg-indigo-100",textColor:"text-indigo-800"},{id:"6",type:"success",icon:e.jsx(ae,{className:"h-5 w-5"}),text:"ðŸ“¦ Waste Management: Efficient disposal system | Environmental compliance maintained",bgColor:"bg-green-100",textColor:"text-green-800"},{id:"7",type:"info",icon:e.jsx(Ae,{className:"h-5 w-5"}),text:"âš–ï¸ Quality Control: Automated disposal triggers | Storage optimization active",bgColor:"bg-blue-100",textColor:"text-blue-800"},{id:"8",type:"achievement",icon:e.jsx(Oe,{className:"h-5 w-5"}),text:"ðŸŽ¯ Rio Fish Farm: Leading waste management practices in Kenya's fish industry",bgColor:"bg-emerald-100",textColor:"text-emerald-800"}];o(g)},[l]),e.jsx("div",{className:"w-full bg-gradient-to-r from-orange-50 to-red-50 border-b border-orange-200 shadow-sm overflow-hidden relative z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"relative py-2 sm:py-3 overflow-hidden",children:e.jsxs("div",{className:"flex animate-marquee-simple whitespace-nowrap",children:[t.map(r=>e.jsxs("div",{className:`flex items-center gap-2 sm:gap-3 px-3 sm:px-6 py-1 sm:py-2 rounded-full ${r.bgColor} ${r.textColor} font-medium text-xs sm:text-sm whitespace-nowrap mx-2 sm:mx-4 shadow-sm border flex-shrink-0`,children:[r.icon,e.jsx("span",{children:r.text})]},r.id)),t.map(r=>e.jsxs("div",{className:`flex items-center gap-2 sm:gap-3 px-3 sm:px-6 py-1 sm:py-2 rounded-full ${r.bgColor} ${r.textColor} font-medium text-xs sm:text-sm whitespace-nowrap mx-2 sm:mx-4 shadow-sm border flex-shrink-0`,children:[r.icon,e.jsx("span",{children:r.text})]},`duplicate-${r.id}`))]})})})})}const hs=()=>{const[l,t]=p.useState([]),[o,r]=p.useState({totalDisposals:0,totalDisposedWeight:0,totalDisposalCost:0,pendingDisposals:0,recentDisposals:0,averageDisposalAge:0,topDisposalReason:"Age"}),[g,x]=p.useState([]),[_,h]=p.useState(!0),[y,u]=p.useState(!1),[V,R]=p.useState(!1),[M,W]=p.useState(!1),[L,H]=p.useState(null),[f,i]=p.useState("all"),[D,E]=p.useState(1),[S,F]=p.useState([]),[n,d]=p.useState(""),[C,k]=p.useState(new Set),[T,$]=p.useState(0),[K,P]=p.useState(""),[I,se]=p.useState(!1),[w,X]=p.useState({from:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],to:new Date().toISOString().split("T")[0]}),Z=[{value:"all",label:"All Items",description:"Show all available items",days:0},{value:"custom_age",label:"Custom Age",description:"Items older than specified days",days:0},{value:"inactive_storage",label:"Inactive Storage",description:"Items in inactive storage locations",days:0}];p.useEffect(()=>{U(),oe()},[]),p.useEffect(()=>{oe()},[f,D]);const U=()=>q(void 0,null,function*(){try{h(!0);const[s,a]=yield Promise.all([te.getDisposalRecords(),te.getDisposalStats()]);t(s),r(a)}catch(s){console.error("Error loading disposal data:",s)}finally{h(!1)}}),oe=()=>q(void 0,null,function*(){try{let s=0,a,c=!1,j=!1;f==="all"?(s=0,j=!0):f==="custom_age"?s=D:f==="inactive_storage"&&(s=0,c=!0,j=!1);const m=yield te.getInventoryForDisposal(s,j,a,c);x(m)}catch(s){console.error("Error loading inventory for disposal:",s),x([])}}),he=()=>q(void 0,null,function*(){if(S.length===0){alert("Please select at least one item for disposal");return}try{W(!0);const s=g.filter(c=>S.includes(c.sorting_result_id)).reduce((c,j)=>c+j.total_weight_grams/1e3,0),a=yield te.createDisposal({selectedItems:S,disposalReason:n,disposalCost:T,disposalNotes:K,totalWeight:s});a.success?(alert(`âœ… ${a.message}`),pe(),u(!1),yield U()):alert(`âŒ Error creating disposal: ${a.error}`)}catch(s){console.error("Error creating disposal:",s),alert("âŒ An error occurred while creating the disposal record")}finally{W(!1)}}),pe=()=>{i("all"),E(1),F([]),d(""),$(0),P("")},ue=s=>{F(a=>a.includes(s)?a.filter(c=>c!==s):[...a,s])},fe=s=>{k(a=>{const c=new Set(a);return c.has(s)?c.delete(s):c.add(s),c})},je=()=>{const s=new Set(g.map(a=>a.storage_location_name));k(s)},ve=()=>{k(new Set)},re=()=>{const s=l.filter(m=>{const v=new Date(m.created_at).toISOString().split("T")[0];return v>=w.from&&v<=w.to}),a=s.reduce((m,v)=>m+(v.total_weight_kg||0),0),c=s.reduce((m,v)=>m+(v.disposal_cost||0),0),j={};return s.forEach(m=>{var v;const G=typeof m.disposal_reason=="object"?((v=m.disposal_reason)==null?void 0:v.name)||"Unknown":m.disposal_reason||"Unknown";j[G]||(j[G]={count:0,weight:0,cost:0}),j[G].count++,j[G].weight+=m.total_weight_kg||0,j[G].cost+=m.disposal_cost||0}),{totalRecords:s.length,totalWeight:a,totalCost:c,reasonGroups:j,records:s}},be=()=>{const s=re(),a=[["Date","Reason","Weight (kg)","Cost (KES)","Status"].join(","),...s.records.map(v=>{var G;return[new Date(v.created_at).toLocaleDateString(),typeof v.disposal_reason=="object"?((G=v.disposal_reason)==null?void 0:G.name)||"Unknown":v.disposal_reason||"Unknown",v.total_weight_kg||0,v.disposal_cost||0,v.status].join(",")})].join(`
`),c=new Blob([a],{type:"text/csv"}),j=window.URL.createObjectURL(c),m=document.createElement("a");m.href=j,m.download=`disposal-report-${w.from}-to-${w.to}.csv`,m.click(),window.URL.revokeObjectURL(j)};return _?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading disposal data..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 content-container",children:[e.jsx(Qe,{stats:o}),e.jsxs("div",{className:"container mx-auto responsive-padding max-w-full overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Disposal Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage fish disposal and waste handling"})]}),e.jsxs(B,{className:"bg-red-600 hover:bg-red-700 text-white",onClick:()=>u(!0),children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),"Create Disposal"]})]}),e.jsx(Ce,{open:y,onOpenChange:u,children:e.jsxs(ke,{className:"!max-w-4xl !w-[90vw] !h-[80vh] !flex !flex-col !top-[10vh] !left-[5vw] !translate-x-0 !translate-y-0",children:[e.jsxs(Te,{children:[e.jsx(Ee,{className:"text-xl font-semibold",children:"Create New Disposal Record"}),e.jsx(Fe,{children:"Configure disposal criteria and select items for disposal"})]}),e.jsxs("div",{className:"space-y-4 flex-1 overflow-y-auto overflow-x-hidden min-h-0 pt-2",style:{maxHeight:"calc(80vh - 150px)"},children:[e.jsxs(b,{className:"shadow-lg border-0 bg-gradient-to-br from-blue-50 to-indigo-50 max-w-md mx-auto",children:[e.jsxs(A,{className:"pb-4",children:[e.jsxs(O,{className:"text-xl font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-600"}),"Select Filter Criteria"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Choose criteria for selecting items to dispose"})]}),e.jsx(N,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"ageCategory",className:"text-sm font-semibold text-gray-700",children:"Filter Criteria *"}),e.jsxs(ye,{value:f,onValueChange:s=>{i(s);const a=Z.find(c=>c.value===s);a&&d(a.label)},children:[e.jsx(_e,{className:"h-12 bg-white border-2 border-gray-200 hover:border-blue-300 focus:border-blue-500 transition-colors",children:e.jsx(we,{placeholder:"Select filter criteria"})}),e.jsx(De,{children:Z.map(s=>e.jsx(Se,{value:s.value,children:e.jsxs("div",{className:"flex flex-col py-1",children:[e.jsx("span",{className:"font-medium text-gray-800",children:s.label}),e.jsx("span",{className:"text-xs text-gray-500",children:s.description})]})},s.value))})]})]})})]}),f&&f!==""&&e.jsxs("div",{className:"space-y-4",children:[f==="custom_age"&&e.jsxs(b,{className:"shadow-lg border-0 bg-gradient-to-br from-yellow-50 to-orange-50 max-w-md mx-auto",children:[e.jsxs(A,{className:"pb-4",children:[e.jsxs(O,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-orange-600"}),"Custom Age Threshold"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Set the minimum age in days for items to dispose"})]}),e.jsx(N,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"customDaysOld",className:"text-sm font-semibold text-gray-700",children:"Days Old Threshold *"}),e.jsx(ee,{id:"customDaysOld",type:"number",value:D,onChange:s=>E(Number(s.target.value)),className:"h-12 bg-white border-2 border-gray-200 hover:border-orange-300 focus:border-orange-500 transition-colors",placeholder:"Enter days old threshold",min:"1"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 max-w-full overflow-x-hidden",children:[e.jsxs(b,{className:"shadow-lg border-0 bg-gradient-to-br from-blue-50 to-indigo-50",children:[e.jsxs(A,{className:"pb-4",children:[e.jsxs(O,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-blue-600"}),"Filter Items for Disposal"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure criteria for selecting items"})]}),e.jsx(N,{className:"space-y-4",children:f==="custom_age"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{className:"text-sm font-semibold text-gray-700",children:"Age Threshold"}),e.jsx("div",{className:"p-3 bg-white rounded-lg border border-gray-200",children:e.jsxs("span",{className:"text-sm text-gray-600",children:[D," days or older"]})})]})})]}),e.jsxs(b,{className:"shadow-lg border-0 bg-gradient-to-br from-green-50 to-emerald-50",children:[e.jsxs(A,{className:"pb-4",children:[e.jsxs(O,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-green-600"}),"Disposal Details"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Provide disposal information"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"disposalCost",className:"text-sm font-semibold text-gray-700",children:"Disposal Cost (KES)"}),e.jsx(ee,{id:"disposalCost",type:"number",value:T,onChange:s=>$(Number(s.target.value)),className:"h-12 bg-white border-2 border-gray-200 hover:border-green-300 focus:border-green-500 transition-colors",placeholder:"Enter disposal cost",min:"0",step:"0.01"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"disposalNotes",className:"text-sm font-semibold text-gray-700",children:"Notes"}),e.jsx(ee,{id:"disposalNotes",value:K,onChange:s=>P(s.target.value),className:"h-12 bg-white border-2 border-gray-200 hover:border-green-300 focus:border-green-500 transition-colors",placeholder:"Additional notes (optional)"})]})]})]})]}),e.jsxs(b,{className:"overflow-hidden",children:[e.jsxs(A,{className:"pb-4",children:[e.jsxs(O,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-gray-600"}),"Available Items for Disposal (",g.length,")"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[f==="all"&&"Showing all available items",f==="custom_age"&&`Showing items older than ${D} days`,f==="inactive_storage"&&"Showing items in inactive storage locations"]})]}),e.jsx(N,{className:"max-h-96 overflow-y-auto",children:g.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(J,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No items found matching your criteria"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between bg-blue-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",g.length," items across ",new Set(g.map(s=>s.storage_location_name)).size," storage locations"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(B,{variant:"outline",size:"sm",onClick:je,className:"text-xs",children:"Expand All"}),e.jsx(B,{variant:"outline",size:"sm",onClick:ve,className:"text-xs",children:"Collapse All"})]})]}),Object.entries(g.reduce((s,a)=>{const c=a.storage_location_name;return s[c]||(s[c]=[]),s[c].push(a),s},{})).map(([s,a])=>{const c=C.has(s),j=a;return e.jsxs(b,{className:"border-2 border-gray-200",children:[e.jsxs(A,{className:"pb-3 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>fe(s),children:[e.jsxs(O,{className:"text-lg font-semibold text-gray-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[c?e.jsx(We,{className:"w-4 h-4 text-gray-500"}):e.jsx(Le,{className:"w-4 h-4 text-gray-500"}),e.jsx(ie,{className:"w-5 h-5 text-blue-600"}),s]}),e.jsxs(Y,{variant:"outline",className:"text-sm",children:[j.length," items"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Total Weight: ",(j.reduce((m,v)=>m+v.total_weight_grams,0)/1e3).toFixed(2)," kg"]})]}),c&&e.jsx(N,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 overflow-x-hidden",children:j.map(m=>e.jsx(b,{className:`cursor-pointer transition-all duration-200 hover:shadow-md ${S.includes(m.sorting_result_id)?"ring-2 ring-red-500 bg-red-50":"hover:bg-gray-50"}`,onClick:()=>ue(m.sorting_result_id),children:e.jsxs(N,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Y,{variant:"outline",className:"text-xs",children:m.batch_number}),e.jsxs(Y,{variant:"secondary",className:"text-xs",children:["Size ",m.size_class]})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Weight:"}),e.jsxs("span",{className:"font-medium",children:[(m.total_weight_grams/1e3).toFixed(2)," kg"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Age:"}),e.jsxs("span",{className:"font-medium",children:[m.days_in_storage," days"]})]})]}),S.includes(m.sorting_result_id)&&e.jsx("div",{className:"mt-2 text-center",children:e.jsx(Y,{className:"bg-red-600 text-white text-xs",children:"Selected"})})]})},m.sorting_result_id))})})]},s)})]})})]})]})]}),e.jsxs($e,{className:"flex-shrink-0 border-t pt-4",children:[e.jsx(B,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),f&&f!==""&&e.jsx(B,{onClick:he,className:"bg-red-600 hover:bg-red-700",disabled:M,children:M?"Processing...":"Create Disposal"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(b,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Disposals"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.length})]}),e.jsx(J,{className:"h-8 w-8 text-gray-400"})]})})}),e.jsx(b,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Weight"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[(o.totalDisposedWeight||0).toFixed(1)," kg"]})]}),e.jsx(ae,{className:"h-8 w-8 text-gray-400"})]})})}),e.jsx(b,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Cost"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["KES ",(o.totalDisposalCost||0).toFixed(2)]})]}),e.jsx(le,{className:"h-8 w-8 text-gray-400"})]})})}),e.jsx(b,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.pendingDisposals||0})]}),e.jsx(ge,{className:"h-8 w-8 text-gray-400"})]})})})]}),e.jsxs(b,{className:"mb-6",children:[e.jsx(A,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-blue-600"}),"Disposal Reports"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(B,{variant:"outline",size:"sm",onClick:()=>se(!I),className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),I?"Hide Reports":"Show Reports"]}),I&&e.jsxs(B,{variant:"outline",size:"sm",onClick:be,className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Export CSV"]})]})]})}),I&&e.jsxs(N,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"reportFromDate",className:"text-sm font-semibold text-gray-700",children:"From Date"}),e.jsx(ee,{id:"reportFromDate",type:"date",value:w.from,onChange:s=>X(a=>me(de({},a),{from:s.target.value})),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"reportToDate",className:"text-sm font-semibold text-gray-700",children:"To Date"}),e.jsx(ee,{id:"reportToDate",type:"date",value:w.to,onChange:s=>X(a=>me(de({},a),{to:s.target.value})),className:"mt-1"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(B,{onClick:()=>{const s=new Date().toISOString().split("T")[0],a=new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0];X({from:a,to:s})},variant:"outline",size:"sm",className:"w-full",children:"Last 30 Days"})})]}),(()=>{const s=re();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(b,{className:"bg-blue-50 border-blue-200",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Disposals"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:s.totalRecords})]}),e.jsx(J,{className:"h-8 w-8 text-blue-400"})]})})}),e.jsx(b,{className:"bg-green-50 border-green-200",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Total Weight"}),e.jsxs("p",{className:"text-2xl font-bold text-green-900",children:[s.totalWeight.toFixed(1)," kg"]})]}),e.jsx(ae,{className:"h-8 w-8 text-green-400"})]})})}),e.jsx(b,{className:"bg-orange-50 border-orange-200",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Total Cost"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-900",children:["KES ",s.totalCost.toLocaleString()]})]}),e.jsx(qe,{className:"h-8 w-8 text-orange-400"})]})})})]}),e.jsxs(b,{children:[e.jsx(A,{children:e.jsx(O,{className:"text-lg",children:"Disposal by Reason"})}),e.jsx(N,{children:Object.keys(s.reasonGroups).length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No disposals found for the selected date range"}):e.jsx("div",{className:"space-y-3",children:Object.entries(s.reasonGroups).map(([a,c])=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Y,{variant:"outline",className:"text-sm",children:[c.count," records"]}),e.jsx("span",{className:"font-medium text-gray-800",children:a})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[c.weight.toFixed(1)," kg â€¢ KES ",c.cost.toLocaleString()]})})]},a))})})]}),e.jsxs(b,{children:[e.jsx(A,{children:e.jsx(O,{className:"text-lg",children:"Recent Disposals"})}),e.jsx(N,{children:s.records.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No disposals found for the selected date range"}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Date"}),e.jsx("th",{className:"text-left p-2",children:"Reason"}),e.jsx("th",{className:"text-left p-2",children:"Weight (kg)"}),e.jsx("th",{className:"text-left p-2",children:"Cost (KES)"}),e.jsx("th",{className:"text-left p-2",children:"Status"})]})}),e.jsx("tbody",{children:s.records.slice(0,10).map(a=>{var c;return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2",children:new Date(a.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-2",children:typeof a.disposal_reason=="object"?((c=a.disposal_reason)==null?void 0:c.name)||"Unknown":a.disposal_reason||"Unknown"}),e.jsx("td",{className:"p-2",children:(a.total_weight_kg||0).toFixed(1)}),e.jsx("td",{className:"p-2",children:(a.disposal_cost||0).toLocaleString()}),e.jsx("td",{className:"p-2",children:e.jsx(Y,{variant:a.status==="completed"?"default":"secondary",children:a.status})})]},a.id)})})]}),s.records.length>10&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2 text-center",children:["Showing 10 of ",s.records.length," records"]})]})})]})]})})()]})]}),e.jsxs(b,{children:[e.jsx(A,{children:e.jsx(O,{children:"Disposal Records"})}),e.jsx(N,{children:l.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(J,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No disposal records found"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Date"}),e.jsx("th",{className:"text-left p-2",children:"Reason"}),e.jsx("th",{className:"text-left p-2",children:"Weight (kg)"}),e.jsx("th",{className:"text-left p-2",children:"Cost (KES)"}),e.jsx("th",{className:"text-left p-2",children:"Status"})]})}),e.jsx("tbody",{children:l.map(s=>{var a;return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-2",children:typeof s.disposal_reason=="object"?((a=s.disposal_reason)==null?void 0:a.name)||"Unknown":s.disposal_reason||"Unknown"}),e.jsx("td",{className:"p-2",children:s.total_weight_kg.toFixed(2)}),e.jsx("td",{className:"p-2",children:s.disposal_cost.toFixed(2)}),e.jsx("td",{className:"p-2",children:e.jsx(Y,{variant:s.status==="completed"?"default":"secondary",children:s.status})})]},s.id)})})]})})})]})]})]})};export{hs as default};
