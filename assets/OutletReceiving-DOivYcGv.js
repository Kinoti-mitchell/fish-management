import{c as Se,m as De,r as x,j as e,M as S,B as f,L as u,I as D,e as w,a as b,b as j,f as ze,g as Re,l as _,F as Fe,E as J,N as C,w as I,o as X,t as h}from"./main-F3q40TAH.js";import{S as Y,a as Z,b as ee,c as se,d as y}from"./select-BDoYxUW5.js";import{T as We}from"./textarea-Dn2zPVRL.js";import{D as te,a as $e,b as ae,c as ie,d as le}from"./dialog-CkI_bZ5S.js";import{a as Ce}from"./auditLogger-B1yol5NU.js";import{R as re}from"./refresh-cw-BE374wKn.js";import{P as Ie}from"./plus-PbpcxJmY.js";import{C as ce}from"./circle-check-big-BWLP4q_v.js";import{S as Ee}from"./scale-BxtwfTXG.js";import{R as Oe}from"./ruler-BqWCOJw_.js";import{M as Ve}from"./map-pin-Y4fdPQe9.js";import{C as Pe}from"./index-CEX4zLXe.js";import{C as Le}from"./clock-D4eLWtjC.js";import{W as E}from"./weight-BDP6grDy.js";import{D as ne}from"./dollar-sign-cj95uAeY.js";import{S as Me}from"./square-pen-gRqhOfXw.js";import"./index-yY-Pidxn.js";import"./index-DWnEPUXc.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]],Ae=Se("calculator",Te);function ns({onNavigate:Ue}){const{user:o}=De(),[g,O]=x.useState([]),[z,R]=x.useState(!1),[de,V]=x.useState(!0),[P,L]=x.useState(!1),[F,M]=x.useState(!1),[p,oe]=x.useState([]),[i,T]=x.useState(null),[n,xe]=x.useState(null),[he,A]=x.useState(!1),[W,me]=x.useState(new Set),[l,m]=x.useState({dispatchId:"",outletId:"",actualWeight:"",actualValue:"",condition:"",receivedBy:o?`${o.first_name} ${o.last_name}`:"",notes:"",sizeDiscrepancies:{}});x.useEffect(()=>{o&&m(s=>({...s,receivedBy:`${o.first_name} ${o.last_name}`}))},[o]);const U=s=>`REC${String(s+1).padStart(4,"0")}`,ue=s=>{const a={};return s.forEach((t,c)=>{const r=t.dispatch?.outlet_order?.outlet?.name||"Unknown Outlet";a[r]||(a[r]=[]),a[r].push({...t,displayIndex:c})}),a},ge=s=>{const a=new Set(W);a.has(s)?a.delete(s):a.add(s),me(a)},pe=s=>{xe(s),A(!0)},$=async()=>{try{V(!0);const s=C(o?.id),{data:a,error:t}=await I(async()=>await s.from("outlet_receiving").select(`
            *,
            dispatch_records!inner(
              id,
              destination,
              dispatch_date,
              outlet_orders!inner(
                id,
                order_number,
                outlets!inner(
                  id,
                  name,
                  location
                )
              )
            )
          `).order("received_date",{ascending:!1}));if(t)throw t;const c=(a||[]).map(r=>({id:r.id,dispatch_id:r.dispatch_id,outlet_order_id:r.outlet_order_id,received_date:r.received_date,received_by:r.received_by,expected_weight:parseFloat(r.expected_weight)||0,actual_weight_received:parseFloat(r.actual_weight_received)||0,expected_value:parseFloat(r.expected_value)||0,actual_value_received:parseFloat(r.actual_value_received)||0,condition:r.condition||"good",size_discrepancies:r.size_discrepancies||null,discrepancy_notes:r.discrepancy_notes||null,status:r.status||"confirmed",outlet_name:r.outlet_name||"Unknown",outlet_location:r.outlet_location||"Unknown",created_at:r.created_at,updated_at:r.updated_at,dispatch:{id:r.dispatch_records?.id||r.dispatch_id,destination:r.dispatch_records?.destination||"Unknown",dispatch_date:r.dispatch_records?.dispatch_date,outlet_order:{order_number:r.dispatch_records?.outlet_orders?.order_number||"N/A",outlet:{name:r.dispatch_records?.outlet_orders?.outlets?.name||r.outlet_name||"Unknown",location:r.dispatch_records?.outlet_orders?.outlets?.location||r.outlet_location||"Unknown"}}}}));O(c)}catch(s){const a=X(s,"fetching receiving records");h.error(a),O([])}finally{V(!1)}},fe=async()=>{try{const s=C(o?.id),{data:a,error:t}=await I(async()=>await s.from("dispatch_records").select(`
            id,
            outlet_order_id,
            destination,
            total_weight,
            total_value,
            size_breakdown,
            status,
            dispatch_date,
            notes,
            picking_date,
            picking_time,
            assigned_driver,
            outlet_order:outlet_orders(
              id,
              order_number,
              total_value,
              outlet:outlets(name, location, phone)
            )
          `).in("status",["in-transit","dispatched","scheduled"]).order("dispatch_date",{ascending:!1}));if(t)throw t;return console.log("Fetched dispatches:",a),a?.forEach((c,r)=>{console.log(`Dispatch ${r} size breakdown:`,c.size_breakdown)}),a||[]}catch(s){return console.error("Error fetching dispatches:",s),[]}},v=()=>{if(!i?.size_breakdown)return 0;let s=0;return Object.entries(i.size_breakdown).forEach(([a,t])=>{const c=l.sizeDiscrepancies[parseInt(a)]||0,r=t+c;s+=r}),s},B=()=>{const s=v(),a=parseFloat(l.actualWeight)||0,t=i?.size_breakdown&&Object.keys(i.size_breakdown).length>0,c=Object.keys(l.sizeDiscrepancies).length>0;return!!(l.dispatchId&&i&&l.actualWeight&&l.actualWeight.trim()!==""&&parseFloat(l.actualWeight)>0&&l.actualValue&&l.actualValue.trim()!==""&&parseFloat(l.actualValue)>0&&l.condition&&l.condition.trim()!==""&&o&&o.id&&(!t||c)&&(s===0||Math.abs(s-a)<=.1))},be=()=>{const s=[];(!l.dispatchId||!i)&&s.push("Please select a valid dispatch");const a=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(l.dispatchId&&!a.test(l.dispatchId)&&(s.push("Invalid dispatch ID format. Please refresh and select a dispatch again."),console.error("Invalid dispatch ID:",l.dispatchId)),!l.actualWeight||l.actualWeight.trim()===""?s.push("Please enter the weight received"):parseFloat(l.actualWeight)<=0?s.push("Weight received must be greater than 0"):parseFloat(l.actualWeight)<.1&&s.push("Weight received seems too low (<0.1kg). Please verify the value"),!l.actualValue||l.actualValue.trim()===""?s.push("Please enter the value received"):parseFloat(l.actualValue)<=0&&s.push("Value received must be greater than 0"),(!l.condition||l.condition.trim()==="")&&s.push("Please select the condition of received items"),(!o||!o.id)&&s.push("User session expired. Please refresh and try again"),i){const t=i.total_weight||0,c=i.total_value||0;t>1e4&&console.warn(`âš ï¸ WARNING: Expected weight (${t}kg) seems unrealistic. Please verify dispatch data.`),c>1e6&&console.warn(`âš ï¸ WARNING: Expected value (KES ${c.toLocaleString()}) seems unrealistic. Please verify dispatch data.`)}if(i&&i.total_weight>0){const t=i.total_weight||0,c=parseFloat(l.actualWeight)||0,r=Math.abs(c-t),d=t>0?r/t*100:0;d>20&&console.warn(`Weight discrepancy is ${d.toFixed(1)}% - please verify the received weight`)}if(l.actualWeight&&isNaN(parseFloat(l.actualWeight))&&s.push("Weight received must be a valid number"),l.actualValue&&isNaN(parseFloat(l.actualValue))&&s.push("Value received must be a valid number"),i?.size_breakdown&&Object.keys(i.size_breakdown).length>0)if(!(Object.keys(l.sizeDiscrepancies).length>0))s.push("This dispatch has size breakdown data. Please fill in the size discrepancies section below.");else{const c=v(),r=parseFloat(l.actualWeight)||0,d=Math.abs(c-r);d>.1&&s.push(`Size breakdown total (${c.toFixed(1)}kg) does not match total weight received (${r.toFixed(1)}kg). Difference: ${d.toFixed(1)}kg`)}return s},je=async(s,a,t,c,r)=>{try{await Ce.custom(s,a,t,{old_values:c,new_values:r})}catch(d){console.warn("Failed to log audit event:",d)}},ve=async()=>{if(F){h.warning("Please wait, submission in progress...");return}try{M(!0);const s=be();if(s.length>0){s.forEach(d=>h.error(d));return}if(i){const d=i.total_weight||0,Q=i.total_value||0,k=parseFloat(l.actualWeight)||0;d>1e4&&h.warning(`âš ï¸ Large expected weight: ${d}kg`),Q>1e6&&h.warning(`âš ï¸ Large expected value: KES ${Q.toLocaleString()}`),k>d&&k>1e4&&h.warning(`âš ï¸ Received weight (${k}kg) is larger than expected (${d}kg)`);const H=d>0?Math.abs(k-d)/d*100:0;H>20&&h.warning(`âš ï¸ Large discrepancy: ${H.toFixed(1)}%`)}const a={dispatch_id:l.dispatchId,outlet_order_id:i.outlet_order_id,received_date:new Date().toISOString().split("T")[0],received_by:o?.id||null,expected_weight:parseFloat((i.total_weight||0).toString()),actual_weight_received:parseFloat(l.actualWeight)||0,expected_pieces:0,actual_pieces_received:0,expected_value:parseFloat((i.total_value||i.outlet_order?.total_value||0).toString()),actual_value_received:parseFloat(l.actualValue)||0,condition:l.condition||"good",size_discrepancies:Object.keys(l.sizeDiscrepancies).length>0?l.sizeDiscrepancies:null,discrepancy_notes:l.notes||null,status:"confirmed",outlet_name:i.outlet_order?.outlet?.name||i.destination,outlet_location:i.outlet_order?.outlet?.location||"Unknown"};console.log("Creating receiving record with data:",a),console.log("Form data dispatchId:",l.dispatchId),console.log("Form data dispatchId type:",typeof l.dispatchId),console.log("Selected dispatch:",i),console.log("Selected dispatch ID:",i?.id),console.log("Selected dispatch ID type:",typeof i?.id);const t=C(o?.id),{data:c,error:r}=await I(async()=>await t.from("outlet_receiving").insert([a]).select("id").single());if(r)throw r;await t.from("dispatch_records").update({status:"delivered",updated_at:new Date().toISOString()}).eq("id",l.dispatchId);try{await je("INSERT","outlet_receiving",c.id,null,{...a,entry_code:`RCV-${Date.now()}`,fish_type:i.fish_type||"Tilapia",condition:a.condition,weight_received:a.actual_weight_received,outlet_id:i.outlet_order?.outlet_id,receiving_date:a.received_date})}catch(d){console.warn("Audit logging failed (non-critical):",d)}h.success("Receiving record created successfully"),m({dispatchId:"",outletId:"",actualWeight:"",actualValue:"",condition:"",receivedBy:o?`${o.first_name} ${o.last_name}`:"",notes:"",sizeDiscrepancies:{}}),T(null),R(!1),await $()}catch(s){const a=X(s,"creating receiving record");h.error(a)}finally{M(!1)}},Ne=async()=>{try{const s=await fe();console.log("Fetched dispatches:",s),oe(s)}catch(s){console.error("Error loading dispatches:",s),h.error("Failed to load available dispatches")}};x.useEffect(()=>{console.log("Available dispatches updated:",p),p.forEach((s,a)=>{console.log(`Dispatch ${a}:`,{id:s.id,idType:typeof s.id,destination:s.destination,total_weight:s.total_weight,size_breakdown:s.size_breakdown})})},[p]);const we=s=>{console.log("Selected dispatch ID:",s),console.log("Available dispatches:",p);const a=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(!a.test(s)){console.error("Invalid dispatch ID format:",s),h.error("Invalid dispatch selection. Please refresh and try again.");return}const t=p.find(c=>c.id===s);if(console.log("Found dispatch:",t),!t){console.error("Dispatch not found for ID:",s),h.error("Selected dispatch not found. Please refresh and try again.");return}if(!t.id||!a.test(t.id)){console.error("Dispatch has invalid ID:",t.id),h.error("Selected dispatch has invalid ID. Please refresh and try again.");return}T(t),console.log("Selected dispatch size breakdown:",t.size_breakdown),console.log("Size breakdown keys:",t.size_breakdown?Object.keys(t.size_breakdown):"No size breakdown"),console.log("Size breakdown entries:",t.size_breakdown?Object.entries(t.size_breakdown):"No size breakdown"),m(c=>({...c,dispatchId:t.id,outletId:t.outlet_order?.outlet?.name||"",actualWeight:t.total_weight?.toString()||"",actualValue:t.total_value?.toString()||"",condition:"good"}))},_e=async()=>{L(!0),await $(),L(!1)};x.useEffect(()=>{$()},[]),x.useEffect(()=>{z&&Ne()},[z]);const K=s=>{switch(s){case"confirmed":return"bg-emerald-500 text-white";case"disputed":return"bg-red-500 text-white";case"pending":return"bg-amber-500 text-white";default:return"bg-gray-500 text-white"}},q=s=>{switch(s){case"excellent":return"bg-green-500 text-white";case"good":return"bg-blue-500 text-white";case"fair":return"bg-orange-500 text-white";case"poor":return"bg-red-500 text-white";default:return"bg-gray-500 text-white"}},ye=s=>`KES ${s.toLocaleString()}`,G=(s,a)=>{const t=a-s,c=s>0?(t/s*100).toFixed(1):"0";return{diff:t,percentage:c}},ke=s=>{if(!s)return"No size discrepancies";const a=Object.entries(s).filter(([t,c])=>c!==0).map(([t,c])=>`Size ${t}: ${c>0?"+":""}${c}`);return a.length>0?a.join(", "):"No size discrepancies"},N={totalReceivings:g.length,confirmed:g.filter(s=>s.status==="confirmed").length,disputed:g.filter(s=>s.status==="disputed").length,totalValue:g.reduce((s,a)=>s+(a.actual_value_received||0),0),totalWeight:g.reduce((s,a)=>s+(a.actual_weight_received||0),0)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-blue-50 content-container responsive-padding",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h1",{className:"text-4xl font-bold text-gray-900 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-green-500 to-blue-600 rounded-2xl shadow-lg",children:e.jsx(S,{className:"h-10 w-10 text-white"})}),"Outlet Receiving Records"]}),e.jsx("p",{className:"text-xl text-gray-600 ml-16",children:"Track what outlets received â€¢ Size-based verification â€¢ Quality control"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(f,{variant:"outline",onClick:_e,disabled:P,className:"px-6 py-3 rounded-2xl font-semibold",children:[e.jsx(re,{className:`h-5 w-5 mr-2 ${P?"animate-spin":""}`}),"Refresh"]}),e.jsxs(te,{open:z,onOpenChange:R,children:[e.jsx($e,{asChild:!0,children:e.jsxs(f,{className:"bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 text-white px-8 py-4 rounded-2xl font-semibold text-lg shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:scale-105",children:[e.jsx(Ie,{className:"h-6 w-6 mr-3"}),"Record Receiving"]})}),e.jsxs(ae,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsx(le,{className:"text-2xl font-bold text-gray-900",children:"Record Outlet Receiving"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required"]})]}),e.jsxs("div",{className:"space-y-6 py-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(u,{className:"text-base font-semibold text-gray-700",children:["Select Dispatch ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(Y,{value:l.dispatchId,onValueChange:we,children:[e.jsx(Z,{className:"h-14 text-base",children:e.jsx(ee,{placeholder:"Select dispatch to receive"})}),e.jsx(se,{children:p.map(s=>e.jsxs(y,{value:s.id,children:[s.outlet_order?.order_number||`ORD-${s.id?.slice(-6)}`," - ",s.destination,s.total_weight>0?` (${s.total_weight}kg)`:" (Not picked yet)"," ","- ",s.status.toUpperCase()]},s.id))})]})]}),i&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-2xl border-l-4 border-blue-400",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Dispatch Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Outlet:"})," ",i.outlet_order?.outlet?.name||i.destination]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Location:"})," ",i.outlet_order?.outlet?.location||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Order Number:"})," ",i.outlet_order?.order_number||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx("span",{className:`ml-1 px-2 py-1 rounded text-xs font-medium ${i.status==="dispatched"?"bg-green-100 text-green-800":i.status==="in-transit"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:i.status.toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Expected Weight:"}),e.jsxs("span",{className:`font-medium ${i.total_weight>1e4?"text-red-600":"text-green-600"}`,children:[i.total_weight,"kg",i.total_weight>1e4&&e.jsx("span",{className:"text-xs text-red-500 ml-1",children:"âš ï¸"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Expected Value:"}),e.jsxs("span",{className:`font-medium ${(i.total_value||0)>1e6?"text-red-600":"text-gray-900"}`,children:["KES ",(i.total_value||i.outlet_order?.total_value||0).toLocaleString(),(i.total_value||0)>1e6&&e.jsx("span",{className:"text-xs text-red-500 ml-1",children:"âš ï¸"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Dispatch Date:"})," ",new Date(i.dispatch_date).toLocaleDateString()]}),i.assigned_driver&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Driver:"})," ",i.assigned_driver]}),i.picking_date&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Picking Date:"})," ",new Date(i.picking_date).toLocaleDateString()]})]}),i.size_breakdown&&Object.keys(i.size_breakdown).length>0?e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold text-blue-900",children:"Size Breakdown Available:"}),e.jsxs("span",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs font-medium",children:[Object.keys(i.size_breakdown).length," sizes"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(i.size_breakdown).map(([s,a])=>e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-md text-sm font-medium border border-blue-300",children:["Size ",s,": ",a,"kg"]},s))}),e.jsx("div",{className:"mt-2 text-xs text-blue-700",children:"âš ï¸ Size discrepancies must be filled below before submitting"})]}):e.jsx("div",{className:"mt-3 p-2 bg-gray-50 border border-gray-200 rounded text-sm text-gray-600",children:"No size breakdown data available for this dispatch"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(u,{className:"text-base font-semibold text-gray-700",children:["Weight Received (kg) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(D,{type:"number",step:"0.1",placeholder:"202.5",className:"h-14 text-base",value:l.actualWeight,onChange:s=>m({...l,actualWeight:s.target.value})}),i&&l.actualWeight&&e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"text-gray-600",children:["Expected: ",i.total_weight,"kg"]}),(()=>{const s=i.total_weight||0,a=parseFloat(l.actualWeight)||0,t=s-a,c=a-s,r=s>0?(c/s*100).toFixed(1):"0",d=Math.abs(c)>s*.1;return e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:`${d?"text-orange-600 font-medium":"text-green-600"}`,children:c>0?`+${c.toFixed(1)}kg (${r}% over)`:c<0?`${c.toFixed(1)}kg (${r}% under)`:"Exact match"}),e.jsxs("div",{className:"text-blue-600 font-medium",children:["Remaining: ",t>0?t.toFixed(1):0,"kg"]})]})})()]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(u,{className:"text-base font-semibold text-gray-700",children:["Value Received (KES) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(D,{type:"number",placeholder:"101250",className:"h-14 text-base",value:l.actualValue,onChange:s=>m({...l,actualValue:s.target.value})}),i&&l.actualValue&&e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Expected: KES ",i.total_value?.toLocaleString()]}),(()=>{const s=i.total_value||0,t=(parseFloat(l.actualValue)||0)-s,c=s>0?(t/s*100).toFixed(1):"0",r=Math.abs(t)>s*.1;return e.jsxs("span",{className:`ml-2 ${r?"text-orange-600 font-medium":"text-green-600"}`,children:["(",t>0?"+":"","KES ",t.toLocaleString(),", ",c,"%)"]})})()]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(u,{className:"text-base font-semibold text-gray-700",children:["Quality Condition ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(Y,{value:l.condition,onValueChange:s=>m({...l,condition:s}),children:[e.jsx(Z,{className:"h-14 text-base",children:e.jsx(ee,{placeholder:"Select condition"})}),e.jsxs(se,{children:[e.jsx(y,{value:"excellent",children:"ðŸŸ¢ Excellent - Perfect condition"}),e.jsx(y,{value:"good",children:"ðŸ”µ Good - Minor issues"}),e.jsx(y,{value:"fair",children:"ðŸŸ¡ Fair - Some quality concerns"}),e.jsx(y,{value:"poor",children:"ðŸ”´ Poor - Significant quality issues"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(u,{className:"text-base font-semibold text-gray-700",children:"Received By"}),e.jsx(D,{placeholder:"Staff member name",className:"h-14 text-base bg-gray-50",value:l.receivedBy,readOnly:!0,title:"Automatically set to logged-in user"})]}),i?.size_breakdown&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs(u,{className:"text-base font-semibold text-gray-700",children:["Size Discrepancies ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-blue-600"}),e.jsx("div",{className:"text-sm text-blue-800 font-medium",children:"This dispatch has size breakdown data. Please fill in the actual quantities received for each size."})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:Object.entries(i.size_breakdown).map(([s,a])=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{className:"text-sm font-medium text-gray-600",children:["Size ",s," (Expected: ",a,"kg)"]}),e.jsx(D,{type:"number",step:"0.1",placeholder:"Actual received",className:"h-10 text-sm",onChange:t=>{const r=(parseFloat(t.target.value)||0)-a;m(d=>({...d,sizeDiscrepancies:{...d.sizeDiscrepancies,[parseInt(s)]:r}}))}})]},s))}),Object.keys(l.sizeDiscrepancies).length>0&&e.jsxs("div",{className:"mt-4 p-3 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Size Breakdown Total:"}),e.jsxs("span",{className:"text-sm font-bold text-blue-600",children:[v().toFixed(1)," kg"]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Total Weight Received:"}),e.jsxs("span",{className:"text-sm font-bold text-green-600",children:[parseFloat(l.actualWeight||"0").toFixed(1)," kg"]})]}),(()=>{const s=v(),a=parseFloat(l.actualWeight||"0"),t=Math.abs(s-a),c=t<=.1;return e.jsxs("div",{className:`flex items-center justify-between p-2 rounded ${c?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[e.jsx("span",{className:"text-sm font-medium",children:"Match Status:"}),e.jsx("span",{className:`text-sm font-bold ${c?"text-green-600":"text-red-600"}`,children:c?"âœ… Match":`âŒ ${t.toFixed(1)}kg difference`})]})})()]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(u,{className:"text-base font-semibold text-gray-700",children:"Quality & Discrepancy Notes"}),e.jsx(We,{placeholder:"Any quality issues, missing items, or other discrepancies...",className:"h-24 text-base",value:l.notes,onChange:s=>m({...l,notes:s.target.value})})]}),e.jsxs("div",{className:"flex flex-col gap-4 pt-6",children:[!B()&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-amber-600"}),e.jsx("div",{className:"text-sm text-amber-800 font-medium",children:(()=>{const s=v(),a=parseFloat(l.actualWeight||"0"),t=Math.abs(s-a),c=i?.size_breakdown&&Object.keys(i.size_breakdown).length>0,r=Object.keys(l.sizeDiscrepancies).length>0;return c&&!r?"This dispatch has size breakdown data. Please fill in the size discrepancies section below.":s>0&&t>.1?`Size breakdown total (${s.toFixed(1)}kg) does not match total weight (${a.toFixed(1)}kg). Please adjust the values.`:"Please fill in all required fields to continue"})()})]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(f,{variant:"outline",onClick:()=>R(!1),className:"px-8 py-3 text-base",children:"Cancel"}),e.jsx(f,{onClick:ve,disabled:F||!B(),className:"bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 px-8 py-3 text-base disabled:opacity-50 disabled:cursor-not-allowed",children:F?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 mr-2 animate-spin"}),"Recording..."]}):"Record Receiving"})]})]})]})]})]})]})," "]}),"   ",e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsx(b,{className:"border-0 shadow-xl bg-gradient-to-br from-green-50 to-emerald-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-green-600 uppercase tracking-wide",children:"Total Records"}),e.jsx("p",{className:"text-4xl font-bold text-green-900 mt-2",children:N.totalReceivings})]}),e.jsx("div",{className:"p-4 bg-green-600 rounded-2xl shadow-lg",children:e.jsx(S,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(b,{className:"border-0 shadow-xl bg-gradient-to-br from-emerald-50 to-green-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-emerald-600 uppercase tracking-wide",children:"Confirmed"}),e.jsx("p",{className:"text-4xl font-bold text-emerald-900 mt-2",children:N.confirmed})]}),e.jsx("div",{className:"p-4 bg-emerald-600 rounded-2xl shadow-lg",children:e.jsx(ce,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(b,{className:"border-0 shadow-xl bg-gradient-to-br from-red-50 to-red-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-red-600 uppercase tracking-wide",children:"Disputed"}),e.jsx("p",{className:"text-4xl font-bold text-red-900 mt-2",children:N.disputed})]}),e.jsx("div",{className:"p-4 bg-red-600 rounded-2xl shadow-lg",children:e.jsx(w,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(b,{className:"border-0 shadow-xl bg-gradient-to-br from-blue-50 to-blue-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-blue-600 uppercase tracking-wide",children:"Total Weight"}),e.jsx("p",{className:"text-4xl font-bold text-blue-900 mt-2",children:N.totalWeight.toFixed(1)}),e.jsx("p",{className:"text-sm text-blue-600",children:"kg"})]}),e.jsx("div",{className:"p-4 bg-blue-600 rounded-2xl shadow-lg",children:e.jsx(Ee,{className:"h-8 w-8 text-white"})})]})})}),e.jsx(b,{className:"border-0 shadow-xl bg-gradient-to-br from-purple-50 to-purple-100 hover:shadow-2xl transition-all duration-300",children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-purple-600 uppercase tracking-wide",children:"Total Value"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900 mt-2",children:ye(N.totalValue)})]}),e.jsx("div",{className:"p-4 bg-purple-600 rounded-2xl shadow-lg",children:e.jsx(Ae,{className:"h-8 w-8 text-white"})})]})})})]}),e.jsxs(b,{className:"border-0 shadow-2xl bg-white/80 backdrop-blur-sm",children:[e.jsx(ze,{className:"pb-6 bg-gradient-to-r from-gray-50 to-gray-100 rounded-t-3xl",children:e.jsxs(Re,{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(Oe,{className:"h-8 w-8 text-green-600"}),"Receiving Records by Size"]})}),e.jsx(j,{className:"p-8",children:de?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-4",children:"Loading receiving records..."})]}):g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No receiving records found"}),e.jsx("p",{className:"text-gray-500",children:"Start by recording your first outlet receiving"})]}):e.jsx("div",{className:"space-y-6",children:Object.entries(ue(g)).map(([s,a])=>e.jsxs("div",{className:"border-2 border-gray-100 rounded-3xl p-6 hover:shadow-xl transition-all duration-300 bg-gradient-to-r from-white to-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>ge(s),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ve,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:s}),e.jsx("p",{className:"text-sm text-gray-500",children:a[0]?.dispatch?.outlet_order?.outlet?.location||"Unknown Location"})]})]}),e.jsxs(_,{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full",children:[a.length," ",a.length===1?"Order":"Orders"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Total Received: ",a.reduce((t,c)=>t+(c.actual_weight_received||0),0).toFixed(1)," kg"]}),e.jsx(Pe,{className:`h-5 w-5 text-gray-400 transition-transform duration-200 ${W.has(s)?"rotate-180":""}`})]})]}),W.has(s)&&e.jsx("div",{className:"mt-6 space-y-4",children:a.map((t,c)=>{const r=G(t.expected_weight||0,t.actual_weight_received||0),d=G(t.expected_value||0,t.actual_value_received||0);return e.jsx("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 hover:shadow-lg transition-all duration-200",children:e.jsxs("div",{className:"flex flex-col xl:flex-row justify-between items-start xl:items-center gap-6",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-lg font-bold text-gray-900",children:U(t.displayIndex||c)})]}),e.jsx(_,{className:`text-sm font-semibold px-3 py-1 rounded-xl ${K(t.status)}`,children:t.status.toUpperCase()}),e.jsx(_,{className:`text-sm font-semibold px-3 py-1 rounded-xl ${q(t.condition)}`,children:t.condition.toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-gray-700",children:[e.jsx(Fe,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",children:["Order: ",t.dispatch?.outlet_order?.order_number||`ORD-${t.dispatch_id?.slice(-6)}`]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Dispatch: ",t.dispatch?.destination||`DSP-${t.dispatch_id?.slice(-6)}`]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-700",children:[e.jsx(ce,{className:"h-4 w-4 text-purple-500"}),e.jsxs("span",{className:"text-sm font-medium",children:["By: ",t.received_by_user?`${t.received_by_user.first_name} ${t.received_by_user.last_name}`:"Unknown"]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-700",children:[e.jsx(Le,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{className:"text-sm font-medium",children:new Date(t.received_date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-700",children:[e.jsx(E,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{className:"text-sm font-medium",children:[t.actual_weight_received||0," kg"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(E,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-900 text-sm",children:"Weight"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Expected:"}),e.jsxs("span",{className:"font-medium",children:[t.expected_weight||0," kg"]})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Received:"}),e.jsxs("span",{className:"font-medium text-green-600",children:[t.actual_weight_received||0," kg"]})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Diff:"}),e.jsxs("span",{className:`font-medium ${r.diff>=0?"text-green-600":"text-red-600"}`,children:[r.diff>=0?"+":"",r.diff.toFixed(2)," kg"]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ne,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"font-semibold text-gray-900 text-sm",children:"Value"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Expected:"}),e.jsxs("span",{className:"font-medium",children:["KSh ",(t.expected_value||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Received:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["KSh ",(t.actual_value_received||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Diff:"}),e.jsxs("span",{className:`font-medium ${d.diff>=0?"text-green-600":"text-red-600"}`,children:[d.diff>=0?"+":"","KSh ",d.diff.toLocaleString()]})]})]})]})]}),t.discrepancy_notes&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-yellow-800 text-sm mb-1",children:"Discrepancy Notes"}),e.jsx("div",{className:"text-xs text-yellow-700",children:t.discrepancy_notes})]})]})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(f,{variant:"outline",size:"sm",className:"h-10 px-4 border-2 border-blue-200 text-blue-700 hover:bg-blue-50 hover:border-blue-300",onClick:()=>pe(t),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"View Details"]}),e.jsxs(f,{variant:"outline",size:"sm",className:"h-10 px-4 border-2 border-green-200 text-green-700 hover:bg-green-50 hover:border-green-300",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Edit"]})]})]})},t.id)})})]},s))})})]})]}),e.jsx(te,{open:he,onOpenChange:A,children:e.jsxs(ae,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ie,{children:e.jsxs(le,{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(J,{className:"h-6 w-6 text-blue-600"}),"Receiving Record Details - ",n&&U(0)]})}),n&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"Outlet Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",n.dispatch?.outlet_order?.outlet?.name||"Unknown"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Location:"})," ",n.dispatch?.outlet_order?.outlet?.location||"Unknown"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Order Number:"})," ",n.dispatch?.outlet_order?.order_number||"N/A"]})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-xl",children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-3",children:"Receiving Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Received By:"})," ",n.received_by_user?`${n.received_by_user.first_name} ${n.received_by_user.last_name}`:"Unknown"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",new Date(n.received_date).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",e.jsx(_,{className:K(n.status),children:n.status.toUpperCase()})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5 text-blue-600"}),"Weight Details"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Expected Weight:"}),e.jsxs("span",{className:"font-medium",children:[n.expected_weight||0," kg"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Actual Weight:"}),e.jsxs("span",{className:"font-medium text-green-600",children:[n.actual_weight_received||0," kg"]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"text-gray-600",children:"Difference:"}),e.jsxs("span",{className:`font-medium ${(n.actual_weight_received||0)>=(n.expected_weight||0)?"text-green-600":"text-red-600"}`,children:[(n.actual_weight_received||0)-(n.expected_weight||0)>=0?"+":"",((n.actual_weight_received||0)-(n.expected_weight||0)).toFixed(2)," kg"]})]})]})]})}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-xl",children:[e.jsxs("h3",{className:"font-semibold text-purple-900 mb-3 flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5 text-purple-600"}),"Value Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Expected Value"}),e.jsxs("div",{className:"text-lg font-bold text-gray-900",children:["KSh ",(n.expected_value||0).toLocaleString()]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Actual Value"}),e.jsxs("div",{className:"text-lg font-bold text-green-600",children:["KSh ",(n.actual_value_received||0).toLocaleString()]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Difference"}),e.jsxs("div",{className:`text-lg font-bold ${(n.actual_value_received||0)-(n.expected_value||0)>=0?"text-green-600":"text-red-600"}`,children:[(n.actual_value_received||0)-(n.expected_value||0)>=0?"+":"","KSh ",((n.actual_value_received||0)-(n.expected_value||0)).toLocaleString()]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-orange-50 p-4 rounded-xl",children:[e.jsx("h3",{className:"font-semibold text-orange-900 mb-3",children:"Condition"}),e.jsx(_,{className:q(n.condition),children:n.condition.toUpperCase()})]}),n.discrepancy_notes&&e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-xl",children:[e.jsxs("h3",{className:"font-semibold text-yellow-900 mb-3 flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5 text-yellow-600"}),"Discrepancy Notes"]}),e.jsx("p",{className:"text-sm text-yellow-800",children:n.discrepancy_notes})]})]}),n.size_discrepancies&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Size Discrepancies"}),e.jsx("div",{className:"text-sm text-gray-700",children:ke(n.size_discrepancies)})]})]})]})})]})}export{ns as default};
