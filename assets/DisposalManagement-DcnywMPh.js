import{r,j as e,p as ve,e as pe,P as he,s as w,m as us,t as S,B as F,a as C,f as U,g as H,b as k,L as D,I as le,X as fs,l as Y,A as Ke,i as Ge,E as Ye}from"./main-F3q40TAH.js";import{S as ue,a as fe,b as je,c as _e,d as X}from"./select-BDoYxUW5.js";import{T as js}from"./textarea-Dn2zPVRL.js";import{D as Se,a as _s,b as Ce,c as ke,d as Ie,f as Fe,e as Te}from"./dialog-CkI_bZ5S.js";import{C as vs}from"./checkbox-pZRoTaeU.js";import{T as ys,a as bs,b as Qe,c as J,d as Ds,e as Z}from"./table-BtrSXgeX.js";import{D as ws}from"./dollar-sign-cj95uAeY.js";import{T as Ns}from"./trending-down-XHRtTxL1.js";import{C as es}from"./clock-D4eLWtjC.js";import{S as Ss}from"./scale-BxtwfTXG.js";import{A as Cs}from"./activity-0dM36Tla.js";import{P as ks}from"./plus-PbpcxJmY.js";import{a as Xe,C as Is}from"./index-CEX4zLXe.js";import{R as Fs}from"./refresh-cw-BE374wKn.js";import{B as Ts}from"./building-2-kU8qLx0o.js";import{W as Je}from"./weight-BDP6grDy.js";import{D as As}from"./download-CypQS1zr.js";import{F as Ms}from"./file-text-B_xMAq1W.js";import{C as Es}from"./circle-check-big-BWLP4q_v.js";import"./index-yY-Pidxn.js";import"./index-DWnEPUXc.js";function $s({stats:A}){const[l,p]=r.useState([]);return r.useEffect(()=>{const c=[{id:"1",type:"warning",icon:e.jsx(ve,{className:"h-5 w-5"}),text:`ðŸ—‘ï¸ Total Disposals: ${A?.totalDisposals||0} records | ${(A?.totalDisposedWeight||0).toFixed(1)}kg disposed`,bgColor:"bg-orange-100",textColor:"text-orange-800"},{id:"2",type:"info",icon:e.jsx(ws,{className:"h-5 w-5"}),text:`ðŸ’° Disposal Costs: KES ${(A?.totalDisposalCost||0).toLocaleString()} total cost | ${(A?.averageDisposalAge||0).toFixed(1)} days avg age`,bgColor:"bg-red-100",textColor:"text-red-800"},{id:"3",type:"warning",icon:e.jsx(pe,{className:"h-5 w-5"}),text:`âš ï¸ Pending Disposals: ${A?.pendingDisposals||0} awaiting approval | ${A?.recentDisposals||0} this week`,bgColor:"bg-yellow-100",textColor:"text-yellow-800"},{id:"4",type:"info",icon:e.jsx(Ns,{className:"h-5 w-5"}),text:`ðŸ“‰ Disposal Trend: ${A?.monthlyDisposalTrend||0}% change this month | Top reason: ${A?.topDisposalReason||"Age"}`,bgColor:"bg-purple-100",textColor:"text-purple-800"},{id:"5",type:"info",icon:e.jsx(es,{className:"h-5 w-5"}),text:`â° Average Age: ${(A?.averageDisposalAge||0).toFixed(1)} days before disposal | Quality control active`,bgColor:"bg-indigo-100",textColor:"text-indigo-800"},{id:"6",type:"success",icon:e.jsx(he,{className:"h-5 w-5"}),text:"ðŸ“¦ Waste Management: Efficient disposal system | Environmental compliance maintained",bgColor:"bg-green-100",textColor:"text-green-800"},{id:"7",type:"info",icon:e.jsx(Ss,{className:"h-5 w-5"}),text:"âš–ï¸ Quality Control: Automated disposal triggers | Storage optimization active",bgColor:"bg-blue-100",textColor:"text-blue-800"},{id:"8",type:"achievement",icon:e.jsx(Cs,{className:"h-5 w-5"}),text:"ðŸŽ¯ Rio Fish Farm: Leading waste management practices in Kenya's fish industry",bgColor:"bg-emerald-100",textColor:"text-emerald-800"}];p(c)},[A]),e.jsx("div",{className:"w-full bg-gradient-to-r from-orange-50 to-red-50 border-b border-orange-200 shadow-sm overflow-hidden relative z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"relative py-2 sm:py-3 overflow-hidden",children:e.jsxs("div",{className:"flex animate-marquee-simple whitespace-nowrap",children:[l.map(c=>e.jsxs("div",{className:`flex items-center gap-2 sm:gap-3 px-3 sm:px-6 py-1 sm:py-2 rounded-full ${c.bgColor} ${c.textColor} font-medium text-xs sm:text-sm whitespace-nowrap mx-2 sm:mx-4 shadow-sm border flex-shrink-0`,children:[c.icon,e.jsx("span",{children:c.text})]},c.id)),l.map(c=>e.jsxs("div",{className:`flex items-center gap-2 sm:gap-3 px-3 sm:px-6 py-1 sm:py-2 rounded-full ${c.bgColor} ${c.textColor} font-medium text-xs sm:text-sm whitespace-nowrap mx-2 sm:mx-4 shadow-sm border flex-shrink-0`,children:[c.icon,e.jsx("span",{children:c.text})]},`duplicate-${c.id}`))]})})})})}class Rs{async getDisposalStats(){try{console.log("ðŸ” [DisposalService] Fetching disposal statistics...");const{data:l,error:p}=await w.from("disposal_records").select(`
          *,
          disposal_reason:disposal_reasons(name)
        `).order("created_at",{ascending:!1});if(p)throw console.error("âŒ [DisposalService] Error fetching disposal records:",p),p;console.log("ðŸ“Š [DisposalService] Disposal records:",l?.length||0);const c=l?.length||0,M=l?.reduce((h,v)=>h+(v.total_weight_kg||0),0)||0,j=l?.reduce((h,v)=>h+(v.disposal_cost||0),0)||0,E=l?.filter(h=>h.status==="pending").length||0,K=new Date;K.setDate(K.getDate()-7);const ee=l?.filter(h=>new Date(h.created_at)>=K).length||0,B=l?.filter(h=>h.status==="completed")||[];let Q=0;B.length>0&&(Q=B.reduce((v,xe)=>{const ie=new Date(xe.created_at),N=new Date(xe.disposal_date),ye=Math.floor((N.getTime()-ie.getTime())/(1e3*60*60*24));return v+ye},0)/B.length);const R={};l?.forEach(h=>{const v=h.disposal_reason?.name||"Unknown";R[v]=(R[v]||0)+1});const T=Object.keys(R).reduce((h,v)=>R[h]>R[v]?h:v,"Age"),$=new Date,z=$.getMonth(),i=$.getFullYear(),y=z===0?11:z-1,O=z===0?i-1:i,f=l?.filter(h=>{const v=new Date(h.created_at);return v.getMonth()===z&&v.getFullYear()===i}).length||0,_=l?.filter(h=>{const v=new Date(h.created_at);return v.getMonth()===y&&v.getFullYear()===O}).length||0,L=_>0?(f-_)/_*100:0,q={totalDisposals:c,totalDisposedWeight:M,totalDisposalCost:j,pendingDisposals:E,recentDisposals:ee,averageDisposalAge:Q,topDisposalReason:T,monthlyDisposalTrend:L};return console.log("ðŸ“Š [DisposalService] Calculated stats:",q),q}catch(l){return console.error("âŒ [DisposalService] Error getting disposal stats:",l),{totalDisposals:0,totalDisposedWeight:0,totalDisposalCost:0,pendingDisposals:0,recentDisposals:0,averageDisposalAge:0,topDisposalReason:"Age",monthlyDisposalTrend:0}}}async getDisposalRecords(l=50,p=0){try{const{data:c,error:M}=await w.from("disposal_records").select(`
          *,
          disposal_reason:disposal_reasons(name)
        `).order("created_at",{ascending:!1}).range(p,p+l-1);if(M)throw M;return c||[]}catch(c){return console.error("Error fetching disposal records:",c),[]}}async getDisposalReasons(){try{const{data:l,error:p}=await w.from("disposal_reasons").select("*").eq("is_active",!0).order("name");if(p)throw p;return l||[]}catch(l){return console.error("Error fetching disposal reasons:",l),[]}}async getInventoryForDisposal(l=30,p=!0,c,M=!1){try{console.log("ðŸ” [DisposalService] Getting inventory for disposal with improved filtering..."),console.log("ðŸ“Š [DisposalService] Filter criteria:",{daysOld:l,includeStorageIssues:p});const j=new Date;j.setDate(j.getDate()-l);const E=j.toISOString().split("T")[0];console.log("ðŸ“… [DisposalService] Cutoff date:",E);const{data:K,error:ee}=await w.from("storage_locations").select("id, name, status, capacity_kg, current_usage_kg").order("name");if(ee)throw console.error("âŒ [DisposalService] Storage locations error:",ee),ee;console.log("ðŸ“ [DisposalService] Storage locations found:",K?.length||0);const B=new Map;K?.forEach(i=>{B.set(i.id,i)});let Q=w.from("sorting_results").select(`
          id,
          size_class,
          total_pieces,
          total_weight_grams,
          storage_location_id,
          sorting_batch:sorting_batches(
            id,
            batch_number,
            status,
            created_at,
            processing_record:processing_records(
              id,
              processing_date,
              warehouse_entry:warehouse_entries(
                id,
                entry_date,
                farmer_id,
                farmers(name, phone, location)
              )
            )
          )
        `).not("storage_location_id","is",null).gt("total_weight_grams",0);Q=Q.eq("sorting_batch.status","completed");const{data:R,error:T}=await Q.order("created_at",{ascending:!1});if(T)throw console.error("âŒ [DisposalService] Query error:",T),T;console.log("ðŸ“Š [DisposalService] Raw query results:",R?.length||0,"items");const $=(R||[]).filter(i=>{const y=B.get(i.storage_location_id);if(!i.total_weight_grams||i.total_weight_grams<=0)return console.log("âŒ [DisposalService] Item filtered out - no weight:",i.id,i.total_weight_grams),!1;const O=i.sorting_batch?.processing_record?.processing_date||i.sorting_batch?.created_at?.split("T")[0];if(!O)return console.log("âŒ [DisposalService] Item filtered out - no processing date:",i.id),!1;const f=new Date(O);if(isNaN(f.getTime())||f>new Date)return console.log("âŒ [DisposalService] Item filtered out - invalid or future date:",i.id,O),!1;const _=Math.floor((new Date().getTime()-f.getTime())/(1e3*60*60*24));let L=!1;l===0?L=!0:c&&c>l?L=_>=l&&_<=c:L=_>=l;let q=!1;M?q=y&&y.status!=="active":p&&(q=!i.storage_location_id||!y||y.status!=="active"||y.current_usage_kg>y.capacity_kg);const h=L||q;return console.log("ðŸ” [DisposalService] Item check:",{id:i.id,batchNumber:i.sorting_batch?.batch_number,processingDate:O,daysInStorage:_,weightGrams:i.total_weight_grams,isOldEnough:L,hasStorageIssues:q,storageStatus:y?.status,isEligible:h}),h});console.log("ðŸ“Š [DisposalService] Eligible items after filtering:",$.length);const z=$.map(i=>{const y=B.get(i.storage_location_id),O=i.sorting_batch?.processing_record?.processing_date||i.sorting_batch?.created_at?.split("T")[0],f=Math.floor((new Date().getTime()-new Date(O).getTime())/(1e3*60*60*24));let _="Age";return i.storage_location_id?y?y.status!=="active"?_="Storage Inactive":y.current_usage_kg>y.capacity_kg?_="Storage Over Capacity":f>=l&&(_="Age"):_="Storage Not Found":_="No Storage Location",{sorting_result_id:i.id,size_class:i.size_class,total_pieces:i.total_pieces,total_weight_grams:i.total_weight_grams,batch_number:i.sorting_batch?.batch_number||"BATCH-"+i.sorting_batch?.id?.substring(0,8),storage_location_name:y?.name||"No Storage Assigned",farmer_name:i.sorting_batch?.processing_record?.warehouse_entry?.farmers?.name||"Unknown Farmer",processing_date:O,days_in_storage:f,disposal_reason:_,quality_notes:`Fish from ${i.sorting_batch?.processing_record?.warehouse_entry?.farmers?.name||"Unknown Farmer"}`,storage_status:y?.status||"unknown"}});return console.log("ðŸ“Š [DisposalService] Transformed items:",z.length),z}catch(j){return console.error("âŒ [DisposalService] Error getting inventory for disposal:",j),[]}}async getInventoryForDisposalFallback(l=30){try{const p=new Date;p.setDate(p.getDate()-l);const{data:c,error:M}=await w.from("sorting_results").select(`
          id,
          size_class,
          total_weight_grams,
          batch_number,
          storage_location_name,
          farmer_name,
          processing_date,
          quality_notes,
          storage_locations!inner(status)
        `).eq("status","available").lte("processing_date",p.toISOString().split("T")[0]).gte("total_weight_grams",0);if(M)throw M;return c?.map(j=>({sorting_result_id:j.id,size_class:j.size_class,total_weight_grams:j.total_weight_grams,batch_number:j.batch_number,storage_location_name:j.storage_location_name,storage_status:j.storage_locations?.status||"active",farmer_name:j.farmer_name,processing_date:j.processing_date,days_in_storage:Math.floor((new Date().getTime()-new Date(j.processing_date).getTime())/(1e3*60*60*24)),disposal_reason:j.storage_locations?.status==="inactive"?"Storage Inactive":"Age",quality_notes:j.quality_notes}))||[]}catch(p){return console.error("Error in fallback method:",p),[]}}}const Ze=new Rs;function ot({onNavigate:A}){const{user:l}=us(),[p,c]=r.useState([]),[M,j]=r.useState([]),[E,K]=r.useState([]),[ee,B]=r.useState(null),[Q,R]=r.useState(!0),[T,$]=r.useState(!1),[z,i]=r.useState(""),[y,O]=r.useState("all"),[f,_]=r.useState([]),[L,q]=r.useState(!1),[h,v]=r.useState(!1),[xe,ie]=r.useState(!1),[N,ye]=r.useState(null),[I,be]=r.useState(null),[G,re]=r.useState([]),[ne,Ae]=r.useState(""),[Me,Ee]=r.useState("waste"),[$e,Re]=r.useState(""),[ze,Oe]=r.useState(0),[Le,qe]=r.useState(""),[g,ce]=r.useState(0),[De,de]=r.useState(!0),[n,Pe]=r.useState("all"),[P,V]=r.useState(""),[se,W]=r.useState(""),[We,ss]=r.useState(new Set),[me,Be]=r.useState(20),ts=[{value:"waste",label:"Waste Disposal",description:"General waste disposal"},{value:"compost",label:"Compost",description:"Convert to compost"},{value:"donation",label:"Donation",description:"Donate to charity"},{value:"return_to_farmer",label:"Return to Farmer",description:"Return to original farmer"}],Ve=[{value:"all",label:"All Items",description:"Show all available items",days:0},{value:"recent",label:"Recent (1-7 days)",description:"Items 1-7 days old",days:7},{value:"aging",label:"Aging (8-30 days)",description:"Items 8-30 days old",days:30},{value:"old",label:"Old (31-60 days)",description:"Items 31-60 days old",days:60},{value:"very_old",label:"Very Old (61-100 days)",description:"Items 61-100 days old",days:100},{value:"expired",label:"Expired (100+ days)",description:"Items over 100 days old",days:1e3},{value:"inactive_storage",label:"Inactive Storage",description:"Items in inactive storage locations",days:0},{value:"storage_issues",label:"All Storage Issues",description:"Items with any storage problems",days:0},{value:"custom_age",label:"Custom Age",description:"Items older than specified days",days:0}];r.useEffect(()=>{ge()},[]),r.useEffect(()=>{L&&we()},[g,De,P,se,L,n,me]),r.useEffect(()=>{const s=Ve.find(t=>t.value===n);s&&(n==="storage_issues"||n==="inactive_storage"?(ce(0),de(!0),V(""),W("")):n==="custom_age"?(ce(me),de(!1),V(""),W("")):n==="all"?(ce(0),de(!1),V(""),W("")):(ce(s.days),de(!1),V(""),W("")))},[n]),r.useEffect(()=>{if(g>0&&g<=7){const s=new Date,t=new Date;t.setDate(s.getDate()-g),V(t.toISOString().split("T")[0]),W(s.toISOString().split("T")[0])}else g===0&&(V(""),W(""))},[g]);const ge=async()=>{try{R(!0),await Promise.all([as(),os(),we(),ls()])}catch(s){console.error("Error loading disposal data:",s),S.error("Failed to load disposal data")}finally{R(!1)}},as=async()=>{const{data:s,error:t}=await w.from("disposal_records").select(`
        *,
        disposal_reason:disposal_reasons(*)
      `).order("created_at",{ascending:!1});if(t)throw console.error("Error loading disposal records:",t),t;if(s&&s.length>0){const a=new Set;if(s.forEach(m=>{m.disposed_by&&a.add(m.disposed_by),m.approved_by&&a.add(m.approved_by)}),a.size>0){const{data:m,error:d}=await w.from("profiles").select("id, full_name").in("id",Array.from(a));if(!d&&m){const o=new Map(m.map(u=>[u.id,u.full_name])),x=s.map(u=>({...u,disposed_by:u.disposed_by?o.get(u.disposed_by)||`User ${u.disposed_by.slice(0,8)}`:null,approved_by:u.approved_by?o.get(u.approved_by)||`User ${u.approved_by.slice(0,8)}`:null}));c(x);return}}}c(s||[])},os=async()=>{const{data:s,error:t}=await w.from("disposal_reasons").select("*").eq("is_active",!0).order("name");if(t)throw t;j(s||[])},ls=async()=>{try{console.log("ðŸ” [DisposalManagement] Loading disposal statistics...");const s=await Ze.getDisposalStats();B(s),console.log("ðŸ“Š [DisposalManagement] Disposal stats loaded:",s)}catch(s){console.error("âŒ [DisposalManagement] Error loading disposal stats:",s),B({totalDisposals:0,totalDisposedWeight:0,totalDisposalCost:0,pendingDisposals:0,recentDisposals:0,averageDisposalAge:0,topDisposalReason:"Age",monthlyDisposalTrend:0})}},we=async()=>{try{console.log("ðŸ” [DisposalManagement] Loading inventory for disposal with improved filtering..."),console.log("ðŸ“Š [DisposalManagement] Filter criteria:",{daysOld:g,includeStorageIssues:De,fromDate:P,toDate:se});let s,t=!1;n==="recent"?s=7:n==="aging"?s=30:n==="old"?s=60:n==="very_old"?s=100:n==="inactive_storage"?t=!0:n==="custom_age"&&ce(me);const a=await Ze.getInventoryForDisposal(g,De,s,t);console.log("ðŸ“Š [DisposalManagement] Raw data from service:",a?.length||0,"items");let m=a||[];(P||se)&&(console.log("ðŸ” [DisposalManagement] Applying additional date filtering:",{fromDate:P,toDate:se}),console.log("ðŸ“Š [DisposalManagement] Items before date filtering:",m.length),m=m.filter(d=>{if(!d.processing_date)return console.log("âŒ [DisposalManagement] Item has no processing date:",d.sorting_result_id),!1;const o=new Date(d.processing_date),x=P?new Date(P):null,u=se?new Date(se):null;if(isNaN(o.getTime()))return console.log("âŒ [DisposalManagement] Invalid processing date:",d.processing_date),!1;const ae=!x||o>=x,b=!u||o<=u;return console.log("ðŸ” [DisposalManagement] Date check:",{itemId:d.sorting_result_id,processingDate:d.processing_date,processingDateObj:o,from:x,to:u,passesFrom:ae,passesTo:b,passes:ae&&b}),ae&&b}),console.log("ðŸ“Š [DisposalManagement] Items after date filtering:",m.length)),m.sort((d,o)=>o.days_in_storage-d.days_in_storage),console.log("ðŸ“Š [DisposalManagement] Final filtered data:",m.length,"items"),K(m)}catch(s){console.error("âŒ [DisposalManagement] Error loading inventory for disposal:",s),K([])}},is=async()=>{if(!ne||f.length===0){S.error("Please select a reason and at least one item");return}if(T){S.error("Please wait, operation in progress...");return}$(!0);try{console.log("ðŸ” [DisposalManagement] Starting disposal creation..."),console.log("ðŸ“Š [DisposalManagement] Selected reason:",ne),console.log("ðŸ“Š [DisposalManagement] Selected items:",f.length),console.log("ðŸ“Š [DisposalManagement] User ID:",l?.id);const s=M.find(b=>b.id===ne);if(!s){console.error("âŒ [DisposalManagement] Disposal reason not found:",ne),S.error("Selected disposal reason is invalid. Please refresh and try again.");return}console.log("âœ… [DisposalManagement] Disposal reason verified:",s.name);const a=`DISPOSAL-${new Date().toISOString().replace(/[-:T]/g,"").substring(0,14)}`;console.log("ðŸ“Š [DisposalManagement] Generated disposal number:",a);const m={disposal_number:a,disposal_reason_id:ne,disposal_method:Me,disposal_location:$e||null,disposal_cost:ze||0,notes:Le||null,disposed_by:l?.id||null,status:"pending",total_weight_kg:0};console.log("ðŸ“Š [DisposalManagement] Disposal record data:",m);const{data:d,error:o}=await w.from("disposal_records").insert(m).select().single();if(o)throw console.error("âŒ [DisposalManagement] Error creating disposal record:",o),console.error("âŒ [DisposalManagement] Error details:",{code:o.code,message:o.message,details:o.details,hint:o.hint}),o;console.log("âœ… [DisposalManagement] Disposal record created:",d);const x=E.filter(b=>f.includes(b.sorting_result_id));console.log("ðŸ“Š [DisposalManagement] Selected inventory items:",x.length);let u=0;for(const b of x){const Ne=b.total_weight_grams/1e3;u+=Ne,console.log(`ðŸ“¦ [DisposalManagement] Adding item to disposal: ${b.batch_number} Size ${b.size_class} - ${Ne}kg (${b.total_weight_grams}g)`);const He={disposal_record_id:d.id,sorting_result_id:b.sorting_result_id,size_class:b.size_class,weight_kg:Ne,batch_number:b.batch_number,storage_location_name:b.storage_location_name,farmer_name:b.farmer_name,processing_date:b.processing_date,quality_notes:b.quality_notes,disposal_reason:b.disposal_reason};console.log("ðŸ“Š [DisposalManagement] Disposal item data:",He);const{error:oe}=await w.from("disposal_items").insert(He);if(oe)throw console.error("âŒ [DisposalManagement] Error creating disposal item:",oe),console.error("âŒ [DisposalManagement] Item error details:",{code:oe.code,message:oe.message,details:oe.details,hint:oe.hint}),oe}console.log(`Updating disposal record ${d.id} with total weight: ${u}kg`);const{error:ae}=await w.from("disposal_records").update({total_weight_kg:u}).eq("id",d.id);if(ae)throw console.error("Error updating disposal record:",ae),ae;S.success(`Disposal created successfully! ${f.length} items added (${u.toFixed(2)} kg)`),q(!1),gs(),ge()}catch(s){console.error("Error creating disposal:",s),S.error("Failed to create disposal record")}finally{$(!1)}},rs=async s=>{be(s),ie(!0);try{const{data:t,error:a}=await w.from("disposal_items").select("*").eq("disposal_record_id",s.id);a?(console.error("Error loading disposal items:",a),re([])):re(t||[])}catch(t){console.error("Error loading disposal items:",t),re([])}},ns=async s=>{ye(s),v(!0);try{const{data:t,error:a}=await w.from("disposal_items").select("*").eq("disposal_record_id",s.id);a?(console.error("Error loading disposal items:",a),re([])):re(t||[])}catch(t){console.error("Error loading disposal items:",t),re([])}},cs=async s=>{try{const{error:t}=await w.rpc("complete_disposal",{p_disposal_id:s});if(t)throw t;S.success("Disposal completed successfully"),ge()}catch(t){console.error("Error completing disposal:",t),S.error("Failed to complete disposal")}},ds=async()=>{if(I)try{$(!0);const{error:s}=await w.from("disposal_records").update({status:"completed",approved_by:l?.id||null}).eq("id",I.id);if(s)throw s;const{error:t}=await w.from("disposal_items").select("sorting_result_id").eq("disposal_record_id",I.id);if(t)throw t;if(G&&G.length>0){const a=G.map(d=>d.sorting_result_id);console.log(`Removing ${a.length} items from inventory:`,a);const{error:m}=await w.from("sorting_results").update({total_weight_grams:0,total_pieces:0}).in("id",a);if(m)throw console.error("Error removing items from inventory:",m),m;console.log(`Successfully removed ${a.length} items from inventory`)}S.success("Disposal completed and items removed from storage"),ie(!1),be(null),ge()}catch(s){console.error("Error approving disposal:",s),S.error("Failed to approve disposal")}finally{$(!1)}},ms=async()=>{if(I)try{$(!0),console.log(`Attempting to decline disposal: ${I.id}`);const{error:s}=await w.from("disposal_records").update({status:"cancelled",notes:(I.notes||"")+`

[Declined by user]`}).eq("id",I.id);if(s)throw console.error("Error updating disposal record:",s),s;console.log(`Declining disposal record ${I.id}`),S.success("Disposal declined and marked as cancelled"),ie(!1),be(null),ge()}catch(s){console.error("Error declining disposal:",s),S.error("Failed to decline disposal")}finally{$(!1)}},gs=()=>{Ae(""),Ee("waste"),Re(""),Oe(0),qe(""),_([]),V(""),W(""),Pe("all"),Be(20)},Ue=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},ps=()=>{const s=["Number","Date","Reason","Weight (kg)","Status","Created By","Approved/Denied By"],t=te.map(x=>[x.disposal_number,new Date(x.disposal_date).toLocaleDateString(),x.disposal_reason?.name||"N/A",x.total_weight_kg.toFixed(1),x.status,x.disposed_by||"N/A",x.approved_by||(x.status==="pending"?"Pending":"-")]),a=[s.join(","),...t.map(x=>x.map(u=>`"${u}"`).join(","))].join(`
`),m=new Blob([a],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),o=URL.createObjectURL(m);d.setAttribute("href",o),d.setAttribute("download",`disposal-records-${new Date().toISOString().split("T")[0]}.csv`),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)},hs=()=>{const s=window.open("","_blank");if(!s)return;const t=`
      <html>
        <head>
          <title>Disposal Records Report</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            h1 { color: #1f2937; margin-bottom: 20px; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            th { background-color: #f3f4f6; font-weight: bold; }
            .status-pending { background-color: #fef3c7; color: #92400e; }
            .status-approved { background-color: #dbeafe; color: #1e40af; }
            .status-completed { background-color: #d1fae5; color: #065f46; }
            .status-cancelled { background-color: #fee2e2; color: #991b1b; }
          </style>
        </head>
        <body>
          <h1>Rio Fish Farm - Disposal Records Report</h1>
          <p>Generated on: ${new Date().toLocaleDateString()}</p>
          <p>Total Records: ${te.length}</p>
          <table>
            <thead>
              <tr>
                <th>Number</th>
                <th>Date</th>
                <th>Reason</th>
                <th>Weight (kg)</th>
                <th>Status</th>
                <th>Created By</th>
                <th>Approved/Denied By</th>
              </tr>
            </thead>
            <tbody>
              ${te.map(a=>`
                <tr>
                  <td>${a.disposal_number}</td>
                  <td>${new Date(a.disposal_date).toLocaleDateString()}</td>
                  <td>${a.disposal_reason?.name||"N/A"}</td>
                  <td>${a.total_weight_kg.toFixed(1)}</td>
                  <td class="status-${a.status}">${a.status}</td>
                  <td>${a.disposed_by||"N/A"}</td>
                  <td>${a.approved_by||(a.status==="pending"?"Pending":"-")}</td>
                </tr>
              `).join("")}
            </tbody>
          </table>
        </body>
      </html>
    `;s.document.write(t),s.document.close(),s.print()},te=p.filter(s=>{const t=s.disposal_number.toLowerCase().includes(z.toLowerCase())||s.disposal_reason?.name.toLowerCase().includes(z.toLowerCase()),a=y==="all"||s.status===y;return t&&a}),xs=E.reduce((s,t)=>s+t.total_weight_grams/1e3,0);return Q?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-blue-600 font-medium",children:"Loading disposal management..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 content-container",children:[e.jsx($s,{stats:ee}),e.jsxs("div",{className:"container mx-auto responsive-padding max-w-full overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Disposal Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage fish disposal and waste handling"})]}),e.jsxs(Se,{open:L,onOpenChange:q,children:[e.jsx(_s,{asChild:!0,children:e.jsxs(F,{className:"bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(ks,{className:"w-4 h-4 mr-2"}),"Create Disposal"]})}),e.jsxs(Ce,{className:"max-w-4xl w-[95vw] max-h-[90vh] overflow-y-auto overflow-x-hidden",children:[e.jsxs(ke,{children:[e.jsx(Ie,{className:"text-xl font-semibold",children:"Create New Disposal Record"}),e.jsx(Fe,{children:"Configure disposal criteria and select items for disposal"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4 max-w-full overflow-x-hidden",children:[e.jsxs(C,{children:[e.jsx(U,{className:"pb-3",children:e.jsx(H,{className:"text-lg",children:"Filter Items for Disposal"})}),e.jsxs(k,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"ageCategory",className:"text-sm font-medium",children:"Disposal Reason *"}),e.jsxs(ue,{value:n,onValueChange:Pe,children:[e.jsx(fe,{className:"mt-1",children:e.jsx(je,{placeholder:"Select disposal reason"})}),e.jsx(_e,{children:Ve.map(s=>e.jsx(X,{value:s.value,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.label}),e.jsx("span",{className:"text-xs text-gray-500",children:s.description})]})},s.value))})]})]}),n==="custom_age"&&e.jsxs("div",{children:[e.jsx(D,{htmlFor:"customDaysOld",className:"text-sm font-medium",children:"Days Old Threshold"}),e.jsx(le,{id:"customDaysOld",type:"number",value:me,onChange:s=>Be(Number(s.target.value)),placeholder:"20",className:"mt-1",min:"1"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Show items older than this many days"})]}),n==="expired"&&e.jsxs("div",{children:[e.jsx(D,{htmlFor:"expiredDate",className:"text-sm font-medium",children:"Expiration Date"}),e.jsx(le,{id:"expiredDate",type:"date",value:P,onChange:s=>{const t=s.target.value,a=new Date().toISOString().split("T")[0];if(t>a){S.error("Cannot select future dates for expired items");return}V(t),W(a)},className:"mt-1",max:new Date().toISOString().split("T")[0]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Show items processed before this date"})]}),(n==="storage_issues"||n==="inactive_storage")&&e.jsxs("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Storage Issues Detected"})]}),e.jsx("p",{className:"text-xs text-yellow-700",children:n==="inactive_storage"?"Items in inactive storage locations will be shown":"Items with storage problems (inactive, over-capacity, missing location) will be shown"})]}),n==="all"&&e.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(he,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"All Available Items"})]}),e.jsx("p",{className:"text-xs text-blue-700",children:"All items in storage will be shown for selection"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsxs(D,{htmlFor:"fromDate",className:"text-sm font-medium break-words",children:["From Date ",g===0?"(Optional)":g<=7?`(Auto-set to ${g} days ago)`:`(Manual selection for ${g}+ days)`]}),e.jsx(le,{id:"fromDate",type:"date",value:P,onChange:s=>{const t=s.target.value,a=new Date().toISOString().split("T")[0];if(t>a){S.error("Cannot select future dates for disposal filtering");return}V(t),t&&W(a)},className:"mt-1",max:new Date().toISOString().split("T")[0],disabled:g>0&&g<=7}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 break-words",children:g===0?"Leave empty to show all items. Selecting a date will auto-set To Date to today.":g<=7?`Automatically set based on ${g} days threshold`:`Select start date for items ${g}+ days old. To Date will be auto-set to today.`})]}),e.jsxs("div",{children:[e.jsxs(D,{htmlFor:"toDate",className:"text-sm font-medium break-words",children:["To Date ",g===0?"(Optional)":g<=7?"(Auto-set to today)":"(Manual selection)"]}),e.jsx(le,{id:"toDate",type:"date",value:se,onChange:s=>{const t=s.target.value,a=new Date().toISOString().split("T")[0];if(t>a){S.error("Cannot select future dates for disposal filtering");return}if(P&&t<P){S.error("To Date cannot be before From Date");return}W(t)},className:"mt-1",max:new Date().toISOString().split("T")[0],min:P||void 0,disabled:g>0&&g<=7}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 break-words",children:g===0?"Automatically set to today when From Date is selected":g<=7?"Automatically set to today":"Automatically set to today when From Date is selected"})]})]})]})]}),e.jsxs(C,{children:[e.jsx(U,{className:"pb-3",children:e.jsx(H,{className:"text-lg",children:"Disposal Details"})}),e.jsxs(k,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"reason",className:"text-sm font-medium",children:"Disposal Reason *"}),e.jsxs(ue,{value:ne,onValueChange:Ae,children:[e.jsx(fe,{className:"mt-1",children:e.jsx(je,{placeholder:"Select reason"})}),e.jsx(_e,{children:M.map(s=>e.jsx(X,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"method",className:"text-sm font-medium",children:"Disposal Method *"}),e.jsxs(ue,{value:Me,onValueChange:Ee,children:[e.jsx(fe,{className:"mt-1",children:e.jsx(je,{placeholder:"Select method"})}),e.jsx(_e,{children:ts.map(s=>e.jsx(X,{value:s.value,children:s.label},s.value))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"location",className:"text-sm font-medium",children:"Disposal Location"}),e.jsx(le,{id:"location",value:$e,onChange:s=>Re(s.target.value),placeholder:"e.g., Waste Management Facility",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"cost",className:"text-sm font-medium",children:"Disposal Cost (KSh)"}),e.jsx(le,{id:"cost",type:"number",value:ze,onChange:s=>Oe(Number(s.target.value)),placeholder:"0",className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"notes",className:"text-sm font-medium",children:"Notes"}),e.jsx(js,{id:"notes",value:Le,onChange:s=>qe(s.target.value),placeholder:"Additional disposal notes...",rows:3,className:"mt-1"})]})]})]})]}),e.jsxs(C,{className:"overflow-x-hidden",children:[e.jsxs(U,{className:"pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(H,{className:"text-lg",children:"Select Items for Disposal"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>_(E.map(s=>s.sorting_result_id)),className:"text-green-600 hover:text-green-700",children:[e.jsx(Xe,{className:"w-4 h-4 mr-1"}),"Select All"]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>_([]),className:"text-gray-600 hover:text-gray-700",children:[e.jsx(fs,{className:"w-4 h-4 mr-1"}),"Clear All"]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:we,className:"text-blue-600 hover:text-blue-700",children:[e.jsx(Fs,{className:"w-4 h-4 mr-1"}),"Refresh"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{className:"text-sm text-gray-600 break-words",children:[e.jsxs("span",{className:"font-medium",children:["Selected: ",f.length," items"]}),e.jsx("span",{className:"mx-2",children:"â€¢"}),e.jsxs("span",{className:"font-medium",children:["Total Weight: ",E.filter(s=>f.includes(s.sorting_result_id)).reduce((s,t)=>s+t.total_weight_grams/1e3,0).toFixed(2)," kg"]})]}),e.jsx(Y,{variant:"outline",className:"text-xs break-words",children:n==="all"?"Showing all items":n==="storage_issues"?"Showing items with storage issues":n==="inactive_storage"?"Showing items in inactive storage":n==="expired"?"Showing items 100+ days old":n==="recent"?"Showing items 1-7 days old":n==="aging"?"Showing items 8-30 days old":n==="old"?"Showing items 31-60 days old":n==="very_old"?"Showing items 61-100 days old":n==="custom_age"?`Showing items ${me}+ days old`:`Showing items ${g}+ days old`})]}),f.length>0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-2 break-words",children:["Size Distribution: ",Object.entries(E.filter(s=>f.includes(s.sorting_result_id)).reduce((s,t)=>(s[t.size_class]=(s[t.size_class]||0)+t.total_weight_grams/1e3,s),{})).map(([s,t])=>`Size ${s}: ${t.toFixed(1)}kg`).join(" | ")]})]}),e.jsxs(k,{children:[e.jsx("div",{className:"border rounded-lg max-h-60 overflow-y-auto",children:Object.entries(E.reduce((s,t)=>{const a=t.storage_location_name;return s[a]||(s[a]=[]),s[a].push(t),s},{})).map(([s,t])=>{const a=We.has(s),m=t.reduce((o,x)=>o+x.total_weight_grams/1e3,0),d=t.filter(o=>f.includes(o.sorting_result_id)).length;return e.jsxs("div",{className:"border-b last:border-b-0",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 cursor-pointer",onClick:()=>{const o=new Set(We);a?o.delete(s):o.add(s),ss(o)},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ts,{className:"w-4 h-4 text-gray-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s}),t[0]?.storage_status==="inactive"&&e.jsx(Y,{variant:"destructive",className:"text-xs",children:"Inactive"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.length," batches â€¢ ",m.toFixed(1),"kg",d>0&&` â€¢ ${d} selected`]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{variant:t[0]?.disposal_reason==="Storage Inactive"?"destructive":"secondary",children:t[0]?.disposal_reason}),e.jsx(Is,{className:`w-4 h-4 transition-transform ${a?"rotate-180":""}`})]})]}),a&&e.jsx("div",{className:"p-3 bg-white",children:e.jsx("div",{className:"grid grid-cols-1 gap-2",children:t.map(o=>e.jsx("div",{className:`flex items-center justify-between p-2 rounded border ${f.includes(o.sorting_result_id)?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(vs,{checked:f.includes(o.sorting_result_id),onCheckedChange:x=>{_(x?[...f,o.sorting_result_id]:f.filter(u=>u!==o.sorting_result_id))}}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-blue-600",children:o.batch_number}),e.jsxs(Y,{variant:"outline",className:"text-xs",children:["Size ",o.size_class]}),e.jsxs(Y,{variant:o.days_in_storage>30?"destructive":"secondary",className:"text-xs",children:[o.days_in_storage," days"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[o.farmer_name," â€¢ ",(o.total_weight_grams/1e3).toFixed(1),"kg"]})]})]})},o.sorting_result_id))})})]},s)})}),E.length===0&&e.jsxs(Ke,{className:"mt-4",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx(Ge,{children:"No items found for disposal with current criteria."})]})]})]})]}),e.jsxs(Te,{children:[e.jsx(F,{variant:"outline",onClick:()=>q(!1),children:"Cancel"}),e.jsx(F,{onClick:is,className:"bg-red-600 hover:bg-red-700",disabled:T,children:T?"Processing...":"Create Disposal"})]})]})]}),e.jsx(Se,{open:xe,onOpenChange:ie,children:e.jsxs(Ce,{className:"max-w-2xl",children:[e.jsxs(ke,{children:[e.jsxs(Ie,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-orange-500"}),"Confirm Disposal"]}),e.jsx(Fe,{children:"Please review the disposal details and confirm or decline the action."})]}),I&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Disposal Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Disposal Number:"}),e.jsx("p",{className:"text-gray-600",children:I.disposal_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Method:"}),e.jsx("p",{className:"text-gray-600 capitalize",children:I.disposal_method})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Weight:"}),e.jsxs("p",{className:"text-gray-600",children:[I.total_weight_kg.toFixed(2)," kg"]})]})]}),I.notes&&e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:I.notes})]})]}),e.jsxs("div",{className:"bg-white border rounded-lg",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("h4",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"Items Being Disposed (",G.length," items)"]})}),e.jsx("div",{className:"max-h-60 overflow-y-auto",children:G.length>0?e.jsx("div",{className:"space-y-2",children:G.map((s,t)=>e.jsx("div",{className:"border rounded-lg p-3 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-medium text-blue-600 text-lg",children:s.batch_number}),e.jsxs(Y,{variant:"outline",className:"text-sm",children:["Size ",s.size_class||"Unknown"]})]}),e.jsxs("span",{className:"text-lg font-semibold text-gray-700",children:[s.weight_kg.toFixed(2)," kg"]})]})},t))}):e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx(he,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"Loading disposal items..."})]})})]}),e.jsxs(Ke,{children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsxs(Ge,{children:[e.jsx("strong",{children:"Warning:"})," Approving this disposal will permanently remove the ",G.length," items shown above from storage. This action cannot be undone."]})]})]}),e.jsxs(Te,{className:"gap-2",children:[e.jsx(F,{variant:"outline",onClick:ms,disabled:T,className:"text-red-600 hover:text-red-700",children:T?"Processing...":"Decline"}),e.jsx(F,{onClick:ds,disabled:T,className:"bg-green-600 hover:bg-green-700",children:T?"Processing...":"Approve & Remove from Storage"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(C,{children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Disposals"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p.length})]}),e.jsx(ve,{className:"h-8 w-8 text-gray-400"})]})})}),e.jsx(C,{children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:p.filter(s=>s.status==="pending").length})]}),e.jsx(es,{className:"h-8 w-8 text-yellow-400"})]})})}),e.jsx(C,{children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Available Items"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:E.length})]}),e.jsx(he,{className:"h-8 w-8 text-orange-400"})]})})}),e.jsx(C,{children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Weight"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[xs.toFixed(1),"kg"]})]}),e.jsx(Je,{className:"h-8 w-8 text-blue-400"})]})})})]}),e.jsx(C,{className:"mb-6",children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(le,{placeholder:"Search disposal records...",value:z,onChange:s=>i(s.target.value),className:"max-w-md"})}),e.jsxs(ue,{value:y,onValueChange:O,children:[e.jsx(fe,{className:"w-40",children:e.jsx(je,{placeholder:"Status"})}),e.jsxs(_e,{children:[e.jsx(X,{value:"all",children:"All"}),e.jsx(X,{value:"pending",children:"Pending"}),e.jsx(X,{value:"approved",children:"Approved"}),e.jsx(X,{value:"completed",children:"Completed"}),e.jsx(X,{value:"cancelled",children:"Cancelled"})]})]})]})})}),e.jsxs(C,{children:[e.jsx(U,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5"}),"Disposal Records"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(F,{onClick:ps,variant:"outline",size:"sm",disabled:te.length===0,className:"flex items-center gap-2",children:[e.jsx(As,{className:"h-4 w-4"}),"Export CSV"]}),e.jsxs(F,{onClick:hs,variant:"outline",size:"sm",disabled:te.length===0,className:"flex items-center gap-2",children:[e.jsx(Ms,{className:"h-4 w-4"}),"Export PDF"]})]})]})}),e.jsxs(k,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ys,{children:[e.jsx(bs,{children:e.jsxs(Qe,{children:[e.jsx(J,{children:"Number"}),e.jsx(J,{children:"Date"}),e.jsx(J,{children:"Reason"}),e.jsx(J,{children:"Weight"}),e.jsx(J,{children:"Status"}),e.jsx(J,{children:"Created By"}),e.jsx(J,{children:"Approved/Denied By"}),e.jsx(J,{children:"Actions"})]})}),e.jsx(Ds,{children:te.map(s=>e.jsxs(Qe,{className:"hover:bg-gray-50",children:[e.jsx(Z,{className:"font-medium",children:s.disposal_number}),e.jsx(Z,{children:new Date(s.disposal_date).toLocaleDateString()}),e.jsx(Z,{children:s.disposal_reason?.name}),e.jsxs(Z,{children:[s.total_weight_kg.toFixed(1),"kg"]}),e.jsx(Z,{children:e.jsx(Y,{className:Ue(s.status),children:s.status})}),e.jsx(Z,{children:s.disposed_by||"N/A"}),e.jsx(Z,{children:s.approved_by||(s.status==="pending"?"Pending":"-")}),e.jsx(Z,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(F,{variant:"ghost",size:"sm",onClick:()=>ns(s),title:"View Details",children:e.jsx(Ye,{className:"w-4 h-4"})}),s.status==="pending"&&e.jsx(F,{variant:"ghost",size:"sm",onClick:()=>rs(s),className:"text-blue-600 hover:text-blue-700",title:"Review & Approve Disposal",children:e.jsx(Xe,{className:"w-4 h-4"})}),s.status==="approved"&&e.jsx(F,{variant:"ghost",size:"sm",onClick:()=>cs(s.id),className:"text-green-600 hover:text-green-700",title:"Complete Disposal",children:e.jsx(Es,{className:"w-4 h-4"})})]})})]},s.id))})]})}),te.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ve,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:"No disposal records found"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Create your first disposal record to get started"})]})]})]}),e.jsx(Se,{open:h,onOpenChange:v,children:e.jsxs(Ce,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ke,{children:[e.jsxs(Ie,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5"}),"Disposal Details"]}),e.jsx(Fe,{children:"View detailed information about this disposal record"})]}),N&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{children:[e.jsx(U,{children:e.jsx(H,{className:"text-lg",children:"Basic Information"})}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-gray-600",children:"Disposal Number"}),e.jsx("p",{className:"text-lg font-semibold",children:N.disposal_number})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-gray-600",children:"Status"}),e.jsx("div",{className:"mt-1",children:e.jsx(Y,{className:Ue(N.status),children:N.status})})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-gray-600",children:"Date"}),e.jsx("p",{className:"text-gray-900",children:new Date(N.disposal_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-gray-600",children:"Method"}),e.jsx("p",{className:"text-gray-900 capitalize",children:N.disposal_method})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-gray-600",children:"Location"}),e.jsx("p",{className:"text-gray-900",children:N.disposal_location||"Not specified"})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-gray-600",children:"Cost"}),e.jsxs("p",{className:"text-gray-900",children:["KSh ",N.disposal_cost.toFixed(2)]})]})]})})]}),e.jsxs(C,{children:[e.jsx(U,{children:e.jsx(H,{className:"text-lg",children:"Disposal Reason"})}),e.jsx(k,{children:e.jsx("p",{className:"text-gray-900",children:N.disposal_reason?.name||"Not specified"})})]}),e.jsxs(C,{children:[e.jsx(U,{children:e.jsx(H,{className:"text-lg",children:"Summary"})}),e.jsx(k,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Je,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Weight"}),e.jsxs("p",{className:"text-xl font-semibold",children:[N.total_weight_kg.toFixed(2)," kg"]})]})]})})})]}),N.notes&&e.jsxs(C,{children:[e.jsx(U,{children:e.jsx(H,{className:"text-lg",children:"Notes"})}),e.jsx(k,{children:e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:N.notes})})]}),e.jsxs(C,{children:[e.jsx(U,{children:e.jsx(H,{className:"text-lg",children:"Disposal Items"})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-gray-600",children:"Total Weight"}),e.jsxs("p",{className:"text-lg font-semibold",children:[N.total_weight_kg.toFixed(2)," kg"]})]})}),e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-gray-600",children:"Disposal Location"}),e.jsx("p",{className:"text-gray-900 font-medium",children:N.disposal_location||"Not specified"})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-gray-600",children:"Disposal Method"}),e.jsx("p",{className:"text-gray-900 font-medium capitalize",children:N.disposal_method.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-gray-600",children:"Disposal Cost"}),e.jsxs("p",{className:"text-gray-900 font-medium",children:["KSh ",N.disposal_cost.toFixed(2)]})]})]})})]}),G.length>0&&e.jsxs(C,{children:[e.jsx(U,{children:e.jsx(H,{className:"text-lg",children:"Detailed Items Breakdown"})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-3",children:G.map((s,t)=>e.jsx("div",{className:"border rounded-lg p-3 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-medium text-blue-600 text-lg",children:s.batch_number}),e.jsxs(Y,{variant:"outline",className:"text-sm",children:["Size ",s.size_class||"Unknown"]})]}),e.jsxs("span",{className:"text-lg font-semibold text-gray-700",children:[s.weight_kg.toFixed(2)," kg"]})]})},t))})})]})]}),e.jsx(Te,{children:e.jsx(F,{variant:"outline",onClick:()=>v(!1),children:"Close"})})]})})]})]})}export{ot as default};
