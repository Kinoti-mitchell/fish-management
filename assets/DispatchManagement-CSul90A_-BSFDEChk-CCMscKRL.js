import{w as h,c as e,C as ve,X as E,B as be,P as fe,O as je,a as ye,l as Q,n as b,d as Ne,b as We,S as K,T as u,J as f}from"./index-D0a7Ul_G.js";import{_ as Be,j as Re,C as Qe,N as Xe,P as Me}from"./select-DqWpyIkf-D_8tzK0d-BBn-WGEA.js";import{i as we}from"./clock-sArWPAJm-BmsKQooK-qn3wSWAF.js";import{e as X}from"./building-2-DwnJS45a-o2Atf5vx-dKfe0ydE.js";import{o as _e}from"./map-pin-C-M6umvy-CUBiYWs8-BzOTRlrX.js";import{p as ke}from"./circle-check-big-BZ9nasO6-BWVBSi9U-D_bzRs9E.js";import"./index-B7iGXlpc-YR4igk-O-CmE8Ucvu.js";import"./index-io8wS31O-C_L8DqSR-BTUohV_t.js";import"./index-CEgc-Zw--jggqibQ8-DNEgScq_.js";var He=Object.defineProperty,Ye=Object.defineProperties,Ze=Object.getOwnPropertyDescriptors,De=Object.getOwnPropertySymbols,Ge=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable,Se=(p,a,n)=>a in p?He(p,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):p[a]=n,I=(p,a)=>{for(var n in a||(a={}))Ge.call(a,n)&&Se(p,n,a[n]);if(De)for(var n of De(a))Je.call(a,n)&&Se(p,n,a[n]);return p},z=(p,a)=>Ye(p,Ze(a)),k=(p,a,n)=>new Promise((F,q)=>{var L=j=>{try{D(n.next(j))}catch(S){q(S)}},$=j=>{try{D(n.throw(j))}catch(S){q(S)}},D=j=>j.done?F(j.value):Promise.resolve(j.value).then(L,$);D((n=n.apply(p,a)).next())});function ot({onNavigate:p}){var a,n,F,q,L,$,D,j,S;const[w,Pe]=h.useState([]),[P,V]=h.useState([]),[Oe,Ie]=h.useState([]),[U,M]=h.useState(!0),[H,Y]=h.useState([]),[ze,Z]=h.useState(!1),[v,T]=h.useState([]),[y,C]=h.useState(null),[qe,W]=h.useState(!1),[G,Te]=h.useState([]),[x,O]=h.useState({driverId:"",notes:"",pickingDate:"",pickingTime:""}),[Ce,J]=h.useState(!1),[o,ee]=h.useState(null),B=()=>k(this,null,function*(){try{const{data:t,error:s}=yield f.from("outlet_orders").select(`
          *,
          outlet:outlets(
            id,
            name,
            location,
            phone,
            manager_name,
            status
          )
        `).eq("status","confirmed").order("order_date",{ascending:!1});if(s)throw s;Pe(t||[])}catch(t){console.error("Error fetching confirmed orders:",t),u.error("Failed to fetch confirmed orders",{description:"Please refresh the page or try again later",duration:5e3})}}),R=()=>k(this,null,function*(){try{const{data:t,error:s}=yield f.from("outlet_orders").select(`
          *,
          outlet:outlets(
            id,
            name,
            location,
            phone,
            manager_name,
            status
          )
        `).eq("status","dispatched").order("dispatch_date",{ascending:!1});if(s)throw s;if(t&&t.length>0){const r=t.map(c=>c.id),{data:i,error:l}=yield f.from("dispatch_records").select("*").in("outlet_order_id",r);if(!l&&i){const c=t.map(g=>{const _=i.find(N=>N.outlet_order_id===g.id);return z(I({},g),{dispatch_record:_||null})});V(c)}else console.warn("Could not fetch dispatch records:",l),V(t)}else V([])}catch(t){console.error("Error fetching dispatched orders:",t),u.error("Failed to fetch dispatched orders",{description:"Please refresh the page or try again later",duration:5e3})}}),Ae=()=>k(this,null,function*(){try{const{data:t,error:s}=yield f.from("outlets").select("*").order("name");if(s)throw s;Ie(t||[])}catch(t){console.error("Error fetching outlets:",t),u.error("Failed to fetch outlets",{description:"Please refresh the page or try again later",duration:5e3})}}),Ee=()=>k(this,null,function*(){try{const{data:t,error:s}=yield f.from("profiles").select("id, first_name, last_name").eq("role","driver").order("first_name");if(s)throw s;const r=(t||[]).map(i=>({id:i.id,name:`${i.first_name} ${i.last_name}`}));Te(r)}catch(t){console.error("Error fetching drivers:",t),u.error("Failed to fetch drivers",{description:"Please refresh the page or try again later",duration:5e3})}}),te=()=>k(this,null,function*(){try{const{data:t,error:s}=yield f.from("processing_records").select(`
          id,
          post_processing_weight,
          ready_for_dispatch_count,
          processing_date,
          final_value
        `).gt("ready_for_dispatch_count",0).order("processing_date",{ascending:!1});if(s)throw s;Y(t||[])}catch(t){console.error("Error fetching inventory:",t),u.error("Failed to fetch inventory",{description:"Please refresh the page or try again later",duration:5e3}),Y([])}}),Fe=t=>{C(t),O({driverId:"",notes:"",pickingDate:"",pickingTime:""}),W(!0)},Le=()=>k(this,null,function*(){if(!y||!x.driverId){u.error("Please select a driver");return}if(!x.pickingDate||!x.pickingTime){u.error("Please select picking date and time");return}try{const t=G.find(m=>m.id===x.driverId),s=(t==null?void 0:t.name)||"Unknown Driver",r=w.find(m=>m.id===y),i=Oe.find(m=>m.id===(r==null?void 0:r.outlet_id)),l=(r==null?void 0:r.requested_quantity)||0,c=(r==null?void 0:r.requested_quantity)||0,g=(r==null?void 0:r.size_quantities)||{},{data:_,error:N}=yield f.from("dispatch_records").insert({outlet_order_id:y,fish_ids:[],destination:(i==null?void 0:i.name)||"Unknown",dispatch_date:new Date().toISOString().split("T")[0],total_weight:l,total_pieces:c,size_breakdown:g,total_value:(r==null?void 0:r.total_value)||0,status:"scheduled",notes:x.notes,picking_date:x.pickingDate,picking_time:x.pickingTime,assigned_driver:s,assigned_date:new Date().toISOString().split("T")[0]}).select().single();if(N)throw N;const{error:d}=yield f.from("outlet_orders").update({status:"dispatched",dispatch_date:new Date().toISOString().split("T")[0],notes:x.notes}).eq("id",y);if(d)throw d;W(!1),C(null),yield Promise.all([B(),R()]),u.success("Dispatch approved successfully!",{description:`Driver ${s} assigned to order for picking on ${x.pickingDate} at ${x.pickingTime}`,duration:5e3})}catch(t){console.error("Error approving dispatch:",t),u.error("Failed to approve dispatch",{description:"Please try again or contact support if the issue persists",duration:5e3})}}),$e=t=>{ee(t),J(!0)},Ue=()=>{J(!1),ee(null)},Ke=()=>{window.print()},Ve=()=>k(this,null,function*(){if(!y||v.length===0){u.error("Please select items from inventory");return}try{const t=v.map(d=>d.inventoryItem.id),{error:s}=yield f.from("processing_records").update({ready_for_dispatch_count:0}).in("id",t);if(s)throw s;const r=v.reduce((d,m)=>d+m.weight,0),i=v.reduce((d,m)=>d+m.quantity,0),l=v.reduce((d,m)=>{const A=m.inventoryItem.final_size||0;return d[A]=(d[A]||0)+m.quantity,d},{}),c=w.find(d=>d.id===y),{data:g,error:_}=yield f.from("dispatch_records").update({fish_ids:t,total_weight:r,total_pieces:i,size_breakdown:l,status:"dispatched",notes:`Inventory picked for order ${(c==null?void 0:c.order_number)||y}`}).eq("outlet_order_id",y).select().single();if(_)throw _;const{error:N}=yield f.from("outlet_orders").update({status:"dispatched",dispatch_date:new Date().toISOString().split("T")[0]}).eq("id",y);if(N)throw N;yield Promise.all([B(),R(),te()]),Z(!1),C(null),T([]),u.success("Order dispatched successfully!",{description:`Order ${(c==null?void 0:c.order_number)||y} has been dispatched with ${i} pieces`,duration:5e3})}catch(t){console.error("Error dispatching order:",t),u.error("Failed to dispatch order",{description:"Please try again or contact support if the issue persists",duration:5e3})}});return h.useEffect(()=>{k(this,null,function*(){M(!0),yield Promise.all([B(),R(),Ae(),te(),Ee()]),M(!1)})},[]),e.jsxs(e.Fragment,{children:[e.jsx("style",{jsx:"true",global:"true",children:`
        @media print {
          body * {
            visibility: hidden;
          }
          .printable-invoice, .printable-invoice * {
            visibility: visible;
          }
          .printable-invoice {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            background: white !important;
            color: black !important;
            box-shadow: none !important;
            border: none !important;
            margin: 0 !important;
            padding: 20px !important;
            max-height: none !important;
            overflow: visible !important;
          }
          .printable-invoice .bg-gradient-to-r {
            background: #2563eb !important;
            color: white !important;
          }
          .printable-invoice .bg-green-600 {
            background: #16a34a !important;
            color: white !important;
          }
          .printable-invoice .bg-gray-50 {
            background: #f9fafb !important;
          }
          .printable-invoice .bg-yellow-50 {
            background: #fefce8 !important;
          }
          .printable-invoice .text-white {
            color: white !important;
          }
          .printable-invoice .text-blue-100 {
            color: #dbeafe !important;
          }
          .printable-invoice .text-green-100 {
            color: #dcfce7 !important;
          }
          .printable-invoice .border {
            border: 1px solid #d1d5db !important;
          }
          .printable-invoice .rounded-lg,
          .printable-invoice .rounded-xl,
          .printable-invoice .rounded-2xl {
            border-radius: 4px !important;
          }
          .printable-invoice .shadow-2xl,
          .printable-invoice .shadow-lg {
            box-shadow: none !important;
          }
          .printable-invoice .p-8 {
            padding: 16px !important;
          }
          .printable-invoice .p-6 {
            padding: 12px !important;
          }
          .printable-invoice .p-4 {
            padding: 8px !important;
          }
          .printable-invoice .p-3 {
            padding: 6px !important;
          }
          .printable-invoice .text-3xl {
            font-size: 24px !important;
          }
          .printable-invoice .text-2xl {
            font-size: 20px !important;
          }
          .printable-invoice .text-lg {
            font-size: 16px !important;
          }
          .printable-invoice .mb-6 {
            margin-bottom: 12px !important;
          }
          .printable-invoice .mb-4 {
            margin-bottom: 8px !important;
          }
          .printable-invoice .mb-2 {
            margin-bottom: 4px !important;
          }
          .printable-invoice .mb-1 {
            margin-bottom: 2px !important;
          }
          .printable-invoice .mt-4 {
            margin-top: 8px !important;
          }
          .printable-invoice .gap-6 {
            gap: 12px !important;
          }
          .printable-invoice .max-h-[60vh] {
            max-height: none !important;
          }
          .printable-invoice .overflow-hidden {
            overflow: visible !important;
          }
          .printable-invoice .overflow-y-auto {
            overflow: visible !important;
          }
          .printable-invoice .flex {
            display: block !important;
          }
          .printable-invoice .grid {
            display: block !important;
          }
          .printable-invoice .grid > * {
            margin-bottom: 8px !important;
          }
          .printable-invoice .hidden {
            display: none !important;
          }
          .printable-invoice table {
            width: 100% !important;
            border-collapse: collapse !important;
          }
          .printable-invoice th,
          .printable-invoice td {
            padding: 8px !important;
            text-align: left !important;
            border-bottom: 1px solid #d1d5db !important;
          }
        }
      `}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 content-container responsive-padding",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl p-6 text-white shadow-lg",children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(ve,{size:"lg",showText:!1})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(E,{className:"h-8 w-8"}),"Dispatch Management"]}),e.jsx("p",{className:"text-white/80 mt-2",children:"Assign drivers to confirmed orders and manage dispatch operations"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-white/70",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold",children:w.length+P.length})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-white/70",children:"Awaiting Dispatch"}),e.jsx("p",{className:"text-2xl font-bold text-orange-200",children:w.length})]})]})]})}),!U&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Awaiting Dispatch"}),e.jsx("p",{className:"text-3xl font-bold text-orange-800",children:w.length})]}),e.jsx("div",{className:"p-3 bg-orange-100 rounded-full",children:e.jsx(we,{className:"h-6 w-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Dispatched"}),e.jsx("p",{className:"text-3xl font-bold text-green-800",children:P.length})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx(E,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Orders"}),e.jsx("p",{className:"text-3xl font-bold text-blue-800",children:w.length+P.length})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx(X,{className:"h-6 w-6 text-blue-600"})})]})})]}),U&&e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-3 text-muted-foreground",children:"Loading dispatch data..."})]}),!U&&e.jsxs(be,{className:"shadow-lg border-0",children:[e.jsx(fe,{className:"bg-gradient-to-r from-orange-50 to-amber-50 border-b",children:e.jsxs(je,{className:"flex items-center gap-2 text-orange-800",children:[e.jsx(we,{className:"h-5 w-5"}),"Orders Awaiting Driver Assignment (",w.length,")"]})}),e.jsx(ye,{className:"p-6",children:w.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("div",{className:"bg-orange-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4",children:e.jsx(E,{className:"h-10 w-10 text-orange-600"})}),e.jsx("p",{className:"text-lg font-medium",children:"No orders awaiting dispatch"}),e.jsx("p",{className:"text-sm",children:"Confirmed orders will appear here for driver assignment"})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:w.map(t=>{var s,r,i,l;return e.jsxs("div",{className:"bg-white border border-orange-200 rounded-xl p-5 hover:shadow-xl transition-all duration-300 hover:border-orange-400 hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Q,{className:"bg-orange-100 text-orange-800 text-xs font-medium px-2 py-1",children:"AWAITING DRIVER"})}),e.jsx(b,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-blue-50",children:e.jsx(Ne,{className:"h-4 w-4 text-gray-600"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(X,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-900 text-sm",children:((s=t.outlet)==null?void 0:s.name)||"Unknown Outlet"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(_e,{className:"h-3 w-3"}),e.jsx("span",{children:((r=t.outlet)==null?void 0:r.location)||"Unknown Location"})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Order ID:"}),e.jsx("span",{className:"font-medium text-gray-900",children:t.order_number||t.id})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Quantity:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[t.requested_quantity,"kg"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Sizes:"}),e.jsx("span",{className:"font-medium text-gray-900",children:((i=t.requested_sizes)==null?void 0:i.join(", "))||"Any"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(t.order_date).toLocaleDateString()})]})]}),e.jsx("div",{className:"border-t border-gray-100 pt-3 mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Value"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["KES ",((l=t.total_value)==null?void 0:l.toLocaleString())||"0"]})]})}),e.jsx("div",{className:"space-y-2",children:e.jsxs(b,{size:"sm",onClick:()=>Fe(t.id),className:"w-full bg-green-600 hover:bg-green-700 text-white text-xs",children:[e.jsx(ke,{className:"h-3 w-3 mr-1"}),"Approve Dispatch"]})})]},t.id)})})})]}),!U&&e.jsxs(be,{className:"shadow-lg border-0",children:[e.jsx(fe,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-b",children:e.jsxs(je,{className:"flex items-center gap-2 text-green-800",children:[e.jsx(E,{className:"h-5 w-5"}),"Dispatched Orders (",P.length,")"]})}),e.jsx(ye,{className:"p-6",children:P.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("div",{className:"bg-green-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4",children:e.jsx(E,{className:"h-10 w-10 text-green-600"})}),e.jsx("p",{className:"text-lg font-medium",children:"No dispatched orders"}),e.jsx("p",{className:"text-sm",children:"Orders that have been dispatched will appear here"})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:P.map(t=>{var s,r,i,l,c,g,_,N,d,m,A,se,ie,re,ae,ne,le,de,oe,ce,me,xe,he,pe,ge,ue;return e.jsxs("div",{className:"bg-white border border-green-200 rounded-xl p-5 hover:shadow-xl transition-all duration-300 hover:border-green-400 hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Q,{className:"bg-green-100 text-green-800 text-xs font-medium px-2 py-1",children:"DISPATCHED"})}),e.jsx(b,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-blue-50",onClick:()=>$e(t),title:"View Invoice Details",children:e.jsx(Ne,{className:"h-4 w-4 text-gray-600"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(X,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-900 text-sm",children:((s=t.outlet)==null?void 0:s.name)||"Unknown Outlet"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(_e,{className:"h-3 w-3"}),e.jsx("span",{children:((r=t.outlet)==null?void 0:r.location)||"Unknown Location"})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Order ID:"}),e.jsx("span",{className:"font-medium text-gray-900",children:t.order_number||t.id})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Quantity:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[t.requested_quantity,"kg"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Sizes:"}),e.jsx("span",{className:"font-medium text-gray-900",children:((i=t.requested_sizes)==null?void 0:i.join(", "))||"Any"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Dispatched:"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(t.dispatch_date||t.order_date).toLocaleDateString()})]}),(((l=t.dispatch_record)==null?void 0:l.picking_date)||((g=(c=t.dispatch_record)==null?void 0:c.notes)==null?void 0:g.includes("Picking:")))&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Picking Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:(_=t.dispatch_record)!=null&&_.picking_date?new Date(t.dispatch_record.picking_date).toLocaleDateString():((m=(d=(N=t.dispatch_record)==null?void 0:N.notes)==null?void 0:d.match(/Picking: ([^ ]+)/))==null?void 0:m[1])||"Not specified"})]}),(((A=t.dispatch_record)==null?void 0:A.picking_time)||((ie=(se=t.dispatch_record)==null?void 0:se.notes)==null?void 0:ie.includes("at ")))&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Picking Time:"}),e.jsx("span",{className:"font-medium text-gray-900",children:((re=t.dispatch_record)==null?void 0:re.picking_time)||((le=(ne=(ae=t.dispatch_record)==null?void 0:ae.notes)==null?void 0:ne.match(/at ([^.]+)/))==null?void 0:le[1])||"Not specified"})]}),(((de=t.dispatch_record)==null?void 0:de.assigned_driver)||((ce=(oe=t.dispatch_record)==null?void 0:oe.notes)==null?void 0:ce.includes("Driver:")))&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Driver:"}),e.jsx("span",{className:"font-medium text-gray-900",children:((me=t.dispatch_record)==null?void 0:me.assigned_driver)||((pe=(he=(xe=t.dispatch_record)==null?void 0:xe.notes)==null?void 0:he.match(/Driver: ([^,]+)/))==null?void 0:pe[1])||"Not assigned"})]}),((ge=t.dispatch_record)==null?void 0:ge.total_weight)&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Weight:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[t.dispatch_record.total_weight," kg"]})]})]}),e.jsx("div",{className:"border-t border-gray-100 pt-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Value"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["KES ",((ue=t.total_value)==null?void 0:ue.toLocaleString())||"0"]})]})})]},t.id)})})})]}),ze&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Pick Inventory for Order"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Select items from inventory to fulfill this order"})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:H.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(We,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No inventory available"}),e.jsx("p",{className:"text-sm",children:"No items are ready for dispatch"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:H.map(t=>{const s=v.some(i=>i.inventoryItem.id===t.id),r=v.find(i=>i.inventoryItem.id===t.id);return e.jsxs("div",{className:`border rounded-lg p-4 ${s?"border-orange-500 bg-orange-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium text-gray-900",children:["Size ",t.final_size]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Available: ",t.ready_for_dispatch_count," pieces"]})]}),e.jsx(Q,{className:s?"bg-orange-500":"bg-gray-500",children:s?"Picked":"Available"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("p",{children:["Weight: ",t.total_weight,"kg"]}),e.jsxs("p",{children:["Storage: ",t.storage_location||"Unknown"]}),e.jsxs("p",{children:["Farmer: ",t.farmer_name||"Unknown"]})]}),s?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"1",max:t.ready_for_dispatch_count,value:(r==null?void 0:r.quantity)||1,onChange:i=>{const l=parseInt(i.target.value)||1;T(c=>c.map(g=>g.inventoryItem.id===t.id?z(I({},g),{quantity:l,weight:l*(t.total_weight/t.ready_for_dispatch_count)}):g))},className:"w-20 px-2 py-1 border rounded text-sm"}),e.jsx(b,{size:"sm",variant:"outline",onClick:()=>{T(i=>i.filter(l=>l.inventoryItem.id!==t.id))},className:"text-red-600 hover:text-red-700",children:"Remove"})]}):e.jsx(b,{size:"sm",onClick:()=>{T(i=>[...i,{inventoryItem:t,quantity:1,weight:t.total_weight/t.ready_for_dispatch_count}])},className:"w-full bg-orange-600 hover:bg-orange-700 text-white",children:"Add to Pick List"})]})]},t.id)})})}),e.jsxs("div",{className:"p-6 border-t bg-gray-50 flex justify-between items-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:v.length>0&&e.jsxs("p",{children:["Selected: ",v.reduce((t,s)=>t+s.quantity,0)," pieces,",v.reduce((t,s)=>t+s.weight,0).toFixed(2),"kg"]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(b,{variant:"outline",onClick:()=>{Z(!1),C(null),T([])},children:"Cancel"}),e.jsx(b,{onClick:Ve,disabled:v.length===0,className:"bg-orange-600 hover:bg-orange-700 text-white",children:"Dispatch Order"})]})]})]})}),qe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Approve Dispatch"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Assign a driver and approve this dispatch"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium text-gray-700",children:"Select Driver"}),e.jsxs(Be,{onValueChange:t=>O(s=>z(I({},s),{driverId:t})),children:[e.jsx(Re,{className:"mt-1",children:e.jsx(Qe,{placeholder:"Choose a driver"})}),e.jsx(Xe,{children:G.map(t=>e.jsx(Me,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium text-gray-700",children:"Picking Date *"}),e.jsx("input",{type:"date",value:x.pickingDate,onChange:t=>O(s=>z(I({},s),{pickingDate:t.target.value})),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium text-gray-700",children:"Picking Time *"}),e.jsx("input",{type:"time",value:x.pickingTime,onChange:t=>O(s=>z(I({},s),{pickingTime:t.target.value})),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium text-gray-700",children:"Notes (Optional)"}),e.jsx("textarea",{value:x.notes,onChange:t=>O(s=>z(I({},s),{notes:t.target.value})),placeholder:"Add any notes for this dispatch...",className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]})]}),e.jsxs("div",{className:"p-6 border-t bg-gray-50 flex justify-end gap-3",children:[e.jsx(b,{variant:"outline",onClick:()=>{W(!1),C(null),O({driverId:"",notes:"",pickingDate:"",pickingTime:""})},children:"Cancel"}),e.jsxs(b,{onClick:Le,disabled:!x.driverId,className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Approve Dispatch"]})]})]})}),Ce&&o&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"printable-invoice bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl",children:e.jsx(ve,{size:"lg",showText:!1})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Dispatch Invoice"}),e.jsxs("p",{className:"text-blue-100 text-lg mt-1",children:["Order #",o.order_number||o.id.slice(0,8)]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:Ke,className:"bg-white/10 border-white/30 text-white hover:bg-white/20 px-4 py-2 rounded-xl font-semibold",children:"Print"}),e.jsx(b,{variant:"outline",size:"sm",onClick:Ue,className:"bg-white/10 border-white/30 text-white hover:bg-white/20 px-4 py-2 rounded-xl font-semibold",children:"Close"})]})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-2",children:"From:"}),e.jsx("p",{className:"text-gray-700",children:"Rio Fish Management"}),e.jsx("p",{className:"text-gray-700",children:"Nairobi, Kenya"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-2",children:"To:"}),e.jsx("p",{className:"text-gray-700 font-medium",children:((a=o.outlet)==null?void 0:a.name)||"Unknown Outlet"}),e.jsx("p",{className:"text-gray-700",children:((n=o.outlet)==null?void 0:n.location)||"Unknown Location"})]})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("th",{className:"text-left py-2 font-semibold text-gray-700",children:"Item"}),e.jsx("th",{className:"text-left py-2 font-semibold text-gray-700",children:"Details"})]})}),e.jsxs("tbody",{className:"text-sm",children:[e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Order #"}),e.jsx("td",{className:"py-2 font-medium",children:o.order_number||o.id.slice(0,8)})]}),e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Date"}),e.jsx("td",{className:"py-2 font-medium",children:new Date(o.order_date).toLocaleDateString()})]}),e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Quantity"}),e.jsxs("td",{className:"py-2 font-medium",children:[o.requested_quantity," kg"]})]}),e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Sizes"}),e.jsx("td",{className:"py-2 font-medium",children:((F=o.requested_sizes)==null?void 0:F.join(", "))||"Any Size"})]}),e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Driver"}),e.jsx("td",{className:"py-2 font-medium",children:((q=o.dispatch_record)==null?void 0:q.assigned_driver)||((D=($=(L=o.dispatch_record)==null?void 0:L.notes)==null?void 0:$.match(/Driver: ([^,]+)/))==null?void 0:D[1])||"Not assigned"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 text-gray-600",children:"Price/kg"}),e.jsxs("td",{className:"py-2 font-medium",children:["KES ",((j=o.price_per_kg)==null?void 0:j.toLocaleString())||"0"]})]})]})]})}),e.jsxs("div",{className:"bg-green-600 rounded-lg p-4 text-white text-center",children:[e.jsx("p",{className:"text-green-100 text-sm mb-1",children:"Total Amount"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KES ",((S=o.total_value)==null?void 0:S.toLocaleString())||"0"]})]}),o.notes&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Notes:"})," ",o.notes]})})]})]})})]})})]})}export{ot as default};
