import{H as ce,w as u,c as e,n as p,g as oe,_ as me,D as I,l as y,B as J,a as K,b as xe,S as C}from"./index-D0a7Ul_G.js";import{x as R,v as he,h as ge,y as Q,j as f,N as pe,w as b}from"./table-CAL6gWyU-CwnFeCJe-DbQ5m2wV.js";import{W as U}from"./inventoryService-gXyYRUkQ-CaNYK-Tu-DXS6GM-l.js";import{V as ue,_ as je,H as fe,C as be}from"./dialog-NtgNh5u1-2hJTriox-IAMkB2HC.js";import{v as Ne}from"./textarea-TOFJikG_-C72QqR98-D5hWOVfE.js";import{r as L}from"./circle-alert-DCgzIeFQ-JtILe7g3-BxoVeYrg.js";import{t as V}from"./scale-Coap2kcd-Bsk2bCpZ-BAcJJTw5.js";import{r as G}from"./loader-circle-CqHSO3Z4-BnZJOCMy-z05WTHxy.js";import{p as w}from"./circle-check-big-BZ9nasO6-BWVBSi9U-D_bzRs9E.js";import{h as H}from"./file-text-35uk4vLR-D2sbaJVA-BaZwXqWF.js";import{o as ve}from"./search-BLXOOEcj-BfErFHpQ-DLGkxSNR.js";import{h as ye}from"./refresh-cw-BlPh9kri-DxVFEABi-aZB1kqTg.js";import{y as we}from"./download-cYb9BEHt-BKKeRdQe-9aZ5Dx7S.js";import{i as M}from"./clock-sArWPAJm-BmsKQooK-qn3wSWAF.js";var _e=Object.defineProperty,Se=Object.defineProperties,$e=Object.getOwnPropertyDescriptors,X=Object.getOwnPropertySymbols,De=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable,Z=(o,d,a)=>d in o?_e(o,d,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[d]=a,ke=(o,d)=>{for(var a in d||(d={}))De.call(d,a)&&Z(o,a,d[a]);if(X)for(var a of X(d))Ce.call(d,a)&&Z(o,a,d[a]);return o},ze=(o,d)=>Se(o,$e(d)),A=(o,d,a)=>new Promise((v,k)=>{var z=x=>{try{_(a.next(x))}catch(m){k(m)}},T=x=>{try{_(a.throw(x))}catch(m){k(m)}},_=x=>x.done?v(x.value):Promise.resolve(x.value).then(z,T);_((a=a.apply(o,d)).next())});function Te({isOpen:o,onClose:d,transferRequest:a,onApprove:v,onDecline:k,currentUserId:z}){const[T,_]=u.useState(""),[x,m]=u.useState(!1),[O,S]=u.useState(null),E=()=>A(this,null,function*(){m(!0),S(null);try{yield v(a.id,z),d()}catch(N){S(N.message||"Failed to approve transfer")}finally{m(!1)}}),g=()=>A(this,null,function*(){m(!0),S(null);try{yield k(a.id,z),d()}catch(N){S(N.message||"Failed to decline transfer")}finally{m(!1)}});return e.jsx(ue,{open:o,onOpenChange:d,children:e.jsxs(je,{className:"max-w-2xl",children:[e.jsx(fe,{children:e.jsxs(be,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-amber-600"}),"Transfer Approval Required"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{children:e.jsxs(K,{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Transfer Request Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{className:"text-sm font-medium text-gray-600",children:"From Storage"}),e.jsx("p",{className:"font-semibold text-gray-900",children:a.from_storage_name})]}),e.jsxs("div",{children:[e.jsx(C,{className:"text-sm font-medium text-gray-600",children:"To Storage"}),e.jsx("p",{className:"font-semibold text-gray-900",children:a.to_storage_name})]}),e.jsxs("div",{children:[e.jsx(C,{className:"text-sm font-medium text-gray-600",children:"Size Class"}),e.jsx(y,{variant:"outline",className:"w-auto justify-center",children:a.is_bulk?a.size_class:`Size ${a.size_class}`}),a.is_bulk&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[a.batch_size," size",a.batch_size!==1?"s":""," in batch"]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(C,{className:"text-sm font-medium text-gray-600",children:"Total Weight"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-green-600"}),e.jsxs("span",{className:"font-bold text-green-600 text-lg",children:[a.weight_kg.toFixed(1),"kg"]})]})]}),e.jsxs("div",{children:[e.jsx(C,{className:"text-sm font-medium text-gray-600",children:"Piece Count"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.quantity.toLocaleString()," pieces"]})]}),a.notes&&e.jsxs("div",{className:"col-span-2",children:[e.jsx(C,{className:"text-sm font-medium text-gray-600",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-700 bg-gray-50 p-2 rounded",children:a.notes})]})]})]})}),e.jsx(J,{children:e.jsxs(K,{className:"p-4",children:[e.jsx(C,{htmlFor:"approval-notes",className:"text-sm font-medium text-gray-700",children:"Approval Notes (Optional)"}),e.jsx(Ne,{id:"approval-notes",placeholder:"Add any notes about this approval decision...",value:T,onChange:N=>_(N.target.value),className:"mt-2",rows:3})]})}),O&&e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(L,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-red-700",children:O})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t",children:[e.jsxs(p,{variant:"outline",onClick:g,disabled:x,className:"text-red-600 border-red-300 hover:bg-red-50",children:[x?e.jsx(G,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(R,{className:"w-4 h-4 mr-2"}),"Decline Transfer"]}),e.jsxs(p,{onClick:E,disabled:x,className:"bg-green-600 hover:bg-green-700 text-white",children:[x?e.jsx(G,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(w,{className:"w-4 h-4 mr-2"}),"Approve & Complete"]})]})]})]})})}function Ve({onNavigate:o}={}){var d;const{user:a}=ce(),[v,k]=u.useState([]),[z,T]=u.useState(!1),[_,x]=u.useState(null),[m,O]=u.useState(""),[S,E]=u.useState(!1),[g,N]=u.useState("all"),[Y,B]=u.useState(!1),[n,W]=u.useState(null),ee=s=>{const l=new Map,t=[];return s.forEach(r=>{const i=`${r.from_storage}-${r.to_storage}-${r.created_at}-${r.notes||""}`;l.has(i)||l.set(i,[]),l.get(i).push(r)}),l.forEach(r=>{if(r.length>1){const i=r[0],F=r.reduce((D,P)=>D+(Number(P.quantity)||0),0),c=r.reduce((D,P)=>D+(Number(P.weight_kg)||0),0),$=r.map(D=>D.size).sort((D,P)=>D-P),de=ze(ke({},i),{id:`batch-${i.id}`,is_batch:!0,batch_sizes:$,total_batch_quantity:F,total_batch_weight:c,batch_transfers:r,size:$[0]});t.push(de)}else t.push(r[0])}),t.sort((r,i)=>new Date(i.created_at).getTime()-new Date(r.created_at).getTime())},q=()=>A(this,null,function*(){T(!0),x(null);try{console.log("ðŸ” Fetching transfer history...");const s=yield U.getTransferHistory(200);console.log("ðŸ“Š Transfer history data received:",s),console.log("ðŸ“‹ Data analysis:",{totalTransfers:(s==null?void 0:s.length)||0,hasData:s&&s.length>0,sampleTransfer:(s==null?void 0:s[0])||null,allTransfers:s});const l=ee(s);console.log("ðŸ“¦ Grouped transfers:",l),console.log("ðŸ” Individual transfers (before grouping):",s),k(l)}catch(s){console.error("Error fetching transfer history:",s),x(s.message||"Failed to fetch transfer history")}finally{T(!1)}}),se=()=>A(this,null,function*(){E(!0),yield q(),E(!1)}),te=(s,l)=>A(this,null,function*(){try{const t=s.startsWith("batch-")?s.replace("batch-",""):s;yield U.approveTransfer(t,l),yield q(),B(!1),W(null)}catch(t){throw console.error("Error approving transfer:",t),t}}),ae=(s,l)=>A(this,null,function*(){try{const t=s.startsWith("batch-")?s.replace("batch-",""):s;yield U.declineTransfer(t,l),yield q(),B(!1),W(null)}catch(t){throw console.error("Error declining transfer:",t),t}}),re=s=>{W(s),B(!0)};u.useEffect(()=>{q()},[]);const h=v.filter(s=>{const l=!m||s.from_storage.toLowerCase().includes(m.toLowerCase())||s.to_storage.toLowerCase().includes(m.toLowerCase())||s.notes.toLowerCase().includes(m.toLowerCase())||(s.size||0).toString().includes(m),t=g==="all"||s.status===g;return l&&t}),le=s=>{switch(s){case"pending":return e.jsxs(y,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Pending"]});case"approved":return e.jsxs(y,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[e.jsx(w,{className:"w-3 h-3 mr-1"}),"Approved"]});case"completed":return e.jsxs(y,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[e.jsx(w,{className:"w-3 h-3 mr-1"}),"Completed"]});case"declined":return e.jsxs(y,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),"Denied"]});default:return e.jsx(y,{variant:"outline",className:"bg-gray-50 text-gray-700 border-gray-200",children:s})}},j=(()=>{const s=v.length,l=v.filter(i=>i.status==="pending").length,t=v.filter(i=>i.status==="approved").length,r=v.filter(i=>i.status==="declined").length;return{all:s,pending:l,approved:t,declined:r}})(),ne=()=>{const s=["Date","From Storage","To Storage","Size Class","Weight (kg)","Pieces","Status","Notes","Created By","Approved/Denied By","Action"],l=h.map(c=>{var $;return[new Date(c.created_at).toLocaleDateString(),c.from_storage,c.to_storage,c.size,(($=c.weight_kg)==null?void 0:$.toFixed(1))||"0.0",c.quantity,c.status,c.notes,c.created_by||"System",c.approved_by||(c.status==="pending"?"Pending":"-"),c.status==="pending"?"Review":c.status==="approved"?"Approved":c.status==="declined"?"Declined":c.status==="completed"?"Completed":"Unknown"]}),t=[s.join(","),...l.map(c=>c.map($=>`"${$}"`).join(","))].join(`
`),r=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),F=URL.createObjectURL(r);i.setAttribute("href",F),i.setAttribute("download",`transfer-reports-${new Date().toISOString().split("T")[0]}.csv`),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)},ie=()=>{const s=window.open("","_blank");if(!s)return;const l=`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Transfer Reports - ${new Date().toLocaleDateString()}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            h1 { color: #2563eb; margin-bottom: 20px; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            th { background-color: #f5f5f5; font-weight: bold; }
            .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
            .summary { background-color: #f8fafc; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>Fish Inventory Transfer Reports</h1>
            <p>Generated: ${new Date().toLocaleString()}</p>
          </div>
          
          <div class="summary">
            <h3>Summary</h3>
            <p><strong>Total Transfers:</strong> ${h.length}</p>
            <p><strong>Total Quantity Transferred:</strong> ${h.reduce((t,r)=>t+r.quantity,0)} pieces</p>
            <p><strong>Date Range:</strong> ${h.length>0?`${new Date(Math.min(...h.map(t=>new Date(t.created_at).getTime()))).toLocaleDateString()} - ${new Date(Math.max(...h.map(t=>new Date(t.created_at).getTime()))).toLocaleDateString()}`:"No transfers found"}</p>
          </div>

          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>From Storage</th>
                <th>To Storage</th>
                <th>Size Class</th>
                <th>Weight (kg)</th>
                <th>Pieces</th>
                <th>Status</th>
                <th>Notes</th>
                <th>Created By</th>
                <th>Approved/Denied By</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              ${h.map(t=>{var r;return`
                <tr>
                  <td>${new Date(t.created_at).toLocaleDateString()}</td>
                  <td>${t.from_storage}</td>
                  <td>${t.to_storage}</td>
                  <td>Size ${t.size}</td>
                  <td>${((r=t.weight_kg)==null?void 0:r.toFixed(1))||"0.0"}</td>
                  <td>${t.quantity}</td>
                  <td>${t.status}</td>
                  <td>${t.notes}</td>
                  <td>${t.created_by||"System"}</td>
                  <td>${t.approved_by||(t.status==="pending"?"Pending":"-")}</td>
                  <td>${t.status==="pending"?"Review":t.status==="approved"?"Approved":t.status==="declined"?"Declined":t.status==="completed"?"Completed":"Unknown"}</td>
                </tr>
              `}).join("")}
            </tbody>
          </table>
        </body>
      </html>
    `;s.document.write(l),s.document.close(),s.print()};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 content-container responsive-padding",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(H,{className:"h-6 w-6 md:h-8 md:w-8 text-blue-600"}),"Transfer Reports & Approvals"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage and approve fish transfer requests"})]}),o&&e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:e.jsxs(p,{onClick:()=>o("inventory"),variant:"outline",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(oe,{className:"w-4 h-4"}),"Back to Inventory"]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(me,{placeholder:"Search transfers...",value:m,onChange:s=>O(s.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{onClick:se,variant:"outline",size:"sm",disabled:S,children:[e.jsx(ye,{className:`w-4 h-4 mr-2 ${S?"animate-spin":""}`}),"Refresh"]}),e.jsxs(p,{onClick:ne,variant:"outline",size:"sm",disabled:h.length===0,children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Export CSV"]}),e.jsxs(p,{onClick:ie,variant:"outline",size:"sm",disabled:h.length===0,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Export PDF"]})]})]})}),j.pending>0&&e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-amber-200 p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(L,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-amber-800",children:"Pending Transfers Require Approval"}),e.jsxs("p",{className:"text-sm text-amber-700",children:["You have ",j.pending," transfer request",j.pending!==1?"s":"",' waiting for approval. Click the "Review" button in the table below to approve or decline transfers.']})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(p,{variant:g==="all"?"default":"outline",size:"sm",onClick:()=>N("all"),className:`flex items-center gap-2 ${g==="all"?"bg-blue-600 hover:bg-blue-700 text-white":"bg-white hover:bg-gray-50 text-gray-700 border-gray-300"}`,children:[e.jsx(H,{className:"h-4 w-4"}),"All (",j.all,")"]}),e.jsxs(p,{variant:g==="pending"?"default":"outline",size:"sm",onClick:()=>N("pending"),className:`flex items-center gap-2 ${g==="pending"?"bg-yellow-600 hover:bg-yellow-700 text-white":"bg-white hover:bg-gray-50 text-gray-700 border-gray-300"}`,children:[e.jsx(M,{className:"h-4 w-4"}),"Pending (",j.pending,")"]}),e.jsxs(p,{variant:g==="approved"?"default":"outline",size:"sm",onClick:()=>N("approved"),className:`flex items-center gap-2 ${g==="approved"?"bg-green-600 hover:bg-green-700 text-white":"bg-white hover:bg-gray-50 text-gray-700 border-gray-300"}`,children:[e.jsx(w,{className:"h-4 w-4"}),"Approved (",j.approved,")"]}),e.jsxs(p,{variant:g==="declined"?"default":"outline",size:"sm",onClick:()=>N("declined"),className:`flex items-center gap-2 ${g==="declined"?"bg-red-600 hover:bg-red-700 text-white":"bg-white hover:bg-gray-50 text-gray-700 border-gray-300"}`,children:[e.jsx(R,{className:"h-4 w-4"}),"Denied (",j.declined,")"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Transfers"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:h.length})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(I,{className:"w-6 h-6 text-blue-600"})})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm",children:[e.jsxs("span",{className:"text-green-600 font-medium",children:[j.approved," approved"]}),e.jsx("span",{className:"text-gray-400 mx-2",children:"â€¢"}),e.jsxs("span",{className:"text-gray-500",children:[j.pending," pending"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Approved Weight"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[h.filter(s=>s.status==="approved").reduce((s,l)=>s+(Number(l.weight_kg)||0),0).toFixed(1),"kg"]})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(w,{className:"w-6 h-6 text-green-600"})})]}),e.jsx("div",{className:"mt-2 flex items-center text-sm",children:e.jsx("span",{className:"text-gray-600",children:"Weight of approved transfers"})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Denied"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:h.filter(s=>s.status==="declined").length})]}),e.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:e.jsx(R,{className:"w-6 h-6 text-red-600"})})]}),e.jsx("div",{className:"mt-2 flex items-center text-sm",children:e.jsx("span",{className:"text-gray-600",children:"Number of denied transfers"})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Weight"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:[h.reduce((s,l)=>s+(Number(l.weight_kg)||0),0).toFixed(1),"kg"]})]}),e.jsx("div",{className:"p-3 bg-orange-100 rounded-lg",children:e.jsx(V,{className:"w-6 h-6 text-orange-600"})})]}),e.jsx("div",{className:"mt-2 flex items-center text-sm",children:e.jsx("span",{className:"text-gray-600",children:"Total weight transferred"})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Reviews"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:j.pending})]}),e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(M,{className:"w-6 h-6 text-purple-600"})})]}),e.jsx("div",{className:"mt-2 flex items-center text-sm",children:j.pending>0?e.jsxs("span",{className:"text-amber-600 font-medium flex items-center",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),"Needs attention"]}):e.jsxs("span",{className:"text-green-600 font-medium flex items-center",children:[e.jsx(w,{className:"w-4 h-4 mr-1"}),"All caught up"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-4 sm:p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Transfer History"}),e.jsx("p",{className:"text-sm text-gray-600",children:"View and manage all transfer requests"})]}),e.jsx("div",{className:"p-0",children:z?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(G,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading transfer history..."})]})}):_?e.jsxs("div",{className:"flex items-center gap-2 p-8 bg-red-50 border border-red-200 rounded-lg m-6",children:[e.jsx(L,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-800",children:"Error Loading Data"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:_}),e.jsx(p,{onClick:q,variant:"outline",size:"sm",className:"mt-2",children:"Try Again"})]})]}):h.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"p-4 bg-gray-50 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:e.jsx(I,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Transfers Found"}),e.jsx("p",{className:"text-gray-600",children:m?"No transfers match your search criteria":"No transfers have been recorded yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(he,{children:[e.jsx(ge,{children:e.jsxs(Q,{children:[e.jsx(f,{children:"Date"}),e.jsx(f,{children:"From Storage"}),e.jsx(f,{children:"To Storage"}),e.jsx(f,{children:"Size Class"}),e.jsx(f,{children:"Weight (kg)"}),e.jsx(f,{children:"Pieces"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:"Notes"}),e.jsx(f,{children:"Created By"}),e.jsx(f,{children:"Approved/Denied By"}),e.jsx(f,{children:"Actions"})]})}),e.jsx(pe,{children:h.map(s=>{var l,t,r;return e.jsxs(Q,{children:[e.jsx(b,{className:"font-medium",children:new Date(s.created_at).toLocaleDateString()}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-red-100 rounded",children:e.jsx(I,{className:"w-3 h-3 text-red-600"})}),e.jsx("span",{className:"font-medium",children:s.from_storage})]})}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-green-100 rounded",children:e.jsx(I,{className:"w-3 h-3 text-green-600 rotate-180"})}),e.jsx("span",{className:"font-medium",children:s.to_storage})]})}),e.jsx(b,{children:e.jsx("div",{className:"flex flex-col items-center gap-1",children:s.is_batch?e.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[e.jsx(y,{variant:"secondary",className:"text-xs",children:"Batch"}),(l=s.batch_sizes)==null?void 0:l.map((i,F)=>e.jsxs(y,{variant:"outline",className:"text-xs",children:["Size ",i]},F))]}):e.jsxs(y,{variant:"outline",className:"w-auto justify-center",children:["Size ",s.size]})})}),e.jsx(b,{className:"font-semibold text-blue-600",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-4 h-4"}),s.is_batch?`${((t=s.total_batch_weight)==null?void 0:t.toFixed(1))||"0.0"}kg`:`${((r=s.weight_kg)==null?void 0:r.toFixed(1))||"0.0"}kg`]})}),e.jsx(b,{className:"text-sm text-gray-500",children:s.is_batch?`${s.total_batch_quantity||0} pieces`:`${s.quantity} pieces`}),e.jsx(b,{children:le(s.status)}),e.jsx(b,{className:"max-w-xs truncate",children:s.notes||"-"}),e.jsx(b,{className:"text-sm text-gray-500",children:s.created_by||"System"}),e.jsx(b,{className:"text-sm text-gray-500",children:s.approved_by||(s.status==="pending"?"Pending":"-")}),e.jsxs(b,{children:[s.status==="pending"&&e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>re(s),className:"text-blue-600 border-blue-200 hover:bg-blue-50",children:[e.jsx(w,{className:"w-4 h-4 mr-1"}),"Review"]}),s.status==="approved"&&e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Approved"})]}),s.status==="declined"&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Declined"})]}),s.status==="completed"&&e.jsxs("div",{className:"flex items-center gap-1 text-blue-600",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Completed"})]})]})]},s.id)})})]})})})]}),Y&&n&&e.jsx(Te,{isOpen:Y,onClose:()=>{B(!1),W(null)},transferRequest:{id:n.id,from_storage_name:n.from_storage,to_storage_name:n.to_storage,size_class:n.is_batch?0:n.size,quantity:n.is_batch?n.total_batch_quantity||0:n.quantity,weight_kg:n.is_batch?n.total_batch_weight||0:n.weight_kg,notes:n.notes,created_at:n.created_at,is_bulk:n.is_batch||n.is_bulk,batch_size:n.is_batch?((d=n.batch_sizes)==null?void 0:d.length)||0:n.batch_size,batch_transfers:n.batch_transfers,is_batch:n.is_batch,batch_sizes:n.batch_sizes,total_batch_quantity:n.total_batch_quantity,total_batch_weight:n.total_batch_weight},onApprove:te,onDecline:ae,currentUserId:(a==null?void 0:a.id)||""})]})})}export{Ve as default};
