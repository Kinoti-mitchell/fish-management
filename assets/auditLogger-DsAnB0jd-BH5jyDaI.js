import{K as g}from"./index-Cx51dYQZ.js";var a=(c,e,t)=>new Promise((o,l)=>{var r=i=>{try{u(t.next(i))}catch(s){l(s)}},d=i=>{try{u(t.throw(i))}catch(s){l(s)}},u=i=>i.done?o(i.value):Promise.resolve(i.value).then(r,d);u((t=t.apply(c,e)).next())});class n{static logEvent(e){return a(this,null,function*(){try{const t=JSON.parse(sessionStorage.getItem("currentUser")||"null");if(!t){console.warn("No authenticated user found for audit logging");return}const o={user_id:t.id,action:e.action,table_name:e.table_name,record_id:e.record_id,old_values:e.old_values?JSON.stringify(e.old_values):null,new_values:e.new_values?JSON.stringify(e.new_values):null,ip_address:e.ip_address||null,user_agent:e.user_agent||navigator.userAgent,created_at:new Date().toISOString()},l=void 0;let r=null;l||(r=(yield g.from("audit_logs").insert([o])).error),r&&console.warn("Failed to log audit event:",r)}catch(t){console.warn("Failed to log audit event:",t)}})}static logCreate(e,t,o){return a(this,null,function*(){yield n.logEvent({action:"CREATE",table_name:e,record_id:t,new_values:o})})}static logUpdate(e,t,o,l){return a(this,null,function*(){yield n.logEvent({action:"UPDATE",table_name:e,record_id:t,old_values:o,new_values:l})})}static logDelete(e,t,o){return a(this,null,function*(){yield n.logEvent({action:"DELETE",table_name:e,record_id:t,old_values:o})})}static logLogin(e,t){return a(this,null,function*(){yield n.logEvent({action:"LOGIN",table_name:"profiles",record_id:e,new_values:{login_time:new Date().toISOString()},user_agent:t})})}static logLogout(e){return a(this,null,function*(){yield n.logEvent({action:"LOGOUT",table_name:"profiles",record_id:e,new_values:{logout_time:new Date().toISOString()}})})}static logCustomAction(e,t,o,l){return a(this,null,function*(){yield n.logEvent({action:e,table_name:t,record_id:o,new_values:l})})}}const v={create:n.logCreate,update:n.logUpdate,delete:n.logDelete,login:n.logLogin,logout:n.logLogout,custom:n.logCustomAction};export{v as m};
