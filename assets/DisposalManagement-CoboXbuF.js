var we=Object.defineProperty,_e=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var ce=(r,t,a)=>t in r?we(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a,oe=(r,t)=>{for(var a in t||(t={}))ve.call(t,a)&&ce(r,a,t[a]);if(ne)for(var a of ne(t))De.call(t,a)&&ce(r,a,t[a]);return r},re=(r,t)=>_e(r,ye(t));var M=(r,t,a)=>new Promise((l,x)=>{var h=y=>{try{p(a.next(y))}catch(f){x(f)}},D=y=>{try{p(a.throw(y))}catch(f){x(f)}},p=y=>y.done?l(y.value):Promise.resolve(y.value).then(h,D);p((a=a.apply(r,t)).next())});import{s as O,r as b,j as e,p as Q,e as me,P as ae,B as K,a as w,f as W,g as U,b as _,L as H,I as ee,l as Y,C as Se}from"./index-CpNFiXA1.js";import{S as Ce,a as ke,b as Te,c as Ee,d as Ie}from"./select-DqWpyIkf.js";import{D as Fe,b as Ae,c as Re,d as $e,f as Me,e as Oe}from"./dialog-NtgNh5u1.js";import{D as We}from"./dollar-sign-BhCk0N5D.js";import{T as Ue}from"./trending-down-ByidX05P.js";import{C as xe}from"./clock-sArWPAJm.js";import{S as ze}from"./scale-Coap2kcd.js";import{A as qe}from"./activity-CcEyukxx.js";import{P as Le}from"./plus-FJ0CIBRX.js";import{C as de}from"./calendar-CU6tj0PZ.js";import{M as ge}from"./map-pin-C-M6umvy.js";import{C as Pe}from"./index-io8wS31O.js";import{C as Ke}from"./chevron-right-DTnlI_34.js";import{F as Be}from"./file-text-35uk4vLR.js";import{D as Ge}from"./download-cYb9BEHt.js";import{T as He}from"./trending-up-DUO3gdV8.js";import"./index-B7iGXlpc.js";import"./index-CEgc-Zw-.js";class Ye{getDisposalStats(){return M(this,null,function*(){try{console.log("ðŸ” [DisposalService] Fetching disposal statistics...");const{data:t,error:a}=yield O.from("disposal_records").select(`
          *,
          disposal_reason:disposal_reasons(name)
        `).order("created_at",{ascending:!1});if(a)throw console.error("âŒ [DisposalService] Error fetching disposal records:",a),a;console.log("ðŸ“Š [DisposalService] Disposal records:",(t==null?void 0:t.length)||0);const l=(t==null?void 0:t.length)||0,x=(t==null?void 0:t.reduce((c,g)=>c+(g.total_weight_kg||0),0))||0,h=(t==null?void 0:t.reduce((c,g)=>c+(g.disposal_cost||0),0))||0,D=(t==null?void 0:t.filter(c=>c.status==="pending").length)||0,p=new Date;p.setDate(p.getDate()-7);const y=(t==null?void 0:t.filter(c=>new Date(c.created_at)>=p).length)||0,f=(t==null?void 0:t.filter(c=>c.status==="completed"))||[];let B=0;f.length>0&&(B=f.reduce((g,k)=>{const T=new Date(k.created_at),A=new Date(k.disposal_date),R=Math.floor((A.getTime()-T.getTime())/(1e3*60*60*24));return g+R},0)/f.length);const I={};t==null||t.forEach(c=>{var k;const g=((k=c.disposal_reason)==null?void 0:k.name)||"Unknown";I[g]=(I[g]||0)+1});const L=Object.keys(I).reduce((c,g)=>I[c]>I[g]?c:g,"Age"),F=new Date,z=F.getMonth(),G=F.getFullYear(),N=z===0?11:z-1,i=z===0?G-1:G,m=(t==null?void 0:t.filter(c=>{const g=new Date(c.created_at);return g.getMonth()===z&&g.getFullYear()===G}).length)||0,S=(t==null?void 0:t.filter(c=>{const g=new Date(c.created_at);return g.getMonth()===N&&g.getFullYear()===i}).length)||0,C=S>0?(m-S)/S*100:0,v={totalDisposals:l,totalDisposedWeight:x,totalDisposalCost:h,pendingDisposals:D,recentDisposals:y,averageDisposalAge:B,topDisposalReason:L,monthlyDisposalTrend:C};return console.log("ðŸ“Š [DisposalService] Calculated stats:",v),v}catch(t){return console.error("âŒ [DisposalService] Error getting disposal stats:",t),{totalDisposals:0,totalDisposedWeight:0,totalDisposalCost:0,pendingDisposals:0,recentDisposals:0,averageDisposalAge:0,topDisposalReason:"Age",monthlyDisposalTrend:0}}})}getDisposalRecords(t=50,a=0){return M(this,null,function*(){try{const{data:l,error:x}=yield O.from("disposal_records").select(`
          *,
          disposal_reason:disposal_reasons(name)
        `).order("created_at",{ascending:!1}).range(a,a+t-1);if(x)throw x;return l||[]}catch(l){return console.error("Error fetching disposal records:",l),[]}})}getDisposalReasons(){return M(this,null,function*(){try{const{data:t,error:a}=yield O.from("disposal_reasons").select("*").eq("is_active",!0).order("name");if(a)throw a;return t||[]}catch(t){return console.error("Error fetching disposal reasons:",t),[]}})}getInventoryForDisposal(t=30,a=!0,l,x=!1,h,D){return M(this,null,function*(){try{console.log("ðŸ” [DisposalService] Getting inventory for disposal with improved filtering..."),console.log("ðŸ“Š [DisposalService] Filter criteria:",{daysOld:t,includeStorageIssues:a});const p=new Date;p.setDate(p.getDate()-t);const y=p.toISOString().split("T")[0];console.log("ðŸ“… [DisposalService] Cutoff date:",y);const{data:f,error:B}=yield O.from("storage_locations").select("id, name, status, capacity_kg, current_usage_kg").order("name");if(B)throw console.error("âŒ [DisposalService] Storage locations error:",B),B;console.log("ðŸ“ [DisposalService] Storage locations found:",(f==null?void 0:f.length)||0);const I=new Map;f==null||f.forEach(i=>{I.set(i.id,i)});let L=O.from("sorting_results").select(`
          id,
          size_class,
          total_pieces,
          total_weight_grams,
          storage_location_id,
          created_at,
          sorting_batch:sorting_batches(
            id,
            batch_number,
            status,
            created_at
          )
        `).not("storage_location_id","is",null).gt("total_weight_grams",0);L=L.eq("sorting_batch.status","completed");const{data:F,error:z}=yield L.order("created_at",{ascending:!1});if(z)throw console.error("âŒ [DisposalService] Query error:",z),z;console.log("ðŸ“Š [DisposalService] Raw query results:",(F==null?void 0:F.length)||0,"items");const G=(F||[]).filter(i=>{var T,A,R,P;const m=I.get(i.storage_location_id);if(!i.total_weight_grams||i.total_weight_grams<=0)return console.log("âŒ [DisposalService] Item filtered out - no weight:",i.id,i.total_weight_grams),!1;const S=((A=(T=i.sorting_batch)==null?void 0:T.created_at)==null?void 0:A.split("T")[0])||((R=i.created_at)==null?void 0:R.split("T")[0]);if(!S)return console.log("âŒ [DisposalService] Item filtered out - no processing date:",i.id),!1;const C=new Date(S);if(isNaN(C.getTime())||C>new Date)return console.log("âŒ [DisposalService] Item filtered out - invalid or future date:",i.id,S),!1;const v=Math.floor((new Date().getTime()-C.getTime())/(1e3*60*60*24));let c=!1;if(t===0?c=!0:l&&l>t?c=v>=t&&v<=l:c=v>=t,h||D){const $=S;let E=!0;if(h&&$<h&&(E=!1),D&&$>D&&(E=!1),!E)return console.log("âŒ [DisposalService] Item filtered out - not in date range:",i.id,$,"from:",h,"to:",D),!1}let g=!1;if(x)return g=m&&m.status!=="active",g;a&&(g=!i.storage_location_id||!m||m.status!=="active"||m.current_usage_kg>m.capacity_kg);const k=c||g;return console.log("ðŸ” [DisposalService] Item check:",{id:i.id,batchNumber:(P=i.sorting_batch)==null?void 0:P.batch_number,processingDate:S,daysInStorage:v,weightGrams:i.total_weight_grams,isOldEnough:c,hasStorageIssues:g,storageStatus:m==null?void 0:m.status,isEligible:k,inactiveStorageOnly:x}),k});console.log("ðŸ“Š [DisposalService] Eligible items after filtering:",G.length);const N=G.map(i=>{var c,g,k,T,A,R,P,$,E,se,q,V,J,X;const m=I.get(i.storage_location_id),S=((g=(c=i.sorting_batch)==null?void 0:c.created_at)==null?void 0:g.split("T")[0])||((k=i.created_at)==null?void 0:k.split("T")[0]),C=Math.floor((new Date().getTime()-new Date(S).getTime())/(1e3*60*60*24));let v="Age";return i.storage_location_id?m?m.status!=="active"?v="Storage Inactive":m.current_usage_kg>m.capacity_kg?v="Storage Over Capacity":C>=t&&(v="Age"):v="Storage Not Found":v="No Storage Location",{sorting_result_id:i.id,size_class:i.size_class,total_pieces:i.total_pieces,total_weight_grams:i.total_weight_grams,batch_number:((T=i.sorting_batch)==null?void 0:T.batch_number)||"BATCH-"+((R=(A=i.sorting_batch)==null?void 0:A.id)==null?void 0:R.substring(0,8)),storage_location_name:(m==null?void 0:m.name)||"No Storage Assigned",farmer_name:((se=(E=($=(P=i.sorting_batch)==null?void 0:P.processing_record)==null?void 0:$.warehouse_entry)==null?void 0:E.farmers)==null?void 0:se.name)||"Unknown Farmer",processing_date:S,days_in_storage:C,disposal_reason:v,quality_notes:`Fish from ${((X=(J=(V=(q=i.sorting_batch)==null?void 0:q.processing_record)==null?void 0:V.warehouse_entry)==null?void 0:J.farmers)==null?void 0:X.name)||"Unknown Farmer"}`,storage_status:(m==null?void 0:m.status)||"unknown"}});return console.log("ðŸ“Š [DisposalService] Transformed items:",N.length),N}catch(p){return console.error("âŒ [DisposalService] Error getting inventory for disposal:",p),[]}})}createDisposal(t){return M(this,null,function*(){try{console.log("ðŸ” [DisposalService] Creating disposal record..."),console.log("ðŸ“Š [DisposalService] Disposal data:",t);const{data:a,error:l}=yield O.from("disposal_reasons").select("id").eq("name",t.disposalReason).single();if(l)throw console.error("âŒ [DisposalService] Error finding disposal reason:",l),new Error(`Disposal reason "${t.disposalReason}" not found`);const{data:x,error:h}=yield O.from("disposal_records").insert({disposal_reason_id:a.id,total_weight_kg:t.totalWeight,disposal_cost:t.disposalCost,notes:t.disposalNotes,status:"completed",disposal_date:new Date().toISOString().split("T")[0],created_by:"system"}).select().single();if(h)throw console.error("âŒ [DisposalService] Error creating disposal record:",h),h;console.log("âœ… [DisposalService] Disposal record created:",x.id);const D=t.selectedItems.map(f=>({disposal_record_id:x.id,sorting_result_id:f})),{error:p}=yield O.from("disposal_items").insert(D);if(p)throw console.error("âŒ [DisposalService] Error creating disposal items:",p),p;console.log("âœ… [DisposalService] Disposal items created:",D.length);const{error:y}=yield O.from("sorting_results").update({status:"disposed"}).in("id",t.selectedItems);if(y)throw console.error("âŒ [DisposalService] Error updating sorting results:",y),y;return console.log("âœ… [DisposalService] Sorting results updated to disposed status"),{success:!0,disposalRecord:x,message:`Successfully disposed ${t.selectedItems.length} items`}}catch(a){return console.error("âŒ [DisposalService] Error creating disposal:",a),{success:!1,error:a instanceof Error?a.message:"Unknown error occurred"}}})}getInventoryForDisposalFallback(t=30){return M(this,null,function*(){try{const a=new Date;a.setDate(a.getDate()-t);const{data:l,error:x}=yield O.from("sorting_results").select(`
          id,
          size_class,
          total_weight_grams,
          batch_number,
          storage_location_name,
          farmer_name,
          processing_date,
          quality_notes,
          storage_locations!inner(status)
        `).eq("status","available").lte("processing_date",a.toISOString().split("T")[0]).gte("total_weight_grams",0);if(x)throw x;return(l==null?void 0:l.map(h=>{var D,p;return{sorting_result_id:h.id,size_class:h.size_class,total_weight_grams:h.total_weight_grams,batch_number:h.batch_number,storage_location_name:h.storage_location_name,storage_status:((D=h.storage_locations)==null?void 0:D.status)||"active",farmer_name:h.farmer_name,processing_date:h.processing_date,days_in_storage:Math.floor((new Date().getTime()-new Date(h.processing_date).getTime())/(1e3*60*60*24)),disposal_reason:((p=h.storage_locations)==null?void 0:p.status)==="inactive"?"Storage Inactive":"Age",quality_notes:h.quality_notes}}))||[]}catch(a){return console.error("Error in fallback method:",a),[]}})}}const te=new Ye;function Ve({stats:r}){const[t,a]=b.useState([]);return b.useEffect(()=>{const l={totalDisposals:Number(r==null?void 0:r.totalDisposals)||0,totalDisposedWeight:Number(r==null?void 0:r.totalDisposedWeight)||0,totalDisposalCost:Number(r==null?void 0:r.totalDisposalCost)||0,pendingDisposals:Number(r==null?void 0:r.pendingDisposals)||0,recentDisposals:Number(r==null?void 0:r.recentDisposals)||0,averageDisposalAge:Number(r==null?void 0:r.averageDisposalAge)||0,monthlyDisposalTrend:Number(r==null?void 0:r.monthlyDisposalTrend)||0,topDisposalReason:String((r==null?void 0:r.topDisposalReason)||"Age")},x=[{id:"1",type:"warning",icon:e.jsx(Q,{className:"h-5 w-5"}),text:`ðŸ—‘ï¸ Total Disposals: ${l.totalDisposals} records | ${l.totalDisposedWeight.toFixed(1)}kg disposed`,bgColor:"bg-orange-100",textColor:"text-orange-800"},{id:"2",type:"info",icon:e.jsx(We,{className:"h-5 w-5"}),text:`ðŸ’° Disposal Costs: KES ${l.totalDisposalCost.toLocaleString()} total cost | ${l.averageDisposalAge.toFixed(1)} days avg age`,bgColor:"bg-red-100",textColor:"text-red-800"},{id:"3",type:"warning",icon:e.jsx(me,{className:"h-5 w-5"}),text:`âš ï¸ Pending Disposals: ${l.pendingDisposals} awaiting approval | ${l.recentDisposals} this week`,bgColor:"bg-yellow-100",textColor:"text-yellow-800"},{id:"4",type:"info",icon:e.jsx(Ue,{className:"h-5 w-5"}),text:`ðŸ“‰ Disposal Trend: ${l.monthlyDisposalTrend}% change this month | Top reason: ${l.topDisposalReason}`,bgColor:"bg-purple-100",textColor:"text-purple-800"},{id:"5",type:"info",icon:e.jsx(xe,{className:"h-5 w-5"}),text:`â° Average Age: ${l.averageDisposalAge.toFixed(1)} days before disposal | Quality control active`,bgColor:"bg-indigo-100",textColor:"text-indigo-800"},{id:"6",type:"success",icon:e.jsx(ae,{className:"h-5 w-5"}),text:"ðŸ“¦ Waste Management: Efficient disposal system | Environmental compliance maintained",bgColor:"bg-green-100",textColor:"text-green-800"},{id:"7",type:"info",icon:e.jsx(ze,{className:"h-5 w-5"}),text:"âš–ï¸ Quality Control: Automated disposal triggers | Storage optimization active",bgColor:"bg-blue-100",textColor:"text-blue-800"},{id:"8",type:"achievement",icon:e.jsx(qe,{className:"h-5 w-5"}),text:"ðŸŽ¯ Rio Fish Farm: Leading waste management practices in Kenya's fish industry",bgColor:"bg-emerald-100",textColor:"text-emerald-800"}];a(x)},[r]),e.jsx("div",{className:"w-full bg-gradient-to-r from-orange-50 to-red-50 border-b border-orange-200 shadow-sm overflow-hidden relative z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"relative py-2 sm:py-3 overflow-hidden",children:e.jsxs("div",{className:"flex animate-marquee-simple whitespace-nowrap",children:[t.map(l=>e.jsxs("div",{className:`flex items-center gap-2 sm:gap-3 px-3 sm:px-6 py-1 sm:py-2 rounded-full ${l.bgColor} ${l.textColor} font-medium text-xs sm:text-sm whitespace-nowrap mx-2 sm:mx-4 shadow-sm border flex-shrink-0`,children:[l.icon,e.jsx("span",{children:l.text})]},l.id)),t.map(l=>e.jsxs("div",{className:`flex items-center gap-2 sm:gap-3 px-3 sm:px-6 py-1 sm:py-2 rounded-full ${l.bgColor} ${l.textColor} font-medium text-xs sm:text-sm whitespace-nowrap mx-2 sm:mx-4 shadow-sm border flex-shrink-0`,children:[l.icon,e.jsx("span",{children:l.text})]},`duplicate-${l.id}`))]})})})})}const ps=()=>{const[r,t]=b.useState([]),[a,l]=b.useState({totalDisposals:0,totalDisposedWeight:0,totalDisposalCost:0,pendingDisposals:0,recentDisposals:0,averageDisposalAge:0,topDisposalReason:"Age"}),[x,h]=b.useState([]),[D,p]=b.useState(!0),[y,f]=b.useState(!1),[B,I]=b.useState(!1),[L,F]=b.useState(!1),[z,G]=b.useState(null),[N,i]=b.useState("all"),[m,S]=b.useState(1),[C,v]=b.useState([]),[c,g]=b.useState(""),[k,T]=b.useState(new Set),[A,R]=b.useState(0),[P,$]=b.useState(""),[E,se]=b.useState(!1),[q,V]=b.useState({from:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],to:new Date().toISOString().split("T")[0]}),J=[{value:"all",label:"All Items",description:"Show all available items",days:0},{value:"custom_age",label:"Custom Age",description:"Items older than specified days",days:0},{value:"inactive_storage",label:"Inactive Storage",description:"Items in inactive storage locations",days:0}];b.useEffect(()=>{X(),le()},[]),b.useEffect(()=>{le()},[N,m]);const X=()=>M(void 0,null,function*(){try{p(!0);const[s,o]=yield Promise.all([te.getDisposalRecords(),te.getDisposalStats()]);t(s),l(o)}catch(s){console.error("Error loading disposal data:",s)}finally{p(!1)}}),le=()=>M(void 0,null,function*(){try{let s=0,o,n=!1,j=!1;N==="all"?(s=0,j=!0):N==="custom_age"?s=m:N==="inactive_storage"&&(s=0,n=!0,j=!1);const d=yield te.getInventoryForDisposal(s,j,o,n);h(d)}catch(s){console.error("Error loading inventory for disposal:",s),h([])}}),he=()=>M(void 0,null,function*(){if(C.length===0){alert("Please select at least one item for disposal");return}try{F(!0);const o=x.filter(j=>C.includes(j.sorting_result_id)).reduce((j,d)=>j+d.total_weight_grams/1e3,0),n=yield te.createDisposal({selectedItems:C,disposalReason:c,disposalCost:A,disposalNotes:P,totalWeight:o});n.success?(alert(`âœ… ${n.message}`),pe(),f(!1),yield X()):alert(`âŒ Error creating disposal: ${n.error}`)}catch(s){console.error("Error creating disposal:",s),alert("âŒ An error occurred while creating the disposal record")}finally{F(!1)}}),pe=()=>{i("all"),S(1),v([]),g(""),R(0),$("")},ue=s=>{v(o=>o.includes(s)?o.filter(n=>n!==s):[...o,s])},fe=s=>{T(o=>{const n=new Set(o);return n.has(s)?n.delete(s):n.add(s),n})},je=()=>{const s=new Set(x.map(o=>o.storage_location_name));T(s)},be=()=>{T(new Set)},ie=()=>{const s=r.filter(d=>{const u=new Date(d.created_at).toISOString().split("T")[0];return u>=q.from&&u<=q.to}),o=s.reduce((d,u)=>d+(u.total_weight_kg||0),0),n=s.reduce((d,u)=>d+(u.disposal_cost||0),0),j={};return s.forEach(d=>{var Z;const u=typeof d.disposal_reason=="object"?((Z=d.disposal_reason)==null?void 0:Z.name)||"Unknown":d.disposal_reason||"Unknown";j[u]||(j[u]={count:0,weight:0,cost:0}),j[u].count++,j[u].weight+=d.total_weight_kg||0,j[u].cost+=d.disposal_cost||0}),{totalRecords:s.length,totalWeight:o,totalCost:n,reasonGroups:j,records:s}},Ne=()=>{const s=ie(),o=[["Date","Reason","Weight (kg)","Cost (KES)","Status"].join(","),...s.records.map(u=>{var Z;return[new Date(u.created_at).toLocaleDateString(),typeof u.disposal_reason=="object"?((Z=u.disposal_reason)==null?void 0:Z.name)||"Unknown":u.disposal_reason||"Unknown",u.total_weight_kg||0,u.disposal_cost||0,u.status].join(",")})].join(`
`),n=new Blob([o],{type:"text/csv"}),j=window.URL.createObjectURL(n),d=document.createElement("a");d.href=j,d.download=`disposal-report-${q.from}-to-${q.to}.csv`,d.click(),window.URL.revokeObjectURL(j)};return D?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading disposal data..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 content-container",children:[e.jsx(Ve,{stats:a}),e.jsxs("div",{className:"container mx-auto responsive-padding max-w-full overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Disposal Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage fish disposal and waste handling"})]}),e.jsxs(K,{className:"bg-red-600 hover:bg-red-700 text-white",onClick:()=>f(!0),children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Create Disposal"]})]}),e.jsx(Fe,{open:y,onOpenChange:f,children:e.jsxs(Ae,{className:"!max-w-4xl !w-[90vw] !h-[80vh] !flex !flex-col !top-[10vh] !left-[5vw] !translate-x-0 !translate-y-0",children:[e.jsxs(Re,{children:[e.jsx($e,{className:"text-xl font-semibold",children:"Create New Disposal Record"}),e.jsx(Me,{children:"Configure disposal criteria and select items for disposal"})]}),e.jsxs("div",{className:"space-y-4 flex-1 overflow-y-auto overflow-x-hidden min-h-0 pt-2",style:{maxHeight:"calc(80vh - 150px)"},children:[e.jsxs(w,{className:"shadow-lg border-0 bg-gradient-to-br from-blue-50 to-indigo-50 max-w-md mx-auto",children:[e.jsxs(W,{className:"pb-4",children:[e.jsxs(U,{className:"text-xl font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-600"}),"Select Filter Criteria"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Choose criteria for selecting items to dispose"})]}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"ageCategory",className:"text-sm font-semibold text-gray-700",children:"Filter Criteria *"}),e.jsxs(Ce,{value:N,onValueChange:s=>{i(s);const o=J.find(n=>n.value===s);o&&g(o.label)},children:[e.jsx(ke,{className:"h-12 bg-white border-2 border-gray-200 hover:border-blue-300 focus:border-blue-500 transition-colors",children:e.jsx(Te,{placeholder:"Select filter criteria"})}),e.jsx(Ee,{children:J.map(s=>e.jsx(Ie,{value:s.value,children:e.jsxs("div",{className:"flex flex-col py-1",children:[e.jsx("span",{className:"font-medium text-gray-800",children:s.label}),e.jsx("span",{className:"text-xs text-gray-500",children:s.description})]})},s.value))})]})]})})]}),N&&N!==""&&e.jsxs("div",{className:"space-y-4",children:[N==="custom_age"&&e.jsxs(w,{className:"shadow-lg border-0 bg-gradient-to-br from-yellow-50 to-orange-50 max-w-md mx-auto",children:[e.jsxs(W,{className:"pb-4",children:[e.jsxs(U,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-orange-600"}),"Custom Age Threshold"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Set the minimum age in days for items to dispose"})]}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"customDaysOld",className:"text-sm font-semibold text-gray-700",children:"Days Old Threshold *"}),e.jsx(ee,{id:"customDaysOld",type:"number",value:m,onChange:s=>S(Number(s.target.value)),className:"h-12 bg-white border-2 border-gray-200 hover:border-orange-300 focus:border-orange-500 transition-colors",placeholder:"Enter days old threshold",min:"1"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 max-w-full overflow-x-hidden",children:[e.jsxs(w,{className:"shadow-lg border-0 bg-gradient-to-br from-blue-50 to-indigo-50",children:[e.jsxs(W,{className:"pb-4",children:[e.jsxs(U,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-blue-600"}),"Filter Items for Disposal"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure criteria for selecting items"})]}),e.jsx(_,{className:"space-y-4",children:N==="custom_age"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"text-sm font-semibold text-gray-700",children:"Age Threshold"}),e.jsx("div",{className:"p-3 bg-white rounded-lg border border-gray-200",children:e.jsxs("span",{className:"text-sm text-gray-600",children:[m," days or older"]})})]})})]}),e.jsxs(w,{className:"shadow-lg border-0 bg-gradient-to-br from-green-50 to-emerald-50",children:[e.jsxs(W,{className:"pb-4",children:[e.jsxs(U,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-green-600"}),"Disposal Details"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Provide disposal information"})]}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"disposalCost",className:"text-sm font-semibold text-gray-700",children:"Disposal Cost (KES)"}),e.jsx(ee,{id:"disposalCost",type:"number",value:A,onChange:s=>R(Number(s.target.value)),className:"h-12 bg-white border-2 border-gray-200 hover:border-green-300 focus:border-green-500 transition-colors",placeholder:"Enter disposal cost",min:"0",step:"0.01"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"disposalNotes",className:"text-sm font-semibold text-gray-700",children:"Notes"}),e.jsx(ee,{id:"disposalNotes",value:P,onChange:s=>$(s.target.value),className:"h-12 bg-white border-2 border-gray-200 hover:border-green-300 focus:border-green-500 transition-colors",placeholder:"Additional notes (optional)"})]})]})]})]}),e.jsxs(w,{className:"overflow-hidden",children:[e.jsxs(W,{className:"pb-4",children:[e.jsxs(U,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5 text-gray-600"}),"Available Items for Disposal (",x.length,")"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[N==="all"&&"Showing all available items",N==="custom_age"&&`Showing items older than ${m} days`,N==="inactive_storage"&&"Showing items in inactive storage locations"]})]}),e.jsx(_,{className:"max-h-96 overflow-y-auto",children:x.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Q,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No items found matching your criteria"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between bg-blue-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",x.length," items across ",new Set(x.map(s=>s.storage_location_name)).size," storage locations"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{variant:"outline",size:"sm",onClick:je,className:"text-xs",children:"Expand All"}),e.jsx(K,{variant:"outline",size:"sm",onClick:be,className:"text-xs",children:"Collapse All"})]})]}),Object.entries(x.reduce((s,o)=>{const n=o.storage_location_name;return s[n]||(s[n]=[]),s[n].push(o),s},{})).map(([s,o])=>{const n=k.has(s),j=o;return e.jsxs(w,{className:"border-2 border-gray-200",children:[e.jsxs(W,{className:"pb-3 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>fe(s),children:[e.jsxs(U,{className:"text-lg font-semibold text-gray-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n?e.jsx(Pe,{className:"w-4 h-4 text-gray-500"}):e.jsx(Ke,{className:"w-4 h-4 text-gray-500"}),e.jsx(ge,{className:"w-5 h-5 text-blue-600"}),s]}),e.jsxs(Y,{variant:"outline",className:"text-sm",children:[j.length," items"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Total Weight: ",(j.reduce((d,u)=>d+u.total_weight_grams,0)/1e3).toFixed(2)," kg"]})]}),n&&e.jsx(_,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 overflow-x-hidden",children:j.map(d=>e.jsx(w,{className:`cursor-pointer transition-all duration-200 hover:shadow-md ${C.includes(d.sorting_result_id)?"ring-2 ring-red-500 bg-red-50":"hover:bg-gray-50"}`,onClick:()=>ue(d.sorting_result_id),children:e.jsxs(_,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Y,{variant:"outline",className:"text-xs",children:d.batch_number}),e.jsxs(Y,{variant:"secondary",className:"text-xs",children:["Size ",d.size_class]})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Weight:"}),e.jsxs("span",{className:"font-medium",children:[(d.total_weight_grams/1e3).toFixed(2)," kg"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Age:"}),e.jsxs("span",{className:"font-medium",children:[d.days_in_storage," days"]})]})]}),C.includes(d.sorting_result_id)&&e.jsx("div",{className:"mt-2 text-center",children:e.jsx(Y,{className:"bg-red-600 text-white text-xs",children:"Selected"})})]})},d.sorting_result_id))})})]},s)})]})})]})]})]}),e.jsxs(Oe,{className:"flex-shrink-0 border-t pt-4",children:[e.jsx(K,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),N&&N!==""&&e.jsx(K,{onClick:he,className:"bg-red-600 hover:bg-red-700",disabled:L,children:L?"Processing...":"Create Disposal"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(w,{children:e.jsx(_,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Disposals"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.length})]}),e.jsx(Q,{className:"h-8 w-8 text-gray-400"})]})})}),e.jsx(w,{children:e.jsx(_,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Weight"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[(a.totalDisposedWeight||0).toFixed(1)," kg"]})]}),e.jsx(ae,{className:"h-8 w-8 text-gray-400"})]})})}),e.jsx(w,{children:e.jsx(_,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Cost"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["KES ",(a.totalDisposalCost||0).toFixed(2)]})]}),e.jsx(de,{className:"h-8 w-8 text-gray-400"})]})})}),e.jsx(w,{children:e.jsx(_,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.pendingDisposals||0})]}),e.jsx(me,{className:"h-8 w-8 text-gray-400"})]})})})]}),e.jsxs(w,{className:"mb-6",children:[e.jsx(W,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-blue-600"}),"Disposal Reports"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>se(!E),className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4"}),E?"Hide Reports":"Show Reports"]}),E&&e.jsxs(K,{variant:"outline",size:"sm",onClick:Ne,className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Export CSV"]})]})]})}),E&&e.jsxs(_,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx(H,{htmlFor:"reportFromDate",className:"text-sm font-semibold text-gray-700",children:"From Date"}),e.jsx(ee,{id:"reportFromDate",type:"date",value:q.from,onChange:s=>V(o=>re(oe({},o),{from:s.target.value})),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"reportToDate",className:"text-sm font-semibold text-gray-700",children:"To Date"}),e.jsx(ee,{id:"reportToDate",type:"date",value:q.to,onChange:s=>V(o=>re(oe({},o),{to:s.target.value})),className:"mt-1"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(K,{onClick:()=>{const s=new Date().toISOString().split("T")[0],o=new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0];V({from:o,to:s})},variant:"outline",size:"sm",className:"w-full",children:"Last 30 Days"})})]}),(()=>{const s=ie();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(w,{className:"bg-blue-50 border-blue-200",children:e.jsx(_,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Disposals"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:s.totalRecords})]}),e.jsx(Q,{className:"h-8 w-8 text-blue-400"})]})})}),e.jsx(w,{className:"bg-green-50 border-green-200",children:e.jsx(_,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Total Weight"}),e.jsxs("p",{className:"text-2xl font-bold text-green-900",children:[s.totalWeight.toFixed(1)," kg"]})]}),e.jsx(ae,{className:"h-8 w-8 text-green-400"})]})})}),e.jsx(w,{className:"bg-orange-50 border-orange-200",children:e.jsx(_,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Total Cost"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-900",children:["KES ",s.totalCost.toLocaleString()]})]}),e.jsx(He,{className:"h-8 w-8 text-orange-400"})]})})})]}),e.jsxs(w,{children:[e.jsx(W,{children:e.jsx(U,{className:"text-lg",children:"Disposal by Reason"})}),e.jsx(_,{children:Object.keys(s.reasonGroups).length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No disposals found for the selected date range"}):e.jsx("div",{className:"space-y-3",children:Object.entries(s.reasonGroups).map(([o,n])=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Y,{variant:"outline",className:"text-sm",children:[n.count," records"]}),e.jsx("span",{className:"font-medium text-gray-800",children:o})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[n.weight.toFixed(1)," kg â€¢ KES ",n.cost.toLocaleString()]})})]},o))})})]}),e.jsxs(w,{children:[e.jsx(W,{children:e.jsx(U,{className:"text-lg",children:"Recent Disposals"})}),e.jsx(_,{children:s.records.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No disposals found for the selected date range"}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Date"}),e.jsx("th",{className:"text-left p-2",children:"Reason"}),e.jsx("th",{className:"text-left p-2",children:"Weight (kg)"}),e.jsx("th",{className:"text-left p-2",children:"Cost (KES)"}),e.jsx("th",{className:"text-left p-2",children:"Status"})]})}),e.jsx("tbody",{children:s.records.slice(0,10).map(o=>{var n;return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2",children:new Date(o.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-2",children:typeof o.disposal_reason=="object"?((n=o.disposal_reason)==null?void 0:n.name)||"Unknown":o.disposal_reason||"Unknown"}),e.jsx("td",{className:"p-2",children:(o.total_weight_kg||0).toFixed(1)}),e.jsx("td",{className:"p-2",children:(o.disposal_cost||0).toLocaleString()}),e.jsx("td",{className:"p-2",children:e.jsx(Y,{variant:o.status==="completed"?"default":"secondary",children:o.status})})]},o.id)})})]}),s.records.length>10&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2 text-center",children:["Showing 10 of ",s.records.length," records"]})]})})]})]})})()]})]}),e.jsxs(w,{children:[e.jsx(W,{children:e.jsx(U,{children:"Disposal Records"})}),e.jsx(_,{children:r.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Q,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No disposal records found"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Date"}),e.jsx("th",{className:"text-left p-2",children:"Reason"}),e.jsx("th",{className:"text-left p-2",children:"Weight (kg)"}),e.jsx("th",{className:"text-left p-2",children:"Cost (KES)"}),e.jsx("th",{className:"text-left p-2",children:"Status"})]})}),e.jsx("tbody",{children:r.map(s=>{var o;return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-2",children:typeof s.disposal_reason=="object"?((o=s.disposal_reason)==null?void 0:o.name)||"Unknown":s.disposal_reason||"Unknown"}),e.jsx("td",{className:"p-2",children:s.total_weight_kg.toFixed(2)}),e.jsx("td",{className:"p-2",children:s.disposal_cost.toFixed(2)}),e.jsx("td",{className:"p-2",children:e.jsx(Y,{variant:s.status==="completed"?"default":"secondary",children:s.status})})]},s.id)})})]})})})]})]})]})};export{ps as default};
