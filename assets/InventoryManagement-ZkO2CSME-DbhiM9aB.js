import{w as c,s as Ue,u as e,d as V,f as w,r as je,a as Le,c as Ye,l as et,q as tt,o as $,m as xe,Z as fe,t as st,J as at,i as T,j as lt,N as it,b as nt}from"./index-Cx51dYQZ.js";import{H as ye,O as Ne,X as ve,_ as _e}from"./dialog-NtgNh5u1-2hJTriox.js";import{G as P}from"./inventoryService-gXyYRUkQ-CaNYK-Tu.js";import{R as rt}from"./sortingService-Dsc9Jscx-3rLBSyzC.js";import{p as ct}from"./textarea-TOFJikG_-C72QqR98.js";import{f as Ee}from"./checkbox-Caq1szpR-CvNcvjTY.js";import{a as K}from"./scale-Coap2kcd-Bsk2bCpZ.js";import{a as ge}from"./loader-circle-CqHSO3Z4-BnZJOCMy.js";import{y as Q}from"./circle-alert-DCgzIeFQ-JtILe7g3.js";import{t as me}from"./circle-check-big-BZ9nasO6-BWVBSi9U.js";import{h as Pe}from"./file-text-35uk4vLR-D2sbaJVA.js";import{i as de}from"./trending-up-DUO3gdV8-ywoZrOkl.js";import{r as ot}from"./search-BLXOOEcj-BfErFHpQ.js";import{a as dt}from"./refresh-cw-BlPh9kri-DxVFEABi.js";import{t as mt}from"./chart-pie-_gycINAl-BTkl_p_z.js";import{i as pe}from"./clock-sArWPAJm-BmsKQooK.js";import{e as xt}from"./award-DoBG6xPL-BvcxiUhY.js";import{i as gt}from"./index-io8wS31O-C_L8DqSR.js";import{e as ht}from"./chevron-right-DTnlI_34-Bu_ud7Vy.js";import"./index-CEgc-Zw--jggqibQ8.js";var G=(C,D,y)=>new Promise((N,U)=>{var L=g=>{try{B(y.next(g))}catch(O){U(O)}},A=g=>{try{B(y.throw(g))}catch(O){U(O)}},B=g=>g.done?N(g.value):Promise.resolve(g.value).then(L,A);B((y=y.apply(C,D)).next())});/**
* @license lucide-react v0.487.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const ut=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],bt=Le("bell",ut);/**
* @license lucide-react v0.487.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const pt=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],ae=Le("layers",pt);function jt({isOpen:C,onClose:D,sourceStorage:y,itemsToTransfer:N,onTransferComplete:U}){const{user:L}=Ue(),[A,B]=c.useState([]),[g,O]=c.useState(""),[X,we]=c.useState(""),[ze,z]=c.useState(!1),[H,v]=c.useState(null),[Y,b]=c.useState(null),[W,J]=c.useState(!1),[p,ee]=c.useState(new Set);c.useEffect(()=>{if(C){const l=new Set(N.map(m=>m.size));ee(l),v(null),b(null)}},[C,y.id,N]),c.useEffect(()=>{C&&p.size>0&&ke()},[p,C,y.id]);const M=N.filter(l=>p.has(l.size)).reduce((l,m)=>l+m.total_weight,0),q=N.filter(l=>p.has(l.size)).reduce((l,m)=>l+m.quantity,0),Z=l=>{ee(l?new Set(N.map(m=>m.size)):new Set)},le=(l,m)=>{const j=new Set(p);m?j.add(l):j.delete(l),ee(j)},ie=p.size===N.length;p.size>0;const ke=()=>G(this,null,function*(){z(!0),v(null);try{const l=yield P.getAvailableStorageLocationsForTransfer(y.id),m=N.filter(k=>p.has(k.size)).reduce((k,F)=>k+F.total_weight,0),j=l.filter(k=>{const F=k.available_capacity_kg>=m;return console.log(`${k.name}: ${k.available_capacity_kg}kg available, need ${m.toFixed(1)}kg - ${F?"SUITABLE":"NOT ENOUGH SPACE"}`),F});console.log(`Found ${j.length} suitable storage locations for ${m.toFixed(1)}kg transfer`),console.log("Suitable storages:",j),B(j),j.length===0?v(`No storage locations have enough capacity for this transfer. Total weight to transfer: ${m.toFixed(1)}kg`):console.log(`Found ${j.length} suitable storage locations for transfer`)}catch(l){console.error("Error loading available storages:",l),v(l.message||"Failed to load available storage locations")}finally{z(!1)}}),Se=()=>G(this,null,function*(){if(!W){if(!g){v("Please select a destination storage location");return}if(p.size===0){v("Please select at least one size to transfer");return}J(!0),v(null);try{console.log("Creating transfer request..."),console.log("Source storage:",y),console.log("Destination storage ID:",g),console.log("Selected sizes:",Array.from(p)),console.log("Items to transfer:",N.filter(S=>p.has(S.size)));const l=N.filter(S=>p.has(S.size)),m=l.reduce((S,E)=>S+E.quantity,0),j=l.reduce((S,E)=>S+E.total_weight,0);console.log(`Creating batch transfer for ${l.length} selected size classes, total quantity: ${m}, total weight: ${j}kg`);const k=l.map(S=>({size:S.size,quantity:1,weightKg:S.total_weight})),F=yield P.createBatchTransfer(y.id,g,k,`Transfer from ${y.name} - Sizes: ${Array.from(p).sort().join(", ")} - ${X||"No notes"}`,L==null?void 0:L.id);console.log("Batch transfer created:",F),b(`Transfer request created successfully for ${l.length} size${l.length!==1?"s":""}! Awaiting approval.`),U(),setTimeout(()=>{D()},600)}catch(l){console.error("Error creating transfer request:",l),l.message&&(l.message.includes("already exists")||l.message.includes("409"))?v("A transfer request for these items already exists. Please check the 'Transfer Approvals' section to review pending requests."):l.message&&l.message.includes("ERR_CONNECTION_CLOSED")?v("Connection error. Please check your internet connection and try again."):l.message&&l.message.includes("500")?v("Server error. Please try again in a moment."):l.message&&l.message.includes("insufficient")?v("Insufficient inventory for this transfer. Please check available quantities."):v(l.message||"Failed to create transfer request. Please try again.")}finally{J(!1)}}}),te=A.find(l=>l.id===g);return e.jsx(ye,{open:C,onOpenChange:D,children:e.jsxs(Ne,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(ve,{children:e.jsxs(_e,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),"Transfer Stock from ",y.name]})}),e.jsxs("div",{className:"space-y-6 overflow-y-auto flex-1 pr-2",children:[e.jsx($,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(je,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:y.name}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:y.location_type.replace("_"," ")})]}),e.jsx(xe,{variant:"default",className:"bg-green-100 text-green-800",children:"Active"})]})})}),e.jsx($,{children:e.jsxs(T,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Fish to Transfer (by Weight)"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ee,{id:"select-all",checked:ie,onCheckedChange:Z}),e.jsx("label",{htmlFor:"select-all",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Select All"})]})]}),e.jsxs("div",{className:"space-y-2",children:[N.map((l,m)=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${p.has(l.size)?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{id:`size-${l.size}`,checked:p.has(l.size),onCheckedChange:j=>le(l.size,j)}),e.jsxs(xe,{variant:"outline",className:"w-16 justify-center",children:["Size ",l.size]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[l.total_weight.toFixed(1),"kg"]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[l.quantity," pieces"]})]},m)),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Total Weight"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[q," pieces selected"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"font-bold text-green-600 text-lg",children:[M.toFixed(1),"kg"]})]})]})]})]})}),e.jsx($,{children:e.jsxs(T,{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Available Storage Locations"]}),ze?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ge,{className:"w-6 h-6 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading available storage locations..."})]}):H?e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-1 bg-red-100 rounded-full",children:e.jsx(Q,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-1",children:"Transfer Request Failed"}),e.jsx("p",{className:"text-sm text-red-700",children:H}),H.includes("already exists")&&e.jsx("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded",children:e.jsxs("p",{className:"text-xs text-blue-700",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"}),' Navigate to "Transfer Approvals" to review and approve existing requests.']})})]})]})}):A.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No suitable storage locations found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"All active storage locations are at capacity or don't have enough space"})]}):e.jsx("div",{className:"space-y-3",children:A.map(l=>e.jsx("div",{className:`p-4 border rounded-lg transition-all ${g===l.id?"border-blue-300 bg-blue-50 cursor-pointer":"border-gray-200 hover:border-blue-300 hover:bg-gray-50 cursor-pointer"}`,onClick:()=>{O(l.id)},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 ${g===l.id?"border-blue-600 bg-blue-600":"border-gray-300"}`,children:g===l.id&&e.jsx(me,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:l.name}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:l.location_type.replace("_"," ")})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(K,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[l.available_capacity_kg.toFixed(1),"kg available"]})]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-1",children:[l.current_usage_kg.toFixed(1),"kg / ",l.capacity_kg.toFixed(1),"kg used"]}),e.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["Need: ",M.toFixed(1),"kg"]}),e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2 mt-1",children:e.jsx("div",{className:`h-2 rounded-full ${l.utilization_percent>=90?"bg-red-500":l.utilization_percent>=70?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(l.utilization_percent,100)}%`}})})]})]})},l.id))})]})}),Y&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-1 bg-green-100 rounded-full",children:e.jsx(me,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-1",children:"Transfer Request Created"}),e.jsx("p",{className:"text-sm text-green-700",children:Y})]})]})}),e.jsx($,{children:e.jsxs(T,{className:"p-4",children:[e.jsx(nt,{htmlFor:"transfer-notes",className:"text-sm font-medium text-gray-700",children:"Transfer Notes (Optional)"}),e.jsx(ct,{id:"transfer-notes",placeholder:"Add notes about this transfer...",value:X,onChange:l=>we(l.target.value),className:"mt-2",rows:3})]})}),te&&e.jsx($,{className:"border-blue-200 bg-blue-50",children:e.jsxs(T,{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-blue-600"}),"Selected Destination"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:te.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Will have ",(te.available_capacity_kg-M).toFixed(1),"kg remaining after transfer"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-1",children:["Transfer: ",M.toFixed(1),"kg"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Current: ",te.utilization_percent.toFixed(1),"% used"]})]})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t",children:[e.jsx(w,{variant:"outline",onClick:D,disabled:W,children:"Cancel"}),e.jsx(w,{onClick:Se,disabled:!g||W||A.length===0||p.size===0,className:"bg-blue-600 hover:bg-blue-700",children:W?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-4 h-4 mr-2 animate-spin"}),"Transferring..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Transfer Stock"]})})]})]})})}function Wt({onNavigate:C}){var D,y,N,U,L,A,B,g,O,X;const[we,ze]=c.useState([]),[z,H]=c.useState([]),[v,Y]=c.useState([]),[b,W]=c.useState(null),[J,p]=c.useState(""),[ee,M]=c.useState(!1),[q,Z]=c.useState(null),[le,ie]=c.useState(!1),[ke,Se]=c.useState(null),[te,l]=c.useState(null),[m,j]=c.useState(!1),[k,F]=c.useState(null),[S,E]=c.useState([]),[Ce,We]=c.useState(new Set),[ft,yt]=c.useState(!1),[ne,he]=c.useState("grid"),[qe,Me]=c.useState("name"),[Fe,Re]=c.useState([]),[$e,Ve]=c.useState(null),[I,Te]=c.useState(null),[Ae,ue]=c.useState(!1),[Ie,Qe]=c.useState([]),[be,Ge]=c.useState([]),[re,De]=c.useState(!1),se=c.useCallback(()=>G(this,null,function*(){M(!0),Z(null);try{console.log("ðŸ” Fetching inventory data..."),console.log("ðŸ”— Testing database connection...");try{const s=yield P.getInventorySummary();console.log("âœ… Database connection successful, test data:",s)}catch(s){console.error("âŒ Database connection failed:",s)}const t=yield P.getInventoryByStorage();if(console.log("ðŸ“¦ Raw inventory data received:",t),console.log("ðŸ“Š Data structure analysis:",{totalItems:(t==null?void 0:t.length)||0,hasStorageLocationId:(t==null?void 0:t.some(s=>s.storage_location_id))||!1,hasSize:(t==null?void 0:t.some(s=>s.size!==null))||!1,hasQuantity:(t==null?void 0:t.some(s=>s.total_quantity>0))||!1,hasContributingBatches:(t==null?void 0:t.some(s=>s.contributing_batches&&s.contributing_batches.length>0))||!1,itemsWithBatches:(t==null?void 0:t.filter(s=>s.contributing_batches&&s.contributing_batches.length>0).length)||0,itemsWithoutBatches:(t==null?void 0:t.filter(s=>s.size!==null&&s.total_quantity>0&&(!s.contributing_batches||s.contributing_batches.length===0)).length)||0,sampleItem:(t==null?void 0:t[0])||null,sampleItemWithBatches:(t==null?void 0:t.find(s=>s.contributing_batches&&s.contributing_batches.length>0))||null,sampleItemWithoutBatches:(t==null?void 0:t.find(s=>s.size!==null&&s.total_quantity>0&&(!s.contributing_batches||s.contributing_batches.length===0)))||null}),t&&t.length>0){console.log("ðŸ” Detailed data analysis:"),console.log("ðŸ” Raw data structure check:",{isArray:Array.isArray(t),length:t.length,firstItem:t[0],firstItemKeys:t[0]?Object.keys(t[0]):null}),t.forEach((a,o)=>{var h;o<3&&console.log(`Item ${o+1}:`,{storage_location_id:a.storage_location_id,storage_location_name:a.storage_location_name,size:a.size,total_quantity:a.total_quantity,total_weight_kg:a.total_weight_kg,batch_count:a.batch_count,contributing_batches_count:((h=a.contributing_batches)==null?void 0:h.length)||0,contributing_batches:a.contributing_batches,capacity_kg:a.capacity_kg,current_usage_kg:a.current_usage_kg,utilization_percent:a.utilization_percent,status:a.status,allKeys:Object.keys(a)})});const s=t.filter(a=>a&&typeof a=="object").reduce((a,o)=>{try{const h=o.storage_location_name||o.storage_location_id||"Unknown";if(!h||typeof h!="string")return console.warn("âš ï¸ Invalid storage key:",h,"for item:",o),a;a[h]||(a[h]={totalItems:0,totalWeight:0,totalBatches:0,sizes:new Set,status:o.status||"unknown",capacity:o.capacity_kg||0,utilization:o.utilization_percent||0}),a[h]&&(a[h].totalItems+=1,a[h].totalWeight+=o.total_weight_kg||0,a[h].totalBatches+=o.batch_count||0,o.size!==null&&o.size!==void 0&&a[h].sizes.add(o.size))}catch(h){console.error("âŒ Error processing storage summary item:",h,"item:",o)}return a},{});console.log("ðŸ“Š Storage location summary:",s),console.log("âœ… Data validation results:");const x={hasValidData:t.length>0,hasStorageLocations:t.some(a=>a.storage_location_id),hasSizeData:t.some(a=>a.size!==null),hasWeightData:t.some(a=>a.total_weight_kg>0),hasBatchData:t.some(a=>a.contributing_batches&&a.contributing_batches.length>0),totalWeight:t.reduce((a,o)=>a+(o.total_weight_kg||0),0),totalBatches:t.reduce((a,o)=>a+(o.batch_count||0),0),uniqueSizes:[...new Set(t.map(a=>a.size).filter(a=>a!==null))].length,uniqueStorageLocations:[...new Set(t.map(a=>a.storage_location_name))].length};console.log("ðŸ“‹ Validation results:",x)}H(t||[]);const i=yield rt.getSortingBatches();console.log("ðŸ“¦ Sorting batches received:",i),Y(i||[]);const n=yield P.getOldestBatchForRemoval();console.log("ðŸ“¦ Oldest batches received:",n),console.log("ðŸ“¦ Oldest batches count:",(n==null?void 0:n.length)||0),n&&n.length>0&&console.log("ðŸ“¦ First oldest batch:",n[0]),Re(n||[]);const d=yield P.getSizeDemandStatistics();console.log("ðŸ“Š Size demand statistics received:",d),Qe(d||[]);const _=yield P.getPendingTransfers();console.log("ðŸ“¦ Pending transfers received:",_),Ge(_||[])}catch(t){console.error("âŒ Error fetching inventory:",t),console.error("âŒ Error details:",{message:t.message,stack:t.stack,error:t}),Z(t.message||"Failed to fetch inventory data"),H([]),Y([])}finally{M(!1)}}),[]),He=()=>G(this,null,function*(){ie(!0),yield se(),ie(!1)}),Je=t=>{if(t.status==="inactive"&&t.items.length>0){if(R(t.location_id)){const n=Be(t.location_id);Z(n);return}const i=t.items.map(n=>({size:n.size,quantity:n.quantity,total_weight:n.total_weight}));F({id:t.location_id,name:t.location,location_type:t.location_type}),E(i),j(!0)}},Ze=()=>G(this,null,function*(){yield se(),j(!1),F(null),E([]),console.log("Transfer request created successfully!")}),R=t=>be.some(i=>i.from_storage_location_id===t&&i.status==="pending"),Be=t=>{const i=be.filter(n=>n.from_storage_location_id===t&&n.status==="pending").length;return i>0?`Contact your admin for approval. ${i} transfer request${i>1?"s":""} already pending.`:""},Ke=t=>G(this,null,function*(){try{Ve(t),ue(!0);const i=yield P.getBatchDetails(t.batch_id);Te(i)}catch(i){console.error("Error fetching batch details:",i),Te(null)}});c.useEffect(()=>{se()},[se]);const f=c.useMemo(()=>{const t=new Map;z.forEach(r=>{r.storage_location_id&&!t.has(r.storage_location_id)&&t.set(r.storage_location_id,{id:r.storage_location_id,name:r.storage_location_name,type:r.storage_location_type,status:r.storage_status||"active",capacity_kg:r.capacity_kg||0,current_usage_kg:r.current_usage_kg||0,utilization_percent:r.utilization_percent||0})});const i=Array.from(t.values()),n=i.length,d=i.filter(r=>r.status==="active").length,_=i.reduce((r,u)=>r+(u.capacity_kg||0),0),s=i.reduce((r,u)=>r+(u.current_usage_kg||0),0),x=z.filter(r=>r.size!==null&&r.total_quantity>0&&r.contributing_batches&&r.contributing_batches.length>0).length,a=n>0?i.reduce((r,u)=>r+(u.utilization_percent||0),0)/n:0,o=z.reduce((r,u)=>(u.size!==null&&u.total_weight_kg>0&&(r[u.size]=(r[u.size]||0)+u.total_weight_kg),r),{});console.log("ðŸ“Š Size distribution (total across all storage):",o),console.log("ðŸ” Size 9 total weight:",o[9]||"NOT FOUND"),console.log("ðŸ” All sizes found:",Object.keys(o).map(Number).sort((r,u)=>r-u));const h=z.filter(r=>r.size===9);console.log("ðŸ” Size 9 items by storage:",h.map(r=>({storage:r.storage_location_name,weight:r.total_weight_kg})));const ce=new Map;z.forEach(r=>{if(r.storage_location_id&&r.total_weight_kg>0){const u=r.storage_location_id;ce.has(u)||ce.set(u,{storage_location_id:r.storage_location_id,storage_location_name:r.storage_location_name,total_weight_kg:0,utilization_percent:r.utilization_percent||0,capacity_kg:r.capacity_kg||0}),ce.get(u).total_weight_kg+=r.total_weight_kg}});const Oe=Array.from(ce.values()).sort((r,u)=>u.total_weight_kg-r.total_weight_kg).slice(0,3);console.log("ðŸ† Top storage units by total weight:",Oe);const oe=[];return a>85&&oe.push({type:"warning",message:"High overall utilization"}),d<n*.8&&oe.push({type:"info",message:"Some storage units inactive"}),s>_*.9&&oe.push({type:"error",message:"Near capacity limit"}),{totalStorage:n,activeStorage:d,totalCapacity:_,totalUsed:s,totalItems:x,avgUtilization:a,sizeDistribution:o,topStorage:Oe,alerts:oe}},[z]),Xe=c.useMemo(()=>{var t;const i={};z.forEach(s=>{var x;const a=s.storage_location_id||"unknown";if(i[a]||(i[a]={location:s.storage_location_name||"Unknown Storage",location_id:s.storage_location_id||"unknown",location_type:s.storage_location_type||"unknown",status:s.storage_status||"active",capacity_kg:s.capacity_kg||0,current_usage_kg:s.current_usage_kg||0,available_capacity_kg:s.available_capacity_kg||0,utilization_percent:s.utilization_percent||0,items:[]}),s.size===null||s.size!==null&&s.size!==void 0&&s.total_quantity>0){if(s.size===null)return;if(s.contributing_batches&&s.contributing_batches.length>0){const o=i[a].items.findIndex(h=>h.size===s.size);o>=0?(i[a].items[o].quantity+=s.total_quantity,i[a].items[o].total_weight+=s.total_weight_kg||0,i[a].items[o].contributing_batches=[...i[a].items[o].contributing_batches||[],...s.contributing_batches],i[a].items[o].batch_count=(i[a].items[o].batch_count||0)+(s.batch_count||0)):i[a].items.push({id:`${a}-${s.size}`,size:s.size,quantity:s.total_quantity,total_weight:s.total_weight_kg||0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),batch_count:s.batch_count||0,contributing_batches:s.contributing_batches||[]})}else console.warn("âš ï¸ Skipping inventory item without proper batch data:",{storage_location_id:s.storage_location_id,size:s.size,quantity:s.total_quantity,hasContributingBatches:s.contributing_batches&&s.contributing_batches.length>0,contributingBatchesCount:((x=s.contributing_batches)==null?void 0:x.length)||0})}}),Object.values(i).forEach(s=>{s.items.sort((x,a)=>x.size-a.size)});const n=Object.values(i),d=n.map(s=>s.location_id),_=d.filter((s,x)=>d.indexOf(s)!==x);return _.length>0&&console.warn("âš ï¸ Duplicate location IDs found:",_),console.log("ðŸ­ Processed storage units:",{totalUnits:n.length,unitsWithItems:n.filter(s=>s.items.length>0).length,totalItems:n.reduce((s,x)=>s+x.items.length,0),itemsWithBatches:n.reduce((s,x)=>s+x.items.filter(a=>a.contributing_batches&&a.contributing_batches.length>0).length,0),sampleUnit:n[0]||null,sampleItemWithBatches:((t=n.find(s=>s.items.some(x=>x.contributing_batches&&x.contributing_batches.length>0)))==null?void 0:t.items.find(s=>s.contributing_batches&&s.contributing_batches.length>0))||null,locationIds:d,duplicateIds:_}),console.log("ðŸ” Detailed processing analysis:"),n.forEach((s,x)=>{x<2&&console.log(`Storage Unit ${x+1} (${s.location}):`,{location_id:s.location_id,status:s.status,capacity_kg:s.capacity_kg,current_usage_kg:s.current_usage_kg,utilization_percent:s.utilization_percent,totalItems:s.items.length,items:s.items.map(a=>{var o;return{size:a.size,quantity:a.quantity,total_weight:a.total_weight,batch_count:a.batch_count,contributing_batches_count:((o=a.contributing_batches)==null?void 0:o.length)||0}})})}),n},[z]),{user:Nt}=Ue();return ee&&z.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-blue-600 font-medium",children:"Loading inventory..."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 content-container responsive-padding",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(V,{className:"h-6 w-6 md:h-8 md:w-8 text-blue-600"}),"Inventory Management"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage fish inventory across storage locations"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(w,{onClick:()=>C("transfers"),variant:"outline",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Transfer Approvals"]}),e.jsxs(w,{onClick:()=>C("dashboard"),variant:"outline",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(je,{className:"w-4 h-4"}),"Dashboard"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Storage"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:f.totalStorage})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(V,{className:"w-6 h-6 text-blue-600"})})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm",children:[e.jsxs("span",{className:"text-green-600 font-medium",children:[f.activeStorage," active"]}),e.jsx("span",{className:"text-gray-400 mx-2",children:"â€¢"}),e.jsxs("span",{className:"text-gray-500",children:[f.totalStorage-f.activeStorage," inactive"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Capacity"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[f.totalCapacity.toFixed(1),"kg"]})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(K,{className:"w-6 h-6 text-green-600"})})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[f.totalUsed.toFixed(1),"kg used"]}),e.jsx("span",{className:"text-gray-400 mx-2",children:"â€¢"}),e.jsxs("span",{className:"text-gray-500",children:[(f.totalCapacity-f.totalUsed).toFixed(1),"kg available"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Utilization"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:[f.avgUtilization.toFixed(1),"%"]})]}),e.jsx("div",{className:"p-3 bg-orange-100 rounded-lg",children:e.jsx(de,{className:"w-6 h-6 text-orange-600"})})]}),e.jsx("div",{className:"mt-2 flex items-center text-sm",children:f.avgUtilization>85?e.jsxs("span",{className:"text-red-600 font-medium flex items-center",children:[e.jsx(Q,{className:"w-4 h-4 mr-1"}),"High usage"]}):f.avgUtilization>70?e.jsxs("span",{className:"text-yellow-600 font-medium flex items-center",children:[e.jsx(Q,{className:"w-4 h-4 mr-1"}),"Moderate usage"]}):e.jsxs("span",{className:"text-green-600 font-medium flex items-center",children:[e.jsx(me,{className:"w-4 h-4 mr-1"}),"Optimal usage"]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Items"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:f.totalItems})]}),e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(ae,{className:"w-6 h-6 text-purple-600"})})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Size classes"}),e.jsx("span",{className:"text-gray-400 mx-2",children:"â€¢"}),e.jsxs("span",{className:"text-gray-500",children:["Across ",f.totalStorage," locations"]})]})]})]}),f.alerts.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(bt,{className:"w-5 h-5 text-amber-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"System Alerts"})]}),e.jsx("div",{className:"space-y-2",children:f.alerts.map((t,i)=>e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg ${t.type==="error"?"bg-red-50 border border-red-200":t.type==="warning"?"bg-yellow-50 border border-yellow-200":"bg-blue-50 border border-blue-200"}`,children:[e.jsx(Q,{className:`w-4 h-4 ${t.type==="error"?"text-red-600":t.type==="warning"?"text-yellow-600":"text-blue-600"}`}),e.jsx("span",{className:`text-sm font-medium ${t.type==="error"?"text-red-800":t.type==="warning"?"text-yellow-800":"text-blue-800"}`,children:t.message})]},i))})]}),q&&e.jsx("div",{className:`border rounded-lg p-4 ${q.includes("Contact your admin")?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:`w-5 h-5 ${q.includes("Contact your admin")?"text-yellow-600":"text-red-600"}`}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-medium ${q.includes("Contact your admin")?"text-yellow-800":"text-red-800"}`,children:q.includes("Contact your admin")?"Transfer Request Pending":"Error Loading Data"}),e.jsx("p",{className:`text-sm mt-1 ${q.includes("Contact your admin")?"text-yellow-700":"text-red-700"}`,children:q}),!q.includes("Contact your admin")&&e.jsx(w,{onClick:se,variant:"outline",size:"sm",className:"mt-2",children:"Try Again"}),q.includes("Contact your admin")&&e.jsx(w,{onClick:()=>C("transfers"),variant:"outline",size:"sm",className:"mt-2",children:"View Transfer Approvals"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsx("div",{className:"flex-1 w-full sm:max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(ot,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Ye,{placeholder:"Search storage locations...",value:J,onChange:t=>p(t.target.value),className:"pl-10 w-full"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(et,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:qe,onChange:t=>Me(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"capacity",children:"Sort by Capacity"}),e.jsx("option",{value:"utilization",children:"Sort by Utilization"}),e.jsx("option",{value:"items",children:"Sort by Items"})]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden",children:[e.jsx(w,{onClick:()=>he("grid"),variant:ne==="grid"?"default":"ghost",size:"sm",className:"rounded-none border-0 hover:bg-blue-50",title:"Grid View",children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx(w,{onClick:()=>he("list"),variant:ne==="list"?"default":"ghost",size:"sm",className:"rounded-none border-0 hover:bg-green-50",title:"List View",children:e.jsx(Pe,{className:"w-4 h-4"})}),e.jsx(w,{onClick:()=>he("analytics"),variant:ne==="analytics"?"default":"ghost",size:"sm",className:"rounded-none border-0 hover:bg-purple-50",title:"Analytics View",children:e.jsx(tt,{className:"w-4 h-4"})})]}),e.jsxs(w,{onClick:He,variant:"outline",size:"sm",disabled:le,className:"flex-1 sm:flex-none",children:[e.jsx(dt,{className:`w-4 h-4 mr-2 ${le?"animate-spin":""}`}),"Refresh"]})]})]})}),ne==="analytics"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(mt,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Size Distribution"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Total across all storage locations"})]})]}),e.jsx("div",{className:"space-y-3",children:Object.entries(f.sizeDistribution).sort(([,t],[,i])=>i-t).slice(0,12).map(([t,i])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:t})}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Size ",t]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${i/Math.max(...Object.values(f.sizeDistribution).map(n=>n))*100}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-600 w-16 text-right",children:[i.toFixed(1),"kg"]})]})]},t))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(pe,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Oldest Batches (FIFO)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Next batches to be removed"})]})]}),e.jsxs("div",{className:"space-y-3",children:[Fe.slice(0,5).map((t,i)=>{var n;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 rounded-lg border border-orange-200 cursor-pointer hover:bg-orange-100 transition-colors",onClick:()=>Ke(t),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-semibold text-orange-600",children:["#",i+1]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Batch ",t.batch_number]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Size ",t.size_class," â€¢ ",t.days_in_storage," days old"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-orange-600",children:[(n=t.total_weight_kg)==null?void 0:n.toFixed(1),"kg"]}),e.jsx("p",{className:"text-xs text-orange-500 mt-1",children:"Click to view details"})]})]},t.batch_id)}),Fe.length===0&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(pe,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No batches available for removal"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Check console for debugging info"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(de,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Size Demand Statistics"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Based on outlet orders (most requested first)"})]})]}),e.jsxs("div",{className:"space-y-3",children:[Ie.slice(0,8).map((t,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-semibold text-purple-600",children:["#",i+1]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Size ",t.size_class]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.total_orders," orders â€¢ ",t.unique_outlets," outlets â€¢",t.days_span>0?`${t.days_span} days span`:"Recent"]}),e.jsxs("p",{className:"text-xs text-purple-600",children:["Grade ",t.most_requested_grade," preferred"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-purple-600",children:[t.total_weight_kg_requested.toFixed(1),"kg"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"total requested"})]})]},t.size_class)),Ie.length===0&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(de,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No size demand data available"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(xt,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Top Storage Units"}),e.jsx("p",{className:"text-xs text-gray-500",children:"By total weight across all sizes"})]})]}),e.jsx("div",{className:"space-y-3",children:f.topStorage.map((t,i)=>{var n,d;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${i===0?"bg-yellow-100 text-yellow-600":i===1?"bg-gray-100 text-gray-600":"bg-orange-100 text-orange-600"}`,children:e.jsxs("span",{className:"text-sm font-bold",children:["#",i+1]})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.storage_location_name||`Storage Unit ${i+1}`}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(n=t.utilization_percent)==null?void 0:n.toFixed(1),"% utilized"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-600",children:[(d=t.total_weight_kg)==null?void 0:d.toFixed(1),"kg"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"total weight"})]})]},`top-storage-${t.storage_location_id}-${i}`)})})]})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:Xe.filter(t=>!J||t.location.toLowerCase().includes(J.toLowerCase())).sort((t,i)=>{switch(qe){case"capacity":return i.capacity_kg-t.capacity_kg;case"utilization":return i.utilization_percent-t.utilization_percent;case"items":return i.items.length-t.items.length;default:return t.location.localeCompare(i.location)}}).map((t,i)=>{const n=Ce.has(t.location_id);return e.jsxs($,{className:"card-shadow",children:[e.jsxs("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>{const d=new Set(Ce);n?d.delete(t.location_id):d.add(t.location_id),We(d)},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n?e.jsx(gt,{className:"w-5 h-5 text-gray-400"}):e.jsx(ht,{className:"w-5 h-5 text-gray-400"}),e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(V,{className:"w-5 h-5 text-blue-600"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.location}),R(t.location_id)&&e.jsxs(xe,{variant:"destructive",className:"text-xs",children:[be.filter(d=>d.from_storage_location_id===t.location_id&&d.status==="pending").length," Pending"]})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.location_type," â€¢ ",t.items.length," size classes"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[t.current_usage_kg.toFixed(1),"kg / ",t.capacity_kg,"kg"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.utilization_percent.toFixed(1),"% utilized"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.utilization_percent>=95&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs",children:[e.jsx(Q,{className:"w-3 h-3"}),e.jsx("span",{children:"Full"})]}),e.jsx(xe,{variant:t.status==="active"?"default":"secondary",className:t.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:t.status}),t.status==="inactive"&&t.items.length>0&&e.jsxs(w,{onClick:d=>{d.stopPropagation(),Je(t)},variant:"outline",size:"sm",className:`${R(t.location_id)?"text-red-600 border-red-200 hover:bg-red-50":"text-orange-600 border-orange-200 hover:bg-orange-50"}`,children:[e.jsx(fe,{className:"w-4 h-4 mr-1"}),R(t.location_id)?"Pending Transfer":"Transfer"]}),t.status==="active"&&t.items.length>0&&e.jsx(w,{onClick:d=>G(this,null,function*(){if(d.stopPropagation(),!re){if(R(t.location_id)){const _=Be(t.location_id);Z(_);return}De(!0);try{const _=t.items.map(s=>({size:s.size,quantity:s.quantity,total_weight:s.total_weight}));F({id:t.location_id,name:t.location,location_type:t.location_type}),E(_),j(!0)}finally{De(!1)}}}),disabled:re,variant:"outline",size:"sm",className:`${R(t.location_id)?"text-red-600 border-red-200 hover:bg-red-50":"text-blue-600 border-blue-200 hover:bg-blue-50"} ${re?"opacity-50 cursor-not-allowed":""}`,children:re?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-4 h-4 mr-1 animate-spin"}),"Opening..."]}):e.jsxs(e.Fragment,{children:[e.jsx(st,{className:"w-4 h-4 mr-1"}),R(t.location_id)?"Pending Transfer":"Quick Transfer"]})})]})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Capacity"}),e.jsxs("span",{className:`text-xs font-medium ${t.utilization_percent>=95?"text-red-600":t.utilization_percent>80?"text-yellow-600":"text-green-600"}`,children:[t.utilization_percent.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-500 ease-out ${t.utilization_percent>=95?"bg-gradient-to-r from-red-400 to-red-600":t.utilization_percent>80?"bg-gradient-to-r from-yellow-400 to-yellow-600":"bg-gradient-to-r from-green-400 to-green-600"}`,style:{width:`${t.utilization_percent>=95?100:Math.min(t.utilization_percent,100)}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsx("span",{children:"0kg"}),e.jsxs("span",{children:[t.capacity_kg,"kg"]})]})]})]}),n&&e.jsx("div",{className:"border-t border-gray-100 p-4",children:t.items.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No inventory items"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Inventory Items"}),t.items.map(d=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>W(d),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:d.size})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Size ",d.size]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[d.batch_count," batch",d.batch_count!==1?"es":""]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-600",children:[d.total_weight.toFixed(1),"kg"]}),e.jsx(at,{className:"w-4 h-4 text-gray-400"})]})]},d.id))]})})]},`${t.location_id}-${i}`)})}),b&&e.jsx(ye,{open:!!b,onOpenChange:()=>W(null),children:e.jsxs(Ne,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(ve,{children:e.jsxs(_e,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Size ",b.size," - Inventory Details"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx($,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Quantity"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:b.quantity})]})]})})}),e.jsx($,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Weight"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[b.total_weight.toFixed(1),"kg"]})]})]})})}),e.jsx($,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Weight/Fish"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[b.quantity>0?(b.total_weight/b.quantity).toFixed(2):"0.00","kg"]})]})]})})}),e.jsx($,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Contributing Batches"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:b.batch_count||((D=b.contributing_batches)==null?void 0:D.length)||0})]})]})})})]}),e.jsxs($,{children:[e.jsx(lt,{children:e.jsxs(it,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Contributing Batches",b.contributing_batches&&b.contributing_batches.length>6&&e.jsx("span",{className:"text-sm text-gray-500 font-normal ml-2",children:"(scroll to see all)"})]})}),e.jsx(T,{children:e.jsx("div",{className:"border border-gray-200 rounded-lg bg-gray-50 max-h-[500px] overflow-y-auto",children:e.jsx("div",{className:"p-4 space-y-4",children:b.contributing_batches&&b.contributing_batches.length>0?b.contributing_batches.map((t,i)=>{var n;return e.jsx("div",{className:"p-4 border border-gray-300 rounded-lg bg-white shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Batch Number"}),e.jsx("p",{className:"font-semibold text-gray-900",children:t.batch_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Weight Added"}),e.jsxs("p",{className:"font-semibold text-green-600 text-lg",children:[(n=t.weight_kg)==null?void 0:n.toFixed(1),"kg"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Quantity Added"}),e.jsxs("p",{className:"font-semibold text-gray-500",children:["Batch #",t.batch_number]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Storage Location"}),e.jsx("p",{className:"font-semibold text-gray-900",children:t.storage_location_name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Farmer"}),e.jsx("p",{className:"font-semibold text-gray-900",children:t.farmer_name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Processing Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:t.processing_date||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Added Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:new Date(t.added_date).toLocaleDateString()})]})]})},t.batch_id||i)}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ae,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No contributing batches found"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"This may indicate that the data is still being processed or there's an issue with the batch tracking."})]})})})})]})]})]})}),m&&k&&e.jsx(jt,{isOpen:m,onClose:()=>{j(!1),F(null),E([])},sourceStorage:k,itemsToTransfer:S,onTransferComplete:Ze}),Ae&&e.jsx(ye,{open:Ae,onOpenChange:ue,children:e.jsxs(Ne,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(ve,{className:"flex-shrink-0",children:e.jsxs(_e,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-orange-600"}),"Batch Details - ",$e==null?void 0:$e.batch_number]})}),I?e.jsxs("div",{className:"space-y-6 overflow-y-auto flex-1 pr-2",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Batch Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Batch Number"}),e.jsx("p",{className:"font-semibold text-gray-900",children:(y=I.batch)==null?void 0:y.batch_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Created Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:(N=I.batch)!=null&&N.created_at?new Date(I.batch.created_at).toLocaleDateString():"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Processing Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:((L=(U=I.batch)==null?void 0:U.processing_record)==null?void 0:L.processing_date)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Farmer"}),e.jsx("p",{className:"font-semibold text-gray-900",children:((O=(g=(B=(A=I.batch)==null?void 0:A.processing_record)==null?void 0:B.warehouse_entry)==null?void 0:g.farmers)==null?void 0:O.name)||"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Available Sizes (Not Ordered)"}),e.jsxs("div",{className:"space-y-3",children:[(X=I.sizes)==null?void 0:X.map((t,i)=>{var n;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:t.size_class})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Size ",t.size_class]}),e.jsx("p",{className:"text-sm text-gray-500",children:t.storage_location_name})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-blue-600",children:[(n=t.total_weight_kg)==null?void 0:n.toFixed(1),"kg"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Available"})]})]},i)}),(!I.sizes||I.sizes.length===0)&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(V,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"All sizes in this batch have been ordered"})]})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ge,{className:"w-8 h-8 mx-auto mb-2 text-gray-400 animate-spin"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading batch details..."})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200 flex-shrink-0",children:e.jsx(w,{onClick:()=>ue(!1),variant:"outline",className:"px-6",children:"Close"})})]})})]})})}export{Wt as default};
